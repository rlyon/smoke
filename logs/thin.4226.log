>> Writing PID to tmp/pids/thin.4226.pid
>> Using rack adapter
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /?prefix=path/to/my/S3 HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:nn55a5jMcW3LFGzAwuhHaRwT460=
x-amz-date: Sun, 27 Nov 2011 19:50:46 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 9604
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
  <Contents>
    <Key>path/to/my/S3/ACL.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T19:47:12.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>e2ee17326aea0c8c74d0a31b0c7dfc7b</ETag>
    <Size>27438</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>ca96f077e306796fc09a44c52dc350cb</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.py</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T19:47:13.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
	
</ListBucketResult>
GET /path/to/my/S3/AccessLog.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:BoxvW8Is7NveCLr9RtETWWDrnGo=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/x-python;charset=utf-8
ETag: "8eb7d0e65af11d814281c2752b37871b"
Last-Modified: Sun, 27 Nov 2011 03:52:45 GMT
Content-Length: 2551
Connection: close
Server: thin 1.3.1 codename Triple Espresso

## Amazon S3 - Access Control List representation
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import S3Uri
from Exceptions import ParameterError
from Utils import getTreeFromXml
from ACL import GranteeAnonRead

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

__all__ = []
class AccessLog(object):
	LOG_DISABLED = "<BucketLoggingStatus></BucketLoggingStatus>"
	LOG_TEMPLATE = "<LoggingEnabled><TargetBucket></TargetBucket><TargetPrefix></TargetPrefix></LoggingEnabled>"

	def __init__(self, xml = None):
		if not xml:
			xml = self.LOG_DISABLED
		self.tree = getTreeFromXml(xml)
		self.tree.attrib['xmlns'] = "http://doc.s3.amazonaws.com/2006-03-01"
	
	def isLoggingEnabled(self):
		return bool(self.tree.find(".//LoggingEnabled"))

	def disableLogging(self):
		el = self.tree.find(".//LoggingEnabled")
		if el:
			self.tree.remove(el)
	
	def enableLogging(self, target_prefix_uri):
		el = self.tree.find(".//LoggingEnabled")
		if not el:
			el = getTreeFromXml(self.LOG_TEMPLATE)
			self.tree.append(el)
		el.find(".//TargetBucket").text = target_prefix_uri.bucket()
		el.find(".//TargetPrefix").text = target_prefix_uri.object()

	def targetPrefix(self):
		if self.isLoggingEnabled():
			el = self.tree.find(".//LoggingEnabled")
			target_prefix = "s3://%s/%s" % (
				self.tree.find(".//LoggingEnabled//TargetBucket").text, 
				self.tree.find(".//LoggingEnabled//TargetPrefix").text)
			return S3Uri.S3Uri(target_prefix)
		else:
			return ""

	def setAclPublic(self, acl_public):
		le = self.tree.find(".//LoggingEnabled")
		if not le:
			raise ParameterError("Logging not enabled, can't set default ACL for logs")
		tg = le.find(".//TargetGrants")
		if not acl_public:
			if not tg:
				## All good, it's not been there
				return
			else:
				le.remove(tg)
		else: # acl_public == True
			anon_read = GranteeAnonRead().getElement()
			if not tg:
				tg = ET.SubElement(le, "TargetGrants")
			## What if TargetGrants already exists? We should check if 
			## AnonRead is there before appending a new one. Later...
			tg.append(anon_read)

	def isAclPublic(self):
		raise NotImplementedError()

	def __str__(self):
		return ET.tostring(self.tree)
__all__.append("AccessLog")

if __name__ == "__main__":
	from S3Uri import S3Uri
	log = AccessLog()
	print log
	log.enableLogging(S3Uri("s3://targetbucket/prefix/log-"))
	print log
	log.setAclPublic(True)
	print log
	log.setAclPublic(False)
	print log
	log.disableLogging()
	print log
GET /path/to/my/S3/BidirMap.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:62tbZaAttLVS639Msk/6zfk7sU0=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: application/x-python-code
ETag: "fbb9d1c3e06198a40649ac6cb0756199"
Last-Modified: Sun, 27 Nov 2011 03:52:46 GMT
Content-Length: 2038
Connection: close
Server: thin 1.3.1 codename Triple Espresso

—Ú
ÌsÒMc           @   s   d  e  f d Ñ  É  YZ d S(   t   BidirMapc           B   sP   e  Z d  Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 RS(   c         K   s;   h  |  _  h  |  _ x" | D] } |  i | | | É q Wd  S(   N(   t   k2vt   v2kt   __setitem__(   t   selft   mapt   key(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   __init__   s
    		 c         C   sß   |  i  i | É oK |  i  | | j o3 t d t | É d t |  i  | É d É Ç q^ n y |  i  |  i | =Wn t j
 o n X| |  i | <| |  i  | <d  S(   Ns   Value 's   ' already in use with key 't   '(   R   t   has_keyt   KeyErrort   strR   (   R   R   t   value(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyR      s    7c         C   s   |  i  | S(   N(   R   (   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   __getitem__   s    c         C   s   |  i  i É  S(   N(   R   t   __str__(   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyR      s    c         C   s   |  i  | S(   N(   R   (   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   getkey   s    c         C   s   |  i  | S(   N(   R   (   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   getvalue!   s    c         C   s"   g  } |  i  D] } | | q ~ S(   N(   R   (   R   t   _[1]R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   keys$   s    c         C   s"   g  } |  i  D] } | | q ~ S(   N(   R   (   R   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   values'   s    (
   t   __name__t
   __module__R   R   R   R   R   R   R   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyR       s   							N(   t   objectR    (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/BidirMap.pyt   <module>   s    
GET /path/to/my/S3/Config.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:HqaKvopBUmSyr9R8/78PYPL5jo0=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/x-python;charset=utf-8
ETag: "6c103d7c5d2b16bf454852c2fbeb8707"
Last-Modified: Sun, 27 Nov 2011 03:52:51 GMT
Content-Length: 6174
Connection: close
Server: thin 1.3.1 codename Triple Espresso

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import logging
from logging import debug, info, warning, error
import re
import Progress
from SortedDict import SortedDict

class Config(object):
	_instance = None
	_parsed_files = []
	_doc = {}
	access_key = ""
	secret_key = ""
	host_base = "s3.amazonaws.com"
	host_bucket = "%(bucket)s.s3.amazonaws.com"
	simpledb_host = "sdb.amazonaws.com"
	cloudfront_host = "cloudfront.amazonaws.com"
	cloudfront_resource = "/2010-07-15/distribution"
	verbosity = logging.WARNING
	progress_meter = True
	progress_class = Progress.ProgressCR
	send_chunk = 4096
	recv_chunk = 4096
	list_md5 = False
	human_readable_sizes = False
	extra_headers = SortedDict(ignore_case = True)
	force = False
	enable = None
	get_continue = False
	skip_existing = False
	recursive = False
	acl_public = None
	acl_grants = []
	acl_revokes = []
	proxy_host = ""
	proxy_port = 3128
	encrypt = False
	dry_run = False
	preserve_attrs = True
	preserve_attrs_list = [ 
		'uname',	# Verbose owner Name (e.g. 'root')
		'uid',		# Numeric user ID (e.g. 0)
		'gname',	# Group name (e.g. 'users')
		'gid',		# Numeric group ID (e.g. 100)
		'atime',	# Last access timestamp
		'mtime',	# Modification timestamp
		'ctime',	# Creation timestamp
		'mode',		# File mode (e.g. rwxr-xr-x = 755)
		#'acl',		# Full ACL (not yet supported)
	]
	delete_removed = False
	_doc['delete_removed'] = "[sync] Remove remote S3 objects when local file has been deleted"
	gpg_passphrase = ""
	gpg_command = ""
	gpg_encrypt = "%(gpg_command)s -c --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)s"
	gpg_decrypt = "%(gpg_command)s -d --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)s"
	use_https = False
	bucket_location = "US"
	default_mime_type = "binary/octet-stream"
	guess_mime_type = True
	# List of checks to be performed for 'sync'
	sync_checks = ['size', 'md5']	# 'weak-timestamp'
	# List of compiled REGEXPs
	exclude = []
	include = []
	# Dict mapping compiled REGEXPs back to their textual form
	debug_exclude = {}
	debug_include = {}
	encoding = "utf-8"
	urlencoding_mode = "normal"
	log_target_prefix = ""
	reduced_redundancy = False
	follow_symlinks = False
	socket_timeout = 300

	## Creating a singleton
	def __new__(self, configfile = None):
		if self._instance is None:
			self._instance = object.__new__(self)
		return self._instance

	def __init__(self, configfile = None):
		if configfile:
			self.read_config_file(configfile)

	def option_list(self):
		retval = []
		for option in dir(self):
			## Skip attributes that start with underscore or are not string, int or bool
			option_type = type(getattr(Config, option))
			if option.startswith("_") or \
			   not (option_type in (
			   		type("string"),	# str
			        	type(42),	# int
					type(True))):	# bool
				continue
			retval.append(option)
		return retval

	def read_config_file(self, configfile):
		cp = ConfigParser(configfile)
		for option in self.option_list():
			self.update_option(option, cp.get(option))
		self._parsed_files.append(configfile)

	def dump_config(self, stream):
		ConfigDumper(stream).dump("default", self)

	def update_option(self, option, value):
		if value is None:
			return
		#### Special treatment of some options
		## verbosity must be known to "logging" module
		if option == "verbosity":
			try:
				setattr(Config, "verbosity", logging._levelNames[value])
			except KeyError:
				error("Config: verbosity level '%s' is not valid" % value)
		## allow yes/no, true/false, on/off and 1/0 for boolean options
		elif type(getattr(Config, option)) is type(True):	# bool
			if str(value).lower() in ("true", "yes", "on", "1"):
				setattr(Config, option, True)
			elif str(value).lower() in ("false", "no", "off", "0"):
				setattr(Config, option, False)
			else:
				error("Config: value of option '%s' must be Yes or No, not '%s'" % (option, value))
		elif type(getattr(Config, option)) is type(42):		# int
			try:
				setattr(Config, option, int(value))
			except ValueError, e:
				error("Config: value of option '%s' must be an integer, not '%s'" % (option, value))
		else:							# string
			setattr(Config, option, value)

class ConfigParser(object):
	def __init__(self, file, sections = []):
		self.cfg = {}
		self.parse_file(file, sections)
	
	def parse_file(self, file, sections = []):
		debug("ConfigParser: Reading file '%s'" % file)
		if type(sections) != type([]):
			sections = [sections]
		in_our_section = True
		f = open(file, "r")
		r_comment = re.compile("^\s*#.*")
		r_empty = re.compile("^\s*$")
		r_section = re.compile("^\[([^\]]+)\]")
		r_data = re.compile("^\s*(?P<key>\w+)\s*=\s*(?P<value>.*)")
		r_quotes = re.compile("^\"(.*)\"\s*$")
		for line in f:
			if r_comment.match(line) or r_empty.match(line):
				continue
			is_section = r_section.match(line)
			if is_section:
				section = is_section.groups()[0]
				in_our_section = (section in sections) or (len(sections) == 0)
				continue
			is_data = r_data.match(line)
			if is_data and in_our_section:
				data = is_data.groupdict()
				if r_quotes.match(data["value"]):
					data["value"] = data["value"][1:-1]
				self.__setitem__(data["key"], data["value"])
				if data["key"] in ("access_key", "secret_key", "gpg_passphrase"):
					print_value = (data["value"][:2]+"...%d_chars..."+data["value"][-1:]) % (len(data["value"]) - 3)
				else:
					print_value = data["value"]
				debug("ConfigParser: %s->%s" % (data["key"], print_value))
				continue
			warning("Ignoring invalid line in '%s': %s" % (file, line))

	def __getitem__(self, name):
		return self.cfg[name]
	
	def __setitem__(self, name, value):
		self.cfg[name] = value
	
	def get(self, name, default = None):
		if self.cfg.has_key(name):
			return self.cfg[name]
		return default

class ConfigDumper(object):
	def __init__(self, stream):
		self.stream = stream

	def dump(self, section, config):
		self.stream.write("[%s]\n" % section)
		for option in config.option_list():
			self.stream.write("%s = %s\n" % (option, getattr(config, option)))

GET /path/to/my/S3/Exceptions.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:uJX0QubrXA0nsFxSIv74FsLHOeA=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: application/x-python-code
ETag: "9513f99a0b242973c795bb5811fcf25c"
Last-Modified: Sun, 27 Nov 2011 03:52:51 GMT
Content-Length: 4104
Connection: close
Server: thin 1.3.1 codename Triple Espresso

—Ú
ÌsÒMc        	   @   s-  d  d k  l Z l Z l Z d  d k l Z l Z l Z l Z y d  d k	 i
 i Z Wn" e j
 o d  d k i Z n Xd e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d	 Ñ  É  YZ d
 e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d S(   iˇˇˇˇ(   t   getTreeFromXmlt	   unicodiset   deunicodise(   t   debugt   infot   warningt   errorNt   S3Exceptionc           B   sG   e  Z d  d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z e e e É Z RS(   t    c         C   s   t  | É |  _ d  S(   N(   R   t   message(   t   selfR	   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   __init__   s    c         C   s   t  t |  É É S(   N(   R   t   unicode(   R
   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   __str__   s    c         C   s   |  i  S(   N(   R	   (   R
   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   __unicode__   s    c         C   s   |  i  S(   N(   t   _message(   R
   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   _get_message   s    c         C   s   | |  _  d  S(   N(   R   (   R
   R	   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   _set_message   s    (	   t   __name__t
   __module__R   R   R   R   R   t   propertyR	   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR      s   				t   S3Errorc           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   sx  | d |  _  | d |  _ h d d 6d d 6d d 6|  _ t d |  i  |  i f É | i d É o5 x2 | d D]" } t d	 | | d | f É qm Wn | i d
 É où t | d
 É } | } | i d j p | i d É } n xa | i É  D]O } | i	 d j o9 t d | i d t
 | i	 É É | i	 |  i | i <qÌ qÌ Wn |  i d |  _ |  i d |  _ |  i d |  _ d  S(   Nt   statust   reasonR   t   Codet   Messaget   Resources   S3Error: %s (%s)t   headerss   HttpHeader: %s: %st   datat   Errors   .//Errors
   ErrorXML: s   : (   R   R   R   R   t   has_keyR    t   tagt   findt   getchildrent   textt   reprt   codeR	   t   resource(   R
   t   responset   headert   treet
   error_nodet   child(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR   #   s0     $ "c         C   so   d |  i  } | d |  i i d É o |  i d p |  i 7} |  i i d É o | d |  i d 7} n | S(   Nu   %d u   (%s)R   R   u   : %s(   R   R   R   R   (   R
   t   retval(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR   <   s
    2(   R   R   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR   "   s   	t   CloudFrontErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR,   C   s   t   S3UploadErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR-   F   s   t   S3DownloadErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR.   I   s   t   S3RequestErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR/   L   s   t   InvalidFileErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR0   O   s   t   ParameterErrorc           B   s   e  Z RS(    (   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyR1   R   s   (   t   UtilsR    R   R   t   loggingR   R   R   R   t   xml.etree.ElementTreet   etreet   ElementTreet   ETt   ImportErrort   elementtree.ElementTreet	   ExceptionR   R   R,   R-   R.   R/   R0   R1   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/Exceptions.pyt   <module>   s   "!
GET /path/to/my/S3/Progress.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:xFauNRj02IFYV2rf+kOAfc/hnzQ=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/x-python;charset=utf-8
ETag: "9c38d2dfc83c701f8e3e62e771002278"
Last-Modified: Sun, 27 Nov 2011 03:52:56 GMT
Content-Length: 5193
Connection: close
Server: thin 1.3.1 codename Triple Espresso

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import sys
import datetime
import Utils

class Progress(object):
	_stdout = sys.stdout

	def __init__(self, labels, total_size):
		self._stdout = sys.stdout
		self.new_file(labels, total_size)
	
	def new_file(self, labels, total_size):
		self.labels = labels
		self.total_size = total_size
		# Set initial_position to something in the
		# case we're not counting from 0. For instance
		# when appending to a partially downloaded file.
		# Setting initial_position will let the speed
		# be computed right.
		self.initial_position = 0
		self.current_position = self.initial_position
		self.time_start = datetime.datetime.now()
		self.time_last = self.time_start
		self.time_current = self.time_start

		self.display(new_file = True)
	
	def update(self, current_position = -1, delta_position = -1):
		self.time_last = self.time_current
		self.time_current = datetime.datetime.now()
		if current_position > -1:
			self.current_position = current_position
		elif delta_position > -1:
			self.current_position += delta_position
		#else:
		#	no update, just call display()
		self.display()

	def done(self, message):
		self.display(done_message = message)

	def output_labels(self):
		self._stdout.write(u"%(source)s -> %(destination)s  %(extra)s\n" % self.labels)
		self._stdout.flush()

	def display(self, new_file = False, done_message = None):
		"""
		display(new_file = False[/True], done = False[/True])

		Override this method to provide a nicer output.
		"""
		if new_file:
			self.output_labels()
			self.last_milestone = 0
			return

		if self.current_position == self.total_size:
			print_size = Utils.formatSize(self.current_position, True)
			if print_size[1] != "": print_size[1] += "B"
			timedelta = self.time_current - self.time_start
			sec_elapsed = timedelta.days * 86400 + timedelta.seconds + float(timedelta.microseconds)/1000000.0
			print_speed = Utils.formatSize((self.current_position - self.initial_position) / sec_elapsed, True, True)
			self._stdout.write("100%%  %s%s in %.2fs (%.2f %sB/s)\n" % 
				(print_size[0], print_size[1], sec_elapsed, print_speed[0], print_speed[1]))
			self._stdout.flush()
			return

		rel_position = selfself.current_position * 100 / self.total_size
		if rel_position >= self.last_milestone:
			self.last_milestone = (int(rel_position) / 5) * 5
			self._stdout.write("%d%% ", self.last_milestone)
			self._stdout.flush()
			return

class ProgressANSI(Progress):
    ## http://en.wikipedia.org/wiki/ANSI_escape_code
	SCI = '\x1b['
	ANSI_hide_cursor = SCI + "?25l"
	ANSI_show_cursor = SCI + "?25h"
	ANSI_save_cursor_pos = SCI + "s"
	ANSI_restore_cursor_pos = SCI + "u"
	ANSI_move_cursor_to_column = SCI + "%uG"
	ANSI_erase_to_eol = SCI + "0K"
	ANSI_erase_current_line = SCI + "2K"

	def display(self, new_file = False, done_message = None):
		"""
		display(new_file = False[/True], done_message = None)
		"""
		if new_file:
			self.output_labels()
			self._stdout.write(self.ANSI_save_cursor_pos)
			self._stdout.flush()
			return

		timedelta = self.time_current - self.time_start
		sec_elapsed = timedelta.days * 86400 + timedelta.seconds + float(timedelta.microseconds)/1000000.0
		if (sec_elapsed > 0):
			print_speed = Utils.formatSize((self.current_position - self.initial_position) / sec_elapsed, True, True)
		else:
			print_speed = (0, "")
		self._stdout.write(self.ANSI_restore_cursor_pos)
		self._stdout.write(self.ANSI_erase_to_eol)
		self._stdout.write("%(current)s of %(total)s   %(percent)3d%% in %(elapsed)ds  %(speed).2f %(speed_coeff)sB/s" % {
			"current" : str(self.current_position).rjust(len(str(self.total_size))),
			"total" : self.total_size,
			"percent" : self.total_size and (self.current_position * 100 / self.total_size) or 0,
			"elapsed" : sec_elapsed,
			"speed" : print_speed[0],
			"speed_coeff" : print_speed[1]
		})

		if done_message:
			self._stdout.write("  %s\n" % done_message)

		self._stdout.flush()

class ProgressCR(Progress):
    ## Uses CR char (Carriage Return) just like other progress bars do.
	CR_char = chr(13)

	def display(self, new_file = False, done_message = None):
		"""
		display(new_file = False[/True], done_message = None)
		"""
		if new_file:
			self.output_labels()
			return

		timedelta = self.time_current - self.time_start
		sec_elapsed = timedelta.days * 86400 + timedelta.seconds + float(timedelta.microseconds)/1000000.0
		if (sec_elapsed > 0):
			print_speed = Utils.formatSize((self.current_position - self.initial_position) / sec_elapsed, True, True)
		else:
			print_speed = (0, "")
		self._stdout.write(self.CR_char)
		output = " %(current)s of %(total)s   %(percent)3d%% in %(elapsed)4ds  %(speed)7.2f %(speed_coeff)sB/s" % {
			"current" : str(self.current_position).rjust(len(str(self.total_size))),
			"total" : self.total_size,
			"percent" : self.total_size and (self.current_position * 100 / self.total_size) or 0,
			"elapsed" : sec_elapsed,
			"speed" : print_speed[0],
			"speed_coeff" : print_speed[1]
		}
		self._stdout.write(output)
		if done_message:
			self._stdout.write("  %s\n" % done_message)

		self._stdout.flush()
GET /path/to/my/S3/S3.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:bnnCPhNjpp7+z5tjw0JT5yVP64k=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: application/x-python-code
ETag: "ca96f077e306796fc09a44c52dc350cb"
Last-Modified: Sun, 27 Nov 2011 03:53:01 GMT
Content-Length: 24851
Connection: close
Server: thin 1.3.1 codename Triple Espresso

—Ú
ÌsÒMc           @   sâ  d  d k  Z  d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k l Z l	 Z	 l
 Z
 l Z d  d k l Z y d  d k l Z Wn# e j
 o d  d k l Z n Xd  d k Td  d k l Z d  d k l Z d  d k l Z d  d k Td  d	 k l Z l Z d  d
 k l Z d  d k l Z g  Z d e f d Ñ  É  YZ d e f d Ñ  É  YZ e i d É d S(   iˇˇˇˇN(   t   debugt   infot   warningt   error(   t   ST_SIZE(   t   md5(   t   *(   t
   SortedDict(   t   BidirMap(   t   Config(   t   ACLt   GranteeLogDelivery(   t	   AccessLog(   t   S3Urit	   S3Requestc           B   s8   e  Z h  d  Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z RS(   c         C   sX   | |  _  t | p h  d t É|  _ | |  _ | |  _ | |  _ |  i É  |  i É  d  S(   Nt   ignore_case(	   t   s3R   t   Truet   headerst   resourcet   method_stringt   paramst   update_timestampt   sign(   t   selfR   R   R   R   R   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   __init__    s    				
c         C   sD   |  i  i d É o |  i  d =n t i d t i É  É |  i  d <d  S(   Nt   dates   %a, %d %b %Y %H:%M:%S +0000s
   x-amz-date(   R   t   has_keyt   timet   strftimet   gmtime(   R   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR   *   s    c         C   sn   d } xR |  i  D]G } |  i  | d j o | d | |  i  | f 7} q | d | 7} q W| o d | d S(   s”   
		Format URL parameters from self.params and returns
		?parm1=val1&parm2=val2 or an empty string if there 
		are no parameters.  Output of this function should 
		be appended directly to self.resource['uri']
		t    s   &%s=%ss   &%st   ?i   N(   NR   (   R   t   None(   R   t	   param_strt   param(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   format_param_str/   s    
 c         C   s3  |  i  d } | |  i i d d É d 7} | |  i i d d É d 7} | |  i i d d É d 7} xN |  i i É  D]= } | i d É o' | | d t |  i | É d 7} qt qt W|  i d o | d	 |  i d 7} n | |  i d
 7} t d t | É É t	 | É } d |  i
 i i d | |  i d <d  S(   Ns   
s   content-md5R   s   content-typeR   s   x-amz-t   :t   buckett   /t   uris   SignHeaders: s   AWS t   Authorization(   R   R   t   gett   keyst
   startswitht   strR   R    t   reprt   sign_stringR   t   configt
   access_key(   R   t   ht   headert	   signature(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR   >   s     +c         C   sL   |  i  É  |  i É  t |  i É } | d c |  i É  7<|  i | |  i f S(   NR(   (   R   R   t   dictR   R$   R   R   (   R   R   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   get_tripletN   s
    

(   t   __name__t
   __module__R   R   R$   R   R6   (    (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR      s
   
			t   S3c           B   s`  e  Z e d  d d d d d d d d d	 É Z e d
 d d d d d d d É Z e d d d e d
 e d  Bd e d e d Bd e d e d  Bd e d e d Bd e d e d Bd e d e d  Bd e d e d Bd e d e d BÉ 	Z h d d 6d d 6d d  6Z h  Z d! Z d" Ñ  Z	 d# Ñ  Z
 d$ Ñ  Z d% Ñ  Z d& Ñ  Z d' Ñ  Z d? d? d( Ñ Z d? d? h  d) Ñ Z d? d* Ñ Z d+ Ñ  Z d, Ñ  Z d? d- d. Ñ Z d d- d/ Ñ Z d0 Ñ  Z d? d1 Ñ Z d? d2 Ñ Z d3 Ñ  Z d4 Ñ  Z d5 Ñ  Z d6 Ñ  Z d7 Ñ  Z d? e d8 Ñ Z  d? d9 Ñ Z! d? d? d? d? d? d: Ñ Z" d; Ñ  Z# d? e d< Ñ Z$ d e d= Ñ Z% d e d> Ñ Z& RS(@   t   GETi   t   PUTi   t   HEADi   t   DELETEi   t   MASKi   t   SERVICEi   t   BUCKETi   t   OBJECTi   i   t   UNDFINEDi    t   LIST_ALL_BUCKETSt   BUCKET_CREATEt   BUCKET_LISTt   BUCKET_DELETEt
   OBJECT_PUTt
   OBJECT_GETt   OBJECT_HEADt   OBJECT_DELETEs   Bucket '%s' does not existt   NoSuchBuckets    Access to bucket '%s' was deniedt   AccessDenieds   Bucket '%s' already existst   BucketAlreadyExistsi   c         C   s   | |  _  d  S(   N(   R0   (   R   R0   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR   }   s    c         C   sn   |  i  i d j o t i |  i  i |  i  i É S|  i  i o t i |  i | É É St i |  i | É É Sd  S(   NR   (   R0   t
   proxy_hostt   httplibt   HTTPConnectiont
   proxy_portt	   use_httpst   HTTPSConnectiont   get_hostname(   R   R&   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   get_connectionÄ   s
    c         C   sl   | oA t  | É o4 |  i i | É o |  i | } qT t | É } n |  i i } t d | | f É | S(   Ns   get_hostname(%s): %s(   t    check_bucket_name_dns_conformityt	   redir_mapR   t   getHostnameFromBucketR0   t	   host_baseR    (   R   R&   t   host(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyRT   â   s    c         C   s   | |  i  | <d  S(   N(   RW   (   R   R&   t   redir_hostname(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   set_hostnameî   s    c         C   sâ   | d o. t  | d É o d | d | d f } n | d } |  i i d j o! d |  i | d É | f } n t d | É | S(   NR&   s   /%s%sR(   R   s   http://%s%ss   format_uri(): (   RV   R0   RN   RT   R    (   R   R   R(   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt
   format_urió   s    
!c         C   s9   |  i  d É } |  i | É } t | d d É | d <| S(   NRC   t   datat   Buckett   list(   t   create_requestt   send_requestt   getListFromXml(   R   t   requestt   response(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   list_all_buckets¢   s    c         C   s  d Ñ  } d Ñ  } d Ñ  } h  } t  } g  }	 g  }
 x∆ | oæ |  i | | | | É } | | d É } | | d É } | | d É } | oW | o |  i | d d É | d <n |  i | d d É | d <t d	 | d É n |	 | 7}	 |
 | 7}
 q6 W|	 | d
 <|
 | d <| S(   Nc         S   s&   t  |  d É p d } | i É  d j S(   Ns   .//IsTruncatedt   false(   t   getTextFromXmlt   lower(   R^   t   is_truncated(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   _list_truncated©   s    c         S   s   t  |  d É S(   Nt   Contents(   Rc   (   R^   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   _get_contentsÆ   s    c         S   s   t  |  d É S(   Nt   CommonPrefixes(   Rc   (   R^   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   _get_common_prefixes±   s    R^   iˇˇˇˇt   Keyt   markert   Prefixs   Listing continues after '%s'R`   t   common_prefixes(   R   t   bucket_list_noparset   urlencode_stringR    (   R   R&   t   prefixt	   recursiveRk   Rm   Ro   t
   uri_paramst	   truncatedR`   t   prefixesRe   t   current_listt   current_prefixes(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   bucket_list®   s.    			 


c         C   sm   | o |  i  | É | d <n |  i i o | o d | d <n |  i d d | | ç} |  i | É } | S(   NRv   R'   t	   delimiterRE   R&   (   Ru   R0   Rw   Ra   Rb   (   R   R&   Rv   Rw   Rx   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyRt   Ã   s    c         C   s  t  d t É } d } | oê | i É  i É  d j ow | i É  } | i É  d j o | i É  } n | i É  } d } | | 7} | d 7} t d | É t | d t Én t | d t É|  i i	 o d	 | d
 <n |  i
 d d | d | É} |  i | | É } | S(   NR   R   t   USt   EUs/   <CreateBucketConfiguration><LocationConstraint>s1   </LocationConstraint></CreateBucketConfiguration>s   bucket_location: t
   dns_stricts   public-reads	   x-amz-aclRD   R&   R   (   R   R   t   stript   upperRi   R    t   check_bucket_namet   FalseR0   t
   acl_publicRa   Rb   (   R   R&   t   bucket_locationR   t   bodyRd   Re   (    (    s%   /Users/rlyon/src/s3cm
d-1.0.1/S3/S3.pyt   bucket_create÷   s$     

c         C   s(   |  i  d d | É} |  i | É } | S(   NRF   R&   (   Ra   Rb   (   R   R&   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   bucket_deleteÏ   s    c         C   sR   |  i  d d | i É  d d É} |  i | É } t | d d É p d | d <| S(	   NRE   R&   t   extras	   ?locationR^   t   LocationConstraintt   anys   bucket-location(   Ra   R&   Rb   Rh   (   R   R(   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   bucket_infoÒ   s    !R   c      	   C   sÿ  | i  d j o t d | i  É Ç n t i i | É p t d t | É É Ç n y& t | d É } t i | É t	 } Wn: t
 t f j
 o( } t d t | É | i f É Ç n Xt d t É } | o | i | É n | | d <d  }	 |  i i o t i | É d }	 n |	 p |  i i }	 n t d	 |	 É |	 | d
 <|  i i o d | d <n |  i i o d | d <n |  i d d | d | É}
 h t | É d 6t | i É  É d 6| d 6} |  i |
 | | É } | S(   NR   s    Expected URI type 's3', got '%s'u   %s is not a regular filet   rbu   %s: %sR   s   content-lengthi    s   Content-Type set to '%s's   content-types   public-reads	   x-amz-aclt   REDUCED_REDUNDANCYs   x-amz-storage-classRG   R(   R   t   sourcet   destinationRã   (   t   typet
   ValueErrort   ost   patht   isfilet   InvalidFileErrort	   unicodiset   opent   statR   t   IOErrort   OSErrort   strerrorR   R   t   updateR!   R0   t   guess_mime_typet	   mimetypest
   guess_typet   default_mime_typeR    RÜ   t   reduced_redundancyRa   R(   t	   send_file(   R   t   filenameR(   t   extra_headerst   extra_labelt   filet   sizet   eR   t   content_typeRd   t   labelsRe   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt
   object_put˜   s8    $

-c         C   sà   | i  d j o t d | i  É Ç n |  i d d | É} h t | i É  É d 6t | i É d 6| d 6} |  i | | | | É } | S(   NR   s    Expected URI type 's3', got '%s'RH   R(   Rë   Rí   Rã   (   Rì   Rî   Ra   Rô   R(   t   namet	   recv_file(   R   R(   t   streamt   start_positionR®   Rd   R≠   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt
   object_get  s    0c         C   sO   | i  d j o t d | i  É Ç n |  i d d | É} |  i | É } | S(   NR   s    Expected URI type 's3', got '%s'RJ   R(   (   Rì   Rî   Ra   Rb   (   R   R(   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   object_delete   s
    c         C   sÙ   | i  d j o t d | i  É Ç n | i  d j o t d | i  É Ç n t d t É } d | i É  |  i | i É  É f | d <d | d <|  i i o d | d	 <n |  i i	 o d
 | d <n |  i
 d d | d | É} |  i | É } | S(   NR   s    Expected URI type 's3', got '%s'R   s   /%s/%ss   x-amz-copy-sourcet   COPYs   x-amz-metadata-directives   public-reads	   x-amz-aclRê   s   x-amz-storage-classRG   R(   R   (   Rì   Rî   R   R   R&   Ru   t   objectR0   RÜ   R§   Ra   Rb   (   R   t   src_urit   dst_uriRß   R   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   object_copy'  s    )
c         C   se   |  i  | | | É } t d | | f É t | d É d j o! |  i | É } t d | É n | S(   Ns   Object %s copied to %sR^   t   CopyObjectResults   Object %s deleted(   Rπ   R    t   getRootTagNameR¥   (   R   R∑   R∏   Rß   t   response_copyt   response_delete(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   object_move:  s    c         C   s(   |  i  d d | É} |  i | É } | S(   NRI   R(   (   Ra   Rb   (   R   R(   Rd   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   object_infoB  s    c         C   sp   | i  É  o |  i d d | d d É} n" |  i d d | i É  d d É} |  i | É } t | d É } | S(   NRH   R(   Rã   s   ?aclRE   R&   R^   (   t
   has_objectRa   R&   Rb   R
   (   R   R(   Rd   Re   t   acl(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   get_aclG  s    !c         C   sÉ   | i  É  o |  i d d | d d É} n" |  i d d | i É  d d É} t | É } t d | | f É |  i | | É } | S(   NRG   R(   Rã   s   ?aclRD   R&   u   set_acl(%s): acl-xml: %s(   R¿   Ra   R&   R-   R    Rb   (   R   R(   R¡   Rd   Rà   Re   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   set_aclQ  s    !c         C   sD   |  i  d d | i É  d d É} |  i | É } t | d É } | S(   NRE   R&   Rã   s   ?loggingR^   (   Ra   R&   Rb   R   (   R   R(   Rd   Re   t	   accesslog(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   get_accesslog\  s    !c         C   sâ   |  i  | É } t d | i É  t | É f É | i t d É É | i t d É É t d | i É  t | É f É |  i | | É d  S(   Ns   Current ACL(%s): %st   READ_ACPt   WRITEs   Updated ACL(%s): %s(   R¬   R    R(   R-   t   appendGranteeR   R√   (   R   R(   R¡   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   set_accesslog_aclb  s      c   
      C   s  |  i  d d | i É  d d É} t É  } | o | i | É | i | É n | i É  t | É } t d | | f É y |  i | | É } Wni t	 j
 o] }	 |	 i
 d d j o= t
 d É |  i t d	 | i É  É É |  i | | É } q˚ Ç  n X| | f S(
   NRD   R&   Rã   s   ?loggingu$   set_accesslog(%s): accesslog-xml: %st   Codet   InvalidTargetBucketForLoggings.   Setting up log-delivery ACL for target bucket.s   s3://%s(   Ra   R&   R   t   enableLoggingt   setAclPublict   disableLoggingR-   R    Rb   t   S3ErrorR   R…   R   (
   R   R(   t   enablet   log_target_prefix_uriRÜ   Rd   Rƒ   Rà   Re   R´   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   set_accesslogj  s"    !	

c         C   s¶  t  | É t j o | i d É } n | d  j o |  i i } n | d j o | Sd } x0| D](} t | É } | d j  p | d j oQ | d j o | d | 7} qät d | | f É t d	 É | t | É 7} qb | d j pÇ | d
 j pu | d j ph | d j p[ | d j pN | d j pA | d j p4 | d j p' | d j p | d j p | d j o | d | 7} qb | | 7} qb Wt	 d | | f É | S(   Ns   utf-8t   verbatimR   i    i   t	   fixbuckets   %%%02Xu%   Non-printable character 0x%02x in: %su6   Please report it to s3tools-bugs@lists.sourceforge.neti"   i#   i%   i&   i+   i<   i>   i?   i`   i{   s   String '%s' encoded to '%s'(
   Rì   t   unicodet   encodeR!   R0   t   urlencoding_modet   ordR   t   replace_nonprintablesR    (   R   t   stringR◊   t   encodedt   ct   o(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyRu   Ä  s>     
c         K   s  h d  d 6d d 6} | o | p | o t d É Ç n | o0 | i É  } | i É  o | i É  p d  } n | o6 t | É | d <| o d |  i | É | d <q≠ n | o | d c | 7<n t i i	 t i
 | t i d @É }	 t |  |	 | | | É }
 t d | d É |
 S(   NR&   R'   R(   s>   Both 'uri' and either 'bucket' or 'object' parameters suppliedR>   s   CreateRequest: resource[uri]=(   R!   Rî   R&   R¿   R∂   R-   Ru   R9   t   http_methodst   getkeyt
   operationsR   R    (   R   t	   operationR(   R&   R∂   R   Rã   R   R   R   Rd   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyRa   ≥  s     $$c         C   s   |  i  | d d S(   Ni   i   (   t   _max_retries(   R   t   retries(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt
   _fail_waitÀ  s    c      
   C   s„  | i  É  \ } } } t d É | i d É p" | o t | É p d | d <n y— x( | i É  D] } t | | É | | <qa W|  i
 | d É } | i | |  i | É | | É h  }	 | i	 É  }
 |
 i
 |	 d <|
 i |	 d <t |
 i É  É |	 d <|
 i É  |	 d <t d	 t |	 É É | i É  Wnç t j
 oÅ } | o] t d
 | d | f É t d |  i | É É t i |  i | É É |  i | | | d É St d | d É Ç n X|	 d d j oU t |	 d d É } t |	 d d É } |  i | | É t d | É |  i | | É S|	 d d j oÑ t |	 É } | og t d | d É t t | É É t d |  i | É É t i |  i | É É |  i | | | d É S| Ç n |	 d d j  p |	 d d j o t |	 É Ç n |	 S(   Ns"   Processing request, please wait...s   content-lengthi    R&   t   statust   reasonR   R^   s
   Response: s    Retrying failed request: %s (%s)R(   s   Waiting %d sec...i   s   Request failed for: %si3  s	   .//Buckets   .//Endpoints   Redirected to: %siÙ  u   Retrying failed request: %si»   i+  (   R6   R    R   t   lenR+   R-   RU   Rd   R]   t   getresponseRÂ   RÊ   t   convertTupleListToDictt
   getheaderst   readt   closet	   ExceptionR   R‰   R   t   sleepRb   t   S3RequestErrorRh   R\   Rœ   R’   (   R   Rd   Rà   R„   R   R   R   R3   t   connRe   t   http_responseR´   t   redir_bucketR[   (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyRb   œ  sV    
" 
"c         C   sä  | i  É  \ } } } | i d É }	 }
 |  i i o |  i i | |
 É } n t d | i É t i É  } yu |  i | d É } | i	 É  | i
 | |  i | É É x. | i É  D]  } | i | t | | É É q± W| i É  Wn± t j
 o• } |  i i o | i d É n | oc t d | d | f É t d |  i | É É t i |  i | É É |  i | | | | | d É St d	 | d É Ç n X| i d
 É t É  } yxê |	 d
 j oÇ | i |  i i É } | i | É | i | É |  i i o | i d t | É É n |	 t | É 8}	 | o t i | É q∞q∞W| i É  } h  } | i É  } | i  | d <| i! | d <t" | i# É  É | d <| i É  | d <|
 | d <| i$ É  t% d | É Wnt j
 oˆ } |  i i o | i d É n | où | |  i& j  o | o | d p d } n t d | d | f É t d | É t d |  i | É É t i |  i | É É |  i | | | | | d É St% d | i | f É t d	 | d É Ç n Xt i É  } | | | d <| d o t' | d É | d p
 t' d É | d <|  i i o | i É  | i d É n | d d j oX t( | d d É } t( | d d É } |  i) | | É t d | É |  i | | | É S| d i* d É p d  | d d <n | d d! j  p | d d" j o˛ t+ } | d d# j o
 t, } n< | d d$ j o* t- | É } | i. d. j o
 t, } qIn | oã | oi t d | d t- | É f É t d |  i | É É t i |  i | É É |  i | | | | | d É St d) | i É t Ç n t- | É Ç n t% d* | | d d f É | d d i/ d+ É | i É  j o[ t d, É | o/ t d- | i É |  i | | | | | d É St d) | i É t Ç n | S(/   Ns   content-lengths!   Sending file '%s', please wait...R&   t   faileds    Retrying failed request: %s (%s)R(   s   Waiting %d sec...i   s   Upload failed for: %si    t   delta_positionRÂ   RÊ   R   R^   R™   u   Response: %si   g{ÆG·zÑ?s   Upload failed: %s (%s)s(   Retrying on lower speed (throttle=%0.2f)s   Giving up on '%s' %st   elapsediˇˇˇˇt   speedt   donei3  s	   .//Buckets   .//Endpoints   Redirected to: %st   etagR   i»   i+  iÙ  iê  t	   BadDigestt   OperationAbortedt   TokenRefreshRequiredt   RequestTimeouts$   Too many failures. Giving up on '%s's"   MD5 sums: computed=%s, received=%ss   "'s   MD5 Sums don't match!s   Retrying upload of %s(   R˘   R˙   R˚   R¸   (0   R6   R*   R0   t   progress_metert   progress_classR   RØ   R   RU   t   connectt
   putrequestR]   R+   t	   putheaderR-   t
   endheadersRÌ   R˜   R   R‰   RÓ   R•   t   S3UploadErrort   seekR   RÎ   t
   send_chunkRü   t   sendRÁ   t	   hexdigestRË   RÂ   RÊ   RÈ   RÍ   RÏ   R    R‚   t   floatRh   R\   R   RÖ   R   Rœ   t   codeRÇ   (   R   Rd   R©   R≠   t   throttleR„   R   R   R   t	   size_leftt
   size_totalt   progresst   timestamp_startR   R3   R´   t   md5_hashR^   t   md5_computedRe   RÒ   t   timestamp_endRÚ   R[   t	   try_retryt   err(    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR•     s∆    
 	 

4
"

$

c         C   s`  | i  É  \ } } } |  i i o |  i i | d É }	 n t d | i É t i É  }
 y¯ |  i | d É } | i É  | i	 | |  i
 | É É x. | i É  D]  } | i | t | | É É qû W| d j o& t d | É | i d d | É n | i É  h  } | i É  } | i | d <| i | d <t | i É  É | d	 <t d
 | É Wn± t j
 o• } |  i i o |	 i d É n | oc t d | d | f É t d |  i | É É t i |  i | É É |  i | | | | | d É St d | d É Ç n X| d d j oh | i É  | d <t | d d É } t | d d É } |  i | | É t d | É |  i | | | É S| d d j  p | d d j o t | É Ç n | d j o t  É  } n t! | d	 d É } | | } | } |  i i o | |	 _" | |	 _# | |	 _$ n y∫ x© | | j  oõ | |  i i% j o |  i i% p | } | i | É } | i& | É | d j o | i' | É n | t( | É 7} |  i i o |	 i' d t( | É É qqW| i) É  Wn± t j
 o• } |  i i o |	 i d É n | oc t d | d | f É t d |  i | É É t i |  i | É É |  i | | | | | d É St d | d É Ç n X| i* É  t i É  } |  i i o |	 i' É  |	 i d É n | d j o | i+ É  | d <nz y t, | i É | d <Wn_ t- j
 oS } | i. t. i/ j o t d | i | f É n t d É | d	 d | d <n X| d	 d i0 | d É d j | d <| |
 | d  <| | d! <| d  o t1 | d! É | d  p
 t1 d" É | d# <| d! | t2 | d	 d É j o( t d$ | | d	 d | d! f É n t d% | d É | d p$ t d& | d | d	 d f É n | S('   Ni    s#   Receiving file '%s', please wait...R&   s   Requesting Range: %d .. endt   Ranges	   bytes=%d-RÂ   RÊ   R   s   Response: %sRÛ   s    Retrying failed request: %s (%s)R(   s   Waiting %d sec...i   s   Download failed for: %si3  R^   s	   .//Buckets   .//Endpoints   Redirected to: %si»   i+  s   content-lengthRÙ   R˜   R   s   Unable to open file: %s: %ss(   Unable to verify MD5. Assume it matches.R¯   t   md5matchRı   R™   iˇˇˇˇRˆ   s4   Reported size (%s) does not match received size (%s)s   ReceiveFile: Computed MD5 = %ss5   MD5 signatures do not match: computed=%s, received=%s(3   R6   R0   R˝   R˛   R   RØ   R   RU   Rˇ   R   R]   R+   R  R-   R    R  RË   RÂ   RÊ   RÈ   RÍ   RÌ   R˜   R   R‰   RÓ   R∞   t   S3DownloadErrorRÎ   Rh   R\   Rœ   R   t   intt
   total_sizet   initial_positiont   current_positiont
   recv_chunkt   writeRü   RÁ   RÏ   t   flushR  t   hash_file_md5Rú   t   errnot   ENOENTt   findR  t   long(   R   Rd   R±   R≠   R≤   R„   R   R   R   R  R  R   R3   Re   RÒ   R´   RÚ   R[   R  R  R  R  t
   this_chunkR^   R  (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR∞   Ä  s¿    
 
"
		 &


%
4#"N('   R7   R8   R   Rﬁ   t   targetsR‡   t   codesRW   R‚   R   RU   RT   R\   R]   Rf   R!   R}   Rt   Râ   Rä   Ré   RÆ   R≥   R¥   Rπ   Ræ   Rø   R¬   R√   R≈   R…   RÖ   R“   Ru   Ra   R‰   Rb   R•   R∞   (    (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyR9   U   sn   		
							$
		!			
			3	4}(   t   sysRï   t   os.pathR   RO   t   loggingR°   t   reR    R   R   R
   Rõ   R   t   hashlibR   t   ImportErrort   UtilsR   R   R	   t
   ExceptionsR
   R   R   R   t   __all__R∂   R   R9   t   append(    (    (    s%   /Users/rlyon/src/s3cmd-1.0.1/S3/S3.pyt   <module>   s4   "

6ˇ ˇ §
GET /path/to/my/S3/SimpleDB.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ExrNe0hyLbJzayEFmDAKpUydxyc=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/x-python;charset=utf-8
ETag: "e7a9a30012449beb3fa970b1d239a273"
Last-Modified: Sun, 27 Nov 2011 03:53:01 GMT
Content-Length: 6017
Connection: close
Server: thin 1.3.1 codename Triple Espresso

## Amazon SimpleDB library
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

"""
Low-level class for working with Amazon SimpleDB
"""

import time
import urllib
import base64
import hmac
import sha
import httplib
from logging import debug, info, warning, error

from Utils import convertTupleListToDict
from SortedDict import SortedDict
from Exceptions import *

class SimpleDB(object):
	# API Version
	# See http://docs.amazonwebservices.com/AmazonSimpleDB/2007-11-07/DeveloperGuide/
	Version = "2007-11-07"
	SignatureVersion = 1

	def __init__(self, config):
		self.config = config

	## ------------------------------------------------
	## Methods implementing SimpleDB API
	## ------------------------------------------------

	def ListDomains(self, MaxNumberOfDomains = 100):
		'''
		Lists all domains associated with our Access Key. Returns 
		domain names up to the limit set by MaxNumberOfDomains.
		'''
		parameters = SortedDict()
		parameters['MaxNumberOfDomains'] = MaxNumberOfDomains
		return self.send_request("ListDomains", DomainName = None, parameters = parameters)

	def CreateDomain(self, DomainName):
		return self.send_request("CreateDomain", DomainName = DomainName)

	def DeleteDomain(self, DomainName):
		return self.send_request("DeleteDomain", DomainName = DomainName)

	def PutAttributes(self, DomainName, ItemName, Attributes):
		parameters = SortedDict()
		parameters['ItemName'] = ItemName
		seq = 0
		for attrib in Attributes:
			if type(Attributes[attrib]) == type(list()):
				for value in Attributes[attrib]:
					parameters['Attribute.%d.Name' % seq] = attrib
					parameters['Attribute.%d.Value' % seq] = unicode(value)
					seq += 1
			else:
				parameters['Attribute.%d.Name' % seq] = attrib
				parameters['Attribute.%d.Value' % seq] = unicode(Attributes[attrib])
				seq += 1
		## TODO:
		## - support for Attribute.N.Replace
		## - support for multiple values for one attribute
		return self.send_request("PutAttributes", DomainName = DomainName, parameters = parameters)

	def GetAttributes(self, DomainName, ItemName, Attributes = []):
		parameters = SortedDict()
		parameters['ItemName'] = ItemName
		seq = 0
		for attrib in Attributes:
			parameters['AttributeName.%d' % seq] = attrib
			seq += 1
		return self.send_request("GetAttributes", DomainName = DomainName, parameters = parameters)

	def DeleteAttributes(self, DomainName, ItemName, Attributes = {}):
		"""
		Remove specified Attributes from ItemName.
		Attributes parameter can be either:
		- not specified, in which case the whole Item is removed
		- list, e.g. ['Attr1', 'Attr2'] in which case these parameters are removed
		- dict, e.g. {'Attr' : 'One', 'Attr' : 'Two'} in which case the 
		  specified values are removed from multi-value attributes.
		"""
		parameters = SortedDict()
		parameters['ItemName'] = ItemName
		seq = 0
		for attrib in Attributes:
			parameters['Attribute.%d.Name' % seq] = attrib
			if type(Attributes) == type(dict()):
				parameters['Attribute.%d.Value' % seq] = unicode(Attributes[attrib])
			seq += 1
		return self.send_request("DeleteAttributes", DomainName = DomainName, parameters = parameters)

	def Query(self, DomainName, QueryExpression = None, MaxNumberOfItems = None, NextToken = None):
		parameters = SortedDict()
		if QueryExpression:
			parameters['QueryExpression'] = QueryExpression
		if MaxNumberOfItems:
			parameters['MaxNumberOfItems'] = MaxNumberOfItems
		if NextToken:
			parameters['NextToken'] = NextToken
		return self.send_request("Query", DomainName = DomainName, parameters = parameters)
		## Handle NextToken? Or maybe not - let the upper level do it

	## ------------------------------------------------
	## Low-level methods for handling SimpleDB requests
	## ------------------------------------------------

	def send_request(self, *args, **kwargs):
		request = self.create_request(*args, **kwargs)
		#debug("Request: %s" % repr(request))
		conn = self.get_connection()
		conn.request("GET", self.format_uri(request['uri_params']))
		http_response = conn.getresponse()
		response = {}
		response["status"] = http_response.status
		response["reason"] = http_response.reason
		response["headers"] = convertTupleListToDict(http_response.getheaders())
		response["data"] =  http_response.read()
		conn.close()

		if response["status"] < 200 or response["status"] > 299:
			debug("Response: " + str(response))
			raise S3Error(response)

		return response

	def create_request(self, Action, DomainName, parameters = None):
		if not parameters:
			parameters = SortedDict()
		parameters['AWSAccessKeyId'] = self.config.access_key
		parameters['Version'] = self.Version
		parameters['SignatureVersion'] = self.SignatureVersion
		parameters['Action'] = Action
		parameters['Timestamp'] = time.strftime("%Y-%m-%dT%H:%M:%SZ", time.gmtime())
		if DomainName:
			parameters['DomainName'] = DomainName
		parameters['Signature'] = self.sign_request(parameters)
		parameters.keys_return_lowercase = False
		uri_params = urllib.urlencode(parameters)
		request = {}
		request['uri_params'] = uri_params
		request['parameters'] = parameters
		return request

	def sign_request(self, parameters):
		h = ""
		parameters.keys_sort_lowercase = True
		parameters.keys_return_lowercase = False
		for key in parameters:
			h += "%s%s" % (key, parameters[key])
		#debug("SignRequest: %s" % h)
		return base64.encodestring(hmac.new(self.config.secret_key, h, sha).digest()).strip()

	def get_connection(self):
		if self.config.proxy_host != "":
			return httplib.HTTPConnection(self.config.proxy_host, self.config.proxy_port)
		else:
			if self.config.use_https:
				return httplib.HTTPSConnection(self.config.simpledb_host)
			else:
				return httplib.HTTPConnection(self.config.simpledb_host)

	def format_uri(self, uri_params):
		if self.config.proxy_host != "":
			uri = "http://%s/?%s" % (self.config.simpledb_host, uri_params)
		else:
			uri = "/?%s" % uri_params
		#debug('format_uri(): ' + uri)
		return uri
GET /path/to/my/S3/Utils.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:XJ/e8CnPoP4e3FsDPgEZd4t1aFk=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/x-python;charset=utf-8
ETag: "68fbe83ef100b95b2746a691f6c7885a"
Last-Modified: Sun, 27 Nov 2011 03:53:06 GMT
Content-Length: 10994
Connection: close
Server: thin 1.3.1 codename Triple Espresso

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import os
import sys
import time
import re
import string
import random
import rfc822
import hmac
import base64
import errno

from logging import debug, info, warning, error

import Config
import Exceptions

# hashlib backported to python 2.4 / 2.5 is not compatible with hmac!
if sys.version_info[0] == 2 and sys.version_info[1] < 6:
	from md5 import md5
	import sha as sha1
else:
	from hashlib import md5, sha1

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET
from xml.parsers.expat import ExpatError

__all__ = []
def parseNodes(nodes):
	## WARNING: Ignores text nodes from mixed xml/text.
	## For instance <tag1>some text<tag2>other text</tag2></tag1>
	## will be ignore "some text" node
	retval = []
	for node in nodes:
		retval_item = {}
		for child in node.getchildren():
			name = child.tag
			if child.getchildren():
				retval_item[name] = parseNodes([child])
			else:
				retval_item[name] = node.findtext(".//%s" % child.tag)
		retval.append(retval_item)
	return retval
__all__.append("parseNodes")

def stripNameSpace(xml):
	"""
	removeNameSpace(xml) -- remove top-level AWS namespace
	"""
	r = re.compile('^(<?[^>]+?>\s?)(<\w+) xmlns=[\'"](http://[^\'"]+)[\'"](.*)', re.MULTILINE)
	if r.match(xml):
		xmlns = r.match(xml).groups()[2]
		xml = r.sub("\\1\\2\\4", xml)
	else:
		xmlns = None
	return xml, xmlns
__all__.append("stripNameSpace")

def getTreeFromXml(xml):
	xml, xmlns = stripNameSpace(xml)
	try:
		tree = ET.fromstring(xml)
		if xmlns:
			tree.attrib['xmlns'] = xmlns
		return tree
	except ExpatError, e:
		error(e)
		raise Exceptions.ParameterError("Bucket contains invalid filenames. Please run: s3cmd fixbucket s3://your-bucket/")
__all__.append("getTreeFromXml")
	
def getListFromXml(xml, node):
	tree = getTreeFromXml(xml)
	nodes = tree.findall('.//%s' % (node))
	return parseNodes(nodes)
__all__.append("getListFromXml")

def getDictFromTree(tree):
	ret_dict = {}
	for child in tree.getchildren():
		if child.getchildren():
			## Complex-type child. We're not interested
			continue
		if ret_dict.has_key(child.tag):
			if not type(ret_dict[child.tag]) == list:
				ret_dict[child.tag] = [ret_dict[child.tag]]
			ret_dict[child.tag].append(child.text or "")
		else:
			ret_dict[child.tag] = child.text or ""
	return ret_dict
__all__.append("getDictFromTree")

def getTextFromXml(xml, xpath):
	tree = getTreeFromXml(xml)
	if tree.tag.endswith(xpath):
		return tree.text
	else:
		return tree.findtext(xpath)
__all__.append("getTextFromXml")

def getRootTagName(xml):
	tree = getTreeFromXml(xml)
	return tree.tag
__all__.append("getRootTagName")

def xmlTextNode(tag_name, text):
	el = ET.Element(tag_name)
	el.text = unicode(text)
	return el
__all__.append("xmlTextNode")

def appendXmlTextNode(tag_name, text, parent):
	"""
	Creates a new <tag_name> Node and sets
	its content to 'text'. Then appends the
	created Node to 'parent' element if given.
	Returns the newly created Node.
	"""
	el = xmlTextNode(tag_name, text)
	parent.append(el)
	return el
__all__.append("appendXmlTextNode")

def dateS3toPython(date):
	date = re.compile("(\.\d*)?Z").sub(".000Z", date)
	return time.strptime(date, "%Y-%m-%dT%H:%M:%S.000Z")
__all__.append("dateS3toPython")

def dateS3toUnix(date):
	## FIXME: This should be timezone-aware.
	## Currently the argument to strptime() is GMT but mktime() 
	## treats it as "localtime". Anyway...
	return time.mktime(dateS3toPython(date))
__all__.append("dateS3toUnix")

def dateRFC822toPython(date):
	return rfc822.parsedate(date)
__all__.append("dateRFC822toPython")

def dateRFC822toUnix(date):
	return time.mktime(dateRFC822toPython(date))
__all__.append("dateRFC822toUnix")

def formatSize(size, human_readable = False, floating_point = False):
	size = floating_point and float(size) or int(size)
	if human_readable:
		coeffs = ['k', 'M', 'G', 'T']
		coeff = ""
		while size > 2048:
			size /= 1024
			coeff = coeffs.pop(0)
		return (size, coeff)
	else:
		return (size, "")
__all__.append("formatSize")

def formatDateTime(s3timestamp):
	return time.strftime("%Y-%m-%d %H:%M", dateS3toPython(s3timestamp))
__all__.append("formatDateTime")

def convertTupleListToDict(list):
	retval = {}
	for tuple in list:
		retval[tuple[0]] = tuple[1]
	return retval
__all__.append("convertTupleListToDict")

_rnd_chars = string.ascii_letters+string.digits
_rnd_chars_len = len(_rnd_chars)
def rndstr(len):
	retval = ""
	while len > 0:
		retval += _rnd_chars[random.randint(0, _rnd_chars_len-1)]
		len -= 1
	return retval
__all__.append("rndstr")

def mktmpsomething(prefix, randchars, createfunc):
	old_umask = os.umask(0077)
	tries = 5
	while tries > 0:
		dirname = prefix + rndstr(randchars)
		try:
			createfunc(dirname)
			break
		except OSError, e:
			if e.errno != errno.EEXIST:
				os.umask(old_umask)
				raise
		tries -= 1

	os.umask(old_umask)
	return dirname
__all__.append("mktmpsomething")

def mktmpdir(prefix = "/tmp/tmpdir-", randchars = 10):
	return mktmpsomething(prefix, randchars, os.mkdir)
__all__.append("mktmpdir")

def mktmpfile(prefix = "/tmp/tmpfile-", randchars = 20):
	createfunc = lambda filename : os.close(os.open(filename, os.O_CREAT | os.O_EXCL))
	return mktmpsomething(prefix, randchars, createfunc)
__all__.append("mktmpfile")

def hash_file_md5(filename):
	h = md5()
	f = open(filename, "rb")
	while True:
		# Hash 32kB chunks
		data = f.read(32*1024)
		if not data:
			break
		h.update(data)
	f.close()
	return h.hexdigest()
__all__.append("hash_file_md5")

def mkdir_with_parents(dir_name):
	"""
	mkdir_with_parents(dst_dir)
	
	Create directory 'dir_name' with all parent directories

	Returns True on success, False otherwise.
	"""
	pathmembers = dir_name.split(os.sep)
	tmp_stack = []
	while pathmembers and not os.path.isdir(os.sep.join(pathmembers)):
		tmp_stack.append(pathmembers.pop())
	while tmp_stack:
		pathmembers.append(tmp_stack.pop())
		cur_dir = os.sep.join(pathmembers)
		try:
			debug("mkdir(%s)" % cur_dir)
			os.mkdir(cur_dir)
		except (OSError, IOError), e:
			warning("%s: can not make directory: %s" % (cur_dir, e.strerror))
			return False
		except Exception, e:
			warning("%s: %s" % (cur_dir, e))
			return False
	return True
__all__.append("mkdir_with_parents")

def unicodise(string, encoding = None, errors = "replace"):
	"""
	Convert 'string' to Unicode or raise an exception.
	"""

	if not encoding:
		encoding = Config.Config().encoding

	if type(string) == unicode:
		return string
	debug("Unicodising %r using %s" % (string, encoding))
	try:
		return string.decode(encoding, errors)
	except UnicodeDecodeError:
		raise UnicodeDecodeError("Conversion to unicode failed: %r" % string)
__all__.append("unicodise")

def deunicodise(string, encoding = None, errors = "replace"):
	"""
	Convert unicode 'string' to <type str>, by default replacing
	all invalid characters with '?' or raise an exception.
	"""

	if not encoding:
		encoding = Config.Config().encoding

	if type(string) != unicode:
		return str(string)
	debug("DeUnicodising %r using %s" % (string, encoding))
	try:
		return string.encode(encoding, errors)
	except UnicodeEncodeError:
		raise UnicodeEncodeError("Conversion from unicode failed: %r" % string)
__all__.append("deunicodise")

def unicodise_safe(string, encoding = None):
	"""
	Convert 'string' to Unicode according to current encoding 
	and replace all invalid characters with '?'
	"""

	return unicodise(deunicodise(string, encoding), encoding).replace(u'\ufffd', '?')
__all__.append("unicodise_safe")

def replace_nonprintables(string):
	"""
	replace_nonprintables(string)

	Replaces all non-printable characters 'ch' in 'string'
	where ord(ch) <= 26 with ^@, ^A, ... ^Z
	"""
	new_string = ""
	modified = 0
	for c in string:
		o = ord(c)
		if (o <= 31):
			new_string += "^" + chr(ord('@') + o)
			modified += 1
		elif (o == 127):
			new_string += "^?"
			modified += 1
		else:
			new_string += c
	if modified and Config.Config().urlencoding_mode != "fixbucket":
		warning("%d non-printable characters replaced in: %s" % (modified, new_string))
	return new_string
__all__.app
end("replace_nonprintables")

def sign_string(string_to_sign):
	#debug("string_to_sign: %s" % string_to_sign)
	signature = base64.encodestring(hmac.new(Config.Config().secret_key, string_to_sign, sha1).digest()).strip()
	#debug("signature: %s" % signature)
	return signature
__all__.append("sign_string")

def check_bucket_name(bucket, dns_strict = True):
	if dns_strict:
		invalid = re.search("([^a-z0-9\.-])", bucket)
		if invalid:
			raise Exceptions.ParameterError("Bucket name '%s' contains disallowed character '%s'. The only supported ones are: lowercase us-ascii letters (a-z), digits (0-9), dot (.) and hyphen (-)." % (bucket, invalid.groups()[0]))
	else:
		invalid = re.search("([^A-Za-z0-9\._-])", bucket)
		if invalid:
			raise Exceptions.ParameterError("Bucket name '%s' contains disallowed character '%s'. The only supported ones are: us-ascii letters (a-z, A-Z), digits (0-9), dot (.), hyphen (-) and underscore (_)." % (bucket, invalid.groups()[0]))

	if len(bucket) < 3:
		raise Exceptions.ParameterError("Bucket name '%s' is too short (min 3 characters)" % bucket)
	if len(bucket) > 255:
		raise Exceptions.ParameterError("Bucket name '%s' is too long (max 255 characters)" % bucket)
	if dns_strict:
		if len(bucket) > 63:
			raise Exceptions.ParameterError("Bucket name '%s' is too long (max 63 characters)" % bucket)
		if re.search("-\.", bucket):
			raise Exceptions.ParameterError("Bucket name '%s' must not contain sequence '-.' for DNS compatibility" % bucket)
		if re.search("\.\.", bucket):
			raise Exceptions.ParameterError("Bucket name '%s' must not contain sequence '..' for DNS compatibility" % bucket)
		if not re.search("^[0-9a-z]", bucket):
			raise Exceptions.ParameterError("Bucket name '%s' must start with a letter or a digit" % bucket)
		if not re.search("[0-9a-z]$", bucket):
			raise Exceptions.ParameterError("Bucket name '%s' must end with a letter or a digit" % bucket)
	return True
__all__.append("check_bucket_name")

def check_bucket_name_dns_conformity(bucket):
	try:
		return check_bucket_name(bucket, dns_strict = True)
	except Exceptions.ParameterError:
		return False
__all__.append("check_bucket_name_dns_conformity")

def getBucketFromHostname(hostname):
	"""
	bucket, success = getBucketFromHostname(hostname)

	Only works for hostnames derived from bucket names
	using Config.host_bucket pattern.

	Returns bucket name and a boolean success flag.
	"""

	# Create RE pattern from Config.host_bucket
	pattern = Config.Config().host_bucket % { 'bucket' : '(?P<bucket>.*)' }
	m = re.match(pattern, hostname)
	if not m:
		return (hostname, False)
	return m.groups()[0], True
__all__.append("getBucketFromHostname")

def getHostnameFromBucket(bucket):
	return Config.Config().host_bucket % { 'bucket' : bucket }
__all__.append("getHostnameFromBucket")
GET /path/to/my/S3/__init__.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:nj73ft00NC+1hea2YY1Wa5a3KDc=
x-amz-date: Sun, 27 Nov 2011 19:50:47 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: application/x-python-code
ETag: "6fd10432e9fee54c1311d7d9090af6ee"
Last-Modified: Sun, 27 Nov 2011 03:53:06 GMT
Content-Length: 130
Connection: close
Server: thin 1.3.1 codename Triple Espresso

—Ú
LpÒMc           @   s   d  S(   N(    (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/__init__.pyt   <module>   s    
PUT /path/to/my/S3/ACL.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:FuJTQH7RrnHUR7OBL8PeMWVtbGw=
content-length: 8406
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:53:04 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423584/ctime:1321220027

—Ú
ÌsÒMc           @   s  d  d k  l Z y d  d k i i Z Wn" e j
 o d  d k i Z n Xd e f d Ñ  É  YZ	 d e	 f d Ñ  É  YZ
 d e	 f d Ñ  É  YZ d	 e f d
 Ñ  É  YZ e d j o\ d Z e e É Z d Ge i É  GHe i É  d Ge i É  GHe i É  d Ge i É  GHe GHn d S(   iˇˇˇˇ(   t   getTreeFromXmlNt   Granteec           B   sA   e  Z d  Z d Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z RS(   s/   http://acs.amazonaws.com/groups/global/AllUserss.   http://acs.amazonaws.com/groups/s3/LogDeliveryc         C   s1   d  |  _ d  |  _ d  |  _ d  |  _ d  |  _ d  S(   N(   t   Nonet   xsi_typet   tagt   namet   display_namet
   permission(   t   self(    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   __init__   s
    				c         C   s&   d h |  i  d 6|  i d 6|  i d 6S(   Ns0   Grantee("%(tag)s", "%(name)s", "%(permission)s")R   R   R   (   R   R   R   (   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   __repr__   s    

c         C   s    |  i  d j o |  i t i j S(   Nt   URI(   R   R   R   t   ALL_USERS_URI(   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt
   isAllUsers   s    c         C   s*   |  i  É  o |  i d j p |  i d j S(   Nt   READt   FULL_CONTROL(   R   R   (   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt
   isAnonRead"   s    c         C   sx   t  i d É } t  i | d h d d 6|  i d 6É } t  i | |  i É } |  i | _ t  i | d É } |  i | _ | S(   Nt   GrantR   s)   http://www.w3.org/2001/XMLSchema-instances	   xmlns:xsis   xsi:typet
   Permission(   t   ETt   Elementt
   SubElementR   R   R   t   textR   (   R   t   elt   granteeR   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt
   getElement%   s    (	   t   __name__t
   __module__R   t   LOG_DELIVERY_URIR	   R
   R   R   R   (    (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR      s   				t   GranteeAnonReadc           B   s   e  Z d  Ñ  Z RS(   c         C   s8   t  i |  É d |  _ d |  _ t  i |  _ d |  _ d  S(   Nt   GroupR   R   (   R   R	   R   R   R   R   R   (   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR	   2   s
    		(   R   R   R	   (    (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR   1   s   t   GranteeLogDeliveryc           B   s   e  Z d  Ñ  Z RS(   c         C   s8   t  i |  É d |  _ d |  _ t  i |  _ | |  _ d S(   s1   
		permission must be either READ_ACP or WRITE
		R   R   N(   R   R	   R   R   R   R   R   (   R   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR	   :   s
    		(   R   R   R	   (    (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR   9   s   t   ACLc           B   sÜ   e  Z d  Z d d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d	 Ñ  Z d
 Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z RS(   sj   <AccessControlPolicy><Owner><ID></ID></Owner><AccessControlList></AccessControlList></AccessControlPolicy>c         C   sY   | p t  i } n g  |  _ d |  _ d |  _ t | É } |  i | É |  i | É d  S(   Nt    (   R    t	   EMPTY_ACLt   granteest   owner_idt
   owner_nickR    t
   parseOwnert   parseGrants(   R   t   xmlt   tree(    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR	   G   s    			c         C   s(   | i  d É |  _ | i  d É |  _ d  S(   Ns   .//Owner//IDs   .//Owner//DisplayName(   t   findtextR$   R%   (   R   R)   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR&   S   s    c         C   s¥   x≠ | i  d É D]ú } t É  } | i d É } | i d | _ | i d É i | _ xF | D]> } | i d j o | i | _ qZ | i | _ | i | _	 qZ W|  i
 i | É q Wd  S(   Ns   .//Grants
   .//Grantees/   {http://www.w3.org/2001/XMLSchema-instance}typeR   t   DisplayName(   t   findallR   t   findt   attribR   R   R   R   R   R   R#   t   append(   R   R)   t   grantR   t   gR   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR'   W   s     	 c         C   ss   g  } xf |  i  D][ } | i o | i } n! | i É  o
 d } n
 | i } | i h | d 6| i d 6É q W| S(   Ns   *anon*R   R   (   R#   R   R   R   R/   R   (   R   t   aclR   t   user(    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   getGrantListe   s    
 

	"c         C   s   h |  i  d 6|  i d 6S(   Nt   idt   nick(   R$   R%   (   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   getOwnerq   s    c         C   s*   x# |  i  D] } | i É  o t Sq
 Wt S(   N(   R#   R   t   Truet   False(   R   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR   t   s
    
 	c         C   s%   |  i  É  p |  i t É  É n d  S(   N(   R   t   appendGranteeR   (   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   grantAnonReadz   s    c         C   s<   g  } |  i  D] } | i É  p | | q q ~ |  _  d  S(   N(   R#   R   (   R   t   _[1]R1   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   revokeAnonRead~   s    c         C   s   |  i  i | É d  S(   N(   R#   R/   (   R   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR:   Å   s    c         C   sz   | i  É  } | i É  } x[ |  i D]P } | i i  É  | j o4 | i d j o t S| i i É  | j o t Sq" q" Wt S(   NR   (   t   lowert   upperR#   R   R   R8   R9   (   R   R   R   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   hasGrantÑ   s    
 c         C   s“   |  i  | | É o d  S| i É  } | i É  } d | j o
 d } n d | j o |  i | d É n t É  } | | _ | | _ | i d É d j o d | _ d | _	 n d | _ d | _	 |  i
 | É d  S(	   Nt   ALLR   t   @iˇˇˇˇt   CanonicalUsert   IDt   AmazonCustomerByEmailt   EmailAddress(   R@   R>   R?   t   revokeR   R   R   R-   R   R   R:   (   R   R   R   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR0   ë   s"    
						c         C   s≈   | i  É  } | i É  } d | j oE g  } |  i D]' } | i i  É  | j p | | q3 q3 ~ |  _ nX g  } |  i D]= } | i i  É  | j o | i i É  | j p | | qx qx ~ |  _ d  S(   NRA   (   R>   R?   R#   R   R   (   R   R   R   R<   R1   t   _[2](    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyRG   ¨   s
    Ec         C   sz   t  t i É } d | i d <| i d É } |  i | _ | i d É } x$ |  i D] } | i | i	 É  É qP Wt
 i | É S(   Ns'   http://s3.amazonaws.com/doc/2006-03-01/t   xmlnss   .//Owner//IDs   .//AccessControlList(   R    R    R"   R.   R-   R$   R   R#   R/   R   R   t   tostring(   R   R)   t   ownerR2   R   (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   __str__∂   s    
 N(   R   R   R"   R   R	   R&   R'   R4   R7   R   R;   R=   R:   R@   R0   RG   RL   (    (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyR    D   s   											
t   __main__sÀ  <?xml version="1.0" encoding="UTF-8"?>
<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
<Owner>
	<ID>12345678901234567890</ID>
	<DisplayName>owner-nickname</DisplayName>
</Owner>
<AccessControlList>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="CanonicalUser">
			<ID>12345678901234567890</ID>
			<DisplayName>owner-nickname</DisplayName>
		</Grantee>
		<Permission>FULL_CONTROL</Permission>
	</Grant>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="Group">
			<URI>http://acs.amazonaws.com/groups/global/AllUsers</URI>
		</Grantee>
		<Permission>READ</Permission>
	</Grant>
</AccessControlList>
</AccessControlPolicy>
	s   Grants:(   t   UtilsR    t   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   objectR   R   R   R    R   R(   R2   R4   R=   R;   (    (    (    s&   /Users/rlyon/src/s3cmd-1.0.1/S3/ACL.pyt   <module>   s"   $|


HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:04.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 24B4D8E4766849D5ABA1DF22107BADE5
x-amz-id-2: vkJ4RAdaRUfZqE06wJG7iquvwC1ASLtIctmfYviZYX11mSre
ETag: 181b5fac09b034b06e92badf8da00524

PUT /path/to/my/S3/BidirMap.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:YV+edauGQduZRuDtbSpPJkhEaPM=
content-length: 890
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423584/ctime:1321220014

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

class BidirMap(object):
	def __init__(self, **map):
		self.k2v = {}
		self.v2k = {}
		for key in map:
			self.__setitem__(key, map[key])

	def __setitem__(self, key, value):
		if self.v2k.has_key(value):
			if self.v2k[value] != key:
				raise KeyError("Value '"+str(value)+"' already in use with key '"+str(self.v2k[value])+"'")
		try:
			del(self.v2k[self.k2v[key]])
		except KeyError:
			pass
		self.k2v[key] = value
		self.v2k[value] = key

	def __getitem__(self, key):
		return self.k2v[key]

	def __str__(self):
		return self.v2k.__str__()

	def getkey(self, value):
		return self.v2k[value]
	
	def getvalue(self, key):
		return self.k2v[key]

	def keys(self):
		return [key for key in self.k2v]

	def values(self):
		return [value for value in self.v2k]
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 968BEE1854CEB832798DB5BCBA183A31
x-amz-id-2: QOKU27vokVNh4MznEwjPtLU9XS3CFvFoEblNL5g2VOjABhzq
ETag: 0a3d6c68a87253d7829a6a84f4f6b713

PUT /path/to/my/S3/CloudFront.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:pEayiGlkOQCEtgkqVzQRhqsl3Ls=
content-length: 20025
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423584/ctime:1321220027

—Ú
ÌsÒMc           @   s  d  d k  Z  d  d k Z d  d k Z d  d k l Z l Z l Z l Z y d  d k i	 i
 Z Wn" e j
 o d  d k i
 Z n Xd  d k l Z d  d k Td  d k l Z l Z l Z l Z l Z l Z l Z d  d k l Z l Z d Ñ  Z d Ñ  Z d	 e f d
 Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ  d e f d Ñ  É  YZ! d e f d Ñ  É  YZ" d S(   iˇˇˇˇN(   t   debugt   infot   warningt   error(   t   Config(   t   *(   t   getTreeFromXmlt   appendXmlTextNodet   getDictFromTreet   dateS3toPythont   sign_stringt   getBucketFromHostnamet   getHostnameFromBucket(   t   S3Urit   S3UriS3c         C   s   t  i i |  d É d  S(   Ns   
(   t   syst   stdoutt   write(   t   message(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   output   s    c         C   s+   d |  i  d É }  t d |  | f É d  S(   Ns   %s:i   s   %s %s(   t   ljustR   (   t   labelR   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   pretty_output   s    t   DistributionSummaryc           B   s#   e  Z d  Ñ  Z d Ñ  Z d Ñ  Z RS(   c         C   s8   | i  d j o t d | i  É Ç n |  i | É d  S(   NR   s1   Expected <DistributionSummary /> xml, got: <%s />(   t   tagt
   ValueErrort   parse(   t   selft   tree(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   __init__)   s    c         C   s3   t  | É |  _ |  i d i É  d j |  i d <d  S(   Nt   Enabledt   true(   R   R   t   lower(   R   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   .   s    c         C   s   t  d |  i d É S(   Ns   cf://%st   Id(   R   R   (   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   uri2   s    (   t   __name__t
   __module__R   R   R"   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR      s   		t   DistributionListc           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   sD   t  | É } | i d j o t d | i É Ç n |  i | É d  S(   NR%   s.   Expected <DistributionList /> xml, got: <%s />(   R   R   R   R   (   R   t   xmlR   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   A   s    c         C   sl   t  | É |  _ |  i d i É  d j |  i d <g  |  _ x- | i d É D] } |  i i t | É É qH Wd  S(   Nt   IsTruncatedR   s   .//DistributionSummary(   R   R   R    t
   dist_summst   findallt   appendR   (   R   R   t	   dist_summ(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   G   s     	 (   R#   R$   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR%   5   s   	t   Distributionc           B   s#   e  Z d  Ñ  Z d Ñ  Z d Ñ  Z RS(   c         C   sD   t  | É } | i d j o t d | i É Ç n |  i | É d  S(   NR,   s*   Expected <Distribution /> xml, got: <%s />(   R   R   R   R   (   R   R&   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   ]   s    c         C   sL   t  | É |  _ t |  i d É |  i d <t d | i d É É |  i d <d  S(   Nt   LastModifiedTimeR   s   .//DistributionConfigt   DistributionConfig(   R   R   R	   R.   t   find(   R   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   c   s    c         C   s   t  d |  i d É S(   Ns   cf://%sR!   (   R   R   (   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR"   j   s    (   R#   R$   R   R   R"   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR,   P   s   		R.   c           B   s5   e  Z d  Z d Z d d d Ñ Z d Ñ  Z d Ñ  Z RS(   s[   <DistributionConfig><Origin/><CallerReference/><Enabled>true</Enabled></DistributionConfig>s/   http://cloudfront.amazonaws.com/doc/2010-07-15/c         C   sc   | p t  i } n | p t | É } n | i d j o t d | i É Ç n |  i | É d  S(   NR.   s0   Expected <DistributionConfig /> xml, got: <%s />(   R.   t   EMPTY_CONFIGR   R   R   R   (   R   R&   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   }   s    c         C   sé  t  | É |  _ |  i d i É  d j |  i d <|  i i d É p g  |  i d <n t |  i d É t j o |  i d g |  i d <n g  } |  i d D] } | | i É  qö ~ |  i d <|  i i d É p d |  i d <n |  i i d É p d |  i d <n | i d É } | ob t  | d É } t | d	 É \ | d	 <} | p t d
 | d	 É n t	 d | É |  i d <n d  |  i d <d  S(   NR   R   t   CNAMEt   Commentt    t   DefaultRootObjects
   .//Loggingi    t   Buckets%   Logging to unparsable bucket name: %ss   s3://%(Bucket)s/%(Prefix)st   Logging(   R   R   R    t   has_keyt   typet   listR)   R   R   R   t   None(   R   R   t   _[1]t   cnamet   logging_nodest   logging_dictt   success(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   à   s&     5c         C   sw  t  i d É } t i | i d <t d |  i d | É t d |  i d | É x+ |  i d D] } t d | i É  | É q[ W|  i d o t d |  i d | É n t d t |  i d É i É  | É t |  i d É o! t d t |  i d É | É n |  i d	 o` t  i d	 É } t d
 t	 |  i d	 i
 É  É | É t d |  i d	 i É  | É | i | É n t  i | É S(   NR.   t   xmlnst   Origint   CallerReferenceR1   R2   R   R4   R6   R5   t   Prefix(   t   ETt   ElementR.   R@   t   attribR   R   R    t   strR   t   buckett   objectR*   t   tostring(   R   R   R<   t
   logging_el(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   __str__ü   s$     #!#N(   R#   R$   R0   R@   R:   R   R   RL   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR.   m   s
   	t
   CloudFrontc           B   s:  e  Z h h d  d 6d d 6d 6h d d 6d d 6d 6h d d 6d d 6d	 6h d d 6d d 6d
 6h d d 6d d 6d 6h d d 6d d 6d 6Z d Z d Ñ  Z d Ñ  Z g  d d d d Ñ Z g  g  d d d d d Ñ Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d d Ñ Z d d h  e d Ñ Z d d d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z RS(   t   POSTt   methodR3   t   resourcet
   CreateDistt   DELETEs   /%(dist_id)st
   DeleteDistt   GETt   GetListt   GetDistInfos   /%(dist_id)s/configt   GetDistConfigt   PUTt   SetDistConfigi   c         C   s   | |  _  d  S(   N(   t   config(   R   RZ   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   ¬   s    c         C   sI   |  i  d É } t | d É | d <| d i d o t d É Ç n | S(   NRU   t   datat	   dist_listR'   s3   List is truncated. Ask s3cmd author to add support.(   t   send_requestR%   R   t   NotImplementedError(   R   t   response(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRU   …   s
    c   
      C   s%  t  É  } t | i d <| i É  | i d <t | É | i d <| | i d <| d  j o | i É  | i d <n | | i d <xC | D]; } | i d i | É d j o | i d i | É qÅ qÅ W| o t	 | É | i d <n t | É } t
 d	 | É |  i d
 d | É}	 t |	 d É |	 d <|	 S(   NR   RA   RB   R4   R2   R1   i    R6   s&   CreateDistribution(): request_body: %sRQ   t   bodyR[   t   distribution(   R.   t   TrueR   t	   host_nameRG   R:   t
   public_urlt   countR*   R   R    R]   R,   (
   R   R"   t
   cnames_addt   commentt   loggingt   default_root_objectt   dist_configR<   t   request_bodyR_   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   CreateDistribution—   s&    	 c      	   C   sò  | i  d j o t d | É Ç n t d | É |  i | É } | d }	 | d  j o | |	 i d <n | d  j o | |	 i d <n | d  j o | |	 i d <n xC | D]; }
 |	 i d i |
 É d	 j o |	 i d i |
 É q¨ q¨ WxG | D]? }
 x6 |	 i d i |
 É d	 j o |	 i d i |
 É q˚ WqÚ W| d  j o5 | t j o t |	 i d
 <qwt	 | É |	 i d
 <n |  i
 | |	 | d d É } | S(   Nt   cfs   Expected CFUri instead of: %ss   Checking current status of %sRj   R   R2   R4   R1   i    R6   t   headerst   etag(   R8   R   R   RW   R:   Re   R*   t   removet   FalseR   RY   (   R   t   cfuriRf   t   cnames_removeRg   t   enabledRh   Ri   R_   t   dcR<   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   ModifyDistributionÊ   s4    
   c         C   sZ  | i  d j o t d | É Ç n t d | É |  i | É } | d i d o  t d É t | d i d <|  i | | d | d d É } t d	 É t d
 É xw t ok |  i | É } | d } | i d d j o# | i d t j o t d É Pn t d É t	 i
 d É q¶ Wn h  } | d d | d <|  i d d | i É  d | É} | S(   NRm   s   Expected CFUri instead of: %ss   Checking current status of %sRj   R   s)   Distribution is ENABLED. Disabling first.Rn   Ro   s,   Waiting for Distribution to become disabled.s+   This may take several minutes, please wait.Ra   t   Statust   Deployeds   Distribution is now disableds   Still waiting...i
   s   if-matchRS   t   dist_id(   R8   R   R   RW   Rq   RY   R   Rb   RV   t   timet   sleepR]   Ry   (   R   Rr   R_   t   dRn   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   DeleteDistribution  s2    


 
(

	c         C   sW   | i  d j o t d | É Ç n |  i d d | i É  É} t | d É | d <| S(   NRm   s   Expected CFUri instead of: %sRV   Ry   R[   Ra   (   R8   R   R]   Ry   R,   (   R   Rr   R_   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRV     s
    c         C   sW   | i  d j o t d | É Ç n |  i d d | i É  É} t | d É | d <| S(   NRm   s   Expected CFUri instead of: %sRW   Ry   R[   Rj   (   R8   R   R]   Ry   R.   (   R   Rr   R_   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRW   %  s
    c         C   sï   | d  j o% t d É |  i | É d d } n t d | É t | É } t d | É h  } | | d <|  i d d | i É  d	 | d | É} | S(
   Ns1   SetDistConfig(): Etag not set. Fetching it first.Rn   Ro   s   SetDistConfig(): Etag = %ss!   SetDistConfig(): request_body: %ss   if-matchRY   Ry   R`   (   R:   R    RW   RG   R]   Ry   (   R   Rr   Rj   Ro   Rk   Rn   R_   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRY   ,  s    

c         C   sµ  |  i  | } | o d | d <n |  i | | | É } |  i É  } t d | d | d f É | i | d | d | | d É | i É  }	 h  }
 |	 i |
 d <|	 i |
 d <t |	 i	 É  É |
 d <|	 i
 É  |
 d	 <| i É  t d
 |
 É |
 d d j oÉ t |
 É } | of t d | É t t | É É t d |  i | É É t i |  i | É É |  i | | | | d É S| Ç n |
 d d j  p |
 d d j o t |
 É Ç n |
 S(   Ns
   text/plains   content-types   send_request(): %s %sRO   RP   Rn   t   statust   reasonR[   s   CloudFront: response: %riÙ  u   Retrying failed request: %ss   Waiting %d sec...i   i»   i+  (   t
   operationst   create_requestt   get_connectionR    t   requestt   getresponseR~   R   t   dictt
   getheaderst   readt   closet   CloudFrontErrorR   t   unicodet
   _fail_waitRz   R{   R]   (   R   t   op_nameRy   R`   Rn   t   retriest	   operationRÉ   t   connt   http_responseR_   t   e(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR]   =  s6    "

"c         C   sÙ   |  i  i | d h | d 6} | p
 h  } n | i d É o- | i d É p | d | d <n | d =n | i d É p  t i d t i É  É | d <n |  i | É } d |  i  i d | | d <h  } | | d <| | d	 <| d
 | d
 <| S(   NRP   Ry   t   dates
   x-amz-dates   %a, %d %b %Y %H:%M:%S +0000s   AWS t   :t   AuthorizationRn   RO   (   RZ   t   cloudfront_resourceR7   Rz   t   strftimet   gmtimet   sign_requestt
   access_key(   R   Ré   Ry   Rn   RP   t	   signatureRÉ   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRÅ   _  s"    	
 

c         C   s.   | d } t  | É } t d | | f É | S(   Ns
   x-amz-dateu"   CloudFront.sign_request('%s') = %s(   R
   R    (   R   Rn   t   string_to_signRö   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRò   x  s    
c         C   s6   |  i  i d j o t d É Ç n t i |  i  i É S(   NR3   s7   CloudFront commands don't work from behind a HTTP proxy(   RZ   t
   proxy_hostt   ParameterErrort   httplibt   HTTPSConnectiont   cloudfront_host(   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRÇ   ~  s    c         C   s   |  i  | d d S(   Ni   i   (   t   _max_retries(   R   Rç   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRã   É  s    N(   R#   R$   RÄ   R°   R   RU   R:   Rl   Rv   R}   RV   RW   RY   R]   RÅ   Rò   RÇ   Rã   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyRM   µ   s.   						"		t   Cmdc           B   sç   e  Z d  Z d e f d Ñ  É  YZ e É  Z d	 Z e d Ñ  É Z	 e d Ñ  É Z
 e d Ñ  É Z e d Ñ  É Z e d Ñ  É Z e d Ñ  É Z RS(
   s-   
	Class that implements CloudFront commands
	t   Optionsc           B   s>   e  Z g  Z g  Z d Z d Z d Z d Z d  Ñ  Z	 d Ñ  Z
 RS(   c         C   s9   g  } t  |  É D]! } | i d É o | | q q ~ S(   Nt   cf_(   t   dirt
   startswith(   R   R;   t   opt(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   option_listî  s    c         C   s   t  t i | | É d  S(   N(   t   setattrR¢   t   options(   R   t   optiont   value(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   update_optionó  s    N(   R#   R$   t   cf_cnames_addt   cf_cnames_removeR:   t
   cf_commentt	   cf_enablet
   cf_loggingt   cf_default_root_objectR®   R≠   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR£   å  s   	c         C   sª   t  t É  É } t d |  É |  i d j p t Ç t i d  j of | i É  } h  t _ x9 | d i	 D]* } | i
 É  t i t | i d É d <qg Wt d t i É n t i |  i É  S(   Ns   _get_dist_name_for_bucket(%r)t   s3R\   RA   i    s   dist_list: %s(   RM   R   R    R8   t   AssertionErrorR¢   R\   R:   RU   R(   R"   R   R   RH   (   R"   Rm   R_   R|   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   _get_dist_name_for_bucketù  s    	 (c         C   s±   g  } x§ |  D]ú } t  | É } | i d j oI y t i | É } Wqx t j
 o# } t | É t d | É Ç qx Xn | i d j o t d | É Ç n | i | É q W| S(   NR¥   s>   Unable to translate S3 URI to CloudFront distribution name: %sRm   s&   CloudFront URI required instead of: %s(   R   R8   R¢   R∂   t	   ExceptionR    Rù   R*   (   t   argst   cfurist   argR"   Rë   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   _parse_args™  s     
c         C   sﬂ  t  t É  É } |  pû | i É  } x∂| d i D]| } t d t i | i d É É t d | i É  É t d | i d É t d | i d É t d | i d É t	 d É
 q0 Wn(t
 i |  É } x| D]} | i | É } | d } | i d	 } t d t i | i d É É t d | i É  É t d | i d É t d | i d É t d
 d i | i d É É t d | i d É t d | i d É t d | i d É t d | i d p d É t d | d d É q  Wd  S(   NR\   RA   t   DistIdt
   DomainNameRw   R   R3   Ra   R.   t   CNAMEss   , R1   R2   t   DfltRootObjectR4   R6   t   Disabledt   EtagRn   Ro   (   RM   R   RU   R(   R   R   t   httpurl_to_s3uriR   R"   R   R¢   Rª   RV   t   join(   R∏   Rm   R_   R|   Rπ   Rr   Ru   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR   ∫  s6      
c         C   s  t  t É  É } g  } xâ |  D]Å } t | É } | i d j o t d | É Ç n | i É  o t d | É Ç n | i É  p t d É Ç n | i | É q W| p t d É Ç n xB| D]:} t d | É | i	 | d t
 i i d t
 i i d	 t
 i i d
 t
 i i É} | d } | i d } t d É t d t i | i d É É t d | i É  É t d | i d É t d d i | i d É É t d | i d É t d | i d É t d | i d É t d | i d É t d | d d É qø Wd  S(   NR¥   s:   Bucket can only be created from a s3:// URI instead of: %ss4   Use s3:// URI with a bucket name only instead of: %ss3   CloudFront can only handle lowercase-named buckets.s   No valid bucket names founds   Creating distribution from: %sRf   Rg   Rh   Ri   Ra   R.   s   Distribution created:RA   Rº   RΩ   Ræ   s   , R1   R2   Rw   R   R4   R¡   Rn   Ro   (   RM   R   R   R8   Rù   RI   t   is_dns_compatibleR*   R   Rl   R¢   R™   RÆ   R∞   R≤   R≥   R   R   R   R¬   R"   R√   (   R∏   Rm   t   bucketsR∫   R"   R_   R|   Ru   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   create◊  sB      

c         C   s}   t  t É  É } t i |  É } xX | D]P } | i | É } | d d j o t d | | d f É n t d | É q% Wd  S(   NR~   iê  s(   Distribution %s could not be deleted: %sR   s   Distribution %s deleted(   RM   R   R¢   Rª   R}   R   R   (   R∏   Rm   Rπ   Rr   R_   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   delete˘  s     c         C   sÔ  t  t É  É } t |  É d j o t d É Ç n y t i |  É d } Wn! t j
 o } t d É Ç n X| i | d t i i	 d t i i
 d t i i d t i i d	 t i i d
 t i i É} | d d j o t d | | d f É n t d | É | i | É } | d } | i d } t d t i | i d É É t d | i É  É t d | i d É t d | i d É t d d i | i d É É t d | i d É t d | i d É t d | i d É t d | d d É d  S(   Ni   s7   Too many parameters. Modify one Distribution at a time.i    s    No valid Distribution URI found.Rf   Rs   Rg   Rt   Rh   Ri   R~   iê  s)   Distribution %s could not be modified: %sR   s   Distribution modified: %sRa   R.   RA   Rº   RΩ   Rw   Ræ   s   , R1   R2   R   R4   R¡   Rn   Ro   (   RM   R   t   lenRù   R¢   Rª   t
   IndexErrorRv   R™   RÆ   RØ   R∞   R±   R≤   R≥   R   R   RV   R   R   R   R¬   R"   R√   (   R∏   Rm   Rr   Rë   R_   R|   Ru   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   modify  s:    
N(   R#   R$   t   __doc__RI   R£   R™   R:   R\   t   staticmethodR∂   Rª   R   R∆   R«   R    (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyR¢   á  s   	"
(#   R   Rz   Rû   Rh   R    R   R   R   t   xml.etree.ElementTreet   etreet   ElementTreeRD   t   ImportErrort   elementtree.ElementTreeR   t
   Exceptionst   UtilsR   R   R   R	   R
   R   R   R   R   R   R   RI   R   R%   R,   R.   RM   R¢   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/CloudFront.pyt   <module>   s&   "
4		H“
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 6EFA9EEFFA49EE15AC1FA549CD9D4077
x-amz-id-2: knNYJI1oiiVZabJmH66XZmFV4BeqvyUIB6ZN6Nvi5iCKjMnL
ETag: cf95acdffd54fd3949d8b2f3e4e7d0f3

PUT /path/to/my/S3/Exceptions.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ik6bd57AM/a9QQsC/ubl/77oAJ0=
content-length: 2251
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423584/ctime:1321220014

## Amazon S3 manager - Exceptions library
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from Utils import getTreeFromXml, unicodise, deunicodise
from logging import debug, info, warning, error

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

class S3Exception(Exception):
	def __init__(self, message = ""):
		self.message = unicodise(message)

	def __str__(self):
		## Call unicode(self) instead of self.message because
		## __unicode__() method could be overriden in subclasses!
		return deunicodise(unicode(self))

	def __unicode__(self):
		return self.message

	## (Base)Exception.message has been deprecated in Python 2.6
	def _get_message(self):
		return self._message
	def _set_message(self, message):
		self._message = message
	message = property(_get_message, _set_message)


class S3Error (S3Exception):
	def __init__(self, response):
		self.status = response["status"]
		self.reason = response["reason"]
		self.info = {
			"Code" : "",
			"Message" : "",
			"Resource" : ""
		}
		debug("S3Error: %s (%s)" % (self.status, self.reason))
		if response.has_key("headers"):
			for header in response["headers"]:
				debug("HttpHeader: %s: %s" % (header, response["headers"][header]))
		if response.has_key("data"):
			tree = getTreeFromXml(response["data"])
			error_node = tree
			if not error_node.tag == "Error":
				error_node = tree.find(".//Error")
			for child in error_node.getchildren():
				if child.text != "":
					debug("ErrorXML: " + child.tag + ": " + repr(child.text))
					self.info[child.tag] = child.text
		self.code = self.info["Code"]
		self.message = self.info["Message"]
		self.resource = self.info["Resource"]

	def __unicode__(self):
		retval = u"%d " % (self.status)
		retval += (u"(%s)" % (self.info.has_key("Code") and self.info["Code"] or self.reason))
		if self.info.has_key("Message"):
			retval += (u": %s" % self.info["Message"])
		return retval

class CloudFrontError(S3Error):
	pass
		
class S3UploadError(S3Exception):
	pass

class S3DownloadError(S3Exception):
	pass

class S3RequestError(S3Exception):
	pass

class InvalidFileError(S3Exception):
	pass

class ParameterError(S3Exception):
	pass
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 1D2350257FDF13FBB0144AA27E1911CD
x-amz-id-2: wpyD8GY0UUJb8IM71bCNff5osuX985YSQ140Q7VHEYbmmeD7
ETag: f863cdc2cb89f3fe8836c4b603889dfb

PUT /path/to/my/S3/PkgInfo.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:o7PkZ1IhQky/dKwteCWMDvTNX4Y=
content-length: 639
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423584/ctime:1321220027

—Ú
µvÒMc           @   s(   d  Z  d Z d Z d Z d Z d Z d S(   t   s3cmds   1.0.1s   http://s3tools.orgs   GPL version 2s@   Command line tool for managing Amazon S3 and CloudFront servicessÚ   
S3cmd lets you copy files from/to Amazon S3 
(Simple Storage Service) using a simple to use
command line client. Supports rsync-like backup,
GPG encryption, and more. Also supports management
of Amazon's CloudFront content delivery network.
N(   t   packaget   versiont   urlt   licenset   short_descriptiont   long_description(    (    (    s*   /Users/rlyon/src/s3cmd-1.0.1/S3/PkgInfo.pyt   <module>   s
   
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: A71371BD3C0E869C84DBFCDB0E1D00EB
x-amz-id-2: 4y95E96DkWgmwT7PhFMT4Ko6rtaNF5XN87TDingAwq6mNDZU
ETag: 4eb412d003103ebc938ab27261c6cad1

PUT /path/to/my/S3/S3.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:7AoB3lidA6khzYqQdErAl3xsrWw=
content-length: 27438
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423584/ctime:1321386876

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import sys
import os, os.path
import time
import httplib
import logging
import mimetypes
import re
from logging import debug, info, warning, error
from stat import ST_SIZE

try:
	from hashlib import md5
except ImportError:
	from md5 import md5

from Utils import *
from SortedDict import SortedDict
from BidirMap import BidirMap
from Config import Config
from Exceptions import *
from ACL import ACL, GranteeLogDelivery
from AccessLog import AccessLog
from S3Uri import S3Uri

__all__ = []
class S3Request(object):
	def __init__(self, s3, method_string, resource, headers, params = {}):
		self.s3 = s3
		self.headers = SortedDict(headers or {}, ignore_case = True)
		self.resource = resource
		self.method_string = method_string
		self.params = params

		self.update_timestamp()
		self.sign()

	def update_timestamp(self):
		if self.headers.has_key("date"):
			del(self.headers["date"])
		self.headers["x-amz-date"] = time.strftime("%a, %d %b %Y %H:%M:%S +0000", time.gmtime())

	def format_param_str(self):
		"""
		Format URL parameters from self.params and returns
		?parm1=val1&parm2=val2 or an empty string if there 
		are no parameters.  Output of this function should 
		be appended directly to self.resource['uri']
		"""
		param_str = ""
		for param in self.params:
			if self.params[param] not in (None, ""):
				param_str += "&%s=%s" % (param, self.params[param])
			else:
				param_str += "&%s" % param
		return param_str and "?" + param_str[1:]

	def sign(self):
		h  = self.method_string + "\n"
		h += self.headers.get("content-md5", "")+"\n"
		h += self.headers.get("content-type", "")+"\n"
		h += self.headers.get("date", "")+"\n"
		for header in self.headers.keys():
			if header.startswith("x-amz-"):
				h += header+":"+str(self.headers[header])+"\n"
		if self.resource['bucket']:
			h += "/" + self.resource['bucket']
		h += self.resource['uri']
		debug("SignHeaders: " + repr(h))
		signature = sign_string(h)

		self.headers["Authorization"] = "AWS "+self.s3.config.access_key+":"+signature

	def get_triplet(self):
		self.update_timestamp()
		self.sign()
		resource = dict(self.resource)	## take a copy
		resource['uri'] += self.format_param_str()
		return (self.method_string, resource, self.headers)

class S3(object):
	http_methods = BidirMap(
		GET = 0x01,
		PUT = 0x02,
		HEAD = 0x04,
		DELETE = 0x08,
		MASK = 0x0F,
		)
	
	targets = BidirMap(
		SERVICE = 0x0100,
		BUCKET = 0x0200,
		OBJECT = 0x0400,
		MASK = 0x0700,
		)

	operations = BidirMap(
		UNDFINED = 0x0000,
		LIST_ALL_BUCKETS = targets["SERVICE"] | http_methods["GET"],
		BUCKET_CREATE = targets["BUCKET"] | http_methods["PUT"],
		BUCKET_LIST = targets["BUCKET"] | http_methods["GET"],
		BUCKET_DELETE = targets["BUCKET"] | http_methods["DELETE"],
		OBJECT_PUT = targets["OBJECT"] | http_methods["PUT"],
		OBJECT_GET = targets["OBJECT"] | http_methods["GET"],
		OBJECT_HEAD = targets["OBJECT"] | http_methods["HEAD"],
		OBJECT_DELETE = targets["OBJECT"] | http_methods["DELETE"],
	)

	codes = {
		"NoSuchBucket" : "Bucket '%s' does not exist",
		"AccessDenied" : "Access to bucket '%s' was denied",
		"BucketAlreadyExists" : "Bucket '%s' already exists",
		}

	## S3 sometimes sends HTTP-307 response 
	redir_map = {}

	## Maximum attempts of re-issuing failed requests
	_max_retries = 5

	def __init__(self, config):
		self.config = config

	def get_connection(self, bucket):
		if self.config.proxy_host != "":
			return httplib.HTTPConnection(self.config.proxy_host, self.config.proxy_port)
		else:
			if self.config.use_https:
				return httplib.HTTPSConnection(self.get_hostname(bucket))
			else:
				return httplib.HTTPConnection(self.get_hostname(bucket))

	def get_hostname(self, bucket):
		if bucket and check_bucket_name_dns_conformity(bucket):
			if self.redir_map.has_key(bucket):
				host = self.redir_map[bucket]
			else:
				host = getHostnameFromBucket(bucket)
		else:
			host = self.config.host_base
		debug('get_hostname(%s): %s' % (bucket, host))
		return host

	def set_hostname(self, bucket, redir_hostname):
		self.redir_map[bucket] = redir_hostname

	def format_uri(self, resource):
		if resource['bucket'] and not check_bucket_name_dns_conformity(resource['bucket']):
			uri = "/%s%s" % (resource['bucket'], resource['uri'])
		else:
			uri = resource['uri']
		if self.config.proxy_host != "":
			uri = "http://%s%s" % (self.get_hostname(resource['bucket']), uri)
		debug('format_uri(): ' + uri)
		return uri

	## Commands / Actions
	def list_all_buckets(self):
		request = self.create_request("LIST_ALL_BUCKETS")
		response = self.send_request(request)
		response["list"] = getListFromXml(response["data"], "Bucket")
		return response
	
	def bucket_list(self, bucket, prefix = None, recursive = None):
		def _list_truncated(data):
			## <IsTruncated> can either be "true" or "false" or be missing completely
			is_truncated = getTextFromXml(data, ".//IsTruncated") or "false"
			return is_truncated.lower() != "false"

		def _get_contents(data):
			return getListFromXml(data, "Contents")

		def _get_common_prefixes(data):
			return getListFromXml(data, "CommonPrefixes")

		uri_params = {}
		truncated = True
		list = []
		prefixes = []

		while truncated:
			response = self.bucket_list_noparse(bucket, prefix, recursive, uri_params)
			current_list = _get_contents(response["data"])
			current_prefixes = _get_common_prefixes(response["data"])
			truncated = _list_truncated(response["data"])
			if truncated:
				if current_list:
					uri_params['marker'] = self.urlencode_string(current_list[-1]["Key"])
				else:
					uri_params['marker'] = self.urlencode_string(current_prefixes[-1]["Prefix"])
				debug("Listing continues after '%s'" % uri_params['marker'])

			list += current_list
			prefixes += current_prefixes

		response['list'] = list
		response['common_prefixes'] = prefixes
		return response

	def bucket_list_noparse(self, bucket, prefix = None, recursive = None, uri_params = {}):
		if prefix:
			uri_params['prefix'] = self.urlencode_string(prefix)
		if not self.config.recursive and not recursive:
			uri_params['delimiter'] = "/"
		request = self.create_request("BUCKET_LIST", bucket = bucket, **uri_params)
		response = self.send_request(request)
		#debug(response)
		return response

	def bucket_create(self, bucket, bucket_location = None):
		headers = SortedDict(ignore_case = True)
		body = ""
		if bucket_location and bucket_location.strip().upper() != "US":
			bucket_location = bucket_location.strip()
			if bucket_location.upper() == "EU":
				bucket_location = bucket_location.upper()
			else:
				bucket_location = bucket_location.lower()
			body  = "<CreateBucketConfiguration><LocationConstraint>"
			body += bucket_location
			body += "</LocationConstraint></CreateBucketConfiguration>"
			debug("bucket_location: " + body)
			check_bucket_name(bucket, dns_strict = True)
		else:
			check_bucket_name(bucket, dns_strict = False)
		if self.config.acl_public:
			headers["x-amz-acl"] = "public-read"
		request = self.create_request("BUCKET_CREATE", bucket = bucket, headers = headers)
		response = self.send_request(request, body)
		return response

	def bucket_delete(self, bucket):
		request = self.create_request("BUCKET_DELETE", bucket = bucket)
		response = self.send_request(request)
		return response

	def bucket_info(self, uri):
		request = self.create_request("BUCKET_LIST", bucket = uri.bucket(), extra = "?location")
		response = self.send_request(request)
		response['bucket-location'] = getTextFromXml(response['data'], "LocationConstraint") or "any"
		return response

	def object_put(self, filename, uri, extra_headers = None, extra_label = ""):
		# TODO TODO
		# Make it consistent with stream-oriented object_get()
		if uri.type != "s3":
			raise ValueError("Expected URI type 's3', got '%s'" % uri.type)

		if not os.path.isfile(filename):
			raise InvalidFileError(u"%s is not a regular file" % unicodise(filename))
		try:
			file = open(filename, "rb")
			size = os.stat(filename)[ST_SIZE]
		except (IOError, OSError), e:
			raise InvalidFileError(u"%s: %s" % (unicodise(filename), e.strerror))
		headers = SortedDict(ignore_case = True)
		if extra_headers:
			headers.update(extra_headers)
		headers["content-length"] = size
		content_type = None
		if self.config.guess_mime_type:
			content_type = mimetypes.guess_type(filename)[0]
		if not content_type:
			content_type = self.config.default_mime_type
		debug("Content-Type set to '%s'" % content_type)
		headers["content-type"] = content_type
		if self.config.acl_public:
			headers["x-amz-acl"] = "public-read"
		if self.config.reduced_redundancy:
			headers["x-amz-storage-class"] = "REDUCED_REDUNDANCY"
		request = self.create_request("OBJECT_PUT", uri = uri, headers = headers)
		labels = { 'source' : unicodise(filename), 'destination' : unicodise(uri.uri()), 'extra' : extra_label }
		response = self.send_file(request, file, labels)
		return response

	def object_get(self, uri, stream, start_position = 0, extra_label = ""):
		if uri.type != "s3":
			raise ValueError("Expected URI type 's3', got '%s'" % uri.type)
		request = self.create_request("OBJECT_GET", uri = uri)
		labels = { 'source' : unicodise(uri.uri()), 'destination' : unicodise(stream.name), 'extra' : extra_label }
		response = self.recv_file(request, stream, labels, start_position)
		return response

	def object_delete(self, uri):
		if uri.type != "s3":
			raise ValueError("Expected URI type 's3', got '%s'" % uri.type)
		request = self.create_request("OBJECT_DELETE", uri = uri)
		response = self.send_request(request)
		return response

	def object_copy(self, src_uri, dst_uri, extra_headers = None):
		if src_uri.type != "s3":
			raise ValueError("Expected URI type 's3', got '%s'" % src_uri.type)
		if dst_uri.type != "s3":
			raise ValueError("Expected URI type 's3', got '%s'" % dst_uri.type)
		headers = SortedDict(ignore_case = True)
		headers['x-amz-copy-source'] = "/%s/%s" % (src_uri.bucket(), self.urlencode_string(src_uri.object()))
		## TODO: For now COPY, later maybe add a switch?
		headers['x-amz-metadata-directive'] = "COPY"
		if self.config.acl_public:
			headers["x-amz-acl"] = "public-read"
		if self.config.reduced_redundancy:
			headers["x-amz-storage-class"] = "REDUCED_REDUNDANCY"
		# if extra_headers:
		# 	headers.update(extra_headers)
		request = self.create_request("OBJECT_PUT", uri = dst_uri, headers = headers)
		response = self.send_request(request)
		return response

	def object_move(self, src_uri, dst_uri, extra_headers = None):
		response_copy = self.object_copy(src_uri, dst_uri, extra_headers)
		debug("Object %s copied to %s" % (src_uri, dst_uri))
		if getRootTagName(response_copy["data"]) == "CopyObjectResult":
			response_delete = self.object_delete(src_uri)
			debug("Object %s deleted" % src_uri)
		return response_copy

	def object_info(self, uri):
		request = self.create_request("OBJECT_HEAD", uri = uri)
		response = self.send_request(request)
		return response

	def get_acl(self, uri):
		if uri.has_object():
			request = self.create_request("OBJECT_GET", uri = uri, extra = "?acl")
		else:
			request = self.create_request("BUCKET_LIST", bucket = uri.bucket(), extra = "?acl")

		response = self.send_request(request)
		acl = ACL(response['data'])
		return acl

	def set_acl(self, uri, acl):
		if uri.has_object():
			request = self.create_request("OBJECT_PUT", uri = uri, extra = "?acl")
		else:
			request = self.create_request("BUCKET_CREATE", bucket = uri.bucket(), extra = "?acl")

		body = str(acl)
		debug(u"set_acl(%s): acl-xml: %s" % (uri, body))
		response = self.send_request(request, body)
		return response

	def get_accesslog(self, uri):
		request = self.create_request("BUCKET_LIST", bucket = uri.bucket(), extra = "?logging")
		response = self.send_request(request)
		accesslog = AccessLog(response['data'])
		return accesslog

	def set_accesslog_acl(self, uri):
		acl = self.get_acl(uri)
		debug("Current ACL(%s): %s" % (uri.uri(), str(acl)))
		acl.appendGrantee(GranteeLogDelivery("READ_ACP"))
		acl.appendGrantee(GranteeLogDelivery("WRITE"))
		debug("Updated ACL(%s): %s" % (uri.uri(), str(acl)))
		self.set_acl(uri, acl)

	def set_accesslog(self, uri, enable, log_target_prefix_uri = None, acl_public = False):
		request = self.create_request("BUCKET_CREATE", bucket = uri.bucket(), extra = "?logging")
		accesslog = AccessLog()
		if enable:
			accesslog.enableLogging(log_target_prefix_uri)
			accesslog.setAclPublic(acl_public)
		else:
			accesslog.disableLogging()
		body = str(accesslog)
		debug(u"set_accesslog(%s): accesslog-xml: %s" % (uri, body))
		try:
			response = self.send_request(request, body)
		except S3Error, e:
			if e.info['Code'] == "InvalidTargetBucketForLogging":
				info("Setting up log-delivery ACL for target bucket.")
				self.set_accesslog_acl(S3Uri("s3://%s" % log_target_prefix_uri.bucket()))
				response = self.send_request(request, body)
			else:
				raise
		return accesslog, response

	## Low level methods
	def urlencode_string(self, string, urlencoding_mode = None):
		if type(string) == unicode:
			string = string.encode("utf-8")

		if urlencoding_mode is None:
			urlencoding_mode = self.config.urlencoding_mode

		if urlencoding_mode == "verbatim":
			## Don't do any pre-processing
			return string

		encoded = ""
		## List of characters that must be escaped for S3
		## Haven't found this in any official docs
		## but my tests show it's more less correct.
		## If you start getting InvalidSignature errors
		## from S3 check the error headers returned
		## from S3 to see whether the list hasn't
		## changed.
		for c in string:	# I'm not sure how to know in what encoding 
					# 'object' is. Apparently "type(object)==str"
					# but the contents is a string of unicode
					# bytes, e.g. '\xc4\x8d\xc5\xafr\xc3\xa1k'
					# Don't know what it will do on non-utf8 
					# systems.
					#           [hope that sounds reassuring ;-)]
			o = ord(c)
			if (o < 0x20 or o == 0x7f):
				if urlencoding_mode == "fixbucket":
					encoded += "%%%02X" % o
				else:
					error(u"Non-printable character 0x%02x in: %s" % (o, string))
					error(u"Please report it to s3tools-bugs@lists.sourceforge.net")
					encoded += replace_nonprintables(c)
			elif (o == 0x20 or	# Space and below
			    o == 0x22 or	# "
			    o == 0x23 or	# #
			    o == 0x25 or	# % (escape character)
			    o == 0x26 or	# &
			    o == 0x2B or	# + (or it would become <space>)
			    o == 0x3C or	# <
			    o == 0x3E or	# >
			    o == 0x3F or	# ?
			    o == 0x60 or	# `
			    o >= 123):   	# { and above, including >= 128 for UTF-8
				encoded += "%%%02X" % o
			else:
				encoded += c
		debug("String '%s' encoded to '%s'" % (string, encoded))
		return encoded

	def create_request(self, operation, uri = None, bucket = None, object = None, headers = None, extra = None, **params):
		resource = { 'bucket' : None, 'uri' : "/" }

		if uri and (bucket or object):
			raise ValueError("Both 'uri' and either 'bucket' or 'object' parameters supplied")
		## If URI is given use that instead of bucket/object parameters
		if uri:
			bucket = uri.bucket()
			object = uri.has_object() and uri.object() or None

		if bucket:
			resource['bucket'] = str(bucket)
			if object:
				resource['uri'] = "/" + self.urlencode_string(object)
		if extra:
			resource['uri'] += extra

		method_string = S3.http_methods.getkey(S3.operations[operation] & S3.http_methods["MASK"])

		request = S3Request(self, method_string, resource, headers, params)

		debug("CreateRequest: resource[uri]=" + resource['uri'])
		return request
	
	def _fail_wait(self, retries):
		# Wait a few seconds. The more it fails the more we wait.
		return (self._max_retries - retries + 1) * 3
		
	def send_request(self, request, body = None, retries = _max_retries):
		method_string, resource, headers = request.get_triplet()
		debug("Processing request, plea
se wait...")
		if not headers.has_key('content-length'):
			headers['content-length'] = body and len(body) or 0
		try:
			# "Stringify" all headers
			for header in headers.keys():
				headers[header] = str(headers[header])
			conn = self.get_connection(resource['bucket'])
			conn.request(method_string, self.format_uri(resource), body, headers)
			response = {}
			http_response = conn.getresponse()
			response["status"] = http_response.status
			response["reason"] = http_response.reason
			response["headers"] = convertTupleListToDict(http_response.getheaders())
			response["data"] =  http_response.read()
			debug("Response: " + str(response))
			conn.close()
		except Exception, e:
			if retries:
				warning("Retrying failed request: %s (%s)" % (resource['uri'], e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				return self.send_request(request, body, retries - 1)
			else:
				raise S3RequestError("Request failed for: %s" % resource['uri'])

		if response["status"] == 307:
			## RedirectPermanent
			redir_bucket = getTextFromXml(response['data'], ".//Bucket")
			redir_hostname = getTextFromXml(response['data'], ".//Endpoint")
			self.set_hostname(redir_bucket, redir_hostname)
			warning("Redirected to: %s" % (redir_hostname))
			return self.send_request(request, body)

		if response["status"] >= 500:
			e = S3Error(response)
			if retries:
				warning(u"Retrying failed request: %s" % resource['uri'])
				warning(unicode(e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				return self.send_request(request, body, retries - 1)
			else:
				raise e

		if response["status"] < 200 or response["status"] > 299:
			raise S3Error(response)

		return response

	def send_file(self, request, file, labels, throttle = 0, retries = _max_retries):
		method_string, resource, headers = request.get_triplet()
		size_left = size_total = headers.get("content-length")
		if self.config.progress_meter:
			progress = self.config.progress_class(labels, size_total)
		else:
			info("Sending file '%s', please wait..." % file.name)
		timestamp_start = time.time()
		try:
			conn = self.get_connection(resource['bucket'])
			conn.connect()
			conn.putrequest(method_string, self.format_uri(resource))
			for header in headers.keys():
				conn.putheader(header, str(headers[header]))
			conn.endheaders()
		except Exception, e:
			if self.config.progress_meter:
				progress.done("failed")
			if retries:
				warning("Retrying failed request: %s (%s)" % (resource['uri'], e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				# Connection error -> same throttle value
				return self.send_file(request, file, labels, throttle, retries - 1)
			else:
				raise S3UploadError("Upload failed for: %s" % resource['uri'])
		file.seek(0)
		md5_hash = md5()
		try:
			while (size_left > 0):
				#debug("SendFile: Reading up to %d bytes from '%s'" % (self.config.send_chunk, file.name))
				data = file.read(self.config.send_chunk)
				md5_hash.update(data)
				conn.send(data)
				if self.config.progress_meter:
					progress.update(delta_position = len(data))
				size_left -= len(data)
				if throttle:
					time.sleep(throttle)
			md5_computed = md5_hash.hexdigest()
			response = {}
			http_response = conn.getresponse()
			response["status"] = http_response.status
			response["reason"] = http_response.reason
			response["headers"] = convertTupleListToDict(http_response.getheaders())
			response["data"] = http_response.read()
			response["size"] = size_total
			conn.close()
			debug(u"Response: %s" % response)
		except Exception, e:
			if self.config.progress_meter:
				progress.done("failed")
			if retries:
				if retries < self._max_retries:
					throttle = throttle and throttle * 5 or 0.01
				warning("Upload failed: %s (%s)" % (resource['uri'], e))
				warning("Retrying on lower speed (throttle=%0.2f)" % throttle)
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				# Connection error -> same throttle value
				return self.send_file(request, file, labels, throttle, retries - 1)
			else:
				debug("Giving up on '%s' %s" % (file.name, e))
				raise S3UploadError("Upload failed for: %s" % resource['uri'])

		timestamp_end = time.time()
		response["elapsed"] = timestamp_end - timestamp_start
		response["speed"] = response["elapsed"] and float(response["size"]) / response["elapsed"] or float(-1)

		if self.config.progress_meter:
			## The above conn.close() takes some time -> update() progress meter
			## to correct the average speed. Otherwise people will complain that 
			## 'progress' and response["speed"] are inconsistent ;-)
			progress.update()
			progress.done("done")

		if response["status"] == 307:
			## RedirectPermanent
			redir_bucket = getTextFromXml(response['data'], ".//Bucket")
			redir_hostname = getTextFromXml(response['data'], ".//Endpoint")
			self.set_hostname(redir_bucket, redir_hostname)
			warning("Redirected to: %s" % (redir_hostname))
			return self.send_file(request, file, labels)

		# S3 from time to time doesn't send ETag back in a response :-(
		# Force re-upload here.
		if not response['headers'].has_key('etag'):
			response['headers']['etag'] = '' 

		if response["status"] < 200 or response["status"] > 299:
			try_retry = False
			if response["status"] >= 500:
				## AWS internal error - retry
				try_retry = True
			elif response["status"] >= 400:
				err = S3Error(response)
				## Retriable client error?
				if err.code in [ 'BadDigest', 'OperationAborted', 'TokenRefreshRequired', 'RequestTimeout' ]:
					try_retry = True

			if try_retry:
				if retries:
					warning("Upload failed: %s (%s)" % (resource['uri'], S3Error(response)))
					warning("Waiting %d sec..." % self._fail_wait(retries))
					time.sleep(self._fail_wait(retries))
					return self.send_file(request, file, labels, throttle, retries - 1)
				else:
					warning("Too many failures. Giving up on '%s'" % (file.name))
					raise S3UploadError

			## Non-recoverable error
			raise S3Error(response)

		debug("MD5 sums: computed=%s, received=%s" % (md5_computed, response["headers"]["etag"]))
		if response["headers"]["etag"].strip('"\'') != md5_hash.hexdigest():
			warning("MD5 Sums don't match!")
			if retries:
				warning("Retrying upload of %s" % (file.name))
				return self.send_file(request, file, labels, throttle, retries - 1)
			else:
				warning("Too many failures. Giving up on '%s'" % (file.name))
				raise S3UploadError

		return response

	def recv_file(self, request, stream, labels, start_position = 0, retries = _max_retries):
		method_string, resource, headers = request.get_triplet()
		if self.config.progress_meter:
			progress = self.config.progress_class(labels, 0)
		else:
			info("Receiving file '%s', please wait..." % stream.name)
		timestamp_start = time.time()
		try:
			conn = self.get_connection(resource['bucket'])
			conn.connect()
			conn.putrequest(method_string, self.format_uri(resource))
			for header in headers.keys():
				conn.putheader(header, str(headers[header]))
			if start_position > 0:
				debug("Requesting Range: %d .. end" % start_position)
				conn.putheader("Range", "bytes=%d-" % start_position)
			conn.endheaders()
			response = {}
			http_response = conn.getresponse()
			response["status"] = http_response.status
			response["reason"] = http_response.reason
			response["headers"] = convertTupleListToDict(http_response.getheaders())
			debug("Response: %s" % response)
		except Exception, e:
			if self.config.progress_meter:
				progress.done("failed")
			if retries:
				warning("Retrying failed request: %s (%s)" % (resource['uri'], e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				# Connection error -> same throttle value
				return self.recv_file(request, stream, labels, start_position, retries - 1)
			else:
				raise S3DownloadError("Download failed for: %s" % resource['uri'])

		if response["status"] == 307:
			## RedirectPermanent
			response['data'] = http_response.read()
			redir_bucket = getTextFromXml(response['data'], ".//Bucket")
			redir_hostname = getTextFromXml(response['data'], ".//Endpoint")
			self.set_hostname(redir_bucket, redir_hostname)
			warning("Redirected to: %s" % (redir_hostname))
			return self.recv_file(request, stream, labels)

		if response["status"] < 200 or response["status"] > 299:
			raise S3Error(response)

		if start_position == 0:
			# Only compute MD5 on the fly if we're downloading from beginning
			# Otherwise we'd get a nonsense.
			md5_hash = md5()
		size_left = int(response["headers"]["content-length"])
		size_total = start_position + size_left
		current_position = start_position

		if self.config.progress_meter:
			progress.total_size = size_total
			progress.initial_position = current_position
			progress.current_position = current_position

		try:
			while (current_position < size_total):
				this_chunk = size_left > self.config.recv_chunk and self.config.recv_chunk or size_left
				data = http_response.read(this_chunk)
				stream.write(data)
				if start_position == 0:
					md5_hash.update(data)
				current_position += len(data)
				## Call progress meter from here...
				if self.config.progress_meter:
					progress.update(delta_position = len(data))
			conn.close()
		except Exception, e:
			if self.config.progress_meter:
				progress.done("failed")
			if retries:
				warning("Retrying failed request: %s (%s)" % (resource['uri'], e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				# Connection error -> same throttle value
				return self.recv_file(request, stream, labels, current_position, retries - 1)
			else:
				raise S3DownloadError("Download failed for: %s" % resource['uri'])

		stream.flush()
		timestamp_end = time.time()

		if self.config.progress_meter:
			## The above stream.flush() may take some time -> update() progress meter
			## to correct the average speed. Otherwise people will complain that 
			## 'progress' and response["speed"] are inconsistent ;-)
			progress.update()
			progress.done("done")

		if start_position == 0:
			# Only compute MD5 on the fly if we were downloading from the beginning
			response["md5"] = md5_hash.hexdigest()
		else:
			# Otherwise try to compute MD5 of the output file
			try:
				response["md5"] = hash_file_md5(stream.name)
			except IOError, e:
				if e.errno != errno.ENOENT:
					warning("Unable to open file: %s: %s" % (stream.name, e))
				warning("Unable to verify MD5. Assume it matches.")
				response["md5"] = response["headers"]["etag"]

		response["md5match"] = response["headers"]["etag"].find(response["md5"]) >= 0
		response["elapsed"] = timestamp_end - timestamp_start
		response["size"] = current_position
		response["speed"] = response["elapsed"] and float(response["size"]) / response["elapsed"] or float(-1)
		if response["size"] != start_position + long(response["headers"]["content-length"]):
			warning("Reported size (%s) does not match received size (%s)" % (
				start_position + response["headers"]["content-length"], response["size"]))
		debug("ReceiveFile: Computed MD5 = %s" % response["md5"])
		if not response["md5match"]:
			warning("MD5 signatures do not match: computed=%s, received=%s" % (
				response["md5"], response["headers"]["etag"]))
		return response
__all__.append("S3")
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: B67B80919B1B724E2EAFAE4AFE8C301B
x-amz-id-2: dK0c8z1F1O8it9XEloxv39IzafnFZY38CHoCVBZQRC2ztSXb
ETag: e2ee17326aea0c8c74d0a31b0c7dfc7b

PUT /path/to/my/S3/S3Uri.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:8odFLtZk/XrUuWo/EWdTeQVf5r4=
content-length: 8954
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423584/ctime:1321220027

—Ú
ÌsÒMc        
   @   s8  d  d k  Z  d  d k Z d  d k Z d  d k l Z d  d k l Z d  d k Z d  d k l Z l	 Z	 d e
 f d Ñ  É  YZ d e f d Ñ  É  YZ d	 e f d
 Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ e d j oSe d É Z d Ge e É GHd Ge GHd Ge i GHd Ge i É  GHd Ge i
 É  GHHe d É Z d Ge e É GHd Ge GHd Ge i GHd Ge i É  GHHe d É Z d Ge e É GHd Ge GHd Ge i GHd Ge i É  GHHe d É Z d Ge e É GHd Ge GHd Ge i GHd Ge i É  GHHe d É Z d Ge e É GHd Ge GHd Ge i GHd Ge i É  GHHn d S(   iˇˇˇˇN(   t   BidirMap(   t   debug(   t	   unicodiset    check_bucket_name_dns_conformityt   S3Uric           B   sA   e  Z d Z d Z d  Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 RS(   c         C   s   |  i  pè g  |  _  t i t i } xs | D]g } t | | É t |  É j	 o q* n t | | |  É o) | | |  j o |  i  i | | É q* q* Wn xP |  i  D]E } y$ t i	 | É } | i
 | É | SWq£ t j
 o } q£ q£ Xq£ Wt d | É Ç d  S(   Ns   %s: not a recognized URI(   t   _subclassest   syst   modulest   __name__t   __dict__t   typet
   issubclasst   appendt   objectt   __new__t   __init__t
   ValueError(   t   selft   stringt   dictt	   somethingt   subclasst   instancet   e(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR      s$    
	 % 
 c         C   s
   |  i  É  S(   N(   t   uri(   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   __str__%   s    c         C   s
   |  i  É  S(   N(   R   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   __unicode__(   s    c         C   s   t  d É Ç d  S(   Ns6   This S3 URI does not have Anonymous URL representation(   R   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt
   public_url+   s    c         C   s   |  i  É  i d É d S(   Nt   /iˇˇˇˇ(   R   t   split(   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   basename.   s    N(
   R   t
   __module__t   NoneR
   R   R   R   R   R   R   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR      s   				t   S3UriS3c           B   sï   e  Z d  Z e i d e i É Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d Ñ  Z d Ñ  Z d	 Ñ  Z d
 Ñ  Z e d d Ñ É Z e d Ñ  É Z RS(   t   s3s   ^s3://([^/]+)/?(.*)c         C   s]   |  i  i | É } | p t d | É Ç n | i É  } | d |  _ t | d É |  _ d  S(   Ns   %s: not a S3 URIi    i   (   t   _ret   matchR   t   groupst   _bucketR   t   _object(   R   R   R$   R%   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   4   s    c         C   s   |  i  S(   N(   R&   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   bucket<   s    c         C   s   |  i  S(   N(   R'   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   ?   s    c         C   s   t  |  i É S(   N(   t   boolR&   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt
   has_bucketB   s    c         C   s   t  |  i É S(   N(   R)   R'   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt
   has_objectE   s    c         C   s   d i  d |  i |  i g É S(   NR   s   s3:/(   t   joinR&   R'   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   H   s    c         C   s   t  |  i É S(   N(   R   R&   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   is_dns_compatibleK   s    c         C   s:   |  i  É  o d |  i |  i f Sd |  i |  i f Sd  S(   Ns   http://%s.s3.amazonaws.com/%ss   http://s3.amazonaws.com/%s/%s(   R-   R&   R'   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   N   s    c         C   s!   |  i  É  o d |  i Sd Sd  S(   Ns   %s.s3.amazonaws.coms   s3.amazonaws.com(   R-   R&   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt	   host_nameT   s    t    c         C   s   d |  | f S(   Ns
   s3://%s/%s(    (   R(   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   compose_uriZ   s    c         C   s⁄   t  i d |  t  i É } | i É  d \ } } | i É  } | d j oB | i d É d j o | } d } qæ | i d d É \ } } n6 | i d É o | t d É  } n t	 d |  É Ç t
 d	 h | d
 6| d 6É S(   Ns   (https?://)?([^/]+)/?(.*)i   s   s3.amazonaws.comR   i    R/   s   .s3.amazonaws.coms   Unable to parse URL: %ss   s3://%(bucket)s/%(object)sR(   R   (   t   reR$   t
   IGNORECASER%   t   lowert   countR   t   endswitht   lenR   R   (   t   http_urlt   mt   hostnameR   R(   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   httpurl_to_s3uri^   s    
	(   R   R   R
   R1   t   compileR2   R#   R   R(   R   R*   R+   R   R-   R   R.   t   staticmethodR0   R:   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR!   1   s   									t	   S3UriS3FSc           B   sG   e  Z d  Z e i d e i É Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 RS(   t   s3fss   ^s3fs://([^/]*)/?(.*)c         C   sf   |  i  i | É } | p t d | É Ç n | i É  } | d |  _ t | d É i d É |  _ d  S(   Ns   %s: not a S3fs URIi    i   R   (   R#   R$   R   R%   t   _fsnameR   R   t   _path(   R   R   R$   R%   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   x   s    c         C   s   |  i  S(   N(   R?   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   fsnameÄ   s    c         C   s   d i  |  i É S(   NR   (   R,   R@   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   pathÉ   s    c         C   s   d i  d |  i |  i É  g É S(   NR   s   s3fs:/(   R,   R?   RB   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   Ü   s    (   R   R   R
   R1   R;   R2   R#   R   RA   RB   R   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR=   u   s   			t	   S3UriFilec           B   sJ   e  Z d  Z e i d É Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 RS(   t   files   ^(\w+://)?(.*)c         C   sc   |  i  i | É } | i É  } | d d j o t d | É Ç n t | d É i d É |  _ d  S(   Ni    s   file://s   %s: not a file:// URIi   R   (   Ns   file://(   R#   R$   R%   R    R   R   R   R@   (   R   R   R$   R%   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   å   s
    c         C   s   d i  |  i É S(   NR   (   R,   R@   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyRB   ì   s    c         C   s   d i  d |  i É  g É S(   NR   s   file:/(   R,   RB   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   ñ   s    c         C   s   t  i i |  i É  É S(   N(   t   osRB   t   isdir(   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyRF   ô   s    c         C   s   t  i i |  i É  É S(   N(   RE   RB   t   dirname(   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyRG   ú   s    (   R   R   R
   R1   R;   R#   R   RB   R   RF   RG   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyRC   â   s   				t   S3UriCloudFrontc           B   s>   e  Z d  Z e i d e i É Z d Ñ  Z d Ñ  Z d Ñ  Z	 RS(   t   cfs   ^cf://([^/]*)/?c         C   sJ   |  i  i | É } | p t d | É Ç n | i É  } | d |  _ d  S(   Ns   %s: not a CloudFront URIi    (   R#   R$   R   R%   t   _dist_id(   R   R   R$   R%   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   ¢   s
    c         C   s   |  i  S(   N(   RJ   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   dist_id©   s    c         C   s   d i  d |  i É  g É S(   NR   s   cf:/(   R,   RK   (   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyR   ¨   s    (
   R   R   R
   R1   R;   R2   R#   R   RK   R   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyRH   ü   s
   		t   __main__s   s3://bucket/objects	   type()  =s	   uri     =s	   uri.type=s	   bucket  =s	   object  =s   s3://buckets*   s3fs://filesystem1/path/to/remote/file.txts	   path    =s   /path/to/local/file.txts   cf://1234567890ABCD/s	   dist_id =(   RE   R1   R   R    t   loggingR   t   S3t   UtilsR   R   R   R   R!   R=   RC   RH   R   R   R
   R(   RB   RK   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/S3Uri.pyt   <module>   sV   #D					
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: A118153A152533DDA6AB9B48528009AD
x-amz-id-2: RjiLHuTGrvlPv4ZA2lUGGTMr39bX2NDY07Wh6GWzvXRBWauK
ETag: 4693dba05bcc4e2da47fed4a10db8069

PUT /path/to/my/S3/SortedDict.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:8aA7MGpJpq70dF9qn55zTnr6hyg=
content-length: 2591
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423584/ctime:1321220027

—Ú
ÌsÒMc           @   sÏ   d  d k  l  Z  d e f d Ñ  É  YZ d e f d Ñ  É  YZ e d j oü h d d 6d	 d
 6d d 6d d 6d d 6Z e e É Z d GHd Gx e D] Z d e Gqé Wd GHe e d e	 ÉZ d GHd Gx e i
 É  D] Z d e GqÕ Wd GHn d S(   iˇˇˇˇ(   t   BidirMapt   SortedDictIteratorc           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   s   | |  _  | |  _ d  S(   N(   t   sorted_dictt   keys(   t   selfR   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyt   __init__	   s    	c         C   s4   y |  i  i d É SWn t j
 o t Ç n Xd  S(   Ni    (   R   t   popt
   IndexErrort   StopIteration(   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyt   next   s    (   t   __name__t
   __module__R   R	   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyR      s   	t
   SortedDictc           B   s)   e  Z h  e d  Ñ Z d Ñ  Z d Ñ  Z RS(   c         K   s    t  i |  | | ç | |  _ d S(   sÊ   
		WARNING: SortedDict() with ignore_case==True will
		         drop entries differing only in capitalisation!
				 Eg: SortedDict({'auckland':1, 'Auckland':2}).keys() => ['Auckland']
				 With ignore_case==False it's all right
		N(   t   dictR   t   ignore_case(   R   t   mappingR   t   kwargs(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyR      s    c         C   sè   t  i |  É } |  i od t É  } x | D] } | | | i É  <q) W| i É  } | i É  g  } | D] } | | | qd ~ S| i É  | Sd  S(   N(   R   R   R   R    t   lowert   sort(   R   R   t   xlat_mapt   keyt   lc_keyst   _[1]t   k(    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyR      s    
	 
$
c         C   s   t  |  |  i É  É S(   N(   R   R   (   R   (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyt   __iter__-   s    (   R
   R   t   TrueR   R   R   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyR      s   
	t   __main__i   t   AWSi   t   Actioni   t   americai   t   Aucklandi   t   Americas8   Wanted: Action, america, Auckland, AWS,    [ignore case]s   Got:   s   %s,s      [used: __iter__()]R   s;   Wanted: AWS, Action, Auckland, america,    [case sensitive]s      [used: keys()]N(   R    t   objectR   R   R   R
   t   dt   sdR   t   FalseR   (    (    (    s-   /Users/rlyon/src/s3cmd-1.0.1/S3/SortedDict.pyt   <module>   s$   )  
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 32EB9D64F408335105971C696A2EADBC
x-amz-id-2: FQtSeC5oOHCmnAxc7ETu3OfrA3SFID6TeFe6DTjzvhbohKML
ETag: b7de15f5827bbed529f5b1671c895cd3

PUT /path/to/my/S3/__init__.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:MwV34lQgzMCCIht0EN8pqQjG+r4=
content-length: 0
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:53:05 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307668556/atime:1322423584/ctime:1321220014

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:53:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 398A7D617CDC52172F3FEA36025B8AFF
x-amz-id-2: XcGvKQzNbQDjmPN6xiqlYUpUdAxO5VuIJoHjwS2IBkx5IbHC
ETag: d41d8cd98f00b204e9800998ecf8427e

PUT /path/to/my/S3/ACL.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:obh0namly57nd7yDQQW25H6xVxY=
content-length: 5989
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423642/ctime:1321220014

## Amazon S3 - Access Control List representation
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from Utils import getTreeFromXml

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

class Grantee(object):
	ALL_USERS_URI = "http://acs.amazonaws.com/groups/global/AllUsers"
	LOG_DELIVERY_URI = "http://acs.amazonaws.com/groups/s3/LogDelivery"

	def __init__(self):
		self.xsi_type = None
		self.tag = None
		self.name = None
		self.display_name = None
		self.permission = None

	def __repr__(self):
		return 'Grantee("%(tag)s", "%(name)s", "%(permission)s")' % { 
			"tag" : self.tag, 
			"name" : self.name, 
			"permission" : self.permission 
		}

	def isAllUsers(self):
		return self.tag == "URI" and self.name == Grantee.ALL_USERS_URI
	
	def isAnonRead(self):
		return self.isAllUsers() and (self.permission == "READ" or self.permission == "FULL_CONTROL")
	
	def getElement(self):
		el = ET.Element("Grant")
		grantee = ET.SubElement(el, "Grantee", { 
			'xmlns:xsi' : 'http://www.w3.org/2001/XMLSchema-instance',
			'xsi:type' : self.xsi_type
		})
		name = ET.SubElement(grantee, self.tag)
		name.text = self.name
		permission = ET.SubElement(el, "Permission")
		permission.text = self.permission
		return el

class GranteeAnonRead(Grantee):
	def __init__(self):
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.ALL_USERS_URI
		self.permission = "READ"

class GranteeLogDelivery(Grantee):
	def __init__(self, permission):
		"""
		permission must be either READ_ACP or WRITE
		"""
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.LOG_DELIVERY_URI
		self.permission = permission

class ACL(object):
	EMPTY_ACL = "<AccessControlPolicy><Owner><ID></ID></Owner><AccessControlList></AccessControlList></AccessControlPolicy>"

	def __init__(self, xml = None):
		if not xml:
			xml = ACL.EMPTY_ACL

		self.grantees = []
		self.owner_id = ""
		self.owner_nick = ""

		tree = getTreeFromXml(xml)
		self.parseOwner(tree)
		self.parseGrants(tree)

	def parseOwner(self, tree):
		self.owner_id = tree.findtext(".//Owner//ID")
		self.owner_nick = tree.findtext(".//Owner//DisplayName")

	def parseGrants(self, tree):
		for grant in tree.findall(".//Grant"):
			grantee = Grantee()
			g = grant.find(".//Grantee")
			grantee.xsi_type = g.attrib['{http://www.w3.org/2001/XMLSchema-instance}type']
			grantee.permission = grant.find('Permission').text
			for el in g:
				if el.tag == "DisplayName":
					grantee.display_name = el.text
				else:
					grantee.tag = el.tag
					grantee.name = el.text
			self.grantees.append(grantee)

	def getGrantList(self):
		acl = []
		for grantee in self.grantees:
			if grantee.display_name:
				user = grantee.display_name
			elif grantee.isAllUsers():
				user = "*anon*"
			else:
				user = grantee.name
			acl.append({'grantee': user, 'permission': grantee.permission})
		return acl

	def getOwner(self):
		return { 'id' : self.owner_id, 'nick' : self.owner_nick }

	def isAnonRead(self):
		for grantee in self.grantees:
			if grantee.isAnonRead():
				return True
		return False
	
	def grantAnonRead(self):
		if not self.isAnonRead():
			self.appendGrantee(GranteeAnonRead())
	
	def revokeAnonRead(self):
		self.grantees = [g for g in self.grantees if not g.isAnonRead()]

	def appendGrantee(self, grantee):
		self.grantees.append(grantee)

	def hasGrant(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		for grantee in self.grantees:
			if grantee.name.lower() == name:
				if grantee.permission == "FULL_CONTROL":
					return True
				elif grantee.permission.upper() == permission:
					return True

		return False;

	def grant(self, name, permission):
		if self.hasGrant(name, permission):
			return

		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			permission = "FULL_CONTROL"

		if "FULL_CONTROL" == permission:
			self.revoke(name, "ALL")

		grantee = Grantee()
		grantee.name = name
		grantee.permission = permission

		if  name.find('@') <= -1: # ultra lame attempt to differenciate emails id from canonical ids
			grantee.xsi_type = "CanonicalUser"
			grantee.tag = "ID"
		else:
			grantee.xsi_type = "AmazonCustomerByEmail"
			grantee.tag = "EmailAddress"
				
		self.appendGrantee(grantee)


	def revoke(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			self.grantees = [g for g in self.grantees if not g.name.lower() == name]
		else:
			self.grantees = [g for g in self.grantees if not (g.name.lower() == name and g.permission.upper() ==  permission)]


	def __str__(self):
		tree = getTreeFromXml(ACL.EMPTY_ACL)
		tree.attrib['xmlns'] = "http://s3.amazonaws.com/doc/2006-03-01/"
		owner = tree.find(".//Owner//ID")
		owner.text = self.owner_id
		acl = tree.find(".//AccessControlList")
		for grantee in self.grantees:
			acl.append(grantee.getElement())
		return ET.tostring(tree)

if __name__ == "__main__":
	xml = """<?xml version="1.0" encoding="UTF-8"?>
<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
<Owner>
	<ID>12345678901234567890</ID>
	<DisplayName>owner-nickname</DisplayName>
</Owner>
<AccessControlList>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="CanonicalUser">
			<ID>12345678901234567890</ID>
			<DisplayName>owner-nickname</DisplayName>
		</Grantee>
		<Permission>FULL_CONTROL</Permission>
	</Grant>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="Group">
			<URI>http://acs.amazonaws.com/groups/global/AllUsers</URI>
		</Grantee>
		<Permission>READ</Permission>
	</Grant>
</AccessControlList>
</AccessControlPolicy>
	"""
	acl = ACL(xml)
	print "Grants:", acl.getGrantList()
	acl.revokeAnonRead()
	print "Grants:", acl.getGrantList()
	acl.grantAnonRead()
	print "Grants:", acl.getGrantList()
	print acl
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 2F0E21B687B5D40B0E241E9C620BAE84
x-amz-id-2: q2enhX6MEu5epRPsPib0qDUrkXKNnK4aUG2ZlGqgenEgJkVb
ETag: 577a2c29e4910b5be9d133592a50b85e

PUT /path/to/my/S3/AccessLog.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:BmTGDvTCOrEKSdvPVfeGOsif9Ho=
content-length: 3705
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423642/ctime:1321220027

—Ú
ÌsÒMc           @   s  d  d k  Z  d  d k l Z d  d k l Z d  d k l Z y d  d k i i	 Z
 Wn" e j
 o d  d k i	 Z
 n Xg  Z d e f d Ñ  É  YZ e i d É e d j om d  d k  l  Z  e É  Z e GHe i e  d	 É É e GHe i e É e GHe i e É e GHe i É  e GHn d S(
   iˇˇˇˇN(   t   ParameterError(   t   getTreeFromXml(   t   GranteeAnonReadt	   AccessLogc           B   s_   e  Z d  Z d Z d
 d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d	 Ñ  Z RS(   s+   <BucketLoggingStatus></BucketLoggingStatus>s[   <LoggingEnabled><TargetBucket></TargetBucket><TargetPrefix></TargetPrefix></LoggingEnabled>c         C   s7   | p |  i  } n t | É |  _ d |  i i d <d  S(   Ns&   http://doc.s3.amazonaws.com/2006-03-01t   xmlns(   t   LOG_DISABLEDR   t   treet   attrib(   t   selft   xml(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __init__   s    c         C   s   t  |  i i d É É S(   Ns   .//LoggingEnabled(   t   boolR   t   find(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isLoggingEnabled   s    c         C   s1   |  i  i d É } | o |  i  i | É n d  S(   Ns   .//LoggingEnabled(   R   R   t   remove(   R   t   el(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   disableLogging   s    c         C   sp   |  i  i d É } | p# t |  i É } |  i  i | É n | i É  | i d É _ | i É  | i d É _ d  S(   Ns   .//LoggingEnableds   .//TargetBuckets   .//TargetPrefix(   R   R   R   t   LOG_TEMPLATEt   appendt   buckett   textt   object(   R   t   target_prefix_uriR   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   enableLogging#   s    c         C   sc   |  i  É  oN |  i i d É } d |  i i d É i |  i i d É i f } t i | É Sd Sd  S(   Ns   .//LoggingEnableds
   s3://%s/%ss   .//LoggingEnabled//TargetBuckets   .//LoggingEnabled//TargetPrefixt    (   R   R   R   R   t   S3Uri(   R   R   t   target_prefix(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   targetPrefix+   s    c         C   sô   |  i  i d É } | p t d É Ç n | i d É } | p | p d  S| i | É n: t É  i É  } | p t i | d É } n | i | É d  S(   Ns   .//LoggingEnableds3   Logging not enabled, can't set default ACL for logss   .//TargetGrantst   TargetGrants(	   R   R   R    R   R   t
   getElementt   ETt
   SubElementR   (   R   t
   acl_publict   let   tgt	   anon_read(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   setAclPublic5   s    c         C   s   t  É  Ç d  S(   N(   t   NotImplementedError(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isAclPublicH   s    c         C   s   t  i |  i É S(   N(   R   t   tostringR   (   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __str__K   s    N(   t   __name__t
   __module__R   R   t   NoneR
   R   R   R   R   R$   R&   R(   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyR      s   				
		t   __main__(   R   s   s3://targetbucket/prefix/log-(   R   t
   ExceptionsR    t   UtilsR   t   ACLR   t   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   __all__R   R   R   R)   t   logR   R$   t   Truet   FalseR   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   <module>   s,   <	

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 57104DD2F21C0D4E7B2CA5ABDAB36F7D
x-amz-id-2: 1f0X6O4RBP9oxCQdTXYKQNfGr0IEwmPMKSwPTwdeGzW1BKbl
ETag: aa81939b1ce989e56383f841cbfa26ba

PUT /path/to/my/S3/CloudFront.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:pE/qFVMqpQSe8++cdoFJ5wwIwSc=
content-length: 19915
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423642/ctime:1321220014

## Amazon CloudFront support
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import sys
import time
import httplib
from logging import debug, info, warning, error

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

from Config import Config
from Exceptions import *
from Utils import getTreeFromXml, appendXmlTextNode, getDictFromTree, dateS3toPython, sign_string, getBucketFromHostname, getHostnameFromBucket
from S3Uri import S3Uri, S3UriS3

def output(message):
	sys.stdout.write(message + "\n")

def pretty_output(label, message):
	#label = ("%s " % label).ljust(20, ".")
	label = ("%s:" % label).ljust(15)
	output("%s %s" % (label, message))

class DistributionSummary(object):
	## Example:
	##
	## <DistributionSummary>
	##	<Id>1234567890ABC</Id>
	##	<Status>Deployed</Status>
	##	<LastModifiedTime>2009-01-16T11:49:02.189Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<Origin>example.bucket.s3.amazonaws.com</Origin>
	##	<Enabled>true</Enabled>
	## </DistributionSummary>

	def __init__(self, tree):
		if tree.tag != "DistributionSummary":
			raise ValueError("Expected <DistributionSummary /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")

	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionList(object):
	## Example:
	## 
	## <DistributionList xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Marker />
	##	<MaxItems>100</MaxItems>
	##	<IsTruncated>false</IsTruncated>
	##	<DistributionSummary>
	##	... handled by DistributionSummary() class ...
	##	</DistributionSummary>
	## </DistributionList>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "DistributionList":
			raise ValueError("Expected <DistributionList /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['IsTruncated'] = (self.info['IsTruncated'].lower() == "true")

		self.dist_summs = []
		for dist_summ in tree.findall(".//DistributionSummary"):
			self.dist_summs.append(DistributionSummary(dist_summ))

class Distribution(object):
	## Example:
	##
	## <Distribution xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Id>1234567890ABC</Id>
	##	<Status>InProgress</Status>
	##	<LastModifiedTime>2009-01-16T13:07:11.319Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<DistributionConfig>
	##	... handled by DistributionConfig() class ...
	##	</DistributionConfig>
	## </Distribution>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "Distribution":
			raise ValueError("Expected <Distribution /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['LastModifiedTime'] = dateS3toPython(self.info['LastModifiedTime'])

		self.info['DistributionConfig'] = DistributionConfig(tree = tree.find(".//DistributionConfig"))
	
	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionConfig(object):
	## Example:
	##
	## <DistributionConfig>
	##	<Origin>somebucket.s3.amazonaws.com</Origin>
	##	<CallerReference>s3://somebucket/</CallerReference>
	##	<Comment>http://somebucket.s3.amazonaws.com/</Comment>
	##	<Enabled>true</Enabled>
	##  <Logging>
	##    <Bucket>bu.ck.et</Bucket>
	##    <Prefix>/cf-somebucket/</Prefix>
	##  </Logging>
	## </DistributionConfig>

	EMPTY_CONFIG = "<DistributionConfig><Origin/><CallerReference/><Enabled>true</Enabled></DistributionConfig>"
	xmlns = "http://cloudfront.amazonaws.com/doc/2010-07-15/"
	def __init__(self, xml = None, tree = None):
		if not xml:
			xml = DistributionConfig.EMPTY_CONFIG

		if not tree:
			tree = getTreeFromXml(xml)

		if tree.tag != "DistributionConfig":
			raise ValueError("Expected <DistributionConfig /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")
		if not self.info.has_key("CNAME"):
			self.info['CNAME'] = []
		if type(self.info['CNAME']) != list:
			self.info['CNAME'] = [self.info['CNAME']]
		self.info['CNAME'] = [cname.lower() for cname in self.info['CNAME']]
		if not self.info.has_key("Comment"):
			self.info['Comment'] = ""
		if not self.info.has_key("DefaultRootObject"):
			self.info['DefaultRootObject'] = ""
		## Figure out logging - complex node not parsed by getDictFromTree()
		logging_nodes = tree.findall(".//Logging")
		if logging_nodes:
			logging_dict = getDictFromTree(logging_nodes[0])
			logging_dict['Bucket'], success = getBucketFromHostname(logging_dict['Bucket'])
			if not success:
				warning("Logging to unparsable bucket name: %s" % logging_dict['Bucket'])
			self.info['Logging'] = S3UriS3("s3://%(Bucket)s/%(Prefix)s" % logging_dict)
		else:
			self.info['Logging'] = None

	def __str__(self):
		tree = ET.Element("DistributionConfig")
		tree.attrib['xmlns'] = DistributionConfig.xmlns

		## Retain the order of the following calls!
		appendXmlTextNode("Origin", self.info['Origin'], tree)
		appendXmlTextNode("CallerReference", self.info['CallerReference'], tree)
		for cname in self.info['CNAME']:
			appendXmlTextNode("CNAME", cname.lower(), tree)
		if self.info['Comment']:
			appendXmlTextNode("Comment", self.info['Comment'], tree)
		appendXmlTextNode("Enabled", str(self.info['Enabled']).lower(), tree)
		# don't create a empty DefaultRootObject element as it would result in a MalformedXML error
		if str(self.info['DefaultRootObject']):
			appendXmlTextNode("DefaultRootObject", str(self.info['DefaultRootObject']), tree)
		if self.info['Logging']:
			logging_el = ET.Element("Logging")
			appendXmlTextNode("Bucket", getHostnameFromBucket(self.info['Logging'].bucket()), logging_el)
			appendXmlTextNode("Prefix", self.info['Logging'].object(), logging_el)
			tree.append(logging_el)
		return ET.tostring(tree)

class CloudFront(object):
	operations = {
		"CreateDist" : { 'method' : "POST", 'resource' : "" },
		"DeleteDist" : { 'method' : "DELETE", 'resource' : "/%(dist_id)s" },
		"GetList" : { 'method' : "GET", 'resource' : "" },
		"GetDistInfo" : { 'method' : "GET", 'resource' : "/%(dist_id)s" },
		"GetDistConfig" : { 'method' : "GET", 'resource' : "/%(dist_id)s/config" },
		"SetDistConfig" : { 'method' : "PUT", 'resource' : "/%(dist_id)s/config" },
	}

	## Maximum attempts of re-issuing failed requests
	_max_retries = 5

	def __init__(self, config):
		self.config = config

	## --------------------------------------------------
	## Methods implementing CloudFront API
	## --------------------------------------------------

	def GetList(self):
		response = self.send_request("GetList")
		response['dist_list'] = DistributionList(response['data'])
		if response['dist_list'].info['IsTruncated']:
			raise NotImplementedError("List is truncated. Ask s3cmd author to add support.")
		## TODO: handle Truncated 
		return response
	
	def CreateDistribution(self, uri, cnames_add = [], comment = None, logging = None, default_root_object = None):
		dist_config = DistributionConfig()
		dist_config.info['Enabled'] = True
		dist_config.info['Origin'] = uri.host_name()
		dist_config.info['CallerReference'] = str(uri)
		dist_config.info['DefaultRootObject'] = default_root_object
		if comment == None:
			dist_config.info['Comment'] = uri.public_url()
		else:
			dist_config.info['Comment'] = comment
		for cname in cnames_add:
			if dist_config.info['CNAME'].count(cname) == 0:
				dist_config.info['CNAME'].append(cname)
		if logging:
			dist_config.info['Logging'] = S3UriS3(logging)
		request_body = str(dist_config)
		debug("CreateDistribution(): request_body: %s" % request_body)
		response = self.send_request("CreateDist", body = request_body)
		response['distribution'] = Distribution(response['data'])
		return response
	
	def ModifyDistribution(self, cfuri, cnames_add = [], cnames_remove = [],
	                       comment = None, enabled = None, logging = None,
                           default_root_object = None):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		dc = response['dist_config']
		if enabled != None:
			dc.info['Enabled'] = enabled
		if comment != None:
			dc.info['Comment'] = comment
		if default_root_object != None:
			dc.info['DefaultRootObject'] = default_root_object
		for cname in cnames_add:
			if dc.info['CNAME'].count(cname) == 0:
				dc.info['CNAME'].append(cname)
		for cname in cnames_remove:
			while dc.info['CNAME'].count(cname) > 0:
				dc.info['CNAME'].remove(cname)
		if logging != None:
			if logging == False:
				dc.info['Logging'] = False
			else:
				dc.info['Logging'] = S3UriS3(logging)
		response = self.SetDistConfig(cfuri, dc, response['headers']['etag'])
		return response
		
	def DeleteDistribution(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		if response['dist_config'].info['Enabled']:
			info("Distribution is ENABLED. Disabling first.")
			response['dist_config'].info['Enabled'] = False
			response = self.SetDistConfig(cfuri, response['dist_config'], 
			                              response['headers']['etag'])
			warning("Waiting for Distribution to become disabled.")
			warning("This may take several minutes, please wait.")
			while True:
				response = self.GetDistInfo(cfuri)
				d = response['distribution']
				if d.info['Status'] == "Deployed" and d.info['Enabled'] == False:
					info("Distribution is now disabled")
					break
				warning("Still waiting...")
				time.sleep(10)
		headers = {}
		headers['if-match'] = response['headers']['etag']
		response = self.send_request("DeleteDist", dist_id = cfuri.dist_id(),
		                             headers = headers)
		return response
	
	def GetDistInfo(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistInfo", dist_id = cfuri.dist_id())
		response['distribution'] = Distribution(response['data'])
		return response

	def GetDistConfig(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistConfig", dist_id = cfuri.dist_id())
		response['dist_config'] = DistributionConfig(response['data'])
		return response
	
	def SetDistConfig(self, cfuri, dist_config, etag = None):
		if etag == None:
			debug("SetDistConfig(): Etag not set. Fetching it first.")
			etag = self.GetDistConfig(cfuri)['headers']['etag']
		debug("SetDistConfig(): Etag = %s" % etag)
		request_body = str(dist_config)
		debug("SetDistConfig(): request_body: %s" % request_body)
		headers = {}
		headers['if-match'] = etag
		response = self.send_request("SetDistConfig", dist_id = cfuri.dist_id(),
		                             body = request_body, headers = headers)
		return response

	## --------------------------------------------------
	## Low-level methods for handling CloudFront requests
	## --------------------------------------------------

	def send_request(self, op_name, dist_id = None, body = None, headers = {}, retries = _max_retries):
		operation = self.operations[op_name]
		if body:
			headers['content-type'] = 'text/plain'
		request = self.create_request(operation, dist_id, headers)
		conn = self.get_connection()
		debug("send_request(): %s %s" % (request['method'], request['resource']))
		conn.request(request['method'], request['resource'], body, request['headers'])
		http_response = conn.getresponse()
		response = {}
		response["status"] = http_response.status
		response["reason"] = http_response.reason
		response["headers"] = dict(http_response.getheaders())
		response["data"] =  http_response.read()
		conn.close()

		debug("CloudFront: response: %r" % response)

		if response["status"] >= 500:
			e = CloudFrontError(response)
			if retries:
				warning(u"Retrying failed request: %s" % op_name)
				warning(unicode(e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				return self.send_request(op_name, dist_id, body, retries - 1)
			else:
				raise e

		if response["status"] < 200 or response["status"] > 299:
			raise CloudFrontError(response)

		return response

	def create_request(self, operation, dist_id = None, headers = None):
		resource = self.config.cloudfront_resource + (
		           operation['resource'] % { 'dist_id' : dist_id })

		if not headers:
			headers = {}

		if headers.has_key("date"):
			if not headers.has_key("x-amz-date"):
				headers["x-amz-date"] = headers["date"]
			del(headers["date"])
		
		if not headers.has_key("x-amz-date"):
			headers["x-amz-date"] = time.strftime("%a, %d %b %Y %H:%M:%S +0000", time.gmtime())

		signature = self.sign_request(headers)
		headers["Authorization"] = "AWS "+self.config.access_key+":"+signature

		request = {}
		request['resource'] = resource
		request['headers'] = headers
		request['method'] = operation['method']

		return request

	def sign_request(self, headers):
		string_to_sign = headers['x-amz-date']
		signature = sign_string(string_to_sign)
		debug(u"CloudFront.sign_request('%s') = %s" % (string_to_sign, signature))
		return signature

	def get_connection(self):
		if self.config.proxy_host != "":
			raise ParameterError("CloudFront commands don't work from behind a HTTP proxy")
		return httplib.HTTPSConnection(self.config.cloudfront_host)

	def _fail_wait(self, retries):
		# Wait a few seconds. The more it fails the more we wait.
		return (self._max_retries - retries + 1) * 3

class Cmd(object):
	"""
	Class that implements CloudFront commands
	"""
	
	class Options(object):
		cf_cnames_add = []
		cf_cnames_remove = []
		cf_comment = None
		cf_enable = None
		cf_logging = None
		cf_default_root_object = None

		def option_list(self):
			return [opt for opt in dir(self) if opt.startswith("cf_")]

		def update_option(self, option, value):
			setattr(Cmd.options, option, value)

	options = Options()
	dist_list = None

	@staticmethod
	def _get_dist_name_for_bucket(uri):
		cf = CloudFront(Config())
		debug("_get_dist_name_for_bucket(%r)" % uri)
		assert(uri.type == "s3")
		if Cmd.dist_list is None:
			response = cf.GetList()
			Cmd.dist_list = {}
			for d in response['dist_list'].dist_summs:
				Cmd.dist_list[getBucketFromHostname(d.info['Origin'])[0]] = d.uri()
			debug("dist_list: %s" % Cmd.dist_list)
		return Cmd.dist_list[uri.bucket()]

	@staticmethod
	def _parse_args(args):
		cfuris = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type == 's3':
				try:
					uri = Cmd._get_dist_name_for_bucket(uri)
				except Exception, e:
					debug(e)
					raise ParameterError("Unable to translate S3 URI to CloudFront distribution name: %s" % uri)
			if uri.type != 'cf':
				raise ParameterError("CloudFront URI required instead of: %s" % arg)
			cfuris.append(uri)
		return cfuris

	@staticmethod
	def info(args):
		cf = CloudFront(Config())
		if not args:
			response = cf.GetList()
			for d in response['dist_list'].dist_summs:
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(d.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("Enabled", d.info['Enabled'])
				output("")
		else:
			cfuris = Cmd._parse_args(args)
			for cfuri in cfuris:
				response = cf.GetDistInfo(cfuri)
				d = response['
distribution']
				dc = d.info['DistributionConfig']
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
				pretty_output("Comment", dc.info['Comment'])
				pretty_output("Enabled", dc.info['Enabled'])
				pretty_output("DfltRootObject", dc.info['DefaultRootObject'])
				pretty_output("Logging", dc.info['Logging'] or "Disabled")
				pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def create(args):
		cf = CloudFront(Config())
		buckets = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type != "s3":
				raise ParameterError("Bucket can only be created from a s3:// URI instead of: %s" % arg)
			if uri.object():
				raise ParameterError("Use s3:// URI with a bucket name only instead of: %s" % arg)
			if not uri.is_dns_compatible():
				raise ParameterError("CloudFront can only handle lowercase-named buckets.")
			buckets.append(uri)
		if not buckets:
			raise ParameterError("No valid bucket names found")
		for uri in buckets:
			info("Creating distribution from: %s" % uri)
			response = cf.CreateDistribution(uri, cnames_add = Cmd.options.cf_cnames_add, 
			                                 comment = Cmd.options.cf_comment,
			                                 logging = Cmd.options.cf_logging,
                                             default_root_object = Cmd.options.cf_default_root_object)
			d = response['distribution']
			dc = d.info['DistributionConfig']
			output("Distribution created:")
			pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
			pretty_output("DistId", d.uri())
			pretty_output("DomainName", d.info['DomainName'])
			pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
			pretty_output("Comment", dc.info['Comment'])
			pretty_output("Status", d.info['Status'])
			pretty_output("Enabled", dc.info['Enabled'])
			pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
			pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def delete(args):
		cf = CloudFront(Config())
		cfuris = Cmd._parse_args(args)
		for cfuri in cfuris:
			response = cf.DeleteDistribution(cfuri)
			if response['status'] >= 400:
				error("Distribution %s could not be deleted: %s" % (cfuri, response['reason']))
			output("Distribution %s deleted" % cfuri)

	@staticmethod
	def modify(args):
		cf = CloudFront(Config())
		if len(args) > 1:
			raise ParameterError("Too many parameters. Modify one Distribution at a time.")
		try:
			cfuri = Cmd._parse_args(args)[0]
		except IndexError, e:
			raise ParameterError("No valid Distribution URI found.")
		response = cf.ModifyDistribution(cfuri,
		                                 cnames_add = Cmd.options.cf_cnames_add,
		                                 cnames_remove = Cmd.options.cf_cnames_remove,
		                                 comment = Cmd.options.cf_comment,
		                                 enabled = Cmd.options.cf_enable,
		                                 logging = Cmd.options.cf_logging,
                                         default_root_object = Cmd.options.cf_default_root_object)
		if response['status'] >= 400:
			error("Distribution %s could not be modified: %s" % (cfuri, response['reason']))
		output("Distribution modified: %s" % cfuri)
		response = cf.GetDistInfo(cfuri)
		d = response['distribution']
		dc = d.info['DistributionConfig']
		pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
		pretty_output("DistId", d.uri())
		pretty_output("DomainName", d.info['DomainName'])
		pretty_output("Status", d.info['Status'])
		pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
		pretty_output("Comment", dc.info['Comment'])
		pretty_output("Enabled", dc.info['Enabled'])
		pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
		pretty_output("Etag", response['headers']['etag'])
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 6345B1A500C4B4ADD80F70815A2C8FCD
x-amz-id-2: z7Y1wxVGWc3e6ZmKlkQI5cpByhC5kBkfr834sCIHIu1pyAq2
ETag: 8ca4670a301344a5075ca0e3430bb1d7

PUT /path/to/my/S3/Config.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:/cWnv7ZcTFdVLe4xNGpa/JOvH/I=
content-length: 7790
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423642/ctime:1321220027

—Ú
ÌsÒMc           @   sú   d  d k  Z  d  d k  l Z l Z l Z l Z d  d k Z d  d k Z d  d k l Z d e f d Ñ  É  YZ	 d e f d Ñ  É  YZ
 d e f d	 Ñ  É  YZ d S(
   iˇˇˇˇN(   t   debugt   infot   warningt   error(   t
   SortedDictt   Configc           B   s≥  e  Z d" Z g  Z h  Z d  Z d  Z d Z d Z	 d Z
 d Z d Z e i Z e Z e i Z d Z d Z e Z e Z e d e É Z e Z d" Z e Z e Z e Z  d" Z! g  Z" g  Z# d  Z$ d Z% e Z& e Z' e Z( d	 d
 d d d d d d g Z) e Z* d e d <d  Z+ d  Z, d Z- d Z. e Z/ d Z0 d Z1 e Z2 d d g Z3 g  Z4 g  Z5 h  Z6 h  Z7 d Z8 d Z9 d  Z: e Z; e Z< d Z= d" d Ñ Z> d" d Ñ Z? d Ñ  Z@ d Ñ  ZA d  Ñ  ZB d! Ñ  ZC RS(#   t    s   s3.amazonaws.coms   %(bucket)s.s3.amazonaws.coms   sdb.amazonaws.coms   cloudfront.amazonaws.coms   /2010-07-15/distributioni   t   ignore_casei8  t   unamet   uidt   gnamet   gidt   atimet   mtimet   ctimet   modes@   [sync] Remove remote S3 objects when local file has been deletedt   delete_removeds}   %(gpg_command)s -c --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)ss}   %(gpg_command)s -d --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)st   USs   binary/octet-streamt   sizet   md5s   utf-8t   normali,  c         C   s-   |  i  d  j o t i |  É |  _  n |  i  S(   N(   t	   _instancet   Nonet   objectt   __new__(   t   selft
   configfile(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Q   s    c         C   s   | o |  i  | É n d  S(   N(   t   read_config_file(   R   R   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __init__V   s    c         C   sÇ   g  } xu t  |  É D]g } t t t | É É } | i d É p( | t d É t d É t t É f j o q n | i | É q W| S(   Nt   _t   stringi*   (   t   dirt   typet   getattrR   t
   startswitht   Truet   append(   R   t   retvalt   optiont   option_type(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   option_listZ   s     		c         C   sP   t  | É } x- |  i É  D] } |  i | | i | É É q W|  i i | É d  S(   N(   t   ConfigParserR(   t   update_optiont   gett   _parsed_filesR$   (   R   R   t   cpR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   h   s
     c         C   s   t  | É i d |  É d  S(   Nt   default(   t   ConfigDumpert   dump(   R   t   stream(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   dump_confign   s    c         C   sv  | d  j o d  S| d j oC y t t d t i | É Wqrt j
 o t d | É qrXnt t t | É É t t	 É j or t
 | É i É  d j o t t | t	 É qrt
 | É i É  d j o t t | t É qrt d | | f É n} t t t | É É t d É j oJ y t t | t | É É Wqrt j
 o } t d | | f É qrXn t t | | É d  S(   Nt	   verbositys)   Config: verbosity level '%s' is not validt   truet   yest   ont   1t   falset   not   offt   0s8   Config: value of option '%s' must be Yes or No, not '%s'i*   s9   Config: value of option '%s' must be an integer, not '%s'(   s   trueR5   R6   R7   (   s   falses   noR:   R;   (   R   t   setattrR   t   loggingt   _levelNamest   KeyErrorR   R    R!   R#   t   strt   lowert   Falset   intt
   ValueError(   R   R&   t   valuet   e(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR*   q   s&    ""N(D   t   __name__t
   __module__R   R   R,   t   _doct
   access_keyt
   secret_keyt	   host_baset   host_buckett   simpledb_hostt   cloudfront_hostt   cloudfront_resourceR=   t   WARNINGR3   R#   t   progress_metert   Progresst
   ProgressCRt   progress_classt
   send_chunkt
   recv_chunkRB   t   list_md5t   human_readable_sizesR   t   extra_headerst   forcet   enablet   get_continuet   skip_existingt	   recursivet
   acl_publict
   acl_grantst   acl_revokest
   proxy_hostt
   proxy_portt   encryptt   dry_runt   preserve_attrst   preserve_attrs_listR   t   gpg_passphraset   gpg_commandt   gpg_encryptt   gpg_decryptt	   use_httpst   bucket_locationt   default_mime_typet   guess_mime_typet   sync_checkst   excludet   includet   debug_excludet   debug_includet   encodingt   urlencoding_modet   log_target_prefixt   reduced_redundancyt   follow_symlinkst   socket_timeoutR   R   R(   R   R2   R*   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR      sÑ   			
			R)   c           B   s>   e  Z g  d  Ñ Z g  d Ñ Z d Ñ  Z d Ñ  Z d d Ñ Z RS(   c         C   s   h  |  _  |  i | | É d  S(   N(   t   cfgt
   parse_file(   R   t   filet   sections(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   å   s    	c         C   s  t  d | É t | É t g  É j o | g } n t } t | d É } t i d É } t i d É } t i d É } t i d É } t i d É }	 xq| D]i}
 | i |
 É p | i |
 É o qõ n | i |
 É } | o6 | i É  d } | | j p t | É d j } qõ n | i |
 É } | o∆ | oø | i	 É  } |	 i | d	 É o | d	 d
 d !| d	 <n |  i
 | d | d	 É | d d j o4 | d	 d  d | d	 d t | d	 É d } n | d	 } t  d | d | f É qõ n t d | |
 f É qõ Wd  S(   Ns   ConfigParser: Reading file '%s't   rs   ^\s*#.*s   ^\s*$s   ^\[([^\]]+)\]s$   ^\s*(?P<key>\w+)\s*=\s*(?P<value>.*)s   ^"(.*)"\s*$i    RE   i   iˇˇˇˇt   keyRJ   RK   Ri   i   s   ...%d_chars...i   s   ConfigParser: %s->%ss!   Ignoring invalid line in '%s': %s(   s
   access_keys
   secret_keys   gpg_passphrase(   R    R    R#   t   opent   ret   compilet   matcht   groupst   lent	   groupdictt   __setitem__R   (   R   R~   R   t   in_our_sectiont   ft	   r_commentt   r_emptyt	   r_sectiont   r_datat   r_quotest   linet
   is_sectiont   sectiont   is_datat   datat   print_value(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR}   ê   s>      4
c         C   s   |  i  | S(   N(   R|   (   R   t   name(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __getitem__±   s    c         C   s   | |  i  | <d  S(   N(   R|   (   R   Ró   RE   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyRâ   ¥   s    c         C   s#   |  i  i | É o |  i  | S| S(   N(   R|   t   has_key(   R   Ró   R.   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR+   ∑   s    N(   RG   RH   R   R}   Rò   Râ   R   R+   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR)   ã   s
   !		R/   c           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   s   | |  _  d  S(   N(   R1   (   R   R1   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Ω   s    c         C   sR   |  i  i d | É x7 | i É  D]) } |  i  i d | t | | É f É q! Wd  S(   Ns   [%s]
s   %s = %s
(   R1   t   writeR(   R!   (   R   Rì   t   configR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR0   ¿   s     (   RG   RH   R   R0   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR/   º   s   	(   R=   R    R   R   R   RÉ   RS   R   R   R   R)   R/   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   <module>   s   "1
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 47F5E2A90B7227016B1ABD66D4C53CB2
x-amz-id-2: xQdwtv48cgCvNMnCmpN5duORTHQEepgyOAOAwypRgVrynoaH
ETag: f93c915747f27f2933a18bcc20d80624

PUT /path/to/my/S3/PkgInfo.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:d4HATq18PcPWOfjhv6K8PaCI9wQ=
content-length: 445
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322423642/ctime:1321220014

package = "s3cmd"
version = "1.0.1"
url = "http://s3tools.org"
license = "GPL version 2"
short_description = "Command line tool for managing Amazon S3 and CloudFront services"
long_description = """
S3cmd lets you copy files from/to Amazon S3 
(Simple Storage Service) using a simple to use
command line client. Supports rsync-like backup,
GPG encryption, and more. Also supports management
of Amazon's CloudFront content delivery network.
"""

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: A039174464513206B2F1DFE251ADB974
x-amz-id-2: MTzrJO4TxZQQIz6HzSqiN36soRJIrZTNy7VYVuoe6gbPXcq2
ETag: d3af86656acfd8147cb10b0dafc3d9dc

PUT /path/to/my/S3/Progress.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:tq/dm+uUAZW8zHY+CluxTAll4ls=
content-length: 5526
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423642/ctime:1321220027

—Ú
ÌsÒMc           @   sj   d  d k  Z  d  d k Z d  d k Z d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d S(   iˇˇˇˇNt   Progressc           B   sS   e  Z e i Z d  Ñ  Z d Ñ  Z d d d Ñ Z d Ñ  Z d Ñ  Z	 e
 d d Ñ Z RS(   c         C   s    t  i |  _ |  i | | É d  S(   N(   t   syst   stdoutt   _stdoutt   new_file(   t   selft   labelst
   total_size(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   __init__   s    c         C   se   | |  _  | |  _ d |  _ |  i |  _ t i i É  |  _ |  i |  _ |  i |  _ |  i	 d t
 É d  S(   Ni    R   (   R   R   t   initial_positiont   current_positiont   datetimet   nowt
   time_startt	   time_lastt   time_currentt   displayt   True(   R   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s    			iˇˇˇˇc         C   sf   |  i  |  _ t i i É  |  _  | d j o | |  _ n! | d j o |  i | 7_ n |  i É  d  S(   Niˇˇˇˇ(   R   R   R   R   R
   R   (   R   R
   t   delta_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   update!   s    c         C   s   |  i  d | É d  S(   Nt   done_message(   R   (   R   t   message(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   done,   s    c         C   s(   |  i  i d |  i É |  i  i É  d  S(   Nu)   %(source)s -> %(destination)s  %(extra)s
(   R   t   writeR   t   flush(   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   output_labels/   s    c         C   sp  | o |  i  É  d |  _ d S|  i |  i j o◊ t i |  i t É } | d d j o | d c d 7<n |  i |  i } | i	 d | i
 t | i É d } t i |  i |  i | t t É } |  i i d | d | d | | d | d f É |  i i É  d St i d	 |  i } | |  i j o? t | É d
 d
 |  _ |  i i d |  i É |  i i É  d Sd S(   sn   
		display(new_file = False[/True], done = False[/True])

		Override this method to provide a nicer output.
		i    Ni   t    t   BiÄQ g    ÄÑ.As"   100%%  %s%s in %.2fs (%.2f %sB/s)
id   i   s   %d%% (   R   t   last_milestoneR
   R   t   Utilst
   formatSizeR   R   R   t   dayst   secondst   floatt   microsecondsR	   R   R   R   t   selfselft   int(   R   R   R   t
   print_sizet	   timedeltat   sec_elapsedt   print_speedt   rel_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   3   s*    
	 %#'N(   t   __name__t
   __module__R   R   R   R   R   R   R   R   t   Falset   NoneR   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR    
   s   					t   ProgressANSIc           B   sc   e  Z d  Z e d Z e d Z e d Z e d Z e d Z e d Z e d Z	 e
 d	 d Ñ Z RS(
   s   [s   ?25ls   ?25ht   st   us   %uGt   0Kt   2Kc         C   sÑ  | o/ |  i  É  |  i i |  i É |  i i É  d S|  i |  i } | i d | i t	 | i
 É d } | d j o' t i |  i |  i | t t É } n d } |  i i |  i É |  i i |  i É |  i i d h t |  i É i t t |  i É É É d 6|  i d 6|  i o |  i d	 |  i p d d
 6| d 6| d d 6| d d 6É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   sY   %(current)s of %(total)s   %(percent)3d%% in %(elapsed)ds  %(speed).2f %(speed_coeff)sB/st   currentt   totalid   t   percentt   elapsedt   speedi   t   speed_coeffs     %s
(   i    R   (   R   R   R   t   ANSI_save_cursor_posR   R   R   R   R    R!   R"   R   R   R
   R	   R   t   ANSI_restore_cursor_post   ANSI_erase_to_eolt   strt   rjustt   lenR   (   R   R   R   R&   R'   R(   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   [   s,    
%'(
&N(   R*   R+   t   SCIt   ANSI_hide_cursort   ANSI_show_cursorR9   R:   t   ANSI_move_cursor_to_columnR;   t   ANSI_erase_current_lineR,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR.   P   s   






t
   ProgressCRc           B   s#   e  Z e d  É Z e d d Ñ Z RS(   i   c         C   sW  | o |  i  É  d S|  i |  i } | i d | i t | i É d } | d j o' t i |  i	 |  i
 | t t É } n d } |  i i |  i É d h t |  i	 É i t t |  i É É É d 6|  i d 6|  i o |  i	 d	 |  i p d d
 6| d 6| d d 6| d d 6} |  i i | É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   s\    %(current)s of %(total)s   %(percent)3d%% in %(elapsed)4ds  %(speed)7.2f %(speed_coeff)sB/sR3   R4   id   R5   R6   R7   i   R8   s     %s
(   i    R   (   R   R   R   R   R    R!   R"   R   R   R
   R	   R   R   R   t   CR_charR<   R=   R>   R   R   (   R   R   R   R&   R'   R(   t   output(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s(    
%'(
&N(   R*   R+   t   chrRE   R,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyRD   {   s   (   R   R   R   t   objectR    R.   RD   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   <module>   s
   F+
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: E4418833F1D0087F9999C4269BD463C4
x-amz-id-2: 9ruZCtSI1QVWVCkKllqSWKmNoToP5pFVRuZAWGBkueGRgbO2
ETag: e9d7eb6d87e256e94de8c4e7d7c1a02a

PUT /path/to/my/S3/S3Uri.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:B0QvgvJyqckpOL4tGv7lQXGzsFA=
content-length: 5347
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423642/ctime:1321386876

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import os
import re
import sys
from BidirMap import BidirMap
from logging import debug
import S3
from Utils import unicodise, check_bucket_name_dns_conformity

class S3Uri(object):
	type = None
	_subclasses = None

	def __new__(self, string):
		if not self._subclasses:
			## Generate a list of all subclasses of S3Uri
			self._subclasses = []
			dict = sys.modules[__name__].__dict__
			for something in dict:
				if type(dict[something]) is not type(self):
					continue
				if issubclass(dict[something], self) and dict[something] != self:
					self._subclasses.append(dict[something])
		for subclass in self._subclasses:
			try:
				instance = object.__new__(subclass)
				instance.__init__(string)
				return instance
			except ValueError, e:
				continue
		raise ValueError("%s: not a recognized URI" % string)
	
	def __str__(self):
		return self.uri()

	def __unicode__(self):
		return self.uri()

	def public_url(self):
		raise ValueError("This S3 URI does not have Anonymous URL representation")

	def basename(self):
		return self.__unicode__().split("/")[-1]

class S3UriS3(S3Uri):
	type = "s3"
	_re = re.compile("^s3://([^/]+)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3 URI" % string)
		groups = match.groups()
		self._bucket = groups[0]
		self._object = unicodise(groups[1])

	def bucket(self):
		return self._bucket

	def object(self):
		return self._object
	
	def has_bucket(self):
		return bool(self._bucket)

	def has_object(self):
		return bool(self._object)

	def uri(self):
		return "/".join(["s3:/", self._bucket, self._object])
	
	def is_dns_compatible(self):
		return check_bucket_name_dns_conformity(self._bucket)

	def public_url(self):
		if self.is_dns_compatible():
			return "http://%s.s3.amazonaws.com/%s" % (self._bucket, self._object)
		else:
			return "http://s3.amazonaws.com/%s/%s" % (self._bucket, self._object)

	def host_name(self):
		if self.is_dns_compatible():
			return "%s.s3.amazonaws.com" % (self._bucket)
		else:
			return "s3.amazonaws.com"

	@staticmethod
	def compose_uri(bucket, object = ""):
		return "s3://%s/%s" % (bucket, object)

	@staticmethod
	def httpurl_to_s3uri(http_url):
		m=re.match("(https?://)?([^/]+)/?(.*)", http_url, re.IGNORECASE)
		hostname, object = m.groups()[1:]
		hostname = hostname.lower()
		if hostname == "s3.amazonaws.com":
			## old-style url: http://s3.amazonaws.com/bucket/object
			if object.count("/") == 0:
				## no object given
				bucket = object
				object = ""
			else:
				## bucket/object
				bucket, object = object.split("/", 1)
		elif hostname.endswith(".s3.amazonaws.com"):
			## new-style url: http://bucket.s3.amazonaws.com/object
			bucket = hostname[:-(len(".s3.amazonaws.com"))]
		else:
			raise ValueError("Unable to parse URL: %s" % http_url)
		return S3Uri("s3://%(bucket)s/%(object)s" % { 
			'bucket' : bucket,
			'object' : object })

class S3UriS3FS(S3Uri):
	type = "s3fs"
	_re = re.compile("^s3fs://([^/]*)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3fs URI" % string)
		groups = match.groups()
		self._fsname = groups[0]
		self._path = unicodise(groups[1]).split("/")

	def fsname(self):
		return self._fsname

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["s3fs:/", self._fsname, self.path()])

class S3UriFile(S3Uri):
	type = "file"
	_re = re.compile("^(\w+://)?(.*)")
	def __init__(self, string):
		match = self._re.match(string)
		groups = match.groups()
		if groups[0] not in (None, "file://"):
			raise ValueError("%s: not a file:// URI" % string)
		self._path = unicodise(groups[1]).split("/")

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["file:/", self.path()])

	def isdir(self):
		return os.path.isdir(self.path())

	def dirname(self):
		return os.path.dirname(self.path())

class S3UriCloudFront(S3Uri):
	type = "cf"
	_re = re.compile("^cf://([^/]*)/?", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a CloudFront URI" % string)
		groups = match.groups()
		self._dist_id = groups[0]

	def dist_id(self):
		return self._dist_id

	def uri(self):
		return "/".join(["cf:/", self.dist_id()])

if __name__ == "__main__":
	uri = S3Uri("s3://bucket/object")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print "object  =", uri.object()
	print

	uri = S3Uri("s3://bucket")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print

	uri = S3Uri("s3fs://filesystem1/path/to/remote/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("/path/to/local/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("cf://1234567890ABCD/")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "dist_id =", uri.dist_id()
	print

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 366781A4D1EF0A4A7AEECD63142C8DA8
x-amz-id-2: XVDjYrj2wvAnq5TOWH8kmSICcOEkNmMAQ1qC1iW7emKzTxsv
ETag: 7bfe82b2950b542ef985ee611fa2b310

PUT /path/to/my/S3/SortedDict.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:x7Oxwcx9ma7SImRciIN2KwfE3+U=
content-length: 1640
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322423642/ctime:1321220014

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from BidirMap import BidirMap

class SortedDictIterator(object):
	def __init__(self, sorted_dict, keys):
		self.sorted_dict = sorted_dict
		self.keys = keys

	def next(self):
		try:
			return self.keys.pop(0)
		except IndexError:
			raise StopIteration

class SortedDict(dict):
	def __init__(self, mapping = {}, ignore_case = True, **kwargs):
		"""
		WARNING: SortedDict() with ignore_case==True will
		         drop entries differing only in capitalisation!
				 Eg: SortedDict({'auckland':1, 'Auckland':2}).keys() => ['Auckland']
				 With ignore_case==False it's all right
		"""
		dict.__init__(self, mapping, **kwargs)
		self.ignore_case = ignore_case

	def keys(self):
		keys = dict.keys(self)
		if self.ignore_case:
			# Translation map
			xlat_map = BidirMap()
			for key in keys:
				xlat_map[key.lower()] = key
			# Lowercase keys
			lc_keys = xlat_map.keys()
			lc_keys.sort()
			return [xlat_map[k] for k in lc_keys]
		else:
			keys.sort()
			return keys

	def __iter__(self):
		return SortedDictIterator(self, self.keys())

if __name__ == "__main__":
	d = { 'AWS' : 1, 'Action' : 2, 'america' : 3, 'Auckland' : 4, 'America' : 5 }
	sd = SortedDict(d)
	print "Wanted: Action, america, Auckland, AWS,    [ignore case]"
	print "Got:   ",
	for key in sd:
		print "%s," % key,
	print "   [used: __iter__()]"
	d = SortedDict(d, ignore_case = False)
	print "Wanted: AWS, Action, Auckland, america,    [case sensitive]"
	print "Got:   ",
	for key in d.keys():
		print "%s," % key,
	print "   [used: keys()]"
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 1EE33AE1FAF02CC64CE7ACE9DB9274BD
x-amz-id-2: HliQ8AjMRLaMUHxyXjreza0sdJXIfxrVOjaEZRCwn0mUYLev
ETag: 05a6053b5f0cb40b09872572b238a50c

PUT /path/to/my/S3/Utils.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:WAohegoH/kMfnweiADKZ/QaNb8Q=
content-length: 14047
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 19:54:02 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322423642/ctime:1321220027

—Ú
¨tÒMc           @   sO  d  d k  Z  d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k	 Z	 d  d k
 l Z l Z l Z l Z d  d k Z d  d k Z e i d d j o4 e i d d j  o  d  d k l Z d  d k Z n d  d k l Z l Z y d  d k i i Z Wn" e j
 o d  d k i Z n Xd  d	 k l Z g  Z d
 Ñ  Z e i  d É d Ñ  Z! e i  d É d Ñ  Z" e i  d É d Ñ  Z# e i  d É d Ñ  Z$ e i  d É d Ñ  Z% e i  d É d Ñ  Z& e i  d É d Ñ  Z' e i  d É d Ñ  Z( e i  d É d Ñ  Z) e i  d É d Ñ  Z* e i  d É d  Ñ  Z+ e i  d! É d" Ñ  Z, e i  d# É e- e- d$ Ñ Z. e i  d% É d& Ñ  Z/ e i  d' É d( Ñ  Z0 e i  d) É e i1 e i2 Z3 e4 e3 É Z5 d* Ñ  Z6 e i  d+ É d, Ñ  Z7 e i  d- É d. d/ d0 Ñ Z8 e i  d1 É d2 d3 d4 Ñ Z9 e i  d5 É d6 Ñ  Z: e i  d7 É d8 Ñ  Z; e i  d9 É d d: d; Ñ Z= e i  d< É d d: d= Ñ Z> e i  d> É d d? Ñ Z? e i  d@ É dA Ñ  Z@ e i  dB É dC Ñ  ZA e i  dD É eB dE Ñ ZC e i  dF É dG Ñ  ZD e i  dH É dI Ñ  ZE e i  dJ É dK Ñ  ZF e i  dL É d S(M   iˇˇˇˇN(   t   debugt   infot   warningt   errori    i   i   i   (   t   md5(   R   t   sha1(   t
   ExpatErrorc         C   så   g  } x |  D]w } h  } x[ | i  É  D]M } | i } | i  É  o t | g É | | <q& | i d | i É | | <q& W| i | É q W| S(   Ns   .//%s(   t   getchildrent   tagt
   parseNodest   findtextt   append(   t   nodest   retvalt   nodet   retval_itemt   childt   name(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyR	   $   s      	R	   c         C   sd   t  i d t  i É } | i |  É o/ | i |  É i É  d } | i d |  É }  n d } |  | f S(   s:   
	removeNameSpace(xml) -- remove top-level AWS namespace
	s7   ^(<?[^>]+?>\s?)(<\w+) xmlns=['"](http://[^'"]+)['"](.*)i   s   \1\2\4N(   t   ret   compilet	   MULTILINEt   matcht   groupst   subt   None(   t   xmlt   rt   xmlns(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   stripNameSpace5   s    R   c         C   sv   t  |  É \ }  } y/ t i |  É } | o | | i d <n | SWn. t j
 o" } t | É t i d É Ç n Xd  S(   NR   sP   Bucket contains invalid filenames. Please run: s3cmd fixbucket s3://your-bucket/(   R   t   ETt
   fromstringt   attribR   R   t
   Exceptionst   ParameterError(   R   R   t   treet   e(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTreeFromXmlB   s    
R$   c         C   s)   t  |  É } | i d | É } t | É S(   Ns   .//%s(   R$   t   findallR	   (   R   R   R"   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getListFromXmlN   s    R&   c         C   s∂   h  } x© |  i  É  D]õ } | i  É  o q n | i | i É oW t | | i É t j p | | i g | | i <n | | i i | i p d É q | i p d | | i <q W| S(   Nt    (   R   t   has_keyR   t   typet   listR   t   text(   R"   t   ret_dictR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getDictFromTreeT   s     "R-   c         C   s8   t  |  É } | i i | É o | i S| i | É Sd  S(   N(   R$   R   t   endswithR+   R
   (   R   t   xpathR"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTextFromXmlc   s    R0   c         C   s   t  |  É } | i S(   N(   R$   R   (   R   R"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getRootTagNamek   s    R1   c         C   s"   t  i |  É } t | É | _ | S(   N(   R   t   Elementt   unicodeR+   (   t   tag_nameR+   t   el(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   xmlTextNodep   s    R6   c         C   s    t  |  | É } | i | É | S(   s†   
	Creates a new <tag_name> Node and sets
	its content to 'text'. Then appends the
	created Node to 'parent' element if given.
	Returns the newly created Node.
	(   R6   R   (   R4   R+   t   parentR5   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   appendXmlTextNodev   s    R8   c         C   s+   t  i d É i d |  É }  t i |  d É S(   Ns	   (\.\d*)?Zs   .000Zs   %Y-%m-%dT%H:%M:%S.000Z(   R   R   R   t   timet   strptime(   t   date(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toPythonÇ   s    R<   c         C   s   t  i t |  É É S(   N(   R9   t   mktimeR<   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toUnixá   s    R>   c         C   s   t  i |  É S(   N(   t   rfc822t	   parsedate(   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toPythoné   s    RA   c         C   s   t  i t |  É É S(   N(   R9   R=   RA   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toUnixí   s    RB   c         C   sÜ   | o t  |  É p
 t |  É }  | oQ d d d d g } d } x+ |  d j o |  d :}  | i d É } qB W|  | f S|  d f Sd  S(	   Nt   kt   Mt   Gt   TR'   i   i   i    (   t   floatt   intt   pop(   t   sizet   human_readablet   floating_pointt   coeffst   coeff(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt
   formatSizeñ   s      
RO   c         C   s   t  i d t |  É É S(   Ns   %Y-%m-%d %H:%M(   R9   t   strftimeR<   (   t   s3timestamp(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   formatDateTime£   s    RR   c         C   s-   h  } x  |  D] } | d | | d <q W| S(   Ni   i    (    (   R*   R   t   tuple(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   convertTupleListToDictß   s
     RT   c         C   sG   d } x: |  d j o, | t  t i d t d É 7} |  d 8}  q	 W| S(   NR'   i    i   (   t
   _rnd_charst   randomt   randintt   _rnd_chars_len(   t   lenR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   rndstr∞   s     RZ   c         C   s£   t  i d É } d } xz | d j ol |  t | É } y | | É PWn< t j
 o0 } | i t i j o t  i | É Ç  qÉ n X| d 8} q Wt  i | É | S(   Ni?   i   i    i   (   t   ost   umaskRZ   t   OSErrort   errnot   EEXIST(   t   prefixt	   randcharst
   createfunct	   old_umaskt   triest   dirnameR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpsomething∏   s     
Rf   s   /tmp/tmpdir-i
   c         C   s   t  |  | t i É S(   N(   Rf   R[   t   mkdir(   R`   Ra   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpdir    s    Rh   s   /tmp/tmpfile-i   c         C   s   d Ñ  } t  |  | | É S(   Nc         S   s#   t  i t  i |  t  i t  i BÉ É S(    (   R[   t   closet   opent   O_CREATt   O_EXCL(   t   filename(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <lambda>œ   s    (   Rf   (   R`   Ra   Rb   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   mktmpfileŒ   s    	Ro   c         C   sc   t  É  } t |  d É } x4 t o, | i d É } | p Pn | i | É q W| i É  | i É  S(   Nt   rbi    i   i Ä  (   R   Rj   t   Truet   readt   updateRi   t	   hexdigest(   Rm   t   ht   ft   data(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   hash_file_md5”   s    	 
Rx   c         C   s  |  i  t i É } g  } x? | o7 t i i t i i | É É o | i | i É  É q WxØ | oß | i | i É  É t i i | É } y t d | É t i	 | É Wq] t
 t f j
 o! } t d | | i f É t St j
 o } t d | | f É t SXq] Wt S(   sÜ   
	mkdir_with_parents(dst_dir)
	
	Create directory 'dir_name' with all parent directories

	Returns True on success, False otherwise.
	s	   mkdir(%s)s   %s: can not make directory: %ss   %s: %s(   t   splitR[   t   sept   patht   isdirt   joinR   RI   R    Rg   R]   t   IOErrorR   t   strerrort   Falset	   ExceptionRq   (   t   dir_namet   pathmemberst	   tmp_stackt   cur_dirR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mkdir_with_parents‡   s&     ' RÜ   t   replacec         C   sÑ   | p t  i  É  i } n t |  É t j o |  St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   s6   
	Convert 'string' to Unicode or raise an exception.
	s   Unicodising %r using %ss    Conversion to unicode failed: %rN(   t   Configt   encodingR)   R3   R    t   decodet   UnicodeDecodeError(   t   stringRâ   t   errors(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   unicodise˚   s    Ré   c         C   sä   | p t  i  É  i } n t |  É t j o t |  É St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   sx   
	Convert unicode 'string' to <type str>, by default replacing
	all invalid characters with '?' or raise an exception.
	s   DeUnicodising %r using %ss"   Conversion from unicode failed: %rN(   Rà   Râ   R)   R3   t   strR    t   encodet   UnicodeEncodeError(   Rå   Râ   Rç   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   deunicodise  s    Rí   c         C   s"   t  t |  | É | É i d d É S(   sk   
	Convert 'string' to Unicode according to current encoding 
	and replace all invalid characters with '?'
	u   ÔøΩt   ?(   Ré   Rí   Rá   (   Rå   Râ   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   unicodise_safe  s    Rî   c         C   s    d } d } xÇ |  D]z } t  | É } | d j o, | d t t  d É | É 7} | d 7} q | d j o | d 7} | d 7} q | | 7} q W| o. t i É  i d	 j o t d
 | | f É n | S(   sÉ   
	replace_nonprintables(string)

	Replaces all non-printable characters 'ch' in 'string'
	where ord(ch) <= 26 with ^@, ^A, ... ^Z
	R'   i    i   t   ^t   @i   i   s   ^?t	   fixbuckets+   %d non-printable characters replaced in: %s(   t   ordt   chrRà   t   urlencoding_modeR   (   Rå   t
   new_stringt   modifiedt   ct   o(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   replace_nonprintables'  s     
Rü   c         C   s7   t  i t i t i É  i |  t É i É  É i É  } | S(   N(	   t   base64t   encodestringt   hmact   newRà   t
   secret_keyR   t   digestt   strip(   t   string_to_signt	   signature(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   sign_string?  s    3R©   c         C   s¿  | oD t  i d |  É } | o' t i d |  | i É  d f É Ç qã nA t  i d |  É } | o' t i d |  | i É  d f É Ç n t |  É d j  o t i d |  É Ç n t |  É d j o t i d	 |  É Ç n | o÷ t |  É d
 j o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É p t i d |  É Ç n t  i d |  É p t i d |  É Ç qºn t S(   Ns   ([^a-z0-9\.-])sô   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: lowercase us-ascii letters (a-z), digits (0-9), dot (.) and hyphen (-).i    s   ([^A-Za-z0-9\._-])s§   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: us-ascii letters (a-z, A-Z), digits (0-9), dot (.), hyphen (-) and underscore (_).i   s0   Bucket name '%s' is too short (min 3 characters)iˇ   s1   Bucket name '%s' is too long (max 255 characters)i?   s0   Bucket name '%s' is too long (max 63 characters)s   -\.sE   Bucket name '%s' must not contain sequence '-.' for DNS compatibilitys   \.\.sE   Bucket name '%s' must not contain sequence '..' for DNS compatibilitys	   ^[0-9a-z]s4   Bucket name '%s' must start with a letter or a digits	   [0-9a-z]$s2   Bucket name '%s' must end with a letter or a digit(   R   t   searchR    R!   R   RY   Rq   (   t   buckett
   dns_strictt   invalid(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   check_bucket_nameF  s.    +'RÆ   c         C   s2   y t  |  d t ÉSWn t i j
 o t SXd  S(   NR¨   (   RÆ   Rq   R    R!   RÄ   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt    check_bucket_name_dns_conformityb  s    RØ   c         C   sR   t  i  É  i h d d 6} t i | |  É } | p |  t f S| i É  d t f S(   sø   
	bucket, success = getBucketFromHostname(hostname)

	Only works for hostnames derived from bucket names
	using Config.host_bucket pattern.

	Returns bucket name and a boolean success flag.
	s   (?P<bucket>.*)R´   i    (   Rà   t   host_bucketR   R   RÄ   R   Rq   (   t   hostnamet   patternt   m(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getBucketFromHostnamei  s
    R¥   c         C   s   t  i  É  i h |  d 6S(   NR´   (   Rà   R∞   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getHostnameFromBucket{  s    Rµ   (G   R[   t   sysR9   R   Rå   RV   R?   R¢   R†   R^   t   loggingR    R   R   R   Rà   R    t   version_infoR   t   shaR   t   hashlibt   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   xml.parsers.expatR   t   __all__R	   R   R   R$   R&   R-   R0   R1   R6   R8   R<   R>   RA   RB   RÄ   RO   RR   RT   t   ascii_letterst   digitsRU   RY   RX   RZ   Rf   Rh   Ro   Rx   RÜ   R   Ré   Rí   Rî   Rü   R©   Rq   RÆ   RØ   R¥   Rµ   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <module>   s¨   "(			
						
															
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T19:54:02.000Z
Server: Smoke - Mary Jane
x-amz-request-id: F5A0248FB090B22EDCB6705AA82DF6B3
x-amz-id-2: z7gXVV1mGgEL61d3BKBxAYSLJ19ieZYZkheumSXoIvGEGJcy
ETag: c5d468a10b86b6de15cbd0ec76df1776

>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Using rack adapter
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Using rack adapter
>> Exiting!
/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:4:in `<class:App>': uninitialized constant Sinatra::ResponseHelper (NameError)
	from /Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:3:in `<module:Server>'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:2:in `<module:Smoke>'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:1:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server.rb:14:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config.ru:1:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config.ru:1:in `new'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:45:in `for'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:169:in `load_adapter'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:73:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Using rack adapter
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:CYX3XUvgmc5pk4eCXlpKePiUVUI=
x-amz-date: Sun, 27 Nov 2011 20:14:25 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T20:14:25.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 77FF22F9701BD88E719F23E7170752A3
x-amz-id-2: 6OK61hzfEKwBKi9RdqBLbB3kAOW1GJCHUoPr6BKFSxmNt4qH

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:35:in `read': No such file or directory - server.ru (Errno::ENOENT)
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:35:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require': no such file to load -- helpers/sinatra (LoadError)
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server.rb:13:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from server.ru:1:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require': no such file to load -- /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/../lib/smoke/server (LoadError)
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:1:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from server.ru:2:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require': no such file to load -- /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/../lib/smoke/server (LoadError)
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:1:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from server.ru:2:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `initialize': No such file or directory - ../config/database.yml (Errno::ENOENT)
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `open'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from server.ru:2:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `initialize': No such file or directory - ../config/database.yml (Errno::ENOENT)
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `open'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from server.ru:2:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Exiting!
/Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `initialize': No such file or directory - /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/../config/database.yml (Errno::ENOENT)
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `open'
	from /Users/rlyon/src/ruby/sinatra/smoke_server/config/environment/server.rb:3:in `<top (required)>'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/rubies/ruby-1.9.2-p290/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `block in require'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `block in load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:640:in `new_constants_in'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:223:in `load_dependency'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/activesupport-3.1.3/lib/active_support/dependencies.rb:240:in `require'
	from server.ru:2:in `block in <main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `instance_eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/builder.rb:51:in `initialize'
	from server.ru:1:in `new'
	from server.ru:1:in `<main>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `eval'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/rack/adapter/loader.rb:36:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:181:in `load_rackup_config'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:71:in `start'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	from /Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
PUT /path/to/my/S3/ACL.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:LnBzO9R74Oe4KcEXpUD+GK0oTE0=
content-length: 5989
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 20:37:20 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322426240/ctime:1321220014

## Amazon S3 - Access Control List representation
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from Utils import getTreeFromXml

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

class Grantee(object):
	ALL_USERS_URI = "http://acs.amazonaws.com/groups/global/AllUsers"
	LOG_DELIVERY_URI = "http://acs.amazonaws.com/groups/s3/LogDelivery"

	def __init__(self):
		self.xsi_type = None
		self.tag = None
		self.name = None
		self.display_name = None
		self.permission = None

	def __repr__(self):
		return 'Grantee("%(tag)s", "%(name)s", "%(permission)s")' % { 
			"tag" : self.tag, 
			"name" : self.name, 
			"permission" : self.permission 
		}

	def isAllUsers(self):
		return self.tag == "URI" and self.name == Grantee.ALL_USERS_URI
	
	def isAnonRead(self):
		return self.isAllUsers() and (self.permission == "READ" or self.permission == "FULL_CONTROL")
	
	def getElement(self):
		el = ET.Element("Grant")
		grantee = ET.SubElement(el, "Grantee", { 
			'xmlns:xsi' : 'http://www.w3.org/2001/XMLSchema-instance',
			'xsi:type' : self.xsi_type
		})
		name = ET.SubElement(grantee, self.tag)
		name.text = self.name
		permission = ET.SubElement(el, "Permission")
		permission.text = self.permission
		return el

class GranteeAnonRead(Grantee):
	def __init__(self):
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.ALL_USERS_URI
		self.permission = "READ"

class GranteeLogDelivery(Grantee):
	def __init__(self, permission):
		"""
		permission must be either READ_ACP or WRITE
		"""
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.LOG_DELIVERY_URI
		self.permission = permission

class ACL(object):
	EMPTY_ACL = "<AccessControlPolicy><Owner><ID></ID></Owner><AccessControlList></AccessControlList></AccessControlPolicy>"

	def __init__(self, xml = None):
		if not xml:
			xml = ACL.EMPTY_ACL

		self.grantees = []
		self.owner_id = ""
		self.owner_nick = ""

		tree = getTreeFromXml(xml)
		self.parseOwner(tree)
		self.parseGrants(tree)

	def parseOwner(self, tree):
		self.owner_id = tree.findtext(".//Owner//ID")
		self.owner_nick = tree.findtext(".//Owner//DisplayName")

	def parseGrants(self, tree):
		for grant in tree.findall(".//Grant"):
			grantee = Grantee()
			g = grant.find(".//Grantee")
			grantee.xsi_type = g.attrib['{http://www.w3.org/2001/XMLSchema-instance}type']
			grantee.permission = grant.find('Permission').text
			for el in g:
				if el.tag == "DisplayName":
					grantee.display_name = el.text
				else:
					grantee.tag = el.tag
					grantee.name = el.text
			self.grantees.append(grantee)

	def getGrantList(self):
		acl = []
		for grantee in self.grantees:
			if grantee.display_name:
				user = grantee.display_name
			elif grantee.isAllUsers():
				user = "*anon*"
			else:
				user = grantee.name
			acl.append({'grantee': user, 'permission': grantee.permission})
		return acl

	def getOwner(self):
		return { 'id' : self.owner_id, 'nick' : self.owner_nick }

	def isAnonRead(self):
		for grantee in self.grantees:
			if grantee.isAnonRead():
				return True
		return False
	
	def grantAnonRead(self):
		if not self.isAnonRead():
			self.appendGrantee(GranteeAnonRead())
	
	def revokeAnonRead(self):
		self.grantees = [g for g in self.grantees if not g.isAnonRead()]

	def appendGrantee(self, grantee):
		self.grantees.append(grantee)

	def hasGrant(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		for grantee in self.grantees:
			if grantee.name.lower() == name:
				if grantee.permission == "FULL_CONTROL":
					return True
				elif grantee.permission.upper() == permission:
					return True

		return False;

	def grant(self, name, permission):
		if self.hasGrant(name, permission):
			return

		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			permission = "FULL_CONTROL"

		if "FULL_CONTROL" == permission:
			self.revoke(name, "ALL")

		grantee = Grantee()
		grantee.name = name
		grantee.permission = permission

		if  name.find('@') <= -1: # ultra lame attempt to differenciate emails id from canonical ids
			grantee.xsi_type = "CanonicalUser"
			grantee.tag = "ID"
		else:
			grantee.xsi_type = "AmazonCustomerByEmail"
			grantee.tag = "EmailAddress"
				
		self.appendGrantee(grantee)


	def revoke(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			self.grantees = [g for g in self.grantees if not g.name.lower() == name]
		else:
			self.grantees = [g for g in self.grantees if not (g.name.lower() == name and g.permission.upper() ==  permission)]


	def __str__(self):
		tree = getTreeFromXml(ACL.EMPTY_ACL)
		tree.attrib['xmlns'] = "http://s3.amazonaws.com/doc/2006-03-01/"
		owner = tree.find(".//Owner//ID")
		owner.text = self.owner_id
		acl = tree.find(".//AccessControlList")
		for grantee in self.grantees:
			acl.append(grantee.getElement())
		return ET.tostring(tree)

if __name__ == "__main__":
	xml = """<?xml version="1.0" encoding="UTF-8"?>
<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
<Owner>
	<ID>12345678901234567890</ID>
	<DisplayName>owner-nickname</DisplayName>
</Owner>
<AccessControlList>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="CanonicalUser">
			<ID>12345678901234567890</ID>
			<DisplayName>owner-nickname</DisplayName>
		</Grantee>
		<Permission>FULL_CONTROL</Permission>
	</Grant>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="Group">
			<URI>http://acs.amazonaws.com/groups/global/AllUsers</URI>
		</Grantee>
		<Permission>READ</Permission>
	</Grant>
</AccessControlList>
</AccessControlPolicy>
	"""
	acl = ACL(xml)
	print "Grants:", acl.getGrantList()
	acl.revokeAnonRead()
	print "Grants:", acl.getGrantList()
	acl.grantAnonRead()
	print "Grants:", acl.getGrantList()
	print acl
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 0F85516C34CC49031E6A1D5FCF64CEB3
x-amz-id-2: dcnGP3NkfFFNthi1G4zcsjLuplwhmQv8ggJaeFgYyxpKkOSD
ETag: 577a2c29e4910b5be9d133592a50b85e

PUT /path/to/my/S3/AccessLog.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:WGpTKh2OJyMWqu45wCfDxJAZZ8U=
content-length: 3705
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322426240/ctime:1321220027

—Ú
ÌsÒMc           @   s  d  d k  Z  d  d k l Z d  d k l Z d  d k l Z y d  d k i i	 Z
 Wn" e j
 o d  d k i	 Z
 n Xg  Z d e f d Ñ  É  YZ e i d É e d j om d  d k  l  Z  e É  Z e GHe i e  d	 É É e GHe i e É e GHe i e É e GHe i É  e GHn d S(
   iˇˇˇˇN(   t   ParameterError(   t   getTreeFromXml(   t   GranteeAnonReadt	   AccessLogc           B   s_   e  Z d  Z d Z d
 d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d	 Ñ  Z RS(   s+   <BucketLoggingStatus></BucketLoggingStatus>s[   <LoggingEnabled><TargetBucket></TargetBucket><TargetPrefix></TargetPrefix></LoggingEnabled>c         C   s7   | p |  i  } n t | É |  _ d |  i i d <d  S(   Ns&   http://doc.s3.amazonaws.com/2006-03-01t   xmlns(   t   LOG_DISABLEDR   t   treet   attrib(   t   selft   xml(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __init__   s    c         C   s   t  |  i i d É É S(   Ns   .//LoggingEnabled(   t   boolR   t   find(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isLoggingEnabled   s    c         C   s1   |  i  i d É } | o |  i  i | É n d  S(   Ns   .//LoggingEnabled(   R   R   t   remove(   R   t   el(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   disableLogging   s    c         C   sp   |  i  i d É } | p# t |  i É } |  i  i | É n | i É  | i d É _ | i É  | i d É _ d  S(   Ns   .//LoggingEnableds   .//TargetBuckets   .//TargetPrefix(   R   R   R   t   LOG_TEMPLATEt   appendt   buckett   textt   object(   R   t   target_prefix_uriR   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   enableLogging#   s    c         C   sc   |  i  É  oN |  i i d É } d |  i i d É i |  i i d É i f } t i | É Sd Sd  S(   Ns   .//LoggingEnableds
   s3://%s/%ss   .//LoggingEnabled//TargetBuckets   .//LoggingEnabled//TargetPrefixt    (   R   R   R   R   t   S3Uri(   R   R   t   target_prefix(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   targetPrefix+   s    c         C   sô   |  i  i d É } | p t d É Ç n | i d É } | p | p d  S| i | É n: t É  i É  } | p t i | d É } n | i | É d  S(   Ns   .//LoggingEnableds3   Logging not enabled, can't set default ACL for logss   .//TargetGrantst   TargetGrants(	   R   R   R    R   R   t
   getElementt   ETt
   SubElementR   (   R   t
   acl_publict   let   tgt	   anon_read(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   setAclPublic5   s    c         C   s   t  É  Ç d  S(   N(   t   NotImplementedError(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isAclPublicH   s    c         C   s   t  i |  i É S(   N(   R   t   tostringR   (   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __str__K   s    N(   t   __name__t
   __module__R   R   t   NoneR
   R   R   R   R   R$   R&   R(   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyR      s   				
		t   __main__(   R   s   s3://targetbucket/prefix/log-(   R   t
   ExceptionsR    t   UtilsR   t   ACLR   t   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   __all__R   R   R   R)   t   logR   R$   t   Truet   FalseR   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   <module>   s,   <	

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 7F6F44AE36EAE039F1015F55065F13EE
x-amz-id-2: w0kRaP9eWDCrSdcT9YAisIqH5gtfOXTqPQ4pHW5a9SkSLT4z
ETag: aa81939b1ce989e56383f841cbfa26ba

PUT /path/to/my/S3/CloudFront.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:xlLdyN2h+deWUfIgsuLsaZtRm1o=
content-length: 19915
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322426240/ctime:1321220014

## Amazon CloudFront support
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import sys
import time
import httplib
from logging import debug, info, warning, error

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

from Config import Config
from Exceptions import *
from Utils import getTreeFromXml, appendXmlTextNode, getDictFromTree, dateS3toPython, sign_string, getBucketFromHostname, getHostnameFromBucket
from S3Uri import S3Uri, S3UriS3

def output(message):
	sys.stdout.write(message + "\n")

def pretty_output(label, message):
	#label = ("%s " % label).ljust(20, ".")
	label = ("%s:" % label).ljust(15)
	output("%s %s" % (label, message))

class DistributionSummary(object):
	## Example:
	##
	## <DistributionSummary>
	##	<Id>1234567890ABC</Id>
	##	<Status>Deployed</Status>
	##	<LastModifiedTime>2009-01-16T11:49:02.189Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<Origin>example.bucket.s3.amazonaws.com</Origin>
	##	<Enabled>true</Enabled>
	## </DistributionSummary>

	def __init__(self, tree):
		if tree.tag != "DistributionSummary":
			raise ValueError("Expected <DistributionSummary /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")

	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionList(object):
	## Example:
	## 
	## <DistributionList xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Marker />
	##	<MaxItems>100</MaxItems>
	##	<IsTruncated>false</IsTruncated>
	##	<DistributionSummary>
	##	... handled by DistributionSummary() class ...
	##	</DistributionSummary>
	## </DistributionList>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "DistributionList":
			raise ValueError("Expected <DistributionList /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['IsTruncated'] = (self.info['IsTruncated'].lower() == "true")

		self.dist_summs = []
		for dist_summ in tree.findall(".//DistributionSummary"):
			self.dist_summs.append(DistributionSummary(dist_summ))

class Distribution(object):
	## Example:
	##
	## <Distribution xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Id>1234567890ABC</Id>
	##	<Status>InProgress</Status>
	##	<LastModifiedTime>2009-01-16T13:07:11.319Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<DistributionConfig>
	##	... handled by DistributionConfig() class ...
	##	</DistributionConfig>
	## </Distribution>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "Distribution":
			raise ValueError("Expected <Distribution /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['LastModifiedTime'] = dateS3toPython(self.info['LastModifiedTime'])

		self.info['DistributionConfig'] = DistributionConfig(tree = tree.find(".//DistributionConfig"))
	
	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionConfig(object):
	## Example:
	##
	## <DistributionConfig>
	##	<Origin>somebucket.s3.amazonaws.com</Origin>
	##	<CallerReference>s3://somebucket/</CallerReference>
	##	<Comment>http://somebucket.s3.amazonaws.com/</Comment>
	##	<Enabled>true</Enabled>
	##  <Logging>
	##    <Bucket>bu.ck.et</Bucket>
	##    <Prefix>/cf-somebucket/</Prefix>
	##  </Logging>
	## </DistributionConfig>

	EMPTY_CONFIG = "<DistributionConfig><Origin/><CallerReference/><Enabled>true</Enabled></DistributionConfig>"
	xmlns = "http://cloudfront.amazonaws.com/doc/2010-07-15/"
	def __init__(self, xml = None, tree = None):
		if not xml:
			xml = DistributionConfig.EMPTY_CONFIG

		if not tree:
			tree = getTreeFromXml(xml)

		if tree.tag != "DistributionConfig":
			raise ValueError("Expected <DistributionConfig /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")
		if not self.info.has_key("CNAME"):
			self.info['CNAME'] = []
		if type(self.info['CNAME']) != list:
			self.info['CNAME'] = [self.info['CNAME']]
		self.info['CNAME'] = [cname.lower() for cname in self.info['CNAME']]
		if not self.info.has_key("Comment"):
			self.info['Comment'] = ""
		if not self.info.has_key("DefaultRootObject"):
			self.info['DefaultRootObject'] = ""
		## Figure out logging - complex node not parsed by getDictFromTree()
		logging_nodes = tree.findall(".//Logging")
		if logging_nodes:
			logging_dict = getDictFromTree(logging_nodes[0])
			logging_dict['Bucket'], success = getBucketFromHostname(logging_dict['Bucket'])
			if not success:
				warning("Logging to unparsable bucket name: %s" % logging_dict['Bucket'])
			self.info['Logging'] = S3UriS3("s3://%(Bucket)s/%(Prefix)s" % logging_dict)
		else:
			self.info['Logging'] = None

	def __str__(self):
		tree = ET.Element("DistributionConfig")
		tree.attrib['xmlns'] = DistributionConfig.xmlns

		## Retain the order of the following calls!
		appendXmlTextNode("Origin", self.info['Origin'], tree)
		appendXmlTextNode("CallerReference", self.info['CallerReference'], tree)
		for cname in self.info['CNAME']:
			appendXmlTextNode("CNAME", cname.lower(), tree)
		if self.info['Comment']:
			appendXmlTextNode("Comment", self.info['Comment'], tree)
		appendXmlTextNode("Enabled", str(self.info['Enabled']).lower(), tree)
		# don't create a empty DefaultRootObject element as it would result in a MalformedXML error
		if str(self.info['DefaultRootObject']):
			appendXmlTextNode("DefaultRootObject", str(self.info['DefaultRootObject']), tree)
		if self.info['Logging']:
			logging_el = ET.Element("Logging")
			appendXmlTextNode("Bucket", getHostnameFromBucket(self.info['Logging'].bucket()), logging_el)
			appendXmlTextNode("Prefix", self.info['Logging'].object(), logging_el)
			tree.append(logging_el)
		return ET.tostring(tree)

class CloudFront(object):
	operations = {
		"CreateDist" : { 'method' : "POST", 'resource' : "" },
		"DeleteDist" : { 'method' : "DELETE", 'resource' : "/%(dist_id)s" },
		"GetList" : { 'method' : "GET", 'resource' : "" },
		"GetDistInfo" : { 'method' : "GET", 'resource' : "/%(dist_id)s" },
		"GetDistConfig" : { 'method' : "GET", 'resource' : "/%(dist_id)s/config" },
		"SetDistConfig" : { 'method' : "PUT", 'resource' : "/%(dist_id)s/config" },
	}

	## Maximum attempts of re-issuing failed requests
	_max_retries = 5

	def __init__(self, config):
		self.config = config

	## --------------------------------------------------
	## Methods implementing CloudFront API
	## --------------------------------------------------

	def GetList(self):
		response = self.send_request("GetList")
		response['dist_list'] = DistributionList(response['data'])
		if response['dist_list'].info['IsTruncated']:
			raise NotImplementedError("List is truncated. Ask s3cmd author to add support.")
		## TODO: handle Truncated 
		return response
	
	def CreateDistribution(self, uri, cnames_add = [], comment = None, logging = None, default_root_object = None):
		dist_config = DistributionConfig()
		dist_config.info['Enabled'] = True
		dist_config.info['Origin'] = uri.host_name()
		dist_config.info['CallerReference'] = str(uri)
		dist_config.info['DefaultRootObject'] = default_root_object
		if comment == None:
			dist_config.info['Comment'] = uri.public_url()
		else:
			dist_config.info['Comment'] = comment
		for cname in cnames_add:
			if dist_config.info['CNAME'].count(cname) == 0:
				dist_config.info['CNAME'].append(cname)
		if logging:
			dist_config.info['Logging'] = S3UriS3(logging)
		request_body = str(dist_config)
		debug("CreateDistribution(): request_body: %s" % request_body)
		response = self.send_request("CreateDist", body = request_body)
		response['distribution'] = Distribution(response['data'])
		return response
	
	def ModifyDistribution(self, cfuri, cnames_add = [], cnames_remove = [],
	                       comment = None, enabled = None, logging = None,
                           default_root_object = None):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		dc = response['dist_config']
		if enabled != None:
			dc.info['Enabled'] = enabled
		if comment != None:
			dc.info['Comment'] = comment
		if default_root_object != None:
			dc.info['DefaultRootObject'] = default_root_object
		for cname in cnames_add:
			if dc.info['CNAME'].count(cname) == 0:
				dc.info['CNAME'].append(cname)
		for cname in cnames_remove:
			while dc.info['CNAME'].count(cname) > 0:
				dc.info['CNAME'].remove(cname)
		if logging != None:
			if logging == False:
				dc.info['Logging'] = False
			else:
				dc.info['Logging'] = S3UriS3(logging)
		response = self.SetDistConfig(cfuri, dc, response['headers']['etag'])
		return response
		
	def DeleteDistribution(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		if response['dist_config'].info['Enabled']:
			info("Distribution is ENABLED. Disabling first.")
			response['dist_config'].info['Enabled'] = False
			response = self.SetDistConfig(cfuri, response['dist_config'], 
			                              response['headers']['etag'])
			warning("Waiting for Distribution to become disabled.")
			warning("This may take several minutes, please wait.")
			while True:
				response = self.GetDistInfo(cfuri)
				d = response['distribution']
				if d.info['Status'] == "Deployed" and d.info['Enabled'] == False:
					info("Distribution is now disabled")
					break
				warning("Still waiting...")
				time.sleep(10)
		headers = {}
		headers['if-match'] = response['headers']['etag']
		response = self.send_request("DeleteDist", dist_id = cfuri.dist_id(),
		                             headers = headers)
		return response
	
	def GetDistInfo(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistInfo", dist_id = cfuri.dist_id())
		response['distribution'] = Distribution(response['data'])
		return response

	def GetDistConfig(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistConfig", dist_id = cfuri.dist_id())
		response['dist_config'] = DistributionConfig(response['data'])
		return response
	
	def SetDistConfig(self, cfuri, dist_config, etag = None):
		if etag == None:
			debug("SetDistConfig(): Etag not set. Fetching it first.")
			etag = self.GetDistConfig(cfuri)['headers']['etag']
		debug("SetDistConfig(): Etag = %s" % etag)
		request_body = str(dist_config)
		debug("SetDistConfig(): request_body: %s" % request_body)
		headers = {}
		headers['if-match'] = etag
		response = self.send_request("SetDistConfig", dist_id = cfuri.dist_id(),
		                             body = request_body, headers = headers)
		return response

	## --------------------------------------------------
	## Low-level methods for handling CloudFront requests
	## --------------------------------------------------

	def send_request(self, op_name, dist_id = None, body = None, headers = {}, retries = _max_retries):
		operation = self.operations[op_name]
		if body:
			headers['content-type'] = 'text/plain'
		request = self.create_request(operation, dist_id, headers)
		conn = self.get_connection()
		debug("send_request(): %s %s" % (request['method'], request['resource']))
		conn.request(request['method'], request['resource'], body, request['headers'])
		http_response = conn.getresponse()
		response = {}
		response["status"] = http_response.status
		response["reason"] = http_response.reason
		response["headers"] = dict(http_response.getheaders())
		response["data"] =  http_response.read()
		conn.close()

		debug("CloudFront: response: %r" % response)

		if response["status"] >= 500:
			e = CloudFrontError(response)
			if retries:
				warning(u"Retrying failed request: %s" % op_name)
				warning(unicode(e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				return self.send_request(op_name, dist_id, body, retries - 1)
			else:
				raise e

		if response["status"] < 200 or response["status"] > 299:
			raise CloudFrontError(response)

		return response

	def create_request(self, operation, dist_id = None, headers = None):
		resource = self.config.cloudfront_resource + (
		           operation['resource'] % { 'dist_id' : dist_id })

		if not headers:
			headers = {}

		if headers.has_key("date"):
			if not headers.has_key("x-amz-date"):
				headers["x-amz-date"] = headers["date"]
			del(headers["date"])
		
		if not headers.has_key("x-amz-date"):
			headers["x-amz-date"] = time.strftime("%a, %d %b %Y %H:%M:%S +0000", time.gmtime())

		signature = self.sign_request(headers)
		headers["Authorization"] = "AWS "+self.config.access_key+":"+signature

		request = {}
		request['resource'] = resource
		request['headers'] = headers
		request['method'] = operation['method']

		return request

	def sign_request(self, headers):
		string_to_sign = headers['x-amz-date']
		signature = sign_string(string_to_sign)
		debug(u"CloudFront.sign_request('%s') = %s" % (string_to_sign, signature))
		return signature

	def get_connection(self):
		if self.config.proxy_host != "":
			raise ParameterError("CloudFront commands don't work from behind a HTTP proxy")
		return httplib.HTTPSConnection(self.config.cloudfront_host)

	def _fail_wait(self, retries):
		# Wait a few seconds. The more it fails the more we wait.
		return (self._max_retries - retries + 1) * 3

class Cmd(object):
	"""
	Class that implements CloudFront commands
	"""
	
	class Options(object):
		cf_cnames_add = []
		cf_cnames_remove = []
		cf_comment = None
		cf_enable = None
		cf_logging = None
		cf_default_root_object = None

		def option_list(self):
			return [opt for opt in dir(self) if opt.startswith("cf_")]

		def update_option(self, option, value):
			setattr(Cmd.options, option, value)

	options = Options()
	dist_list = None

	@staticmethod
	def _get_dist_name_for_bucket(uri):
		cf = CloudFront(Config())
		debug("_get_dist_name_for_bucket(%r)" % uri)
		assert(uri.type == "s3")
		if Cmd.dist_list is None:
			response = cf.GetList()
			Cmd.dist_list = {}
			for d in response['dist_list'].dist_summs:
				Cmd.dist_list[getBucketFromHostname(d.info['Origin'])[0]] = d.uri()
			debug("dist_list: %s" % Cmd.dist_list)
		return Cmd.dist_list[uri.bucket()]

	@staticmethod
	def _parse_args(args):
		cfuris = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type == 's3':
				try:
					uri = Cmd._get_dist_name_for_bucket(uri)
				except Exception, e:
					debug(e)
					raise ParameterError("Unable to translate S3 URI to CloudFront distribution name: %s" % uri)
			if uri.type != 'cf':
				raise ParameterError("CloudFront URI required instead of: %s" % arg)
			cfuris.append(uri)
		return cfuris

	@staticmethod
	def info(args):
		cf = CloudFront(Config())
		if not args:
			response = cf.GetList()
			for d in response['dist_list'].dist_summs:
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(d.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("Enabled", d.info['Enabled'])
				output("")
		else:
			cfuris = Cmd._parse_args(args)
			for cfuri in cfuris:
				response = cf.GetDistInfo(cfuri)
				d = response['
distribution']
				dc = d.info['DistributionConfig']
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
				pretty_output("Comment", dc.info['Comment'])
				pretty_output("Enabled", dc.info['Enabled'])
				pretty_output("DfltRootObject", dc.info['DefaultRootObject'])
				pretty_output("Logging", dc.info['Logging'] or "Disabled")
				pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def create(args):
		cf = CloudFront(Config())
		buckets = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type != "s3":
				raise ParameterError("Bucket can only be created from a s3:// URI instead of: %s" % arg)
			if uri.object():
				raise ParameterError("Use s3:// URI with a bucket name only instead of: %s" % arg)
			if not uri.is_dns_compatible():
				raise ParameterError("CloudFront can only handle lowercase-named buckets.")
			buckets.append(uri)
		if not buckets:
			raise ParameterError("No valid bucket names found")
		for uri in buckets:
			info("Creating distribution from: %s" % uri)
			response = cf.CreateDistribution(uri, cnames_add = Cmd.options.cf_cnames_add, 
			                                 comment = Cmd.options.cf_comment,
			                                 logging = Cmd.options.cf_logging,
                                             default_root_object = Cmd.options.cf_default_root_object)
			d = response['distribution']
			dc = d.info['DistributionConfig']
			output("Distribution created:")
			pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
			pretty_output("DistId", d.uri())
			pretty_output("DomainName", d.info['DomainName'])
			pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
			pretty_output("Comment", dc.info['Comment'])
			pretty_output("Status", d.info['Status'])
			pretty_output("Enabled", dc.info['Enabled'])
			pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
			pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def delete(args):
		cf = CloudFront(Config())
		cfuris = Cmd._parse_args(args)
		for cfuri in cfuris:
			response = cf.DeleteDistribution(cfuri)
			if response['status'] >= 400:
				error("Distribution %s could not be deleted: %s" % (cfuri, response['reason']))
			output("Distribution %s deleted" % cfuri)

	@staticmethod
	def modify(args):
		cf = CloudFront(Config())
		if len(args) > 1:
			raise ParameterError("Too many parameters. Modify one Distribution at a time.")
		try:
			cfuri = Cmd._parse_args(args)[0]
		except IndexError, e:
			raise ParameterError("No valid Distribution URI found.")
		response = cf.ModifyDistribution(cfuri,
		                                 cnames_add = Cmd.options.cf_cnames_add,
		                                 cnames_remove = Cmd.options.cf_cnames_remove,
		                                 comment = Cmd.options.cf_comment,
		                                 enabled = Cmd.options.cf_enable,
		                                 logging = Cmd.options.cf_logging,
                                         default_root_object = Cmd.options.cf_default_root_object)
		if response['status'] >= 400:
			error("Distribution %s could not be modified: %s" % (cfuri, response['reason']))
		output("Distribution modified: %s" % cfuri)
		response = cf.GetDistInfo(cfuri)
		d = response['distribution']
		dc = d.info['DistributionConfig']
		pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
		pretty_output("DistId", d.uri())
		pretty_output("DomainName", d.info['DomainName'])
		pretty_output("Status", d.info['Status'])
		pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
		pretty_output("Comment", dc.info['Comment'])
		pretty_output("Enabled", dc.info['Enabled'])
		pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
		pretty_output("Etag", response['headers']['etag'])
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: C1A555A192A01F518043CA3C2F1E26A2
x-amz-id-2: wmUgby6iVXPOh4y9JVO9OyplybcwZ25muc23M9zLc3u03U9c
ETag: 8ca4670a301344a5075ca0e3430bb1d7

PUT /path/to/my/S3/Config.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:0htXTgqK4DmAO56s9e1JitYKfPk=
content-length: 7790
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322426240/ctime:1321220027

—Ú
ÌsÒMc           @   sú   d  d k  Z  d  d k  l Z l Z l Z l Z d  d k Z d  d k Z d  d k l Z d e f d Ñ  É  YZ	 d e f d Ñ  É  YZ
 d e f d	 Ñ  É  YZ d S(
   iˇˇˇˇN(   t   debugt   infot   warningt   error(   t
   SortedDictt   Configc           B   s≥  e  Z d" Z g  Z h  Z d  Z d  Z d Z d Z	 d Z
 d Z d Z e i Z e Z e i Z d Z d Z e Z e Z e d e É Z e Z d" Z e Z e Z e Z  d" Z! g  Z" g  Z# d  Z$ d Z% e Z& e Z' e Z( d	 d
 d d d d d d g Z) e Z* d e d <d  Z+ d  Z, d Z- d Z. e Z/ d Z0 d Z1 e Z2 d d g Z3 g  Z4 g  Z5 h  Z6 h  Z7 d Z8 d Z9 d  Z: e Z; e Z< d Z= d" d Ñ Z> d" d Ñ Z? d Ñ  Z@ d Ñ  ZA d  Ñ  ZB d! Ñ  ZC RS(#   t    s   s3.amazonaws.coms   %(bucket)s.s3.amazonaws.coms   sdb.amazonaws.coms   cloudfront.amazonaws.coms   /2010-07-15/distributioni   t   ignore_casei8  t   unamet   uidt   gnamet   gidt   atimet   mtimet   ctimet   modes@   [sync] Remove remote S3 objects when local file has been deletedt   delete_removeds}   %(gpg_command)s -c --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)ss}   %(gpg_command)s -d --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)st   USs   binary/octet-streamt   sizet   md5s   utf-8t   normali,  c         C   s-   |  i  d  j o t i |  É |  _  n |  i  S(   N(   t	   _instancet   Nonet   objectt   __new__(   t   selft
   configfile(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Q   s    c         C   s   | o |  i  | É n d  S(   N(   t   read_config_file(   R   R   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __init__V   s    c         C   sÇ   g  } xu t  |  É D]g } t t t | É É } | i d É p( | t d É t d É t t É f j o q n | i | É q W| S(   Nt   _t   stringi*   (   t   dirt   typet   getattrR   t
   startswitht   Truet   append(   R   t   retvalt   optiont   option_type(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   option_listZ   s     		c         C   sP   t  | É } x- |  i É  D] } |  i | | i | É É q W|  i i | É d  S(   N(   t   ConfigParserR(   t   update_optiont   gett   _parsed_filesR$   (   R   R   t   cpR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   h   s
     c         C   s   t  | É i d |  É d  S(   Nt   default(   t   ConfigDumpert   dump(   R   t   stream(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   dump_confign   s    c         C   sv  | d  j o d  S| d j oC y t t d t i | É Wqrt j
 o t d | É qrXnt t t | É É t t	 É j or t
 | É i É  d j o t t | t	 É qrt
 | É i É  d j o t t | t É qrt d | | f É n} t t t | É É t d É j oJ y t t | t | É É Wqrt j
 o } t d | | f É qrXn t t | | É d  S(   Nt	   verbositys)   Config: verbosity level '%s' is not validt   truet   yest   ont   1t   falset   not   offt   0s8   Config: value of option '%s' must be Yes or No, not '%s'i*   s9   Config: value of option '%s' must be an integer, not '%s'(   s   trueR5   R6   R7   (   s   falses   noR:   R;   (   R   t   setattrR   t   loggingt   _levelNamest   KeyErrorR   R    R!   R#   t   strt   lowert   Falset   intt
   ValueError(   R   R&   t   valuet   e(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR*   q   s&    ""N(D   t   __name__t
   __module__R   R   R,   t   _doct
   access_keyt
   secret_keyt	   host_baset   host_buckett   simpledb_hostt   cloudfront_hostt   cloudfront_resourceR=   t   WARNINGR3   R#   t   progress_metert   Progresst
   ProgressCRt   progress_classt
   send_chunkt
   recv_chunkRB   t   list_md5t   human_readable_sizesR   t   extra_headerst   forcet   enablet   get_continuet   skip_existingt	   recursivet
   acl_publict
   acl_grantst   acl_revokest
   proxy_hostt
   proxy_portt   encryptt   dry_runt   preserve_attrst   preserve_attrs_listR   t   gpg_passphraset   gpg_commandt   gpg_encryptt   gpg_decryptt	   use_httpst   bucket_locationt   default_mime_typet   guess_mime_typet   sync_checkst   excludet   includet   debug_excludet   debug_includet   encodingt   urlencoding_modet   log_target_prefixt   reduced_redundancyt   follow_symlinkst   socket_timeoutR   R   R(   R   R2   R*   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR      sÑ   			
			R)   c           B   s>   e  Z g  d  Ñ Z g  d Ñ Z d Ñ  Z d Ñ  Z d d Ñ Z RS(   c         C   s   h  |  _  |  i | | É d  S(   N(   t   cfgt
   parse_file(   R   t   filet   sections(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   å   s    	c         C   s  t  d | É t | É t g  É j o | g } n t } t | d É } t i d É } t i d É } t i d É } t i d É } t i d É }	 xq| D]i}
 | i |
 É p | i |
 É o qõ n | i |
 É } | o6 | i É  d } | | j p t | É d j } qõ n | i |
 É } | o∆ | oø | i	 É  } |	 i | d	 É o | d	 d
 d !| d	 <n |  i
 | d | d	 É | d d j o4 | d	 d  d | d	 d t | d	 É d } n | d	 } t  d | d | f É qõ n t d | |
 f É qõ Wd  S(   Ns   ConfigParser: Reading file '%s't   rs   ^\s*#.*s   ^\s*$s   ^\[([^\]]+)\]s$   ^\s*(?P<key>\w+)\s*=\s*(?P<value>.*)s   ^"(.*)"\s*$i    RE   i   iˇˇˇˇt   keyRJ   RK   Ri   i   s   ...%d_chars...i   s   ConfigParser: %s->%ss!   Ignoring invalid line in '%s': %s(   s
   access_keys
   secret_keys   gpg_passphrase(   R    R    R#   t   opent   ret   compilet   matcht   groupst   lent	   groupdictt   __setitem__R   (   R   R~   R   t   in_our_sectiont   ft	   r_commentt   r_emptyt	   r_sectiont   r_datat   r_quotest   linet
   is_sectiont   sectiont   is_datat   datat   print_value(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR}   ê   s>      4
c         C   s   |  i  | S(   N(   R|   (   R   t   name(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __getitem__±   s    c         C   s   | |  i  | <d  S(   N(   R|   (   R   Ró   RE   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyRâ   ¥   s    c         C   s#   |  i  i | É o |  i  | S| S(   N(   R|   t   has_key(   R   Ró   R.   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR+   ∑   s    N(   RG   RH   R   R}   Rò   Râ   R   R+   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR)   ã   s
   !		R/   c           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   s   | |  _  d  S(   N(   R1   (   R   R1   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Ω   s    c         C   sR   |  i  i d | É x7 | i É  D]) } |  i  i d | t | | É f É q! Wd  S(   Ns   [%s]
s   %s = %s
(   R1   t   writeR(   R!   (   R   Rì   t   configR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR0   ¿   s     (   RG   RH   R   R0   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR/   º   s   	(   R=   R    R   R   R   RÉ   RS   R   R   R   R)   R/   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   <module>   s   "1
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 739B20DCF4B5A9EAE3F59F8A51FCE610
x-amz-id-2: Bnj6cHWRe2m72gY6b2JYPecPleaot1IWE9kJTGUfXtQnurdw
ETag: f93c915747f27f2933a18bcc20d80624

PUT /path/to/my/S3/PkgInfo.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:rOXVtfSJaGMKMdjcflYuXvE5mXY=
content-length: 445
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322426240/ctime:1321220014

package = "s3cmd"
version = "1.0.1"
url = "http://s3tools.org"
license = "GPL version 2"
short_description = "Command line tool for managing Amazon S3 and CloudFront services"
long_description = """
S3cmd lets you copy files from/to Amazon S3 
(Simple Storage Service) using a simple to use
command line client. Supports rsync-like backup,
GPG encryption, and more. Also supports management
of Amazon's CloudFront content delivery network.
"""

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: BDE72B9DD110D97F044AA54470D813EE
x-amz-id-2: rhLFKybY4mnb2oB4tqlJ1AwtfP7yjlsEwz0S7i6szjhjwr8d
ETag: d3af86656acfd8147cb10b0dafc3d9dc

PUT /path/to/my/S3/Progress.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:tzQN3cPwqvNSphLokE6k7iAWrfg=
content-length: 5526
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322426240/ctime:1321220027

—Ú
ÌsÒMc           @   sj   d  d k  Z  d  d k Z d  d k Z d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d S(   iˇˇˇˇNt   Progressc           B   sS   e  Z e i Z d  Ñ  Z d Ñ  Z d d d Ñ Z d Ñ  Z d Ñ  Z	 e
 d d Ñ Z RS(   c         C   s    t  i |  _ |  i | | É d  S(   N(   t   syst   stdoutt   _stdoutt   new_file(   t   selft   labelst
   total_size(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   __init__   s    c         C   se   | |  _  | |  _ d |  _ |  i |  _ t i i É  |  _ |  i |  _ |  i |  _ |  i	 d t
 É d  S(   Ni    R   (   R   R   t   initial_positiont   current_positiont   datetimet   nowt
   time_startt	   time_lastt   time_currentt   displayt   True(   R   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s    			iˇˇˇˇc         C   sf   |  i  |  _ t i i É  |  _  | d j o | |  _ n! | d j o |  i | 7_ n |  i É  d  S(   Niˇˇˇˇ(   R   R   R   R   R
   R   (   R   R
   t   delta_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   update!   s    c         C   s   |  i  d | É d  S(   Nt   done_message(   R   (   R   t   message(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   done,   s    c         C   s(   |  i  i d |  i É |  i  i É  d  S(   Nu)   %(source)s -> %(destination)s  %(extra)s
(   R   t   writeR   t   flush(   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   output_labels/   s    c         C   sp  | o |  i  É  d |  _ d S|  i |  i j o◊ t i |  i t É } | d d j o | d c d 7<n |  i |  i } | i	 d | i
 t | i É d } t i |  i |  i | t t É } |  i i d | d | d | | d | d f É |  i i É  d St i d	 |  i } | |  i j o? t | É d
 d
 |  _ |  i i d |  i É |  i i É  d Sd S(   sn   
		display(new_file = False[/True], done = False[/True])

		Override this method to provide a nicer output.
		i    Ni   t    t   BiÄQ g    ÄÑ.As"   100%%  %s%s in %.2fs (%.2f %sB/s)
id   i   s   %d%% (   R   t   last_milestoneR
   R   t   Utilst
   formatSizeR   R   R   t   dayst   secondst   floatt   microsecondsR	   R   R   R   t   selfselft   int(   R   R   R   t
   print_sizet	   timedeltat   sec_elapsedt   print_speedt   rel_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   3   s*    
	 %#'N(   t   __name__t
   __module__R   R   R   R   R   R   R   R   t   Falset   NoneR   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR    
   s   					t   ProgressANSIc           B   sc   e  Z d  Z e d Z e d Z e d Z e d Z e d Z e d Z e d Z	 e
 d	 d Ñ Z RS(
   s   [s   ?25ls   ?25ht   st   us   %uGt   0Kt   2Kc         C   sÑ  | o/ |  i  É  |  i i |  i É |  i i É  d S|  i |  i } | i d | i t	 | i
 É d } | d j o' t i |  i |  i | t t É } n d } |  i i |  i É |  i i |  i É |  i i d h t |  i É i t t |  i É É É d 6|  i d 6|  i o |  i d	 |  i p d d
 6| d 6| d d 6| d d 6É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   sY   %(current)s of %(total)s   %(percent)3d%% in %(elapsed)ds  %(speed).2f %(speed_coeff)sB/st   currentt   totalid   t   percentt   elapsedt   speedi   t   speed_coeffs     %s
(   i    R   (   R   R   R   t   ANSI_save_cursor_posR   R   R   R   R    R!   R"   R   R   R
   R	   R   t   ANSI_restore_cursor_post   ANSI_erase_to_eolt   strt   rjustt   lenR   (   R   R   R   R&   R'   R(   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   [   s,    
%'(
&N(   R*   R+   t   SCIt   ANSI_hide_cursort   ANSI_show_cursorR9   R:   t   ANSI_move_cursor_to_columnR;   t   ANSI_erase_current_lineR,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR.   P   s   






t
   ProgressCRc           B   s#   e  Z e d  É Z e d d Ñ Z RS(   i   c         C   sW  | o |  i  É  d S|  i |  i } | i d | i t | i É d } | d j o' t i |  i	 |  i
 | t t É } n d } |  i i |  i É d h t |  i	 É i t t |  i É É É d 6|  i d 6|  i o |  i	 d	 |  i p d d
 6| d 6| d d 6| d d 6} |  i i | É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   s\    %(current)s of %(total)s   %(percent)3d%% in %(elapsed)4ds  %(speed)7.2f %(speed_coeff)sB/sR3   R4   id   R5   R6   R7   i   R8   s     %s
(   i    R   (   R   R   R   R   R    R!   R"   R   R   R
   R	   R   R   R   t   CR_charR<   R=   R>   R   R   (   R   R   R   R&   R'   R(   t   output(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s(    
%'(
&N(   R*   R+   t   chrRE   R,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyRD   {   s   (   R   R   R   t   objectR    R.   RD   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   <module>   s
   F+
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 78EACAEC0194C8147E096286FFB8E85D
x-amz-id-2: TQTsTXj1JmRbP6JtI7z7wTj1qcmf0qnhakDOlLelda0qOLE5
ETag: e9d7eb6d87e256e94de8c4e7d7c1a02a

PUT /path/to/my/S3/S3Uri.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:oaOKtUEmk95DF0G/X3km35+5ueg=
content-length: 5347
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322426240/ctime:1321386876

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import os
import re
import sys
from BidirMap import BidirMap
from logging import debug
import S3
from Utils import unicodise, check_bucket_name_dns_conformity

class S3Uri(object):
	type = None
	_subclasses = None

	def __new__(self, string):
		if not self._subclasses:
			## Generate a list of all subclasses of S3Uri
			self._subclasses = []
			dict = sys.modules[__name__].__dict__
			for something in dict:
				if type(dict[something]) is not type(self):
					continue
				if issubclass(dict[something], self) and dict[something] != self:
					self._subclasses.append(dict[something])
		for subclass in self._subclasses:
			try:
				instance = object.__new__(subclass)
				instance.__init__(string)
				return instance
			except ValueError, e:
				continue
		raise ValueError("%s: not a recognized URI" % string)
	
	def __str__(self):
		return self.uri()

	def __unicode__(self):
		return self.uri()

	def public_url(self):
		raise ValueError("This S3 URI does not have Anonymous URL representation")

	def basename(self):
		return self.__unicode__().split("/")[-1]

class S3UriS3(S3Uri):
	type = "s3"
	_re = re.compile("^s3://([^/]+)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3 URI" % string)
		groups = match.groups()
		self._bucket = groups[0]
		self._object = unicodise(groups[1])

	def bucket(self):
		return self._bucket

	def object(self):
		return self._object
	
	def has_bucket(self):
		return bool(self._bucket)

	def has_object(self):
		return bool(self._object)

	def uri(self):
		return "/".join(["s3:/", self._bucket, self._object])
	
	def is_dns_compatible(self):
		return check_bucket_name_dns_conformity(self._bucket)

	def public_url(self):
		if self.is_dns_compatible():
			return "http://%s.s3.amazonaws.com/%s" % (self._bucket, self._object)
		else:
			return "http://s3.amazonaws.com/%s/%s" % (self._bucket, self._object)

	def host_name(self):
		if self.is_dns_compatible():
			return "%s.s3.amazonaws.com" % (self._bucket)
		else:
			return "s3.amazonaws.com"

	@staticmethod
	def compose_uri(bucket, object = ""):
		return "s3://%s/%s" % (bucket, object)

	@staticmethod
	def httpurl_to_s3uri(http_url):
		m=re.match("(https?://)?([^/]+)/?(.*)", http_url, re.IGNORECASE)
		hostname, object = m.groups()[1:]
		hostname = hostname.lower()
		if hostname == "s3.amazonaws.com":
			## old-style url: http://s3.amazonaws.com/bucket/object
			if object.count("/") == 0:
				## no object given
				bucket = object
				object = ""
			else:
				## bucket/object
				bucket, object = object.split("/", 1)
		elif hostname.endswith(".s3.amazonaws.com"):
			## new-style url: http://bucket.s3.amazonaws.com/object
			bucket = hostname[:-(len(".s3.amazonaws.com"))]
		else:
			raise ValueError("Unable to parse URL: %s" % http_url)
		return S3Uri("s3://%(bucket)s/%(object)s" % { 
			'bucket' : bucket,
			'object' : object })

class S3UriS3FS(S3Uri):
	type = "s3fs"
	_re = re.compile("^s3fs://([^/]*)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3fs URI" % string)
		groups = match.groups()
		self._fsname = groups[0]
		self._path = unicodise(groups[1]).split("/")

	def fsname(self):
		return self._fsname

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["s3fs:/", self._fsname, self.path()])

class S3UriFile(S3Uri):
	type = "file"
	_re = re.compile("^(\w+://)?(.*)")
	def __init__(self, string):
		match = self._re.match(string)
		groups = match.groups()
		if groups[0] not in (None, "file://"):
			raise ValueError("%s: not a file:// URI" % string)
		self._path = unicodise(groups[1]).split("/")

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["file:/", self.path()])

	def isdir(self):
		return os.path.isdir(self.path())

	def dirname(self):
		return os.path.dirname(self.path())

class S3UriCloudFront(S3Uri):
	type = "cf"
	_re = re.compile("^cf://([^/]*)/?", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a CloudFront URI" % string)
		groups = match.groups()
		self._dist_id = groups[0]

	def dist_id(self):
		return self._dist_id

	def uri(self):
		return "/".join(["cf:/", self.dist_id()])

if __name__ == "__main__":
	uri = S3Uri("s3://bucket/object")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print "object  =", uri.object()
	print

	uri = S3Uri("s3://bucket")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print

	uri = S3Uri("s3fs://filesystem1/path/to/remote/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("/path/to/local/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("cf://1234567890ABCD/")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "dist_id =", uri.dist_id()
	print

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 6497D0C016483B21A29A45141EA96880
x-amz-id-2: f7DDFnWaWGZyngN1wCjrsMydUmwoMOcmaXUyfjtkCKiH82uR
ETag: 7bfe82b2950b542ef985ee611fa2b310

PUT /path/to/my/S3/SortedDict.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:U9F6yGxtUsY75tsVF0hHtpyXxOc=
content-length: 1640
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322426240/ctime:1321220014

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from BidirMap import BidirMap

class SortedDictIterator(object):
	def __init__(self, sorted_dict, keys):
		self.sorted_dict = sorted_dict
		self.keys = keys

	def next(self):
		try:
			return self.keys.pop(0)
		except IndexError:
			raise StopIteration

class SortedDict(dict):
	def __init__(self, mapping = {}, ignore_case = True, **kwargs):
		"""
		WARNING: SortedDict() with ignore_case==True will
		         drop entries differing only in capitalisation!
				 Eg: SortedDict({'auckland':1, 'Auckland':2}).keys() => ['Auckland']
				 With ignore_case==False it's all right
		"""
		dict.__init__(self, mapping, **kwargs)
		self.ignore_case = ignore_case

	def keys(self):
		keys = dict.keys(self)
		if self.ignore_case:
			# Translation map
			xlat_map = BidirMap()
			for key in keys:
				xlat_map[key.lower()] = key
			# Lowercase keys
			lc_keys = xlat_map.keys()
			lc_keys.sort()
			return [xlat_map[k] for k in lc_keys]
		else:
			keys.sort()
			return keys

	def __iter__(self):
		return SortedDictIterator(self, self.keys())

if __name__ == "__main__":
	d = { 'AWS' : 1, 'Action' : 2, 'america' : 3, 'Auckland' : 4, 'America' : 5 }
	sd = SortedDict(d)
	print "Wanted: Action, america, Auckland, AWS,    [ignore case]"
	print "Got:   ",
	for key in sd:
		print "%s," % key,
	print "   [used: __iter__()]"
	d = SortedDict(d, ignore_case = False)
	print "Wanted: AWS, Action, Auckland, america,    [case sensitive]"
	print "Got:   ",
	for key in d.keys():
		print "%s," % key,
	print "   [used: keys()]"
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 10CA15F701AAB2E3C291CD83470958F9
x-amz-id-2: xpztL4m4TRFw4jUPHKvwzMUkIoLjOzmK8juEsarLK7y3qN7a
ETag: 05a6053b5f0cb40b09872572b238a50c

PUT /path/to/my/S3/Utils.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:3Hp0zcBy8MZT26WBWbUbAKW/yBw=
content-length: 14047
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 20:37:21 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322426240/ctime:1321220027

—Ú
¨tÒMc           @   sO  d  d k  Z  d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k	 Z	 d  d k
 l Z l Z l Z l Z d  d k Z d  d k Z e i d d j o4 e i d d j  o  d  d k l Z d  d k Z n d  d k l Z l Z y d  d k i i Z Wn" e j
 o d  d k i Z n Xd  d	 k l Z g  Z d
 Ñ  Z e i  d É d Ñ  Z! e i  d É d Ñ  Z" e i  d É d Ñ  Z# e i  d É d Ñ  Z$ e i  d É d Ñ  Z% e i  d É d Ñ  Z& e i  d É d Ñ  Z' e i  d É d Ñ  Z( e i  d É d Ñ  Z) e i  d É d Ñ  Z* e i  d É d  Ñ  Z+ e i  d! É d" Ñ  Z, e i  d# É e- e- d$ Ñ Z. e i  d% É d& Ñ  Z/ e i  d' É d( Ñ  Z0 e i  d) É e i1 e i2 Z3 e4 e3 É Z5 d* Ñ  Z6 e i  d+ É d, Ñ  Z7 e i  d- É d. d/ d0 Ñ Z8 e i  d1 É d2 d3 d4 Ñ Z9 e i  d5 É d6 Ñ  Z: e i  d7 É d8 Ñ  Z; e i  d9 É d d: d; Ñ Z= e i  d< É d d: d= Ñ Z> e i  d> É d d? Ñ Z? e i  d@ É dA Ñ  Z@ e i  dB É dC Ñ  ZA e i  dD É eB dE Ñ ZC e i  dF É dG Ñ  ZD e i  dH É dI Ñ  ZE e i  dJ É dK Ñ  ZF e i  dL É d S(M   iˇˇˇˇN(   t   debugt   infot   warningt   errori    i   i   i   (   t   md5(   R   t   sha1(   t
   ExpatErrorc         C   så   g  } x |  D]w } h  } x[ | i  É  D]M } | i } | i  É  o t | g É | | <q& | i d | i É | | <q& W| i | É q W| S(   Ns   .//%s(   t   getchildrent   tagt
   parseNodest   findtextt   append(   t   nodest   retvalt   nodet   retval_itemt   childt   name(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyR	   $   s      	R	   c         C   sd   t  i d t  i É } | i |  É o/ | i |  É i É  d } | i d |  É }  n d } |  | f S(   s:   
	removeNameSpace(xml) -- remove top-level AWS namespace
	s7   ^(<?[^>]+?>\s?)(<\w+) xmlns=['"](http://[^'"]+)['"](.*)i   s   \1\2\4N(   t   ret   compilet	   MULTILINEt   matcht   groupst   subt   None(   t   xmlt   rt   xmlns(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   stripNameSpace5   s    R   c         C   sv   t  |  É \ }  } y/ t i |  É } | o | | i d <n | SWn. t j
 o" } t | É t i d É Ç n Xd  S(   NR   sP   Bucket contains invalid filenames. Please run: s3cmd fixbucket s3://your-bucket/(   R   t   ETt
   fromstringt   attribR   R   t
   Exceptionst   ParameterError(   R   R   t   treet   e(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTreeFromXmlB   s    
R$   c         C   s)   t  |  É } | i d | É } t | É S(   Ns   .//%s(   R$   t   findallR	   (   R   R   R"   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getListFromXmlN   s    R&   c         C   s∂   h  } x© |  i  É  D]õ } | i  É  o q n | i | i É oW t | | i É t j p | | i g | | i <n | | i i | i p d É q | i p d | | i <q W| S(   Nt    (   R   t   has_keyR   t   typet   listR   t   text(   R"   t   ret_dictR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getDictFromTreeT   s     "R-   c         C   s8   t  |  É } | i i | É o | i S| i | É Sd  S(   N(   R$   R   t   endswithR+   R
   (   R   t   xpathR"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTextFromXmlc   s    R0   c         C   s   t  |  É } | i S(   N(   R$   R   (   R   R"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getRootTagNamek   s    R1   c         C   s"   t  i |  É } t | É | _ | S(   N(   R   t   Elementt   unicodeR+   (   t   tag_nameR+   t   el(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   xmlTextNodep   s    R6   c         C   s    t  |  | É } | i | É | S(   s†   
	Creates a new <tag_name> Node and sets
	its content to 'text'. Then appends the
	created Node to 'parent' element if given.
	Returns the newly created Node.
	(   R6   R   (   R4   R+   t   parentR5   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   appendXmlTextNodev   s    R8   c         C   s+   t  i d É i d |  É }  t i |  d É S(   Ns	   (\.\d*)?Zs   .000Zs   %Y-%m-%dT%H:%M:%S.000Z(   R   R   R   t   timet   strptime(   t   date(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toPythonÇ   s    R<   c         C   s   t  i t |  É É S(   N(   R9   t   mktimeR<   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toUnixá   s    R>   c         C   s   t  i |  É S(   N(   t   rfc822t	   parsedate(   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toPythoné   s    RA   c         C   s   t  i t |  É É S(   N(   R9   R=   RA   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toUnixí   s    RB   c         C   sÜ   | o t  |  É p
 t |  É }  | oQ d d d d g } d } x+ |  d j o |  d :}  | i d É } qB W|  | f S|  d f Sd  S(	   Nt   kt   Mt   Gt   TR'   i   i   i    (   t   floatt   intt   pop(   t   sizet   human_readablet   floating_pointt   coeffst   coeff(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt
   formatSizeñ   s      
RO   c         C   s   t  i d t |  É É S(   Ns   %Y-%m-%d %H:%M(   R9   t   strftimeR<   (   t   s3timestamp(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   formatDateTime£   s    RR   c         C   s-   h  } x  |  D] } | d | | d <q W| S(   Ni   i    (    (   R*   R   t   tuple(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   convertTupleListToDictß   s
     RT   c         C   sG   d } x: |  d j o, | t  t i d t d É 7} |  d 8}  q	 W| S(   NR'   i    i   (   t
   _rnd_charst   randomt   randintt   _rnd_chars_len(   t   lenR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   rndstr∞   s     RZ   c         C   s£   t  i d É } d } xz | d j ol |  t | É } y | | É PWn< t j
 o0 } | i t i j o t  i | É Ç  qÉ n X| d 8} q Wt  i | É | S(   Ni?   i   i    i   (   t   ost   umaskRZ   t   OSErrort   errnot   EEXIST(   t   prefixt	   randcharst
   createfunct	   old_umaskt   triest   dirnameR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpsomething∏   s     
Rf   s   /tmp/tmpdir-i
   c         C   s   t  |  | t i É S(   N(   Rf   R[   t   mkdir(   R`   Ra   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpdir    s    Rh   s   /tmp/tmpfile-i   c         C   s   d Ñ  } t  |  | | É S(   Nc         S   s#   t  i t  i |  t  i t  i BÉ É S(    (   R[   t   closet   opent   O_CREATt   O_EXCL(   t   filename(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <lambda>œ   s    (   Rf   (   R`   Ra   Rb   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   mktmpfileŒ   s    	Ro   c         C   sc   t  É  } t |  d É } x4 t o, | i d É } | p Pn | i | É q W| i É  | i É  S(   Nt   rbi    i   i Ä  (   R   Rj   t   Truet   readt   updateRi   t	   hexdigest(   Rm   t   ht   ft   data(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   hash_file_md5”   s    	 
Rx   c         C   s  |  i  t i É } g  } x? | o7 t i i t i i | É É o | i | i É  É q WxØ | oß | i | i É  É t i i | É } y t d | É t i	 | É Wq] t
 t f j
 o! } t d | | i f É t St j
 o } t d | | f É t SXq] Wt S(   sÜ   
	mkdir_with_parents(dst_dir)
	
	Create directory 'dir_name' with all parent directories

	Returns True on success, False otherwise.
	s	   mkdir(%s)s   %s: can not make directory: %ss   %s: %s(   t   splitR[   t   sept   patht   isdirt   joinR   RI   R    Rg   R]   t   IOErrorR   t   strerrort   Falset	   ExceptionRq   (   t   dir_namet   pathmemberst	   tmp_stackt   cur_dirR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mkdir_with_parents‡   s&     ' RÜ   t   replacec         C   sÑ   | p t  i  É  i } n t |  É t j o |  St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   s6   
	Convert 'string' to Unicode or raise an exception.
	s   Unicodising %r using %ss    Conversion to unicode failed: %rN(   t   Configt   encodingR)   R3   R    t   decodet   UnicodeDecodeError(   t   stringRâ   t   errors(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   unicodise˚   s    Ré   c         C   sä   | p t  i  É  i } n t |  É t j o t |  É St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   sx   
	Convert unicode 'string' to <type str>, by default replacing
	all invalid characters with '?' or raise an exception.
	s   DeUnicodising %r using %ss"   Conversion from unicode failed: %rN(   Rà   Râ   R)   R3   t   strR    t   encodet   UnicodeEncodeError(   Rå   Râ   Rç   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   deunicodise  s    Rí   c         C   s"   t  t |  | É | É i d d É S(   sk   
	Convert 'string' to Unicode according to current encoding 
	and replace all invalid characters with '?'
	u   ÔøΩt   ?(   Ré   Rí   Rá   (   Rå   Râ   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   unicodise_safe  s    Rî   c         C   s    d } d } xÇ |  D]z } t  | É } | d j o, | d t t  d É | É 7} | d 7} q | d j o | d 7} | d 7} q | | 7} q W| o. t i É  i d	 j o t d
 | | f É n | S(   sÉ   
	replace_nonprintables(string)

	Replaces all non-printable characters 'ch' in 'string'
	where ord(ch) <= 26 with ^@, ^A, ... ^Z
	R'   i    i   t   ^t   @i   i   s   ^?t	   fixbuckets+   %d non-printable characters replaced in: %s(   t   ordt   chrRà   t   urlencoding_modeR   (   Rå   t
   new_stringt   modifiedt   ct   o(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   replace_nonprintables'  s     
Rü   c         C   s7   t  i t i t i É  i |  t É i É  É i É  } | S(   N(	   t   base64t   encodestringt   hmact   newRà   t
   secret_keyR   t   digestt   strip(   t   string_to_signt	   signature(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   sign_string?  s    3R©   c         C   s¿  | oD t  i d |  É } | o' t i d |  | i É  d f É Ç qã nA t  i d |  É } | o' t i d |  | i É  d f É Ç n t |  É d j  o t i d |  É Ç n t |  É d j o t i d	 |  É Ç n | o÷ t |  É d
 j o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É p t i d |  É Ç n t  i d |  É p t i d |  É Ç qºn t S(   Ns   ([^a-z0-9\.-])sô   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: lowercase us-ascii letters (a-z), digits (0-9), dot (.) and hyphen (-).i    s   ([^A-Za-z0-9\._-])s§   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: us-ascii letters (a-z, A-Z), digits (0-9), dot (.), hyphen (-) and underscore (_).i   s0   Bucket name '%s' is too short (min 3 characters)iˇ   s1   Bucket name '%s' is too long (max 255 characters)i?   s0   Bucket name '%s' is too long (max 63 characters)s   -\.sE   Bucket name '%s' must not contain sequence '-.' for DNS compatibilitys   \.\.sE   Bucket name '%s' must not contain sequence '..' for DNS compatibilitys	   ^[0-9a-z]s4   Bucket name '%s' must start with a letter or a digits	   [0-9a-z]$s2   Bucket name '%s' must end with a letter or a digit(   R   t   searchR    R!   R   RY   Rq   (   t   buckett
   dns_strictt   invalid(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   check_bucket_nameF  s.    +'RÆ   c         C   s2   y t  |  d t ÉSWn t i j
 o t SXd  S(   NR¨   (   RÆ   Rq   R    R!   RÄ   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt    check_bucket_name_dns_conformityb  s    RØ   c         C   sR   t  i  É  i h d d 6} t i | |  É } | p |  t f S| i É  d t f S(   sø   
	bucket, success = getBucketFromHostname(hostname)

	Only works for hostnames derived from bucket names
	using Config.host_bucket pattern.

	Returns bucket name and a boolean success flag.
	s   (?P<bucket>.*)R´   i    (   Rà   t   host_bucketR   R   RÄ   R   Rq   (   t   hostnamet   patternt   m(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getBucketFromHostnamei  s
    R¥   c         C   s   t  i  É  i h |  d 6S(   NR´   (   Rà   R∞   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getHostnameFromBucket{  s    Rµ   (G   R[   t   sysR9   R   Rå   RV   R?   R¢   R†   R^   t   loggingR    R   R   R   Rà   R    t   version_infoR   t   shaR   t   hashlibt   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   xml.parsers.expatR   t   __all__R	   R   R   R$   R&   R-   R0   R1   R6   R8   R<   R>   RA   RB   RÄ   RO   RR   RT   t   ascii_letterst   digitsRU   RY   RX   RZ   Rf   Rh   Ro   Rx   RÜ   R   Ré   Rí   Rî   Rü   R©   Rq   RÆ   RØ   R¥   Rµ   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <module>   s¨   "(			
						
															
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T20:37:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: B43942319E4EAC2119C519B4CADE481B
x-amz-id-2: vLh92Ixbkb2NtpIQJv3L3X1UWFfols4b0QcVW4loArnlCMkS
ETag: c5d468a10b86b6de15cbd0ec76df1776

GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Mcdm/EJJ1NH7kxv/XFFqHgntiWU=
x-amz-date: Sun, 27 Nov 2011 20:47:01 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T20:47:01.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 8EF7825DC1D3259D09F0C2768825D45C
x-amz-id-2: G73lYMuQOK6OdryJb7FZ9oQfzUTsbDQa63kffgfIcQpZDRHf

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 20:48:45 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:TjBfkY15NLdXanzu/RwKsDcjrZ4=
Content-Length: 0

!! Unexpected error while processing request: undefined method `[]' for nil:NilClass
undefined method `[]' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:100:in `date'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:92:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 20:54:56 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:cCCSPZ5m5sc6Ph6ar1kWGmoDOPI=
Content-Length: 0

HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T20:54:56.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 9971FDBBFB39F689543D51106DAC970B
x-amz-id-2: whQDDiVZ6ppOH2KS1GFmxMrTVlXhDAZ614y2LC2Y9LPu6ZYc

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET /hello HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 20:55:34 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:4bl4aViz+5dytGujijX5j8O71RQ=
Content-Length: 0

HTTP/1.1 403 Forbidden
Content-Length: 200
Content-Type: plain/text
Connection: close
Date: 2011-11-27T20:55:34.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 7C3FC95DFAF329347A1C0E182097D3E9
x-amz-id-2: tOOtl90pVryvkKYOaTsDpMMwNGwTl2lWZR4slptiJ9147ZcN

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource></Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:8BdgQ8q1Km/f9ScxTKp2ZQgmCvI=
x-amz-date: Sun, 27 Nov 2011 20:56:29 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T20:56:29.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 5811CAF2B4C97D6E13DD3A7AB09964D6
x-amz-id-2: nEfBWwSbygLWl5OZOkOF2tqCxCajrGzEK3Kk9GVGWmUDSlnC

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 20:56:40 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:zvl/2aizzIxsBpc+Xeuazzb55wQ=
Content-Length: 0

!! Unexpected error while processing request: undefined method `[]' for nil:NilClass
undefined method `[]' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:100:in `date'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:92:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:06:21 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Hh7bLyj427ZbYk/NSCGcku99Xqg=
Content-Length: 0

!! Unexpected error while processing request: undefined method `[]' for nil:NilClass
undefined method `[]' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:100:in `date'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:92:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:jJ6wmWVtbBKTrZFVksMbyG/TgMQ=
x-amz-date: Sun, 27 Nov 2011 21:07:34 +0000

HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:07:34.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 2611BC87398CB4D3159646F2DD75B09F
x-amz-id-2: FQJ9Nzc40JXuwKVfXAhu4tcJjBHE4cSfLIknsoV47v3bwTYh

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:07:39 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:E4rep0qYn7FaVWC90x8/Iio/35Q=
Content-Length: 0

!! Unexpected error while processing request: undefined method `[]' for nil:NilClass
undefined method `[]' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:100:in `amz_date'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:92:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:BwQZQD8OCmc+UyqQMhMoJMgserE=
x-amz-date: Sun, 27 Nov 2011 21:10:55 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100faecd0
   @input=#<StringIO:0x00000101199d88>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100faec58
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:BwQZQD8OCmc+UyqQMhMoJMgserE=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:10:55 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100fbe4c8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:BwQZQD8OCmc+UyqQMhMoJMgserE="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:10:55 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"3B05A3360A0FD8D5DA4574FCF24D623C",
 "smoke.request_token"=>"oyBoExHKaE5u7lnpvBVPoqDWsw3kvhsy5UcClyq07V6Ut0cn"}
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:10:55.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 3B05A3360A0FD8D5DA4574FCF24D623C
x-amz-id-2: oyBoExHKaE5u7lnpvBVPoqDWsw3kvhsy5UcClyq07V6Ut0cn

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:12:11 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:DwearL7jE4Kr5ENivPuVrjzbLc4=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100fafb80
   @input=#<StringIO:0x00000100fe9cb8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100fafb08
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:12:11 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:DwearL7jE4Kr5ENivPuVrjzbLc4=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100fc69e8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:12:11 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:DwearL7jE4Kr5ENivPuVrjzbLc4="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"1DA53C57A8EAE7E615FDCDD357EC4B41",
 "smoke.request_token"=>"rvG6Fs24RRLRsb78sNXzdrGoKbdF5PprogX6es1y4eUHcBnf"}
!! Unexpected error while processing request: undefined method `[]' for nil:NilClass
undefined method `[]' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:101:in `amz_date'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:92:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:lokgMmcAuJUruiDWH08CF7jymbk=
x-amz-date: Sun, 27 Nov 2011 21:13:39 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100fb0300
   @input=#<StringIO:0x00000100fe5d48>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100fb0288
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:lokgMmcAuJUruiDWH08CF7jymbk=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:13:39 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100fb49a0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:lokgMmcAuJUruiDWH08CF7jymbk="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:13:39 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"BE179789F365204B8EBFBC276F07FAAB",
 "smoke.request_token"=>"9VnVkZLhsDqatbvSE8ALlNbLw8LpntC84l0ErCBZkHjdIyO9"}
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:13:39.000Z
Server: Smoke - Mary Jane
x-amz-request-id: BE179789F365204B8EBFBC276F07FAAB
x-amz-id-2: 9VnVkZLhsDqatbvSE8ALlNbLw8LpntC84l0ErCBZkHjdIyO9

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:13:51 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Xkb9cks4sGodvShqDdX4oYEehOs=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100c034f0
   @input=#<StringIO:0x00000100c33f60>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100c032c0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:13:51 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:Xkb9cks4sGodvShqDdX4oYEehOs=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100c33420>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:13:51 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:Xkb9cks4sGodvShqDdX4oYEehOs="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"22EC08EC465CA9895D8673838E0AF1C4",
 "smoke.request_token"=>"K4nM7I1jWxzGMrthYurY5X2mhFUBwDf2WcMObkRwPjhAD4zP"}
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:13:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 22EC08EC465CA9895D8673838E0AF1C4
x-amz-id-2: K4nM7I1jWxzGMrthYurY5X2mhFUBwDf2WcMObkRwPjhAD4zP

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET /hello HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:13:57 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:fwuls+Krb50a6sl+bOm+aE9TkvU=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001008ec398
   @input=#<StringIO:0x0000010094a0d8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001008ec0c8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/hello",
 "PATH_INFO"=>"/hello",
 "REQUEST_URI"=>"/hello",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:13:57 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:fwuls+Krb50a6sl+bOm+aE9TkvU=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100946c80>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:13:57 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:fwuls+Krb50a6sl+bOm+aE9TkvU="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"hello",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"26EFB2919743BADCA6755E8658E73FE2",
 "smoke.request_token"=>"aeeElau4xAsU5vzh1fTzQg6tRmJVfcg8HRHIwt6PCtwc9yCE"}
HTTP/1.1 403 Forbidden
Content-Length: 200
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:13:57.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 26EFB2919743BADCA6755E8658E73FE2
x-amz-id-2: aeeElau4xAsU5vzh1fTzQg6tRmJVfcg8HRHIwt6PCtwc9yCE

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource></Resource>
	<RequestId></RequestId>
</Error>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:eTuXjtTbeat9FmGq9FyFj8mduys=
x-amz-date: Sun, 27 Nov 2011 21:14:41 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101284338
   @input=#<StringIO:0x0000010309eb70>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001012842c0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:eTuXjtTbeat9FmGq9FyFj8mduys=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:14:41 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x0000010309e508>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:eTuXjtTbeat9FmGq9FyFj8mduys="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:14:41 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"B3D6EF1A897500A94259F49AFF0E55AF",
 "smoke.request_token"=>"imVGMXS93loT0oyBBKVuRd3hJDLu7Kj2MfwuffOor1vQnHTp"}
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:14:41.000Z
Server: Smoke - Mary Jane
x-amz-request-id: B3D6EF1A897500A94259F49AFF0E55AF
x-amz-id-2: imVGMXS93loT0oyBBKVuRd3hJDLu7Kj2MfwuffOor1vQnHTp

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Sn/pVrTHY0aSB/9CC+mP1W1oFhI=
x-amz-date: Sun, 27 Nov 2011 21:16:12 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100e9b3e8
   @input=#<StringIO:0x00000100ebaae0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100e9b370
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:Sn/pVrTHY0aSB/9CC+mP1W1oFhI=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:16:12 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100ea1180>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:Sn/pVrTHY0aSB/9CC+mP1W1oFhI="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:16:12 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"2EF5F9402860B1F610D91335CB4C0B55",
 "smoke.request_token"=>"BXjLNMFMPyGTTcMuLmjZtAt036AvZ95WpmhmwLU0MIwB7k5z"}
StringToSign: GET


Sun, 27 Nov 2011 21:16:12 +0000
x-amz-date:Sun, 27 Nov 2011 21:16:12 +0000
/
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:16:12.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 2EF5F9402860B1F610D91335CB4C0B55
x-amz-id-2: BXjLNMFMPyGTTcMuLmjZtAt036AvZ95WpmhmwLU0MIwB7k5z

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:eN2+pcqpcv0DUkVHx612Dj6MfU8=
x-amz-date: Sun, 27 Nov 2011 21:16:25 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100b2cb30
   @input=#<StringIO:0x00000100b53028>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100b2c810
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:eN2+pcqpcv0DUkVHx612Dj6MfU8=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:16:25 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100b517c8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:eN2+pcqpcv0DUkVHx612Dj6MfU8="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:16:25 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"54D932D4D95FCA689474973FCC3F3743",
 "smoke.request_token"=>"larBT7x8otgTlFu5xJ1vpb96y1ZtEGzqylV9F2472kTYcGsQ"}
StringToSign: GET


Sun, 27 Nov 2011 21:16:25 +0000
x-amz-date:Sun, 27 Nov 2011 21:16:25 +0000
/
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:16:25.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 54D932D4D95FCA689474973FCC3F3743
x-amz-id-2: larBT7x8otgTlFu5xJ1vpb96y1ZtEGzqylV9F2472kTYcGsQ

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:C6Skqkm3Of27CdB5vilBWnuHxVE=
x-amz-date: Sun, 27 Nov 2011 21:18:53 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101458420
   @input=#<StringIO:0x0000010147e4e0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001014583a8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:C6Skqkm3Of27CdB5vilBWnuHxVE=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:18:53 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x0000010145c390>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:C6Skqkm3Of27CdB5vilBWnuHxVE="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:18:53 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"422787B4380A482A1B11AE5FB9B78D5C",
 "smoke.request_token"=>"0jpc8GXB3oboHQf8zjgCtUkmiNaooQf3v1xiiTMAe9BBsrcq"}
!! Unexpected error while processing request: undefined method `has_key' for {"x-amz-date"=>["Sun, 27 Nov 2011 21:18:53 +0000"]}:Hash
undefined method `has_key' for {"x-amz-date"=>["Sun, 27 Nov 2011 21:18:53 +0000"]}:Hash
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/signature.rb:17:in `sign'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:95:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:taKRc4p8pIgqeLgV3RVloHvjei0=
x-amz-date: Sun, 27 Nov 2011 21:19:58 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100d21dc8
   @input=#<StringIO:0x00000100d373a8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100d21d50
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:taKRc4p8pIgqeLgV3RVloHvjei0=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:19:58 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100d25ce8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:taKRc4p8pIgqeLgV3RVloHvjei0="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Sun, 27 Nov 2011 21:19:58 +0000"]},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"017BCA2D9005E78FDCF9AF5E568687A5",
 "smoke.request_token"=>"ZYbxpZJgw44uGiei1Hdi4bOWLhjV7OcOddXUNlDtD4Lm1Hwf"}
StringToSign: GET



x-amz-date:Sun, 27 Nov 2011 21:19:58 +0000
/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:19:58.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 017BCA2D9005E78FDCF9AF5E568687A5
x-amz-id-2: ZYbxpZJgw44uGiei1Hdi4bOWLhjV7OcOddXUNlDtD4Lm1Hwf

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:20:21 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:30/Apz9iJtvWSIyBSIrXpzhYeyY=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100d46420
   @input=#<StringIO:0x00000100d4b9e8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100d46380
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:20:21 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:30/Apz9iJtvWSIyBSIrXpzhYeyY=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100d4b060>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:20:21 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:30/Apz9iJtvWSIyBSIrXpzhYeyY="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"012D5C775FBF36C497449545C4CF9154",
 "smoke.request_token"=>"mi5DtDPAR4CXrGOr8HnLimlk7YqFdxfHucI4tSwr5slPhQNr"}
StringToSign: GET

binary/octet-stream

/
HTTP/1.1 403 Forbidden
Content-Length: 201
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:20:21.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 012D5C775FBF36C497449545C4CF9154
x-amz-id-2: mi5DtDPAR4CXrGOr8HnLimlk7YqFdxfHucI4tSwr5slPhQNr

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET /hello HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:20:23 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:GkiCSmAW9XDbpjC2U8MwLSxYlck=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100cfdba8
   @input=#<StringIO:0x00000100d0d508>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100cfdb30
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/hello",
 "PATH_INFO"=>"/hello",
 "REQUEST_URI"=>"/hello",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:20:23 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:GkiCSmAW9XDbpjC2U8MwLSxYlck=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100d0cc20>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:20:23 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:GkiCSmAW9XDbpjC2U8MwLSxYlck="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"hello",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"8E238AFF63F5D1998BB13A901096D418",
 "smoke.request_token"=>"bl2vdmAQxzrP9lFndaaZNuXZwpMjHI9z2zjEyw7RTrIrB7Xd"}
StringToSign: GET

binary/octet-stream

/hello
HTTP/1.1 403 Forbidden
Content-Length: 200
Content-Type: plain/text
Connection: close
Date: 2011-11-27T21:20:23.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 8E238AFF63F5D1998BB13A901096D418
x-amz-id-2: bl2vdmAQxzrP9lFndaaZNuXZwpMjHI9z2zjEyw7RTrIrB7Xd

<Error>
	<Code>SignatureDoesNotMatch</Code>
	<Message>The request signature we calculated does not match the signature you provided.</Message>
	<Resource></Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:24:07 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:4MAREGYQ7RlFTezT+tt+lyIv3/A=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101634550
   @input=#<StringIO:0x000001016e9dd8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001016344d8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:24:07 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:4MAREGYQ7RlFTezT+tt+lyIv3/A=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001016402b0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:24:07 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:4MAREGYQ7RlFTezT+tt+lyIv3/A="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"CE01F7B092D11E4D04323B23D159A792",
 "smoke.request_token"=>"fOBFQXNJPFedPzqHruk2iMJ1GmSF1DGX4kgzIp2XXdRB7EhT"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:24:07 GMT
/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:24:08.000Z
Server: Smoke - Mary Jane
x-amz-request-id: CE01F7B092D11E4D04323B23D159A792
x-amz-id-2: fOBFQXNJPFedPzqHruk2iMJ1GmSF1DGX4kgzIp2XXdRB7EhT

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /mocky HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:26:51 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:jeZeosoPgu52BTeWAmpy7RH4oa8=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001010dc990
   @input=#<StringIO:0x00000102812d30>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001010dc8a0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "REQUEST_URI"=>"/mocky",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:26:51 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:jeZeosoPgu52BTeWAmpy7RH4oa8=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001011a5160>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:26:51 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:jeZeosoPgu52BTeWAmpy7RH4oa8="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"E5197BA63F769AF47F02007B10DFB1E3",
 "smoke.request_token"=>"6NvaNEyRv9gT4mSpfxy2kf85kfeU8N9aDrzVWNAOxwTJCr71"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:26:51 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 9604
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
  <Contents>
    <Key>path/to/my/S3/ACL.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8f194a5efc6e5b5e77b936c1299839d6</ETag>
    <Size>27450</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>257619936bb45f137d7baa6c4537f50f</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
	
</ListBucketResult>
GET /mocky?prefix=path/to/my HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:34:18 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:YBlIPfGPsjzJBskqa++AsCKK2Pg=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102b0bac8
   @input=#<StringIO:0x00000101363308>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102b0ba50
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"prefix=path/to/my",
 "REQUEST_URI"=>"/mocky?prefix=path/to/my",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:34:18 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:YBlIPfGPsjzJBskqa++AsCKK2Pg=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000101362b88>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:34:18 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:YBlIPfGPsjzJBskqa++AsCKK2Pg="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"07DCC6DBFDE50111B2F05134B9B925FE",
 "smoke.request_token"=>"YwBdp8qEUwhKPeGvk9SK1A8cZmOD1IGlZirTtLZqmdYwkRZk"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:34:18 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 9604
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
  <Contents>
    <Key>path/to/my/S3/ACL.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8f194a5efc6e5b5e77b936c1299839d6</ETag>
    <Size>27450</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>257619936bb45f137d7baa6c4537f50f</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
	
</ListBucketResult>
PUT /path/to/my/S3-copy/S3/ACL.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:a2iBfjfUhiVjfvtjyyb9kVnMAQQ=
content-length: 5989
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 21:35:50 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014

## Amazon S3 - Access Control List representation
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from Utils import getTreeFromXml

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

class Grantee(object):
	ALL_USERS_URI = "http://acs.amazonaws.com/groups/global/AllUsers"
	LOG_DELIVERY_URI = "http://acs.amazonaws.com/groups/s3/LogDelivery"

	def __init__(self):
		self.xsi_type = None
		self.tag = None
		self.name = None
		self.display_name = None
		self.permission = None

	def __repr__(self):
		return 'Grantee("%(tag)s", "%(name)s", "%(permission)s")' % { 
			"tag" : self.tag, 
			"name" : self.name, 
			"permission" : self.permission 
		}

	def isAllUsers(self):
		return self.tag == "URI" and self.name == Grantee.ALL_USERS_URI
	
	def isAnonRead(self):
		return self.isAllUsers() and (self.permission == "READ" or self.permission == "FULL_CONTROL")
	
	def getElement(self):
		el = ET.Element("Grant")
		grantee = ET.SubElement(el, "Grantee", { 
			'xmlns:xsi' : 'http://www.w3.org/2001/XMLSchema-instance',
			'xsi:type' : self.xsi_type
		})
		name = ET.SubElement(grantee, self.tag)
		name.text = self.name
		permission = ET.SubElement(el, "Permission")
		permission.text = self.permission
		return el

class GranteeAnonRead(Grantee):
	def __init__(self):
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.ALL_USERS_URI
		self.permission = "READ"

class GranteeLogDelivery(Grantee):
	def __init__(self, permission):
		"""
		permission must be either READ_ACP or WRITE
		"""
		Grantee.__init__(self)
		self.xsi_type = "Group"
		self.tag = "URI"
		self.name = Grantee.LOG_DELIVERY_URI
		self.permission = permission

class ACL(object):
	EMPTY_ACL = "<AccessControlPolicy><Owner><ID></ID></Owner><AccessControlList></AccessControlList></AccessControlPolicy>"

	def __init__(self, xml = None):
		if not xml:
			xml = ACL.EMPTY_ACL

		self.grantees = []
		self.owner_id = ""
		self.owner_nick = ""

		tree = getTreeFromXml(xml)
		self.parseOwner(tree)
		self.parseGrants(tree)

	def parseOwner(self, tree):
		self.owner_id = tree.findtext(".//Owner//ID")
		self.owner_nick = tree.findtext(".//Owner//DisplayName")

	def parseGrants(self, tree):
		for grant in tree.findall(".//Grant"):
			grantee = Grantee()
			g = grant.find(".//Grantee")
			grantee.xsi_type = g.attrib['{http://www.w3.org/2001/XMLSchema-instance}type']
			grantee.permission = grant.find('Permission').text
			for el in g:
				if el.tag == "DisplayName":
					grantee.display_name = el.text
				else:
					grantee.tag = el.tag
					grantee.name = el.text
			self.grantees.append(grantee)

	def getGrantList(self):
		acl = []
		for grantee in self.grantees:
			if grantee.display_name:
				user = grantee.display_name
			elif grantee.isAllUsers():
				user = "*anon*"
			else:
				user = grantee.name
			acl.append({'grantee': user, 'permission': grantee.permission})
		return acl

	def getOwner(self):
		return { 'id' : self.owner_id, 'nick' : self.owner_nick }

	def isAnonRead(self):
		for grantee in self.grantees:
			if grantee.isAnonRead():
				return True
		return False
	
	def grantAnonRead(self):
		if not self.isAnonRead():
			self.appendGrantee(GranteeAnonRead())
	
	def revokeAnonRead(self):
		self.grantees = [g for g in self.grantees if not g.isAnonRead()]

	def appendGrantee(self, grantee):
		self.grantees.append(grantee)

	def hasGrant(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		for grantee in self.grantees:
			if grantee.name.lower() == name:
				if grantee.permission == "FULL_CONTROL":
					return True
				elif grantee.permission.upper() == permission:
					return True

		return False;

	def grant(self, name, permission):
		if self.hasGrant(name, permission):
			return

		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			permission = "FULL_CONTROL"

		if "FULL_CONTROL" == permission:
			self.revoke(name, "ALL")

		grantee = Grantee()
		grantee.name = name
		grantee.permission = permission

		if  name.find('@') <= -1: # ultra lame attempt to differenciate emails id from canonical ids
			grantee.xsi_type = "CanonicalUser"
			grantee.tag = "ID"
		else:
			grantee.xsi_type = "AmazonCustomerByEmail"
			grantee.tag = "EmailAddress"
				
		self.appendGrantee(grantee)


	def revoke(self, name, permission):
		name = name.lower()
		permission = permission.upper()

		if "ALL" == permission:
			self.grantees = [g for g in self.grantees if not g.name.lower() == name]
		else:
			self.grantees = [g for g in self.grantees if not (g.name.lower() == name and g.permission.upper() ==  permission)]


	def __str__(self):
		tree = getTreeFromXml(ACL.EMPTY_ACL)
		tree.attrib['xmlns'] = "http://s3.amazonaws.com/doc/2006-03-01/"
		owner = tree.find(".//Owner//ID")
		owner.text = self.owner_id
		acl = tree.find(".//AccessControlList")
		for grantee in self.grantees:
			acl.append(grantee.getElement())
		return ET.tostring(tree)

if __name__ == "__main__":
	xml = """<?xml version="1.0" encoding="UTF-8"?>
<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
<Owner>
	<ID>12345678901234567890</ID>
	<DisplayName>owner-nickname</DisplayName>
</Owner>
<AccessControlList>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="CanonicalUser">
			<ID>12345678901234567890</ID>
			<DisplayName>owner-nickname</DisplayName>
		</Grantee>
		<Permission>FULL_CONTROL</Permission>
	</Grant>
	<Grant>
		<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="Group">
			<URI>http://acs.amazonaws.com/groups/global/AllUsers</URI>
		</Grantee>
		<Permission>READ</Permission>
	</Grant>
</AccessControlList>
</AccessControlPolicy>
	"""
	acl = ACL(xml)
	print "Grants:", acl.getGrantList()
	acl.revokeAnonRead()
	print "Grants:", acl.getGrantList()
	acl.grantAnonRead()
	print "Grants:", acl.getGrantList()
	print acl
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102bc56a8
   @input=#<StringIO:0x00000102b29be0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102bc5630
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/ACL.py",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/ACL.py",
 "REQUEST_URI"=>"http://mocky.localhost/mocky/path/to/my/S3-copy/S3/ACL.py?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:a2iBfjfUhiVjfvtjyyb9kVnMAQQ=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:50 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014",
 "CONTENT_LENGTH"=>"5989",
 "CONTENT_TYPE"=>"text/x-python",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102b2d6a0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:a2iBfjfUhiVjfvtjyyb9kVnMAQQ="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:50 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/ACL.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"6BE0E1F165FEDE995A809E7B2E808163",
 "smoke.request_token"=>"omk9kZAkQvseDRSf9GnqTApOgHaJvpPWxwjYZkHYVnCdA2YT"}
StringToSign: PUT

text/x-python

x-amz-date:Sun, 27 Nov 2011 21:35:50 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014
/mocky/path/to/my/S3-copy/S3/ACL.py
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:50.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 6BE0E1F165FEDE995A809E7B2E808163
x-amz-id-2: omk9kZAkQvseDRSf9GnqTApOgHaJvpPWxwjYZkHYVnCdA2YT
ETag: 577a2c29e4910b5be9d133592a50b85e

PUT /path/to/my/S3-copy/S3/AccessLog.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:aYKju0ZlyXhIyIxzyCs4BBF1/Zg=
content-length: 3705
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027

—Ú
ÌsÒMc           @   s  d  d k  Z  d  d k l Z d  d k l Z d  d k l Z y d  d k i i	 Z
 Wn" e j
 o d  d k i	 Z
 n Xg  Z d e f d Ñ  É  YZ e i d É e d j om d  d k  l  Z  e É  Z e GHe i e  d	 É É e GHe i e É e GHe i e É e GHe i É  e GHn d S(
   iˇˇˇˇN(   t   ParameterError(   t   getTreeFromXml(   t   GranteeAnonReadt	   AccessLogc           B   s_   e  Z d  Z d Z d
 d Ñ Z d Ñ  Z d Ñ  Z d Ñ  Z d Ñ  Z	 d Ñ  Z
 d Ñ  Z d	 Ñ  Z RS(   s+   <BucketLoggingStatus></BucketLoggingStatus>s[   <LoggingEnabled><TargetBucket></TargetBucket><TargetPrefix></TargetPrefix></LoggingEnabled>c         C   s7   | p |  i  } n t | É |  _ d |  i i d <d  S(   Ns&   http://doc.s3.amazonaws.com/2006-03-01t   xmlns(   t   LOG_DISABLEDR   t   treet   attrib(   t   selft   xml(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __init__   s    c         C   s   t  |  i i d É É S(   Ns   .//LoggingEnabled(   t   boolR   t   find(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isLoggingEnabled   s    c         C   s1   |  i  i d É } | o |  i  i | É n d  S(   Ns   .//LoggingEnabled(   R   R   t   remove(   R   t   el(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   disableLogging   s    c         C   sp   |  i  i d É } | p# t |  i É } |  i  i | É n | i É  | i d É _ | i É  | i d É _ d  S(   Ns   .//LoggingEnableds   .//TargetBuckets   .//TargetPrefix(   R   R   R   t   LOG_TEMPLATEt   appendt   buckett   textt   object(   R   t   target_prefix_uriR   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   enableLogging#   s    c         C   sc   |  i  É  oN |  i i d É } d |  i i d É i |  i i d É i f } t i | É Sd Sd  S(   Ns   .//LoggingEnableds
   s3://%s/%ss   .//LoggingEnabled//TargetBuckets   .//LoggingEnabled//TargetPrefixt    (   R   R   R   R   t   S3Uri(   R   R   t   target_prefix(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   targetPrefix+   s    c         C   sô   |  i  i d É } | p t d É Ç n | i d É } | p | p d  S| i | É n: t É  i É  } | p t i | d É } n | i | É d  S(   Ns   .//LoggingEnableds3   Logging not enabled, can't set default ACL for logss   .//TargetGrantst   TargetGrants(	   R   R   R    R   R   t
   getElementt   ETt
   SubElementR   (   R   t
   acl_publict   let   tgt	   anon_read(    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   setAclPublic5   s    c         C   s   t  É  Ç d  S(   N(   t   NotImplementedError(   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   isAclPublicH   s    c         C   s   t  i |  i É S(   N(   R   t   tostringR   (   R   (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   __str__K   s    N(   t   __name__t
   __module__R   R   t   NoneR
   R   R   R   R   R$   R&   R(   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyR      s   				
		t   __main__(   R   s   s3://targetbucket/prefix/log-(   R   t
   ExceptionsR    t   UtilsR   t   ACLR   t   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   __all__R   R   R   R)   t   logR   R$   t   Truet   FalseR   (    (    (    s,   /Users/rlyon/src/s3cmd-1.0.1/S3/AccessLog.pyt   <module>   s,   <	

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001029a56c0
   @input=#<StringIO:0x000001029b22a8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001029a55f8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/AccessLog.pyc",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/AccessLog.pyc",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/AccessLog.pyc?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:aYKju0ZlyXhIyIxzyCs4BBF1/Zg=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027",
 "CONTENT_LENGTH"=>"3705",
 "CONTENT_TYPE"=>"application/x-python-code",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001029ac4c0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:aYKju0ZlyXhIyIxzyCs4BBF1/Zg="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/AccessLog.pyc",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"0BD96096360F8F29B69186069E7341FE",
 "smoke.request_token"=>"u8hleFuu0TMfCHgHqWwcis9hhCxKQeyF3HWSwLBLqFqKuRU8"}
StringToSign: PUT

application/x-python-code

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027
/mocky/path/to/my/S3-copy/S3/AccessLog.pyc
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 0BD96096360F8F29B69186069E7341FE
x-amz-id-2: u8hleFuu0TMfCHgHqWwcis9hhCxKQeyF3HWSwLBLqFqKuRU8
ETag: aa81939b1ce989e56383f841cbfa26ba

PUT /path/to/my/S3-copy/S3/CloudFront.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ss0S3V/zF7hnvaPCKryY+jPZ3gc=
content-length: 19915
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014

## Amazon CloudFront support
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import sys
import time
import httplib
from logging import debug, info, warning, error

try:
	import xml.etree.ElementTree as ET
except ImportError:
	import elementtree.ElementTree as ET

from Config import Config
from Exceptions import *
from Utils import getTreeFromXml, appendXmlTextNode, getDictFromTree, dateS3toPython, sign_string, getBucketFromHostname, getHostnameFromBucket
from S3Uri import S3Uri, S3UriS3

def output(message):
	sys.stdout.write(message + "\n")

def pretty_output(label, message):
	#label = ("%s " % label).ljust(20, ".")
	label = ("%s:" % label).ljust(15)
	output("%s %s" % (label, message))

class DistributionSummary(object):
	## Example:
	##
	## <DistributionSummary>
	##	<Id>1234567890ABC</Id>
	##	<Status>Deployed</Status>
	##	<LastModifiedTime>2009-01-16T11:49:02.189Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<Origin>example.bucket.s3.amazonaws.com</Origin>
	##	<Enabled>true</Enabled>
	## </DistributionSummary>

	def __init__(self, tree):
		if tree.tag != "DistributionSummary":
			raise ValueError("Expected <DistributionSummary /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")

	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionList(object):
	## Example:
	## 
	## <DistributionList xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Marker />
	##	<MaxItems>100</MaxItems>
	##	<IsTruncated>false</IsTruncated>
	##	<DistributionSummary>
	##	... handled by DistributionSummary() class ...
	##	</DistributionSummary>
	## </DistributionList>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "DistributionList":
			raise ValueError("Expected <DistributionList /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['IsTruncated'] = (self.info['IsTruncated'].lower() == "true")

		self.dist_summs = []
		for dist_summ in tree.findall(".//DistributionSummary"):
			self.dist_summs.append(DistributionSummary(dist_summ))

class Distribution(object):
	## Example:
	##
	## <Distribution xmlns="http://cloudfront.amazonaws.com/doc/2010-07-15/">
	##	<Id>1234567890ABC</Id>
	##	<Status>InProgress</Status>
	##	<LastModifiedTime>2009-01-16T13:07:11.319Z</LastModifiedTime>
	##	<DomainName>blahblahblah.cloudfront.net</DomainName>
	##	<DistributionConfig>
	##	... handled by DistributionConfig() class ...
	##	</DistributionConfig>
	## </Distribution>

	def __init__(self, xml):
		tree = getTreeFromXml(xml)
		if tree.tag != "Distribution":
			raise ValueError("Expected <Distribution /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		## Normalise some items
		self.info['LastModifiedTime'] = dateS3toPython(self.info['LastModifiedTime'])

		self.info['DistributionConfig'] = DistributionConfig(tree = tree.find(".//DistributionConfig"))
	
	def uri(self):
		return S3Uri("cf://%s" % self.info['Id'])

class DistributionConfig(object):
	## Example:
	##
	## <DistributionConfig>
	##	<Origin>somebucket.s3.amazonaws.com</Origin>
	##	<CallerReference>s3://somebucket/</CallerReference>
	##	<Comment>http://somebucket.s3.amazonaws.com/</Comment>
	##	<Enabled>true</Enabled>
	##  <Logging>
	##    <Bucket>bu.ck.et</Bucket>
	##    <Prefix>/cf-somebucket/</Prefix>
	##  </Logging>
	## </DistributionConfig>

	EMPTY_CONFIG = "<DistributionConfig><Origin/><CallerReference/><Enabled>true</Enabled></DistributionConfig>"
	xmlns = "http://cloudfront.amazonaws.com/doc/2010-07-15/"
	def __init__(self, xml = None, tree = None):
		if not xml:
			xml = DistributionConfig.EMPTY_CONFIG

		if not tree:
			tree = getTreeFromXml(xml)

		if tree.tag != "DistributionConfig":
			raise ValueError("Expected <DistributionConfig /> xml, got: <%s />" % tree.tag)
		self.parse(tree)

	def parse(self, tree):
		self.info = getDictFromTree(tree)
		self.info['Enabled'] = (self.info['Enabled'].lower() == "true")
		if not self.info.has_key("CNAME"):
			self.info['CNAME'] = []
		if type(self.info['CNAME']) != list:
			self.info['CNAME'] = [self.info['CNAME']]
		self.info['CNAME'] = [cname.lower() for cname in self.info['CNAME']]
		if not self.info.has_key("Comment"):
			self.info['Comment'] = ""
		if not self.info.has_key("DefaultRootObject"):
			self.info['DefaultRootObject'] = ""
		## Figure out logging - complex node not parsed by getDictFromTree()
		logging_nodes = tree.findall(".//Logging")
		if logging_nodes:
			logging_dict = getDictFromTree(logging_nodes[0])
			logging_dict['Bucket'], success = getBucketFromHostname(logging_dict['Bucket'])
			if not success:
				warning("Logging to unparsable bucket name: %s" % logging_dict['Bucket'])
			self.info['Logging'] = S3UriS3("s3://%(Bucket)s/%(Prefix)s" % logging_dict)
		else:
			self.info['Logging'] = None

	def __str__(self):
		tree = ET.Element("DistributionConfig")
		tree.attrib['xmlns'] = DistributionConfig.xmlns

		## Retain the order of the following calls!
		appendXmlTextNode("Origin", self.info['Origin'], tree)
		appendXmlTextNode("CallerReference", self.info['CallerReference'], tree)
		for cname in self.info['CNAME']:
			appendXmlTextNode("CNAME", cname.lower(), tree)
		if self.info['Comment']:
			appendXmlTextNode("Comment", self.info['Comment'], tree)
		appendXmlTextNode("Enabled", str(self.info['Enabled']).lower(), tree)
		# don't create a empty DefaultRootObject element as it would result in a MalformedXML error
		if str(self.info['DefaultRootObject']):
			appendXmlTextNode("DefaultRootObject", str(self.info['DefaultRootObject']), tree)
		if self.info['Logging']:
			logging_el = ET.Element("Logging")
			appendXmlTextNode("Bucket", getHostnameFromBucket(self.info['Logging'].bucket()), logging_el)
			appendXmlTextNode("Prefix", self.info['Logging'].object(), logging_el)
			tree.append(logging_el)
		return ET.tostring(tree)

class CloudFront(object):
	operations = {
		"CreateDist" : { 'method' : "POST", 'resource' : "" },
		"DeleteDist" : { 'method' : "DELETE", 'resource' : "/%(dist_id)s" },
		"GetList" : { 'method' : "GET", 'resource' : "" },
		"GetDistInfo" : { 'method' : "GET", 'resource' : "/%(dist_id)s" },
		"GetDistConfig" : { 'method' : "GET", 'resource' : "/%(dist_id)s/config" },
		"SetDistConfig" : { 'method' : "PUT", 'resource' : "/%(dist_id)s/config" },
	}

	## Maximum attempts of re-issuing failed requests
	_max_retries = 5

	def __init__(self, config):
		self.config = config

	## --------------------------------------------------
	## Methods implementing CloudFront API
	## --------------------------------------------------

	def GetList(self):
		response = self.send_request("GetList")
		response['dist_list'] = DistributionList(response['data'])
		if response['dist_list'].info['IsTruncated']:
			raise NotImplementedError("List is truncated. Ask s3cmd author to add support.")
		## TODO: handle Truncated 
		return response
	
	def CreateDistribution(self, uri, cnames_add = [], comment = None, logging = None, default_root_object = None):
		dist_config = DistributionConfig()
		dist_config.info['Enabled'] = True
		dist_config.info['Origin'] = uri.host_name()
		dist_config.info['CallerReference'] = str(uri)
		dist_config.info['DefaultRootObject'] = default_root_object
		if comment == None:
			dist_config.info['Comment'] = uri.public_url()
		else:
			dist_config.info['Comment'] = comment
		for cname in cnames_add:
			if dist_config.info['CNAME'].count(cname) == 0:
				dist_config.info['CNAME'].append(cname)
		if logging:
			dist_config.info['Logging'] = S3UriS3(logging)
		request_body = str(dist_config)
		debug("CreateDistribution(): request_body: %s" % request_body)
		response = self.send_request("CreateDist", body = request_body)
		response['distribution'] = Distribution(response['data'])
		return response
	
	def ModifyDistribution(self, cfuri, cnames_add = [], cnames_remove = [],
	                       comment = None, enabled = None, logging = None,
                           default_root_object = None):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		dc = response['dist_config']
		if enabled != None:
			dc.info['Enabled'] = enabled
		if comment != None:
			dc.info['Comment'] = comment
		if default_root_object != None:
			dc.info['DefaultRootObject'] = default_root_object
		for cname in cnames_add:
			if dc.info['CNAME'].count(cname) == 0:
				dc.info['CNAME'].append(cname)
		for cname in cnames_remove:
			while dc.info['CNAME'].count(cname) > 0:
				dc.info['CNAME'].remove(cname)
		if logging != None:
			if logging == False:
				dc.info['Logging'] = False
			else:
				dc.info['Logging'] = S3UriS3(logging)
		response = self.SetDistConfig(cfuri, dc, response['headers']['etag'])
		return response
		
	def DeleteDistribution(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		# Get current dist status (enabled/disabled) and Etag
		info("Checking current status of %s" % cfuri)
		response = self.GetDistConfig(cfuri)
		if response['dist_config'].info['Enabled']:
			info("Distribution is ENABLED. Disabling first.")
			response['dist_config'].info['Enabled'] = False
			response = self.SetDistConfig(cfuri, response['dist_config'], 
			                              response['headers']['etag'])
			warning("Waiting for Distribution to become disabled.")
			warning("This may take several minutes, please wait.")
			while True:
				response = self.GetDistInfo(cfuri)
				d = response['distribution']
				if d.info['Status'] == "Deployed" and d.info['Enabled'] == False:
					info("Distribution is now disabled")
					break
				warning("Still waiting...")
				time.sleep(10)
		headers = {}
		headers['if-match'] = response['headers']['etag']
		response = self.send_request("DeleteDist", dist_id = cfuri.dist_id(),
		                             headers = headers)
		return response
	
	def GetDistInfo(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistInfo", dist_id = cfuri.dist_id())
		response['distribution'] = Distribution(response['data'])
		return response

	def GetDistConfig(self, cfuri):
		if cfuri.type != "cf":
			raise ValueError("Expected CFUri instead of: %s" % cfuri)
		response = self.send_request("GetDistConfig", dist_id = cfuri.dist_id())
		response['dist_config'] = DistributionConfig(response['data'])
		return response
	
	def SetDistConfig(self, cfuri, dist_config, etag = None):
		if etag == None:
			debug("SetDistConfig(): Etag not set. Fetching it first.")
			etag = self.GetDistConfig(cfuri)['headers']['etag']
		debug("SetDistConfig(): Etag = %s" % etag)
		request_body = str(dist_config)
		debug("SetDistConfig(): request_body: %s" % request_body)
		headers = {}
		headers['if-match'] = etag
		response = self.send_request("SetDistConfig", dist_id = cfuri.dist_id(),
		                             body = request_body, headers = headers)
		return response

	## --------------------------------------------------
	## Low-level methods for handling CloudFront requests
	## --------------------------------------------------

	def send_request(self, op_name, dist_id = None, body = None, headers = {}, retries = _max_retries):
		operation = self.operations[op_name]
		if body:
			headers['content-type'] = 'text/plain'
		request = self.create_request(operation, dist_id, headers)
		conn = self.get_connection()
		debug("send_request(): %s %s" % (request['method'], request['resource']))
		conn.request(request['method'], request['resource'], body, request['headers'])
		http_response = conn.getresponse()
		response = {}
		response["status"] = http_response.status
		response["reason"] = http_response.reason
		response["headers"] = dict(http_response.getheaders())
		response["data"] =  http_response.read()
		conn.close()

		debug("CloudFront: response: %r" % response)

		if response["status"] >= 500:
			e = CloudFrontError(response)
			if retries:
				warning(u"Retrying failed request: %s" % op_name)
				warning(unicode(e))
				warning("Waiting %d sec..." % self._fail_wait(retries))
				time.sleep(self._fail_wait(retries))
				return self.send_request(op_name, dist_id, body, retries - 1)
			else:
				raise e

		if response["status"] < 200 or response["status"] > 299:
			raise CloudFrontError(response)

		return response

	def create_request(self, operation, dist_id = None, headers = None):
		resource = self.config.cloudfront_resource + (
		           operation['resource'] % { 'dist_id' : dist_id })

		if not headers:
			headers = {}

		if headers.has_key("date"):
			if not headers.has_key("x-amz-date"):
				headers["x-amz-date"] = headers["date"]
			del(headers["date"])
		
		if not headers.has_key("x-amz-date"):
			headers["x-amz-date"] = time.strftime("%a, %d %b %Y %H:%M:%S +0000", time.gmtime())

		signature = self.sign_request(headers)
		headers["Authorization"] = "AWS "+self.config.access_key+":"+signature

		request = {}
		request['resource'] = resource
		request['headers'] = headers
		request['method'] = operation['method']

		return request

	def sign_request(self, headers):
		string_to_sign = headers['x-amz-date']
		signature = sign_string(string_to_sign)
		debug(u"CloudFront.sign_request('%s') = %s" % (string_to_sign, signature))
		return signature

	def get_connection(self):
		if self.config.proxy_host != "":
			raise ParameterError("CloudFront commands don't work from behind a HTTP proxy")
		return httplib.HTTPSConnection(self.config.cloudfront_host)

	def _fail_wait(self, retries):
		# Wait a few seconds. The more it fails the more we wait.
		return (self._max_retries - retries + 1) * 3

class Cmd(object):
	"""
	Class that implements CloudFront commands
	"""
	
	class Options(object):
		cf_cnames_add = []
		cf_cnames_remove = []
		cf_comment = None
		cf_enable = None
		cf_logging = None
		cf_default_root_object = None

		def option_list(self):
			return [opt for opt in dir(self) if opt.startswith("cf_")]

		def update_option(self, option, value):
			setattr(Cmd.options, option, value)

	options = Options()
	dist_list = None

	@staticmethod
	def _get_dist_name_for_bucket(uri):
		cf = CloudFront(Config())
		debug("_get_dist_name_for_bucket(%r)" % uri)
		assert(uri.type == "s3")
		if Cmd.dist_list is None:
			response = cf.GetList()
			Cmd.dist_list = {}
			for d in response['dist_list'].dist_summs:
				Cmd.dist_list[getBucketFromHostname(d.info['Origin'])[0]] = d.uri()
			debug("dist_list: %s" % Cmd.dist_list)
		return Cmd.dist_list[uri.bucket()]

	@staticmethod
	def _parse_args(args):
		cfuris = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type == 's3':
				try:
					uri = Cmd._get_dist_name_for_bucket(uri)
				except Exception, e:
					debug(e)
					raise ParameterError("Unable to translate S3 URI to CloudFront distribution name: %s" % uri)
			if uri.type != 'cf':
				raise ParameterError("CloudFront URI required instead of: %s" % arg)
			cfuris.append(uri)
		return cfuris

	@staticmethod
	def info(args):
		cf = CloudFront(Config())
		if not args:
			response = cf.GetList()
			for d in response['dist_list'].dist_summs:
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(d.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("Enabled", d.info['Enabled'])
				output("")
		else:
			cfuris = Cmd._parse_args(args)
			for cfuri in cfuris:
				response = cf.GetDistInfo(cfuri)
				d = re
sponse['distribution']
				dc = d.info['DistributionConfig']
				pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
				pretty_output("DistId", d.uri())
				pretty_output("DomainName", d.info['DomainName'])
				pretty_output("Status", d.info['Status'])
				pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
				pretty_output("Comment", dc.info['Comment'])
				pretty_output("Enabled", dc.info['Enabled'])
				pretty_output("DfltRootObject", dc.info['DefaultRootObject'])
				pretty_output("Logging", dc.info['Logging'] or "Disabled")
				pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def create(args):
		cf = CloudFront(Config())
		buckets = []
		for arg in args:
			uri = S3Uri(arg)
			if uri.type != "s3":
				raise ParameterError("Bucket can only be created from a s3:// URI instead of: %s" % arg)
			if uri.object():
				raise ParameterError("Use s3:// URI with a bucket name only instead of: %s" % arg)
			if not uri.is_dns_compatible():
				raise ParameterError("CloudFront can only handle lowercase-named buckets.")
			buckets.append(uri)
		if not buckets:
			raise ParameterError("No valid bucket names found")
		for uri in buckets:
			info("Creating distribution from: %s" % uri)
			response = cf.CreateDistribution(uri, cnames_add = Cmd.options.cf_cnames_add, 
			                                 comment = Cmd.options.cf_comment,
			                                 logging = Cmd.options.cf_logging,
                                             default_root_object = Cmd.options.cf_default_root_object)
			d = response['distribution']
			dc = d.info['DistributionConfig']
			output("Distribution created:")
			pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
			pretty_output("DistId", d.uri())
			pretty_output("DomainName", d.info['DomainName'])
			pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
			pretty_output("Comment", dc.info['Comment'])
			pretty_output("Status", d.info['Status'])
			pretty_output("Enabled", dc.info['Enabled'])
			pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
			pretty_output("Etag", response['headers']['etag'])

	@staticmethod
	def delete(args):
		cf = CloudFront(Config())
		cfuris = Cmd._parse_args(args)
		for cfuri in cfuris:
			response = cf.DeleteDistribution(cfuri)
			if response['status'] >= 400:
				error("Distribution %s could not be deleted: %s" % (cfuri, response['reason']))
			output("Distribution %s deleted" % cfuri)

	@staticmethod
	def modify(args):
		cf = CloudFront(Config())
		if len(args) > 1:
			raise ParameterError("Too many parameters. Modify one Distribution at a time.")
		try:
			cfuri = Cmd._parse_args(args)[0]
		except IndexError, e:
			raise ParameterError("No valid Distribution URI found.")
		response = cf.ModifyDistribution(cfuri,
		                                 cnames_add = Cmd.options.cf_cnames_add,
		                                 cnames_remove = Cmd.options.cf_cnames_remove,
		                                 comment = Cmd.options.cf_comment,
		                                 enabled = Cmd.options.cf_enable,
		                                 logging = Cmd.options.cf_logging,
                                         default_root_object = Cmd.options.cf_default_root_object)
		if response['status'] >= 400:
			error("Distribution %s could not be modified: %s" % (cfuri, response['reason']))
		output("Distribution modified: %s" % cfuri)
		response = cf.GetDistInfo(cfuri)
		d = response['distribution']
		dc = d.info['DistributionConfig']
		pretty_output("Origin", S3UriS3.httpurl_to_s3uri(dc.info['Origin']))
		pretty_output("DistId", d.uri())
		pretty_output("DomainName", d.info['DomainName'])
		pretty_output("Status", d.info['Status'])
		pretty_output("CNAMEs", ", ".join(dc.info['CNAME']))
		pretty_output("Comment", dc.info['Comment'])
		pretty_output("Enabled", dc.info['Enabled'])
		pretty_output("DefaultRootObject", dc.info['DefaultRootObject'])
		pretty_output("Etag", response['headers']['etag'])
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001028e9920
   @input=#<StringIO:0x000001028ef4b0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001028e98a8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/CloudFront.py",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/CloudFront.py",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/CloudFront.py?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:ss0S3V/zF7hnvaPCKryY+jPZ3gc=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014",
 "CONTENT_LENGTH"=>"19915",
 "CONTENT_TYPE"=>"text/x-python",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001028eec90>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:ss0S3V/zF7hnvaPCKryY+jPZ3gc="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/CloudFront.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"DE6B9FA87142566465545BF4D8347652",
 "smoke.request_token"=>"z4lmafi9JPLB6pVyxXfYD8nYwXyE29RoFg6OzIDYQxKlnGs3"}
StringToSign: PUT

text/x-python

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014
/mocky/path/to/my/S3-copy/S3/CloudFront.py
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: DE6B9FA87142566465545BF4D8347652
x-amz-id-2: z4lmafi9JPLB6pVyxXfYD8nYwXyE29RoFg6OzIDYQxKlnGs3
ETag: 8ca4670a301344a5075ca0e3430bb1d7

PUT /path/to/my/S3-copy/S3/Config.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:QhR486BWo1ZCAxNxOX5L/KdoKMQ=
content-length: 7790
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027

—Ú
ÌsÒMc           @   sú   d  d k  Z  d  d k  l Z l Z l Z l Z d  d k Z d  d k Z d  d k l Z d e f d Ñ  É  YZ	 d e f d Ñ  É  YZ
 d e f d	 Ñ  É  YZ d S(
   iˇˇˇˇN(   t   debugt   infot   warningt   error(   t
   SortedDictt   Configc           B   s≥  e  Z d" Z g  Z h  Z d  Z d  Z d Z d Z	 d Z
 d Z d Z e i Z e Z e i Z d Z d Z e Z e Z e d e É Z e Z d" Z e Z e Z e Z  d" Z! g  Z" g  Z# d  Z$ d Z% e Z& e Z' e Z( d	 d
 d d d d d d g Z) e Z* d e d <d  Z+ d  Z, d Z- d Z. e Z/ d Z0 d Z1 e Z2 d d g Z3 g  Z4 g  Z5 h  Z6 h  Z7 d Z8 d Z9 d  Z: e Z; e Z< d Z= d" d Ñ Z> d" d Ñ Z? d Ñ  Z@ d Ñ  ZA d  Ñ  ZB d! Ñ  ZC RS(#   t    s   s3.amazonaws.coms   %(bucket)s.s3.amazonaws.coms   sdb.amazonaws.coms   cloudfront.amazonaws.coms   /2010-07-15/distributioni   t   ignore_casei8  t   unamet   uidt   gnamet   gidt   atimet   mtimet   ctimet   modes@   [sync] Remove remote S3 objects when local file has been deletedt   delete_removeds}   %(gpg_command)s -c --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)ss}   %(gpg_command)s -d --verbose --no-use-agent --batch --yes --passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)st   USs   binary/octet-streamt   sizet   md5s   utf-8t   normali,  c         C   s-   |  i  d  j o t i |  É |  _  n |  i  S(   N(   t	   _instancet   Nonet   objectt   __new__(   t   selft
   configfile(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Q   s    c         C   s   | o |  i  | É n d  S(   N(   t   read_config_file(   R   R   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __init__V   s    c         C   sÇ   g  } xu t  |  É D]g } t t t | É É } | i d É p( | t d É t d É t t É f j o q n | i | É q W| S(   Nt   _t   stringi*   (   t   dirt   typet   getattrR   t
   startswitht   Truet   append(   R   t   retvalt   optiont   option_type(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   option_listZ   s     		c         C   sP   t  | É } x- |  i É  D] } |  i | | i | É É q W|  i i | É d  S(   N(   t   ConfigParserR(   t   update_optiont   gett   _parsed_filesR$   (   R   R   t   cpR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   h   s
     c         C   s   t  | É i d |  É d  S(   Nt   default(   t   ConfigDumpert   dump(   R   t   stream(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   dump_confign   s    c         C   sv  | d  j o d  S| d j oC y t t d t i | É Wqrt j
 o t d | É qrXnt t t | É É t t	 É j or t
 | É i É  d j o t t | t	 É qrt
 | É i É  d j o t t | t É qrt d | | f É n} t t t | É É t d É j oJ y t t | t | É É Wqrt j
 o } t d | | f É qrXn t t | | É d  S(   Nt	   verbositys)   Config: verbosity level '%s' is not validt   truet   yest   ont   1t   falset   not   offt   0s8   Config: value of option '%s' must be Yes or No, not '%s'i*   s9   Config: value of option '%s' must be an integer, not '%s'(   s   trueR5   R6   R7   (   s   falses   noR:   R;   (   R   t   setattrR   t   loggingt   _levelNamest   KeyErrorR   R    R!   R#   t   strt   lowert   Falset   intt
   ValueError(   R   R&   t   valuet   e(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR*   q   s&    ""N(D   t   __name__t
   __module__R   R   R,   t   _doct
   access_keyt
   secret_keyt	   host_baset   host_buckett   simpledb_hostt   cloudfront_hostt   cloudfront_resourceR=   t   WARNINGR3   R#   t   progress_metert   Progresst
   ProgressCRt   progress_classt
   send_chunkt
   recv_chunkRB   t   list_md5t   human_readable_sizesR   t   extra_headerst   forcet   enablet   get_continuet   skip_existingt	   recursivet
   acl_publict
   acl_grantst   acl_revokest
   proxy_hostt
   proxy_portt   encryptt   dry_runt   preserve_attrst   preserve_attrs_listR   t   gpg_passphraset   gpg_commandt   gpg_encryptt   gpg_decryptt	   use_httpst   bucket_locationt   default_mime_typet   guess_mime_typet   sync_checkst   excludet   includet   debug_excludet   debug_includet   encodingt   urlencoding_modet   log_target_prefixt   reduced_redundancyt   follow_symlinkst   socket_timeoutR   R   R(   R   R2   R*   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR      sÑ   			
			R)   c           B   s>   e  Z g  d  Ñ Z g  d Ñ Z d Ñ  Z d Ñ  Z d d Ñ Z RS(   c         C   s   h  |  _  |  i | | É d  S(   N(   t   cfgt
   parse_file(   R   t   filet   sections(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   å   s    	c         C   s  t  d | É t | É t g  É j o | g } n t } t | d É } t i d É } t i d É } t i d É } t i d É } t i d É }	 xq| D]i}
 | i |
 É p | i |
 É o qõ n | i |
 É } | o6 | i É  d } | | j p t | É d j } qõ n | i |
 É } | o∆ | oø | i	 É  } |	 i | d	 É o | d	 d
 d !| d	 <n |  i
 | d | d	 É | d d j o4 | d	 d  d | d	 d t | d	 É d } n | d	 } t  d | d | f É qõ n t d | |
 f É qõ Wd  S(   Ns   ConfigParser: Reading file '%s't   rs   ^\s*#.*s   ^\s*$s   ^\[([^\]]+)\]s$   ^\s*(?P<key>\w+)\s*=\s*(?P<value>.*)s   ^"(.*)"\s*$i    RE   i   iˇˇˇˇt   keyRJ   RK   Ri   i   s   ...%d_chars...i   s   ConfigParser: %s->%ss!   Ignoring invalid line in '%s': %s(   s
   access_keys
   secret_keys   gpg_passphrase(   R    R    R#   t   opent   ret   compilet   matcht   groupst   lent	   groupdictt   __setitem__R   (   R   R~   R   t   in_our_sectiont   ft	   r_commentt   r_emptyt	   r_sectiont   r_datat   r_quotest   linet
   is_sectiont   sectiont   is_datat   datat   print_value(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR}   ê   s>      4
c         C   s   |  i  | S(   N(   R|   (   R   t   name(    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   __getitem__±   s    c         C   s   | |  i  | <d  S(   N(   R|   (   R   Ró   RE   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyRâ   ¥   s    c         C   s#   |  i  i | É o |  i  | S| S(   N(   R|   t   has_key(   R   Ró   R.   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR+   ∑   s    N(   RG   RH   R   R}   Rò   Râ   R   R+   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR)   ã   s
   !		R/   c           B   s   e  Z d  Ñ  Z d Ñ  Z RS(   c         C   s   | |  _  d  S(   N(   R1   (   R   R1   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR   Ω   s    c         C   sR   |  i  i d | É x7 | i É  D]) } |  i  i d | t | | É f É q! Wd  S(   Ns   [%s]
s   %s = %s
(   R1   t   writeR(   R!   (   R   Rì   t   configR&   (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR0   ¿   s     (   RG   RH   R   R0   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyR/   º   s   	(   R=   R    R   R   R   RÉ   RS   R   R   R   R)   R/   (    (    (    s)   /Users/rlyon/src/s3cmd-1.0.1/S3/Config.pyt   <module>   s   "1
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001013b8ee8
   @input=#<StringIO:0x000001013bdce0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001013b8e70
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/Config.pyc",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/Config.pyc",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/Config.pyc?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:QhR486BWo1ZCAxNxOX5L/KdoKMQ=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027",
 "CONTENT_LENGTH"=>"7790",
 "CONTENT_TYPE"=>"application/x-python-code",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001013bd560>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:QhR486BWo1ZCAxNxOX5L/KdoKMQ="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/Config.pyc",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"08B5A956CC4F0A22AE109977CDFB926C",
 "smoke.request_token"=>"CTEd4ZW3l6M3ravLyHDf3wudndLXo6zVAypsnlhaF8dBPhnh"}
StringToSign: PUT

application/x-python-code

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027
/mocky/path/to/my/S3-copy/S3/Config.pyc
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 08B5A956CC4F0A22AE109977CDFB926C
x-amz-id-2: CTEd4ZW3l6M3ravLyHDf3wudndLXo6zVAypsnlhaF8dBPhnh
ETag: f93c915747f27f2933a18bcc20d80624

PUT /path/to/my/S3-copy/S3/PkgInfo.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:+9COiBjPuJhhJrHLqXWicZ97M4U=
content-length: 445
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322429740/ctime:1321220014

package = "s3cmd"
version = "1.0.1"
url = "http://s3tools.org"
license = "GPL version 2"
short_description = "Command line tool for managing Amazon S3 and CloudFront services"
long_description = """
S3cmd lets you copy files from/to Amazon S3 
(Simple Storage Service) using a simple to use
command line client. Supports rsync-like backup,
GPG encryption, and more. Also supports management
of Amazon's CloudFront content delivery network.
"""

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100f278c0
   @input=#<StringIO:0x00000100f86eb0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100f27848
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/PkgInfo.py",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/PkgInfo.py",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/PkgInfo.py?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:+9COiBjPuJhhJrHLqXWicZ97M4U=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322429740/ctime:1321220014",
 "CONTENT_LENGTH"=>"445",
 "CONTENT_TYPE"=>"text/x-python",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100f86640>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:+9COiBjPuJhhJrHLqXWicZ97M4U="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322429740/ctime:1321220014"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/PkgInfo.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"FFE2D134689E051FC495EF6E0059B7D1",
 "smoke.request_token"=>"JwzDP5C9j9ORyBI8JlBL7OsJ5C8NtHjNkGTiIfizyiOZhgQw"}
StringToSign: PUT

text/x-python

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307670197/atime:1322429740/ctime:1321220014
/mocky/path/to/my/S3-copy/S3/PkgInfo.py
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: FFE2D134689E051FC495EF6E0059B7D1
x-amz-id-2: JwzDP5C9j9ORyBI8JlBL7OsJ5C8NtHjNkGTiIfizyiOZhgQw
ETag: d3af86656acfd8147cb10b0dafc3d9dc

PUT /path/to/my/S3-copy/S3/Progress.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:r9FkUZUBwIhdl58BZtJz0KIsbzA=
content-length: 5526
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027

—Ú
ÌsÒMc           @   sj   d  d k  Z  d  d k Z d  d k Z d e f d Ñ  É  YZ d e f d Ñ  É  YZ d e f d Ñ  É  YZ d S(   iˇˇˇˇNt   Progressc           B   sS   e  Z e i Z d  Ñ  Z d Ñ  Z d d d Ñ Z d Ñ  Z d Ñ  Z	 e
 d d Ñ Z RS(   c         C   s    t  i |  _ |  i | | É d  S(   N(   t   syst   stdoutt   _stdoutt   new_file(   t   selft   labelst
   total_size(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   __init__   s    c         C   se   | |  _  | |  _ d |  _ |  i |  _ t i i É  |  _ |  i |  _ |  i |  _ |  i	 d t
 É d  S(   Ni    R   (   R   R   t   initial_positiont   current_positiont   datetimet   nowt
   time_startt	   time_lastt   time_currentt   displayt   True(   R   R   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s    			iˇˇˇˇc         C   sf   |  i  |  _ t i i É  |  _  | d j o | |  _ n! | d j o |  i | 7_ n |  i É  d  S(   Niˇˇˇˇ(   R   R   R   R   R
   R   (   R   R
   t   delta_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   update!   s    c         C   s   |  i  d | É d  S(   Nt   done_message(   R   (   R   t   message(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   done,   s    c         C   s(   |  i  i d |  i É |  i  i É  d  S(   Nu)   %(source)s -> %(destination)s  %(extra)s
(   R   t   writeR   t   flush(   R   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   output_labels/   s    c         C   sp  | o |  i  É  d |  _ d S|  i |  i j o◊ t i |  i t É } | d d j o | d c d 7<n |  i |  i } | i	 d | i
 t | i É d } t i |  i |  i | t t É } |  i i d | d | d | | d | d f É |  i i É  d St i d	 |  i } | |  i j o? t | É d
 d
 |  _ |  i i d |  i É |  i i É  d Sd S(   sn   
		display(new_file = False[/True], done = False[/True])

		Override this method to provide a nicer output.
		i    Ni   t    t   BiÄQ g    ÄÑ.As"   100%%  %s%s in %.2fs (%.2f %sB/s)
id   i   s   %d%% (   R   t   last_milestoneR
   R   t   Utilst
   formatSizeR   R   R   t   dayst   secondst   floatt   microsecondsR	   R   R   R   t   selfselft   int(   R   R   R   t
   print_sizet	   timedeltat   sec_elapsedt   print_speedt   rel_position(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   3   s*    
	 %#'N(   t   __name__t
   __module__R   R   R   R   R   R   R   R   t   Falset   NoneR   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR    
   s   					t   ProgressANSIc           B   sc   e  Z d  Z e d Z e d Z e d Z e d Z e d Z e d Z e d Z	 e
 d	 d Ñ Z RS(
   s   [s   ?25ls   ?25ht   st   us   %uGt   0Kt   2Kc         C   sÑ  | o/ |  i  É  |  i i |  i É |  i i É  d S|  i |  i } | i d | i t	 | i
 É d } | d j o' t i |  i |  i | t t É } n d } |  i i |  i É |  i i |  i É |  i i d h t |  i É i t t |  i É É É d 6|  i d 6|  i o |  i d	 |  i p d d
 6| d 6| d d 6| d d 6É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   sY   %(current)s of %(total)s   %(percent)3d%% in %(elapsed)ds  %(speed).2f %(speed_coeff)sB/st   currentt   totalid   t   percentt   elapsedt   speedi   t   speed_coeffs     %s
(   i    R   (   R   R   R   t   ANSI_save_cursor_posR   R   R   R   R    R!   R"   R   R   R
   R	   R   t   ANSI_restore_cursor_post   ANSI_erase_to_eolt   strt   rjustt   lenR   (   R   R   R   R&   R'   R(   (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR   [   s,    
%'(
&N(   R*   R+   t   SCIt   ANSI_hide_cursort   ANSI_show_cursorR9   R:   t   ANSI_move_cursor_to_columnR;   t   ANSI_erase_current_lineR,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR.   P   s   






t
   ProgressCRc           B   s#   e  Z e d  É Z e d d Ñ Z RS(   i   c         C   sW  | o |  i  É  d S|  i |  i } | i d | i t | i É d } | d j o' t i |  i	 |  i
 | t t É } n d } |  i i |  i É d h t |  i	 É i t t |  i É É É d 6|  i d 6|  i o |  i	 d	 |  i p d d
 6| d 6| d d 6| d d 6} |  i i | É | o |  i i d | É n |  i i É  d S(   s;   
		display(new_file = False[/True], done_message = None)
		NiÄQ g    ÄÑ.Ai    R   s\    %(current)s of %(total)s   %(percent)3d%% in %(elapsed)4ds  %(speed)7.2f %(speed_coeff)sB/sR3   R4   id   R5   R6   R7   i   R8   s     %s
(   i    R   (   R   R   R   R   R    R!   R"   R   R   R
   R	   R   R   R   t   CR_charR<   R=   R>   R   R   (   R   R   R   R&   R'   R(   t   output(    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyR      s(    
%'(
&N(   R*   R+   t   chrRE   R,   R-   R   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyRD   {   s   (   R   R   R   t   objectR    R.   RD   (    (    (    s+   /Users/rlyon/src/s3cmd-1.0.1/S3/Progress.pyt   <module>   s
   F+
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100c2c738
   @input=#<StringIO:0x00000100c42bf0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100c2c350
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/Progress.pyc",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/Progress.pyc",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/Progress.pyc?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:r9FkUZUBwIhdl58BZtJz0KIsbzA=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027",
 "CONTENT_LENGTH"=>"5526",
 "CONTENT_TYPE"=>"application/x-python-code",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100c41890>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:r9FkUZUBwIhdl58BZtJz0KIsbzA="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/Progress.pyc",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"66DDE7C6446F951D307A9487BEA4B1A8",
 "smoke.request_token"=>"hDuYvMRFKF1Twv5qBXV0OzmHrAnklm7I4p1L9ibR2bgbvSZ2"}
StringToSign: PUT

application/x-python-code

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027
/mocky/path/to/my/S3-copy/S3/Progress.pyc
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 66DDE7C6446F951D307A9487BEA4B1A8
x-amz-id-2: hDuYvMRFKF1Twv5qBXV0OzmHrAnklm7I4p1L9ibR2bgbvSZ2
ETag: e9d7eb6d87e256e94de8c4e7d7c1a02a

PUT /path/to/my/S3-copy/S3/S3Uri.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:5q5LcFo6HXsgJNL0+rkGcMSm6CA=
content-length: 5347
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321386876

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

import os
import re
import sys
from BidirMap import BidirMap
from logging import debug
import S3
from Utils import unicodise, check_bucket_name_dns_conformity

class S3Uri(object):
	type = None
	_subclasses = None

	def __new__(self, string):
		if not self._subclasses:
			## Generate a list of all subclasses of S3Uri
			self._subclasses = []
			dict = sys.modules[__name__].__dict__
			for something in dict:
				if type(dict[something]) is not type(self):
					continue
				if issubclass(dict[something], self) and dict[something] != self:
					self._subclasses.append(dict[something])
		for subclass in self._subclasses:
			try:
				instance = object.__new__(subclass)
				instance.__init__(string)
				return instance
			except ValueError, e:
				continue
		raise ValueError("%s: not a recognized URI" % string)
	
	def __str__(self):
		return self.uri()

	def __unicode__(self):
		return self.uri()

	def public_url(self):
		raise ValueError("This S3 URI does not have Anonymous URL representation")

	def basename(self):
		return self.__unicode__().split("/")[-1]

class S3UriS3(S3Uri):
	type = "s3"
	_re = re.compile("^s3://([^/]+)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3 URI" % string)
		groups = match.groups()
		self._bucket = groups[0]
		self._object = unicodise(groups[1])

	def bucket(self):
		return self._bucket

	def object(self):
		return self._object
	
	def has_bucket(self):
		return bool(self._bucket)

	def has_object(self):
		return bool(self._object)

	def uri(self):
		return "/".join(["s3:/", self._bucket, self._object])
	
	def is_dns_compatible(self):
		return check_bucket_name_dns_conformity(self._bucket)

	def public_url(self):
		if self.is_dns_compatible():
			return "http://%s.s3.amazonaws.com/%s" % (self._bucket, self._object)
		else:
			return "http://s3.amazonaws.com/%s/%s" % (self._bucket, self._object)

	def host_name(self):
		if self.is_dns_compatible():
			return "%s.s3.amazonaws.com" % (self._bucket)
		else:
			return "s3.amazonaws.com"

	@staticmethod
	def compose_uri(bucket, object = ""):
		return "s3://%s/%s" % (bucket, object)

	@staticmethod
	def httpurl_to_s3uri(http_url):
		m=re.match("(https?://)?([^/]+)/?(.*)", http_url, re.IGNORECASE)
		hostname, object = m.groups()[1:]
		hostname = hostname.lower()
		if hostname == "s3.amazonaws.com":
			## old-style url: http://s3.amazonaws.com/bucket/object
			if object.count("/") == 0:
				## no object given
				bucket = object
				object = ""
			else:
				## bucket/object
				bucket, object = object.split("/", 1)
		elif hostname.endswith(".s3.amazonaws.com"):
			## new-style url: http://bucket.s3.amazonaws.com/object
			bucket = hostname[:-(len(".s3.amazonaws.com"))]
		else:
			raise ValueError("Unable to parse URL: %s" % http_url)
		return S3Uri("s3://%(bucket)s/%(object)s" % { 
			'bucket' : bucket,
			'object' : object })

class S3UriS3FS(S3Uri):
	type = "s3fs"
	_re = re.compile("^s3fs://([^/]*)/?(.*)", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a S3fs URI" % string)
		groups = match.groups()
		self._fsname = groups[0]
		self._path = unicodise(groups[1]).split("/")

	def fsname(self):
		return self._fsname

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["s3fs:/", self._fsname, self.path()])

class S3UriFile(S3Uri):
	type = "file"
	_re = re.compile("^(\w+://)?(.*)")
	def __init__(self, string):
		match = self._re.match(string)
		groups = match.groups()
		if groups[0] not in (None, "file://"):
			raise ValueError("%s: not a file:// URI" % string)
		self._path = unicodise(groups[1]).split("/")

	def path(self):
		return "/".join(self._path)

	def uri(self):
		return "/".join(["file:/", self.path()])

	def isdir(self):
		return os.path.isdir(self.path())

	def dirname(self):
		return os.path.dirname(self.path())

class S3UriCloudFront(S3Uri):
	type = "cf"
	_re = re.compile("^cf://([^/]*)/?", re.IGNORECASE)
	def __init__(self, string):
		match = self._re.match(string)
		if not match:
			raise ValueError("%s: not a CloudFront URI" % string)
		groups = match.groups()
		self._dist_id = groups[0]

	def dist_id(self):
		return self._dist_id

	def uri(self):
		return "/".join(["cf:/", self.dist_id()])

if __name__ == "__main__":
	uri = S3Uri("s3://bucket/object")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print "object  =", uri.object()
	print

	uri = S3Uri("s3://bucket")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "bucket  =", uri.bucket()
	print

	uri = S3Uri("s3fs://filesystem1/path/to/remote/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("/path/to/local/file.txt")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "path    =", uri.path()
	print

	uri = S3Uri("cf://1234567890ABCD/")
	print "type()  =", type(uri)
	print "uri     =", uri
	print "uri.type=", uri.type
	print "dist_id =", uri.dist_id()
	print

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x0000010299b0f8
   @input=#<StringIO:0x00000101386f38>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x0000010299b080
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/S3Uri.py",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/S3Uri.py",
 "REQUEST_URI"=>"http://mocky.localhost/mocky/path/to/my/S3-copy/S3/S3Uri.py?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:5q5LcFo6HXsgJNL0+rkGcMSm6CA=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321386876",
 "CONTENT_LENGTH"=>"5347",
 "CONTENT_TYPE"=>"text/x-python",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001013867b8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:5q5LcFo6HXsgJNL0+rkGcMSm6CA="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321386876"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/S3Uri.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"0255D83377AE101329BD264BC8C64AF2",
 "smoke.request_token"=>"8OfBhbYwWElO9QfisvDyWDya23lQPARxufNiQlRVLAtiRJCt"}
StringToSign: PUT

text/x-python

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321386876
/mocky/path/to/my/S3-copy/S3/S3Uri.py
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 0255D83377AE101329BD264BC8C64AF2
x-amz-id-2: 8OfBhbYwWElO9QfisvDyWDya23lQPARxufNiQlRVLAtiRJCt
ETag: 7bfe82b2950b542ef985ee611fa2b310

PUT /path/to/my/S3-copy/S3/SortedDict.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:/PIULrddZiGtd8KhewAUxgBfMvU=
content-length: 1640
content-type: text/x-python
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014

## Amazon S3 manager
## Author: Michal Ludvig <michal@logix.cz>
##         http://www.logix.cz/michal
## License: GPL Version 2

from BidirMap import BidirMap

class SortedDictIterator(object):
	def __init__(self, sorted_dict, keys):
		self.sorted_dict = sorted_dict
		self.keys = keys

	def next(self):
		try:
			return self.keys.pop(0)
		except IndexError:
			raise StopIteration

class SortedDict(dict):
	def __init__(self, mapping = {}, ignore_case = True, **kwargs):
		"""
		WARNING: SortedDict() with ignore_case==True will
		         drop entries differing only in capitalisation!
				 Eg: SortedDict({'auckland':1, 'Auckland':2}).keys() => ['Auckland']
				 With ignore_case==False it's all right
		"""
		dict.__init__(self, mapping, **kwargs)
		self.ignore_case = ignore_case

	def keys(self):
		keys = dict.keys(self)
		if self.ignore_case:
			# Translation map
			xlat_map = BidirMap()
			for key in keys:
				xlat_map[key.lower()] = key
			# Lowercase keys
			lc_keys = xlat_map.keys()
			lc_keys.sort()
			return [xlat_map[k] for k in lc_keys]
		else:
			keys.sort()
			return keys

	def __iter__(self):
		return SortedDictIterator(self, self.keys())

if __name__ == "__main__":
	d = { 'AWS' : 1, 'Action' : 2, 'america' : 3, 'Auckland' : 4, 'America' : 5 }
	sd = SortedDict(d)
	print "Wanted: Action, america, Auckland, AWS,    [ignore case]"
	print "Got:   ",
	for key in sd:
		print "%s," % key,
	print "   [used: __iter__()]"
	d = SortedDict(d, ignore_case = False)
	print "Wanted: AWS, Action, Auckland, america,    [case sensitive]"
	print "Got:   ",
	for key in d.keys():
		print "%s," % key,
	print "   [used: keys()]"
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001029a6278
   @input=#<StringIO:0x00000102960070>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001029a6570
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/SortedDict.py",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/SortedDict.py",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/SortedDict.py?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:/PIULrddZiGtd8KhewAUxgBfMvU=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014",
 "CONTENT_LENGTH"=>"1640",
 "CONTENT_TYPE"=>"text/x-python",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001029681f8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:/PIULrddZiGtd8KhewAUxgBfMvU="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/SortedDict.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"E3658C1A405D70154A92043C6B6204F5",
 "smoke.request_token"=>"4P4sc8Vi9ep5iRN9q3iU4R27kP8pZtpGVRXUhiHiKHcG3Z2Y"}
StringToSign: PUT

text/x-python

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1307669485/atime:1322429740/ctime:1321220014
/mocky/path/to/my/S3-copy/S3/SortedDict.py
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: E3658C1A405D70154A92043C6B6204F5
x-amz-id-2: 4P4sc8Vi9ep5iRN9q3iU4R27kP8pZtpGVRXUhiHiKHcG3Z2Y
ETag: 05a6053b5f0cb40b09872572b238a50c

PUT /path/to/my/S3-copy/S3/Utils.pyc HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:l+PZr6biO53Qr2X8f57mDuf6YTM=
content-length: 14047
content-type: application/x-python-code
x-amz-date: Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs: uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027

—Ú
¨tÒMc           @   sO  d  d k  Z  d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k Z d  d k	 Z	 d  d k
 l Z l Z l Z l Z d  d k Z d  d k Z e i d d j o4 e i d d j  o  d  d k l Z d  d k Z n d  d k l Z l Z y d  d k i i Z Wn" e j
 o d  d k i Z n Xd  d	 k l Z g  Z d
 Ñ  Z e i  d É d Ñ  Z! e i  d É d Ñ  Z" e i  d É d Ñ  Z# e i  d É d Ñ  Z$ e i  d É d Ñ  Z% e i  d É d Ñ  Z& e i  d É d Ñ  Z' e i  d É d Ñ  Z( e i  d É d Ñ  Z) e i  d É d Ñ  Z* e i  d É d  Ñ  Z+ e i  d! É d" Ñ  Z, e i  d# É e- e- d$ Ñ Z. e i  d% É d& Ñ  Z/ e i  d' É d( Ñ  Z0 e i  d) É e i1 e i2 Z3 e4 e3 É Z5 d* Ñ  Z6 e i  d+ É d, Ñ  Z7 e i  d- É d. d/ d0 Ñ Z8 e i  d1 É d2 d3 d4 Ñ Z9 e i  d5 É d6 Ñ  Z: e i  d7 É d8 Ñ  Z; e i  d9 É d d: d; Ñ Z= e i  d< É d d: d= Ñ Z> e i  d> É d d? Ñ Z? e i  d@ É dA Ñ  Z@ e i  dB É dC Ñ  ZA e i  dD É eB dE Ñ ZC e i  dF É dG Ñ  ZD e i  dH É dI Ñ  ZE e i  dJ É dK Ñ  ZF e i  dL É d S(M   iˇˇˇˇN(   t   debugt   infot   warningt   errori    i   i   i   (   t   md5(   R   t   sha1(   t
   ExpatErrorc         C   så   g  } x |  D]w } h  } x[ | i  É  D]M } | i } | i  É  o t | g É | | <q& | i d | i É | | <q& W| i | É q W| S(   Ns   .//%s(   t   getchildrent   tagt
   parseNodest   findtextt   append(   t   nodest   retvalt   nodet   retval_itemt   childt   name(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyR	   $   s      	R	   c         C   sd   t  i d t  i É } | i |  É o/ | i |  É i É  d } | i d |  É }  n d } |  | f S(   s:   
	removeNameSpace(xml) -- remove top-level AWS namespace
	s7   ^(<?[^>]+?>\s?)(<\w+) xmlns=['"](http://[^'"]+)['"](.*)i   s   \1\2\4N(   t   ret   compilet	   MULTILINEt   matcht   groupst   subt   None(   t   xmlt   rt   xmlns(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   stripNameSpace5   s    R   c         C   sv   t  |  É \ }  } y/ t i |  É } | o | | i d <n | SWn. t j
 o" } t | É t i d É Ç n Xd  S(   NR   sP   Bucket contains invalid filenames. Please run: s3cmd fixbucket s3://your-bucket/(   R   t   ETt
   fromstringt   attribR   R   t
   Exceptionst   ParameterError(   R   R   t   treet   e(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTreeFromXmlB   s    
R$   c         C   s)   t  |  É } | i d | É } t | É S(   Ns   .//%s(   R$   t   findallR	   (   R   R   R"   R   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getListFromXmlN   s    R&   c         C   s∂   h  } x© |  i  É  D]õ } | i  É  o q n | i | i É oW t | | i É t j p | | i g | | i <n | | i i | i p d É q | i p d | | i <q W| S(   Nt    (   R   t   has_keyR   t   typet   listR   t   text(   R"   t   ret_dictR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getDictFromTreeT   s     "R-   c         C   s8   t  |  É } | i i | É o | i S| i | É Sd  S(   N(   R$   R   t   endswithR+   R
   (   R   t   xpathR"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getTextFromXmlc   s    R0   c         C   s   t  |  É } | i S(   N(   R$   R   (   R   R"   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getRootTagNamek   s    R1   c         C   s"   t  i |  É } t | É | _ | S(   N(   R   t   Elementt   unicodeR+   (   t   tag_nameR+   t   el(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   xmlTextNodep   s    R6   c         C   s    t  |  | É } | i | É | S(   s†   
	Creates a new <tag_name> Node and sets
	its content to 'text'. Then appends the
	created Node to 'parent' element if given.
	Returns the newly created Node.
	(   R6   R   (   R4   R+   t   parentR5   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   appendXmlTextNodev   s    R8   c         C   s+   t  i d É i d |  É }  t i |  d É S(   Ns	   (\.\d*)?Zs   .000Zs   %Y-%m-%dT%H:%M:%S.000Z(   R   R   R   t   timet   strptime(   t   date(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toPythonÇ   s    R<   c         C   s   t  i t |  É É S(   N(   R9   t   mktimeR<   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateS3toUnixá   s    R>   c         C   s   t  i |  É S(   N(   t   rfc822t	   parsedate(   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toPythoné   s    RA   c         C   s   t  i t |  É É S(   N(   R9   R=   RA   (   R;   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   dateRFC822toUnixí   s    RB   c         C   sÜ   | o t  |  É p
 t |  É }  | oQ d d d d g } d } x+ |  d j o |  d :}  | i d É } qB W|  | f S|  d f Sd  S(	   Nt   kt   Mt   Gt   TR'   i   i   i    (   t   floatt   intt   pop(   t   sizet   human_readablet   floating_pointt   coeffst   coeff(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt
   formatSizeñ   s      
RO   c         C   s   t  i d t |  É É S(   Ns   %Y-%m-%d %H:%M(   R9   t   strftimeR<   (   t   s3timestamp(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   formatDateTime£   s    RR   c         C   s-   h  } x  |  D] } | d | | d <q W| S(   Ni   i    (    (   R*   R   t   tuple(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   convertTupleListToDictß   s
     RT   c         C   sG   d } x: |  d j o, | t  t i d t d É 7} |  d 8}  q	 W| S(   NR'   i    i   (   t
   _rnd_charst   randomt   randintt   _rnd_chars_len(   t   lenR   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   rndstr∞   s     RZ   c         C   s£   t  i d É } d } xz | d j ol |  t | É } y | | É PWn< t j
 o0 } | i t i j o t  i | É Ç  qÉ n X| d 8} q Wt  i | É | S(   Ni?   i   i    i   (   t   ost   umaskRZ   t   OSErrort   errnot   EEXIST(   t   prefixt	   randcharst
   createfunct	   old_umaskt   triest   dirnameR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpsomething∏   s     
Rf   s   /tmp/tmpdir-i
   c         C   s   t  |  | t i É S(   N(   Rf   R[   t   mkdir(   R`   Ra   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mktmpdir    s    Rh   s   /tmp/tmpfile-i   c         C   s   d Ñ  } t  |  | | É S(   Nc         S   s#   t  i t  i |  t  i t  i BÉ É S(    (   R[   t   closet   opent   O_CREATt   O_EXCL(   t   filename(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <lambda>œ   s    (   Rf   (   R`   Ra   Rb   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   mktmpfileŒ   s    	Ro   c         C   sc   t  É  } t |  d É } x4 t o, | i d É } | p Pn | i | É q W| i É  | i É  S(   Nt   rbi    i   i Ä  (   R   Rj   t   Truet   readt   updateRi   t	   hexdigest(   Rm   t   ht   ft   data(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   hash_file_md5”   s    	 
Rx   c         C   s  |  i  t i É } g  } x? | o7 t i i t i i | É É o | i | i É  É q WxØ | oß | i | i É  É t i i | É } y t d | É t i	 | É Wq] t
 t f j
 o! } t d | | i f É t St j
 o } t d | | f É t SXq] Wt S(   sÜ   
	mkdir_with_parents(dst_dir)
	
	Create directory 'dir_name' with all parent directories

	Returns True on success, False otherwise.
	s	   mkdir(%s)s   %s: can not make directory: %ss   %s: %s(   t   splitR[   t   sept   patht   isdirt   joinR   RI   R    Rg   R]   t   IOErrorR   t   strerrort   Falset	   ExceptionRq   (   t   dir_namet   pathmemberst	   tmp_stackt   cur_dirR#   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   mkdir_with_parents‡   s&     ' RÜ   t   replacec         C   sÑ   | p t  i  É  i } n t |  É t j o |  St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   s6   
	Convert 'string' to Unicode or raise an exception.
	s   Unicodising %r using %ss    Conversion to unicode failed: %rN(   t   Configt   encodingR)   R3   R    t   decodet   UnicodeDecodeError(   t   stringRâ   t   errors(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt	   unicodise˚   s    Ré   c         C   sä   | p t  i  É  i } n t |  É t j o t |  É St d |  | f É y |  i | | É SWn# t j
 o t d |  É Ç n Xd S(   sx   
	Convert unicode 'string' to <type str>, by default replacing
	all invalid characters with '?' or raise an exception.
	s   DeUnicodising %r using %ss"   Conversion from unicode failed: %rN(   Rà   Râ   R)   R3   t   strR    t   encodet   UnicodeEncodeError(   Rå   Râ   Rç   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   deunicodise  s    Rí   c         C   s"   t  t |  | É | É i d d É S(   sk   
	Convert 'string' to Unicode according to current encoding 
	and replace all invalid characters with '?'
	u   ÔøΩt   ?(   Ré   Rí   Rá   (   Rå   Râ   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   unicodise_safe  s    Rî   c         C   s    d } d } xÇ |  D]z } t  | É } | d j o, | d t t  d É | É 7} | d 7} q | d j o | d 7} | d 7} q | | 7} q W| o. t i É  i d	 j o t d
 | | f É n | S(   sÉ   
	replace_nonprintables(string)

	Replaces all non-printable characters 'ch' in 'string'
	where ord(ch) <= 26 with ^@, ^A, ... ^Z
	R'   i    i   t   ^t   @i   i   s   ^?t	   fixbuckets+   %d non-printable characters replaced in: %s(   t   ordt   chrRà   t   urlencoding_modeR   (   Rå   t
   new_stringt   modifiedt   ct   o(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   replace_nonprintables'  s     
Rü   c         C   s7   t  i t i t i É  i |  t É i É  É i É  } | S(   N(	   t   base64t   encodestringt   hmact   newRà   t
   secret_keyR   t   digestt   strip(   t   string_to_signt	   signature(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   sign_string?  s    3R©   c         C   s¿  | oD t  i d |  É } | o' t i d |  | i É  d f É Ç qã nA t  i d |  É } | o' t i d |  | i É  d f É Ç n t |  É d j  o t i d |  É Ç n t |  É d j o t i d	 |  É Ç n | o÷ t |  É d
 j o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É o t i d |  É Ç n t  i d |  É p t i d |  É Ç n t  i d |  É p t i d |  É Ç qºn t S(   Ns   ([^a-z0-9\.-])sô   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: lowercase us-ascii letters (a-z), digits (0-9), dot (.) and hyphen (-).i    s   ([^A-Za-z0-9\._-])s§   Bucket name '%s' contains disallowed character '%s'. The only supported ones are: us-ascii letters (a-z, A-Z), digits (0-9), dot (.), hyphen (-) and underscore (_).i   s0   Bucket name '%s' is too short (min 3 characters)iˇ   s1   Bucket name '%s' is too long (max 255 characters)i?   s0   Bucket name '%s' is too long (max 63 characters)s   -\.sE   Bucket name '%s' must not contain sequence '-.' for DNS compatibilitys   \.\.sE   Bucket name '%s' must not contain sequence '..' for DNS compatibilitys	   ^[0-9a-z]s4   Bucket name '%s' must start with a letter or a digits	   [0-9a-z]$s2   Bucket name '%s' must end with a letter or a digit(   R   t   searchR    R!   R   RY   Rq   (   t   buckett
   dns_strictt   invalid(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   check_bucket_nameF  s.    +'RÆ   c         C   s2   y t  |  d t ÉSWn t i j
 o t SXd  S(   NR¨   (   RÆ   Rq   R    R!   RÄ   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt    check_bucket_name_dns_conformityb  s    RØ   c         C   sR   t  i  É  i h d d 6} t i | |  É } | p |  t f S| i É  d t f S(   sø   
	bucket, success = getBucketFromHostname(hostname)

	Only works for hostnames derived from bucket names
	using Config.host_bucket pattern.

	Returns bucket name and a boolean success flag.
	s   (?P<bucket>.*)R´   i    (   Rà   t   host_bucketR   R   RÄ   R   Rq   (   t   hostnamet   patternt   m(    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getBucketFromHostnamei  s
    R¥   c         C   s   t  i  É  i h |  d 6S(   NR´   (   Rà   R∞   (   R´   (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   getHostnameFromBucket{  s    Rµ   (G   R[   t   sysR9   R   Rå   RV   R?   R¢   R†   R^   t   loggingR    R   R   R   Rà   R    t   version_infoR   t   shaR   t   hashlibt   xml.etree.ElementTreet   etreet   ElementTreeR   t   ImportErrort   elementtree.ElementTreet   xml.parsers.expatR   t   __all__R	   R   R   R$   R&   R-   R0   R1   R6   R8   R<   R>   RA   RB   RÄ   RO   RR   RT   t   ascii_letterst   digitsRU   RY   RX   RZ   Rf   Rh   Ro   Rx   RÜ   R   Ré   Rí   Rî   Rü   R©   Rq   RÆ   RØ   R¥   Rµ   (    (    (    s(   /Users/rlyon/src/s3cmd-1.0.1/S3/Utils.pyt   <module>   s¨   "(			
						
															
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102b590c0
   @input=#<StringIO:0x00000102b60690>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102b58ff8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/path/to/my/S3-copy/S3/Utils.pyc",
 "PATH_INFO"=>"/mocky/path/to/my/S3-copy/S3/Utils.pyc",
 "REQUEST_URI"=>
  "http://mocky.localhost/mocky/path/to/my/S3-copy/S3/Utils.pyc?",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:l+PZr6biO53Qr2X8f57mDuf6YTM=",
 "HTTP_X_AMZ_DATE"=>"Sun, 27 Nov 2011 21:35:51 +0000",
 "HTTP_X_AMZ_META_S3CMD_ATTRS"=>
  "uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027",
 "CONTENT_LENGTH"=>"14047",
 "CONTENT_TYPE"=>"application/x-python-code",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102b5fd08>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:l+PZr6biO53Qr2X8f57mDuf6YTM="},
 "smoke.amz_headers"=>
  {"x-amz-date"=>["Sun, 27 Nov 2011 21:35:51 +0000"],
   "x-amz-meta-s3cmd-attrs"=>
    ["uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path/to/my/S3-copy/S3/Utils.pyc",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"1901D5AA1CC56BAEA4B2732D61296744",
 "smoke.request_token"=>"AYMKjWmu1E2Dr9SmUBM68gBlPMIkqaCF7luqVYawLNbaGjfM"}
StringToSign: PUT

application/x-python-code

x-amz-date:Sun, 27 Nov 2011 21:35:51 +0000
x-amz-meta-s3cmd-attrs:uid:501/gname:staff/uname:rlyon/gid:20/mode:33188/mtime:1321220027/atime:1322429750/ctime:1321220027
/mocky/path/to/my/S3-copy/S3/Utils.pyc
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 0
Connection: close
Date: 2011-11-27T21:35:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 1901D5AA1CC56BAEA4B2732D61296744
x-amz-id-2: AYMKjWmu1E2Dr9SmUBM68gBlPMIkqaCF7luqVYawLNbaGjfM
ETag: c5d468a10b86b6de15cbd0ec76df1776

GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:36:01 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:iH8+vYaRhdYZVfgOBE74lV8GNt4=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102a84820
   @input=#<StringIO:0x00000102a8d7e0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102a84780
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:36:01 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:iH8+vYaRhdYZVfgOBE74lV8GNt4=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102a8cef8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:36:01 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:iH8+vYaRhdYZVfgOBE74lV8GNt4="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"66BAA3432CCC9BF64A7F4C0700963841",
 "smoke.request_token"=>"7pc6Pv22rYXtjE5XDAr7VWPz1tPn4CGTluhvrKdMJd2kodVU"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:36:01 GMT
/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:36:01.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 66BAA3432CCC9BF64A7F4C0700963841
x-amz-id-2: 7pc6Pv22rYXtjE5XDAr7VWPz1tPn4CGTluhvrKdMJd2kodVU

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET /mocky?prefix=path/to/my/S3/S3-copy HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:36:36 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:mILlflGwogzIK0jCZNBX1iewEjc=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001029d9538
   @input=#<StringIO:0x000001029e4c58>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001029d94c0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"prefix=path/to/my/S3/S3-copy",
 "REQUEST_URI"=>"/mocky?prefix=path/to/my/S3/S3-copy",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:36:36 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:mILlflGwogzIK0jCZNBX1iewEjc=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001029e2a98>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:36:36 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:mILlflGwogzIK0jCZNBX1iewEjc="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"A2F0716DDF579897C7E8316D34A332DC",
 "smoke.request_token"=>"ey5G7hQsmccD7J2dCGKcyalavCqVvGoeP0eVs9I5Zpy1ROwN"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:36:36 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 19175
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
  <Contents>
    <Key>path/to/my/S3/ACL.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8f194a5efc6e5b5e77b936c1299839d6</ETag>
    <Size>27450</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>257619936bb45f137d7baa6c4537f50f</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/ACL.py</Key>
    <LastModified>2011-11-27T21:35:50.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T21:35:50.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Config.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Config.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Progress.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/S3.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>8f194a5efc6e5b5e77b936c1299839d6</ETag>
    <Size>27450</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/S3.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>257619936bb45f137d7baa6c4537f50f</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Utils.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/__init__.py</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3-copy/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T21:35:51.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
	
</ListBucketResult>
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:38:16 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:3LEWqW34CdpghN9e6839ptBJ86A=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x0000010121e920
   @input=#<StringIO:0x0000010126dc78>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x0000010121e240
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:38:16 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:3LEWqW34CdpghN9e6839ptBJ86A=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x0000010126d4d0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:38:16 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:3LEWqW34CdpghN9e6839ptBJ86A="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"7BC8EFDE7BE931742170AF00C4CF7F60",
 "smoke.request_token"=>"Dx4mxPZ0zP3qdV6KeCmNdGatucHQasvQFOjjxWyVILZN8WlG"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:38:16 GMT
/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 491
Connection: close
Date: 2011-11-27T21:38:16.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 7BC8EFDE7BE931742170AF00C4CF7F60
x-amz-id-2: Dx4mxPZ0zP3qdV6KeCmNdGatucHQasvQFOjjxWyVILZN8WlG

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:42:56 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:O26aSGu/IP6rjtumLlBDP3jMGUc=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100e05910
   @input=#<StringIO:0x00000100e2a3f0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100e05870
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:42:56 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:O26aSGu/IP6rjtumLlBDP3jMGUc=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100e20aa8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:42:56 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:O26aSGu/IP6rjtumLlBDP3jMGUc="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"AA7F5D0BA3FCAB5106244BD4C6701E7E",
 "smoke.request_token"=>"SredaSMUVlLeGgID27xi3HVTV9vYolmxloDflpcggmnjWxCU"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:42:56 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:04 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:6fgFIRZv7nHxpyZM1moy7ab0jHQ=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100c0f890
   @input=#<StringIO:0x00000100c2b068>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100c0f7f0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:04 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:6fgFIRZv7nHxpyZM1moy7ab0jHQ=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100c25dc0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:04 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:6fgFIRZv7nHxpyZM1moy7ab0jHQ="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"AB23884CFA4CC06D41CF6EED352950E4",
 "smoke.request_token"=>"xPudNlw0BnXkEcgKYq7DoTmxQpyq70f3I2zXtaYKVxlPYvVc"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:04 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:06 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:EgPZo7cBJyNCm0ArF1sqybMCxRo=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100c11c80
   @input=#<StringIO:0x000001009c9608>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100c12180
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:06 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:EgPZo7cBJyNCm0ArF1sqybMCxRo=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100abf5a8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:06 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:EgPZo7cBJyNCm0ArF1sqybMCxRo="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"89A26D25B132A2ED8C090BDE57B3D609",
 "smoke.request_token"=>"rRz1vVTciCRKBnE28kIBd21iRR0Q44R1xj7ujHlZo7lMYeAG"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:06 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:08 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:yr7Bdy80TagFkooB5UPt4zLNEWA=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102bac978
   @input=#<StringIO:0x00000102bb15e0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102bac900
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:08 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:yr7Bdy80TagFkooB5UPt4zLNEWA=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102bb0e38>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:08 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:yr7Bdy80TagFkooB5UPt4zLNEWA="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"FE01E5AB0282CBD49FD978AA2D40E639",
 "smoke.request_token"=>"8rOizn5HkmOTtP635bXEjwv8fzfcfZsSMuACwGzxOIyLWdYJ"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:08 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:41 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:8sp0i/sTPxvP/rKLzkeB6bu2Gn8=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102b44d50
   @input=#<StringIO:0x00000102b4ae30>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102b44cd8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:41 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:8sp0i/sTPxvP/rKLzkeB6bu2Gn8=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102b4a4f8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:41 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:8sp0i/sTPxvP/rKLzkeB6bu2Gn8="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"0F5D0CE27CF4E791DC51B80D1F85862F",
 "smoke.request_token"=>"LxrJHXFJr3tZAaqnNfjAXlf7me7jA7frzRdEn3zSbLtW9D0B"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:41 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:44 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:pu7dv3pWpyPYMttE0NXRak/ZGVI=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102a93c80
   @input=#<StringIO:0x00000102a9bcf0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102a93c08
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:44 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:pu7dv3pWpyPYMttE0NXRak/ZGVI=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102a9b4f8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:44 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:pu7dv3pWpyPYMttE0NXRak/ZGVI="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"EB8B27ED076A42E3ED86E5C443A3844A",
 "smoke.request_token"=>"H23OmhIPrci3cnO9c0wOLxeAqKbS1PZbvYbhy2WdaMFUSemC"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:44 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:45 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:lFSKvs+pGTYiKXWJHQfWAaj9dnk=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001029eba58
   @input=#<StringIO:0x000001029f0580>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001029eb968
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:45 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:lFSKvs+pGTYiKXWJHQfWAaj9dnk=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001029efd60>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:45 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:lFSKvs+pGTYiKXWJHQfWAaj9dnk="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"E98C88E41012DA3AE2CDFEF4C0770CB8",
 "smoke.request_token"=>"zWxNsphJEn3wvR24NwVPUbZPpWa3jppBjl1VxkL7S8gNgJlZ"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:45 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:47 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:JrgZ7ofTsvuHvhy/t3OjOrTuz5I=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102958be0
   @input=#<StringIO:0x000001029605c0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000102958b68
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:47 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:JrgZ7ofTsvuHvhy/t3OjOrTuz5I=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x0000010295faa8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:47 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:JrgZ7ofTsvuHvhy/t3OjOrTuz5I="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"5D732E921B150B6DB76320D3B3265764",
 "smoke.request_token"=>"IJiBPb0ULi5ilGCBZpg8nm4RWxAKSCoHssKwo83EEnJoLj8w"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:47 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:50 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:FLKAzUQ2nlIcOdX/AZv4tH61nOc=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001028cdf18
   @input=#<StringIO:0x000001028dfc18>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001028cdea0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:50 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:FLKAzUQ2nlIcOdX/AZv4tH61nOc=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001028df2e0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:50 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:FLKAzUQ2nlIcOdX/AZv4tH61nOc="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"5DD375E3116EC000B100C6D0D04ED0AA",
 "smoke.request_token"=>"uZ3gWDGbRKqI5oanP1Fz4pmRQYuMBnL95Iarb7HWenVV8vRf"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:50 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:51 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ccKO4eMj20MA4og8qmx0D4YhYIU=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000102804230
   @input=#<StringIO:0x00000102809c80>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001028041b8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:51 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:ccKO4eMj20MA4og8qmx0D4YhYIU=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000102809280>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:51 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:ccKO4eMj20MA4og8qmx0D4YhYIU="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"3BB8DADA8F805F5A747568C7A775C78C",
 "smoke.request_token"=>"M578buQexQCBKd4AtLSTojblABmajOKeG90kyoaIn9RYXYzY"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:51 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:53 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:lzwj8DCYWV9RhjbLWeMx6SsHQZI=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x0000010135d778
   @input=#<StringIO:0x00000101364b90>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x0000010135d700
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:53 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:lzwj8DCYWV9RhjbLWeMx6SsHQZI=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001013643e8>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:53 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:lzwj8DCYWV9RhjbLWeMx6SsHQZI="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"EEBB7D3BE050FB776FC78DA8F9EBD9DB",
 "smoke.request_token"=>"yKvOOdmZrFi9yKPTYqhLXaICAS8atAEO3jw0i4q6StLZniwV"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:53 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
GET /mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept: */*
User-Agent: Ruby
Content-Type: binary/octet-stream
Date: Sun, 27 Nov 2011 21:43:55 GMT
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ikgcPFpkqIet5upE9juJc/9LgPA=
Content-Length: 0

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001010e7750
   @input=#<StringIO:0x000001011e0cb0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001010e70c0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky",
 "PATH_INFO"=>"/mocky",
 "QUERY_STRING"=>"delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "REQUEST_URI"=>"/mocky?delimiter=/&prefix=path/to/my/S3/S3-copy/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT"=>"*/*",
 "HTTP_USER_AGENT"=>"Ruby",
 "HTTP_DATE"=>"Sun, 27 Nov 2011 21:43:55 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:ikgcPFpkqIet5upE9juJc/9LgPA=",
 "CONTENT_LENGTH"=>"0",
 "CONTENT_TYPE"=>"binary/octet-stream",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001011c5640>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept"=>"*/*",
   "user-agent"=>"Ruby",
   "date"=>"Sun, 27 Nov 2011 21:43:55 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:ikgcPFpkqIet5upE9juJc/9LgPA="},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"84471546BDD2CA3CC2C33088C21DD388",
 "smoke.request_token"=>"sLpWQpNjvcNyWIgpDEcOVQKVCG7SvWVCJ9k3ZiA98FPALure"}
StringToSign: GET

binary/octet-stream
Sun, 27 Nov 2011 21:43:55 GMT
/mocky
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 253
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
	
</ListBucketResult>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /?prefix=to/my/&delimiter=/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: path.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Ux8vrTHrEs7BX3qNaAJONFj2FjU=
x-amz-date: Mon, 28 Nov 2011 00:33:20 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"path.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100eb6be8
   @input=#<StringIO:0x00000100f3e728>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100eb6b48
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/path/",
 "PATH_INFO"=>"/path/",
 "QUERY_STRING"=>"prefix=to/my/&delimiter=/",
 "REQUEST_URI"=>"http://path.localhost/path/?prefix=to/my/&delimiter=/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"path.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:Ux8vrTHrEs7BX3qNaAJONFj2FjU=",
 "HTTP_X_AMZ_DATE"=>"Mon, 28 Nov 2011 00:33:20 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100ecc240>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"path.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:Ux8vrTHrEs7BX3qNaAJONFj2FjU="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Mon, 28 Nov 2011 00:33:20 +0000"]},
 "smoke.bucket"=>"path",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"90166E62D12597DE911E232EF677C8EA",
 "smoke.request_token"=>"IXlp6A5cACSNIkqxwlYQ1UchU1RCnMXTGA3ZOxlqqLakcktp"}
StringToSign: GET



x-amz-date:Mon, 28 Nov 2011 00:33:20 +0000
/path/
HTTP/1.1 404 Not Found
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 189
Connection: close
Date: 2011-11-28T00:33:20.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 90166E62D12597DE911E232EF677C8EA
x-amz-id-2: IXlp6A5cACSNIkqxwlYQ1UchU1RCnMXTGA3ZOxlqqLakcktp

<?xml version="1.0" encoding="UTF-8"?>
<Error>
	<Code>NoSuchBucket</Code>
	<Message>The specified bucket does not exist.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET /mocky/?delimiter=%2F&max-keys=1000&prefix HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:33:34 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:dIZzkhNOFaed4yLgvqr/kQtXeVA=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000103043a68
   @input=#<StringIO:0x00000103052f68>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001030439f0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"delimiter=%2F&max-keys=1000&prefix",
 "REQUEST_URI"=>"/mocky/?delimiter=%2F&max-keys=1000&prefix",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:33:34 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:dIZzkhNOFaed4yLgvqr/kQtXeVA=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000103052810>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:33:34 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:dIZzkhNOFaed4yLgvqr/kQtXeVA=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"7C7349A5F5B9076FEF9F976D76EE13F4",
 "smoke.request_token"=>"KTPDG3DOPqmJjae0hw4jTZ06Io8HSw96OOi01reUKeCwCEAp"}
StringToSign: GET


Mon, 28 Nov 2011 00:33:34 GMT
/mocky/
ArgumentError - comparison of Fixnum with String failed:
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/bucket.rb:127:in `>'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/bucket.rb:127:in `find_filtered_assets'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:78:in `block in <class:App>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1211:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1211:in `block in compile!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `[]'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `block (3 levels) in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:788:in `route_eval'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `block (2 levels) in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:821:in `block in process_route'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:819:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:819:in `process_route'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:771:in `block in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:770:in `each'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:770:in `route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:886:in `dispatch!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:706:in `block in call!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `block in invoke'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `invoke'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:706:in `call!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:692:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/path_traversal.rb:16:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/json_csrf.rb:17:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/base.rb:47:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/nulllogger.rb:9:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/head.rb:9:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/showexceptions.rb:21:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `block in call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1403:in `synchronize'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `call'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:21:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
HTTP/1.1 500 Internal Server Error
Content-Type: text/html
Content-Length: 145886
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>ArgumentError at &#x2F;mocky&#x2F;</title>

  <script type="text/javascript">
  //<!--
  function toggle(id) {
    var pre  = document.getElementById("pre-" + id);
    var post = document.getElementById("post-" + id);
    var context = document.getElementById("context-" + id);

    if (pre.style.display == 'block') {
      pre.style.display = 'none';
      post.style.display = 'none';
      context.style.background = "none";
    } else {
      pre.style.display = 'block';
      post.style.display = 'block';
      context.style.background = "#fffed9";
    }
  }

  function toggleBacktrace(){
    var bt = document.getElementById("backtrace");
    var toggler = document.getElementById("expando");

    if (bt.className == 'condensed') {
      bt.className = 'expanded';
      toggler.innerHTML = "(condense)";
    } else {
      bt.className = 'condensed';
      toggler.innerHTML = "(expand)";
    }
  }
  //-->
  </script>

<style type="text/css" media="screen">
  *                   {margin: 0; padding: 0; border: 0; outline: 0;}
  div.clear           {clear: both;}
  body                {background: #EEEEEE; margin: 0; padding: 0;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode',
                       'Garuda';}
  code                {font-family: 'Lucida Console', monospace;
                       font-size: 12px;}
  li                  {height: 18px;}
  ul                  {list-style: none; margin: 0; padding: 0;}
  ol:hover            {cursor: pointer;}
  ol li               {white-space: pre;}
  #explanation        {font-size: 12px; color: #666666;
                       margin: 20px 0 0 100px;}
/* WRAP */
  #wrap               {width: 1000px; background: #FFFFFF; margin: 0 auto;
                       padding: 30px 50px 20px 50px;
                       border-left: 1px solid #DDDDDD;
                       border-right: 1px solid #DDDDDD;}
/* HEADER */
  #header             {margin: 0 auto 25px auto;}
  #header img         {float: left;}
  #header #summary    {float: left; margin: 12px 0 0 20px; width:660px;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode';}
  h1                  {margin: 0; font-size: 36px; color: #981919;}
  h2                  {margin: 0; font-size: 22px; color: #333333;}
  #header ul          {margin: 0; font-size: 12px; color: #666666;}
  #header ul li strong{color: #444444;}
  #header ul li       {display: inline; padding: 0 10px;}
  #header ul li.first {padding-left: 0;}
  #header ul li.last  {border: 0; padding-right: 0;}
/* BODY */
  #backtrace,
  #get,
  #post,
  #cookies,
  #rack               {width: 980px; margin: 0 auto 10px auto;}
  p#nav               {float: right; font-size: 14px;}
/* BACKTRACE */
  a#expando           {float: left; padding-left: 5px; color: #666666;
                      font-size: 14px; text-decoration: none; cursor: pointer;}
  a#expando:hover     {text-decoration: underline;}
  h3                  {float: left; width: 100px; margin-bottom: 10px;
                       color: #981919; font-size: 14px; font-weight: bold;}
  #nav a              {color: #666666; text-decoration: none; padding: 0 5px;}
  #backtrace li.frame-info {background: #f7f7f7; padding-left: 10px;
                           font-size: 12px; color: #333333;}
  #backtrace ul       {list-style-position: outside; border: 1px solid #E9E9E9;
                       border-bottom: 0;}
  #backtrace ol       {width: 920px; margin-left: 50px;
                       font: 10px 'Lucida Console', monospace; color: #666666;}
  #backtrace ol li    {border: 0; border-left: 1px solid #E9E9E9;
                       padding: 2px 0;}
  #backtrace ol code  {font-size: 10px; color: #555555; padding-left: 5px;}
  #backtrace-ul li    {border-bottom: 1px solid #E9E9E9; height: auto;
                       padding: 3px 0;}
  #backtrace-ul .code {padding: 6px 0 4px 0;}
  #backtrace.condensed .system,
  #backtrace.condensed .framework {display:none;}
/* REQUEST DATA */
  p.no-data           {padding-top: 2px; font-size: 12px; color: #666666;}
  table.req           {width: 980px; text-align: left; font-size: 12px;
                       color: #666666; padding: 0; border-spacing: 0;
                       border: 1px solid #EEEEEE; border-bottom: 0;
                       border-left: 0;
                       clear:both}
  table.req tr th     {padding: 2px 10px; font-weight: bold;
                       background: #F7F7F7; border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
  table.req tr td     {padding: 2px 20px 2px 10px;
                       border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
/* HIDE PRE/POST CODE AT START */
  .pre-context,
  .post-context       {display: none;}

  table td.code       {width:750px}
  table td.code div   {width:750px;overflow:hidden}
</style>
</head>
<body>
  <div id="wrap">
    <div id="header">
      <img src="/__sinatra__/500.png" alt="application error" height="161" width="313" />
      <div id="summary">
        <h1><strong>ArgumentError</strong> at <strong>&#x2F;mocky&#x2F;
          </strong></h1>
        <h2>comparison of Fixnum with String failed</h2>
        <ul>
          <li class="first"><strong>file:</strong> <code>
            bucket.rb</code></li>
          <li><strong>location:</strong> <code>&gt;
            </code></li>
          <li class="last"><strong>line:
            </strong> 127</li>
        </ul>
      </div>
      <div class="clear"></div>
    </div>

    <div id="backtrace" class='condensed'>
      <h3>BACKTRACE</h3>
      <p><a href="#" id="expando"
            onclick="toggleBacktrace(); return false">(expand)</a></p>
      <p id="nav"><strong>JUMP TO:</strong>
         <a href="#get-info">GET</a>
         <a href="#post-info">POST</a>
         <a href="#cookie-info">COOKIES</a>
         <a href="#env-info">ENV</a>
      </p>
      <div class="clear"></div>

      <ul id="backtrace-ul">

      
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;bucket.rb</code> in
                <code><strong>&gt;</strong></code>
            </li>

            <li class="code app">
              
              <ol start="120"
                  class="pre-context" id="pre-1"
                  onclick="toggle(1);">
                
                <li class="pre-context-line"><code>          asset_list = asset_list.inject([]) do |arr,asset|
</code></li>
                
                <li class="pre-context-line"><code>            base = asset.basename(delimiter,prefix)
</code></li>
                
                <li class="pre-context-line"><code>            arr &lt;&lt; asset if !base.nil? &amp;&amp; base &gt; marker
</code></li>
                
                <li class="pre-context-line"><code>            arr
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
              </ol>
              

              <ol start="127" class="context" id="1"
                  onclick="toggle(1);">
                <li class="context-line" id="context-1"><code>        self.truncated = true if asset_list.length &gt; max_keys</code></li>
              </ol>

              
              <ol start="128" class="post-context"
                  id="post-1" onclick="toggle(1);">
                
                <li class="post-context-line"><code>        asset_list = asset_list[0..max_keys]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      class &lt;&lt; self
</code></li>
                
                <li class="post-context-line"><code>        def find_all_through_acl(user)
</code></li>
                
                <li class="post-context-line"><code>          acls = Acl.where(:user_id =&gt; user.id)
</code></li>
                
                <li class="post-context-line"><code>          acls.map { |acl| acl.bucket }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;bucket.rb</code> in
                <code><strong>find_filtered_assets</strong></code>
            </li>

            <li class="code app">
              
              <ol start="120"
                  class="pre-context" id="pre-2"
                  onclick="toggle(2);">
                
                <li class="pre-context-line"><code>          asset_list = asset_list.inject([]) do |arr,asset|
</code></li>
                
                <li class="pre-context-line"><code>            base = asset.basename(delimiter,prefix)
</code></li>
                
                <li class="pre-context-line"><code>            arr &lt;&lt; asset if !base.nil? &amp;&amp; base &gt; marker
</code></li>
                
                <li class="pre-context-line"><code>            arr
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
              </ol>
              

              <ol start="127" class="context" id="2"
                  onclick="toggle(2);">
                <li class="context-line" id="context-2"><code>        self.truncated = true if asset_list.length &gt; max_keys</code></li>
              </ol>

              
              <ol start="128" class="post-context"
                  id="post-2" onclick="toggle(2);">
                
                <li class="post-context-line"><code>        asset_list = asset_list[0..max_keys]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      class &lt;&lt; self
</code></li>
                
                <li class="post-context-line"><code>        def find_all_through_acl(user)
</code></li>
                
                <li class="post-context-line"><code>          acls = Acl.where(:user_id =&gt; user.id)
</code></li>
                
                <li class="post-context-line"><code>          acls.map { |acl| acl.bucket }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;app.rb</code> in
                <code><strong>block in &lt;class:App&gt;</strong></code>
            </li>

            <li class="code app">
              
              <ol start="71"
                  class="pre-context" id="pre-3"
                  onclick="toggle(3);">
                
                <li class="pre-context-line"><code>          @max_keys = params.has_key?(&#x27;max-keys&#x27;) ? params[&#x27;max-keys&#x27;] : SMOKE_CONFIG[&#x27;default_max_keys&#x27;]
</code></li>
                
                <li class="pre-context-line"><code>          @prefix = params.has_key?(&#x27;prefix&#x27;) ? params[&#x27;prefix&#x27;] : nil
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>          unless @delimited
</code></li>
                
                <li class="pre-context-line"><code>            @assets = @bucket.assets
</code></li>
                
                <li class="pre-context-line"><code>            @common_prefixes = []
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="3"
                  onclick="toggle(3);">
                <li class="context-line" id="context-3"><code>            @assets = @bucket.find_filtered_assets :prefix =&gt; @prefix, :max_keys =&gt; @max_keys</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-3" onclick="toggle(3);">
                
                <li class="post-context-line"><code>            @common_prefixes = @bucket.common_prefixes :prefix =&gt; @prefix, :delimiter =&gt; params[&#x27;delimiter&#x27;]
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>          
</code></li>
                
                <li class="post-context-line"><code>          erb :get_bucket
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1204"
                  class="pre-context" id="pre-4"
                  onclick="toggle(4);">
                
                <li class="pre-context-line"><code>        options.each_pair { |option, args| send(option, *args) }
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        pattern, keys           = compile path
</code></li>
                
                <li class="pre-context-line"><code>        conditions, @conditions = @conditions, []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        [ pattern, keys, conditions, block.arity != 0 ?
</code></li>
                
              </ol>
              

              <ol start="1211" class="context" id="4"
                  onclick="toggle(4);">
                <li class="context-line" id="context-4"><code>            proc { |a,p| unbound_method.bind(a).call(*p) } :</code></li>
              </ol>

              
              <ol start="1212" class="post-context"
                  id="post-4" onclick="toggle(4);">
                
                <li class="post-context-line"><code>            proc { |a,p| unbound_method.bind(a).call } ]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path)
</code></li>
                
                <li class="post-context-line"><code>        keys = []
</code></li>
                
                <li class="post-context-line"><code>        if path.respond_to? :to_str
</code></li>
                
                <li class="post-context-line"><code>          pattern = path.to_str.gsub(&#x2F;[^\?\%\\\&#x2F;\:\*\w]&#x2F;) { |c| encoded(c) }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in compile!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1204"
                  class="pre-context" id="pre-5"
                  onclick="toggle(5);">
                
                <li class="pre-context-line"><code>        options.each_pair { |option, args| send(option, *args) }
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        pattern, keys           = compile path
</code></li>
                
                <li class="pre-context-line"><code>        conditions, @conditions = @conditions, []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        [ pattern, keys, conditions, block.arity != 0 ?
</code></li>
                
              </ol>
              

              <ol start="1211" class="context" id="5"
                  onclick="toggle(5);">
                <li class="context-line" id="context-5"><code>            proc { |a,p| unbound_method.bind(a).call(*p) } :</code></li>
              </ol>

              
              <ol start="1212" class="post-context"
                  id="post-5" onclick="toggle(5);">
                
                <li class="post-context-line"><code>            proc { |a,p| unbound_method.bind(a).call } ]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path)
</code></li>
                
                <li class="post-context-line"><code>        keys = []
</code></li>
                
                <li class="post-context-line"><code>        if path.respond_to? :to_str
</code></li>
                
                <li class="post-context-line"><code>          pattern = path.to_str.gsub(&#x2F;[^\?\%\\\&#x2F;\:\*\w]&#x2F;) { |c| encoded(c) }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>[]</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-6"
                  onclick="toggle(6);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="6"
                  onclick="toggle(6);">
                <li class="context-line" id="context-6"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-6" onclick="toggle(6);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (3 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-7"
                  onclick="toggle(7);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="7"
                  onclick="toggle(7);">
                <li class="context-line" id="context-7"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-7" onclick="toggle(7);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route_eval</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="781"
                  class="pre-context" id="pre-8"
                  onclick="toggle(8);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      route_eval(&amp;pass_block) if pass_block
</code></li>
                
                <li class="pre-context-line"><code>      route_missing
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run a route block and throw :halt with the result.
</code></li>
                
                <li class="pre-context-line"><code>    def route_eval
</code></li>
                
              </ol>
              

              <ol start="788" class="context" id="8"
                  onclick="toggle(8);">
                <li class="context-line" id="context-8"><code>      throw :halt, yield</code></li>
              </ol>

              
              <ol start="789" class="post-context"
                  id="post-8" onclick="toggle(8);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # If the current request matches pattern and conditions, fill params
</code></li>
                
                <li class="post-context-line"><code>    # with keys and call the given block.
</code></li>
                
                <li class="post-context-line"><code>    # Revert params afterwards.
</code></li>
                
                <li class="post-context-line"><code>    #
</code></li>
                
                <li class="post-context-line"><code>    # Returns pass block.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (2 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-9"
                  onclick="toggle(9);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="9"
                  onclick="toggle(9);">
                <li class="context-line" id="context-9"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-9" onclick="toggle(9);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="814"
                  class="pre-context" id="pre-10"
                  onclick="toggle(10);">
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
                <li class="pre-context-line"><code>        catch(:pass) do
</code></li>
                
                <li class="pre-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
              </ol>
              

              <ol start="821" class="context" id="10"
                  onclick="toggle(10);">
                <li class="context-line" id="context-10"><code>          block ? block[self, @block_params] : yield(self, @block_params)</code></li>
              </ol>

              
              <ol start="822" class="post-context"
                  id="post-10" onclick="toggle(10);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # No matching route was found or all routes passed. The default
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="812"
                  class="pre-context" id="pre-11"
                  onclick="toggle(11);">
                
                <li class="pre-context-line"><code>          elsif values.any?
</code></li>
                
                <li class="pre-context-line"><code>            {&#x27;captures&#x27; =&gt; values}
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
              </ol>
              

              <ol start="819" class="context" id="11"
                  onclick="toggle(11);">
                <li class="context-line" id="context-11"><code>        catch(:pass) do</code></li>
              </ol>

              
              <ol start="820" class="post-context"
                  id="post-11" onclick="toggle(11);">
                
                <li class="post-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>          block ? block[self, @block_params] : yield(self, @block_params)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="812"
                  class="pre-context" id="pre-12"
                  onclick="toggle(12);">
                
                <li class="pre-context-line"><code>          elsif values.any?
</code></li>
                
                <li class="pre-context-line"><code>            {&#x27;captures&#x27; =&gt; values}
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
              </ol>
              

              <ol start="819" class="context" id="12"
                  onclick="toggle(12);">
                <li class="context-line" id="context-12"><code>        catch(:pass) do</code></li>
              </ol>

              
              <ol start="820" class="post-context"
                  id="post-12" onclick="toggle(12);">
                
                <li class="post-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>          block ? block[self, @block_params] : yield(self, @block_params)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="764"
                  class="pre-context" id="pre-13"
                  onclick="toggle(13);">
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
              </ol>
              

              <ol start="771" class="context" id="13"
                  onclick="toggle(13);">
                <li class="context-line" id="context-13"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|</code></li>
              </ol>

              
              <ol start="772" class="post-context"
                  id="post-13" onclick="toggle(13);">
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>each</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="763"
                  class="pre-context" id="pre-14"
                  onclick="toggle(14);">
                
                <li class="pre-context-line"><code>      filter! type, base.superclass if base.superclass.respond_to?(:filters)
</code></li>
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
              </ol>
              

              <ol start="770" class="context" id="14"
                  onclick="toggle(14);">
                <li class="context-line" id="context-14"><code>        routes.each do |pattern, keys, conditions, block|</code></li>
              </ol>

              
              <ol start="771" class="post-context"
                  id="post-14" onclick="toggle(14);">
                
                <li class="post-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="763"
                  class="pre-context" id="pre-15"
                  onclick="toggle(15);">
                
                <li class="pre-context-line"><code>      filter! type, base.superclass if base.superclass.respond_to?(:filters)
</code></li>
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
              </ol>
              

              <ol start="770" class="context" id="15"
                  onclick="toggle(15);">
                <li class="context-line" id="context-15"><code>        routes.each do |pattern, keys, conditions, block|</code></li>
              </ol>

              
              <ol start="771" class="post-context"
                  id="post-15" onclick="toggle(15);">
                
                <li class="post-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>dispatch!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="879"
                  class="pre-context" id="pre-16"
                  onclick="toggle(16);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Dispatch a request with error handling.
</code></li>
                
                <li class="pre-context-line"><code>    def dispatch!
</code></li>
                
                <li class="pre-context-line"><code>      static! if settings.static? &amp;&amp; (request.get? || request.head?)
</code></li>
                
                <li class="pre-context-line"><code>      filter! :before
</code></li>
                
              </ol>
              

              <ol start="886" class="context" id="16"
                  onclick="toggle(16);">
                <li class="context-line" id="context-16"><code>      route!</code></li>
              </ol>

              
              <ol start="887" class="post-context"
                  id="post-16" onclick="toggle(16);">
                
                <li class="post-context-line"><code>    rescue ::Exception =&gt; boom
</code></li>
                
                <li class="post-context-line"><code>      handle_exception!(boom)
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      filter! :after unless env[&#x27;sinatra.static_file&#x27;]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Error handling during requests.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="699"
                  class="pre-context" id="pre-17"
                  onclick="toggle(17);">
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @params   = indifferent_params(@request.params)
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>      force_encoding(@params)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @response[&#x27;Content-Type&#x27;] = nil
</code></li>
                
              </ol>
              

              <ol start="706" class="context" id="17"
                  onclick="toggle(17);">
                <li class="context-line" id="context-17"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="707" class="post-context"
                  id="post-17" onclick="toggle(17);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) }
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body and body[0].respond_to? :content_type
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          content_type :html
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-18"
                  onclick="toggle(18);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="18"
                  onclick="toggle(18);">
                <li class="context-line" id="context-18"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-18" onclick="toggle(18);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-19"
                  onclick="toggle(19);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="19"
                  onclick="toggle(19);">
                <li class="context-line" id="context-19"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-19" onclick="toggle(19);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-20"
                  onclick="toggle(20);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="20"
                  onclick="toggle(20);">
                <li class="context-line" id="context-20"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-20" onclick="toggle(20);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="699"
                  class="pre-context" id="pre-21"
                  onclick="toggle(21);">
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @params   = indifferent_params(@request.params)
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>      force_encoding(@params)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @response[&#x27;Content-Type&#x27;] = nil
</code></li>
                
              </ol>
              

              <ol start="706" class="context" id="21"
                  onclick="toggle(21);">
                <li class="context-line" id="context-21"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="707" class="post-context"
                  id="post-21" onclick="toggle(21);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) }
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body and body[0].respond_to? :content_type
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          content_type :html
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="685"
                  class="pre-context" id="pre-22"
                  onclick="toggle(22);">
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>      @template_cache = Tilt::Cache.new
</code></li>
                
                <li class="pre-context-line"><code>      yield self if block_given?
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Rack call interface.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="692" class="context" id="22"
                  onclick="toggle(22);">
                <li class="context-line" id="context-22"><code>      dup.call!(env)</code></li>
              </ol>

              
              <ol start="693" class="post-context"
                  id="post-22" onclick="toggle(22);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    attr_accessor :env, :request, :response, :params
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def call!(env) # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>      @env      = env
</code></li>
                
                <li class="post-context-line"><code>      @request  = Request.new(env)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;xss_header.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="15"
                  class="pre-context" id="pre-23"
                  onclick="toggle(23);">
                
                <li class="pre-context-line"><code>      default_options :xss_mode =&gt; :block
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def header
</code></li>
                
                <li class="pre-context-line"><code>        { &#x27;X-XSS-Protection&#x27; =&gt; &quot;1; mode=#{options[:xss_mode]}&quot; }
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="22" class="context" id="23"
                  onclick="toggle(23);">
                <li class="context-line" id="context-23"><code>        status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="23" class="post-context"
                  id="post-23" onclick="toggle(23);">
                
                <li class="post-context-line"><code>        [status, header.merge(headers), body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;path_traversal.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="9"
                  class="pre-context" id="pre-24"
                  onclick="toggle(24);">
                
                <li class="pre-context-line"><code>    #
</code></li>
                
                <li class="pre-context-line"><code>    # Unescapes &#x27;&#x2F;&#x27; and &#x27;.&#x27;, expands +path_info+.
</code></li>
                
                <li class="pre-context-line"><code>    # Thus &lt;tt&gt;GET &#x2F;foo&#x2F;%2e%2e%2fbar&lt;&#x2F;tt&gt; becomes &lt;tt&gt;GET &#x2F;bar&lt;&#x2F;tt&gt;.
</code></li>
                
                <li class="pre-context-line"><code>    class PathTraversal &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        path_was         = env[&quot;PATH_INFO&quot;]
</code></li>
                
                <li class="pre-context-line"><code>        env[&quot;PATH_INFO&quot;] = cleanup path_was if path_was
</code></li>
                
              </ol>
              

              <ol start="16" class="context" id="24"
                  onclick="toggle(24);">
                <li class="context-line" id="context-24"><code>        app.call env</code></li>
              </ol>

              
              <ol start="17" class="post-context"
                  id="post-24" onclick="toggle(24);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        env[&quot;PATH_INFO&quot;] = path_was
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def cleanup(path)
</code></li>
                
                <li class="post-context-line"><code>        parts     = []
</code></li>
                
                <li class="post-context-line"><code>        unescaped = path.gsub(&#x27;%2e&#x27;, &#x27;.&#x27;).gsub(&#x27;%2f&#x27;, &#x27;&#x2F;&#x27;)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;json_csrf.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="10"
                  class="pre-context" id="pre-25"
                  onclick="toggle(25);">
                
                <li class="pre-context-line"><code>    # JSON GET APIs are vulnerable to being embedded as JavaScript while the
</code></li>
                
                <li class="pre-context-line"><code>    # Array prototype has been patched to track data. Checks the referrer
</code></li>
                
                <li class="pre-context-line"><code>    # even on GET requests if the content type is JSON.
</code></li>
                
                <li class="pre-context-line"><code>    class JsonCsrf &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      default_reaction :deny
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="17" class="context" id="25"
                  onclick="toggle(25);">
                <li class="context-line" id="context-25"><code>        status, headers, body = app.call(env)</code></li>
              </ol>

              
              <ol start="18" class="post-context"
                  id="post-25" onclick="toggle(25);">
                
                <li class="post-context-line"><code>        if headers[&#x27;Content-Type&#x27;].to_s.split(&#x27;;&#x27;, 2).first =~ &#x2F;^\s*application\&#x2F;json\s*$&#x2F;
</code></li>
                
                <li class="post-context-line"><code>          result = react(env) if referrer(env) != Request.new(env).host
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>        result or [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="40"
                  class="pre-context" id="pre-26"
                  onclick="toggle(26);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          warn env, &quot;attack prevented by #{self.class}&quot;
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="47" class="context" id="26"
                  onclick="toggle(26);">
                <li class="context-line" id="context-26"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="48" class="post-context"
                  id="post-26" onclick="toggle(26);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if Array === result and result.size == 3
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;xss_header.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="15"
                  class="pre-context" id="pre-27"
                  onclick="toggle(27);">
                
                <li class="pre-context-line"><code>      default_options :xss_mode =&gt; :block
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def header
</code></li>
                
                <li class="pre-context-line"><code>        { &#x27;X-XSS-Protection&#x27; =&gt; &quot;1; mode=#{options[:xss_mode]}&quot; }
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="22" class="context" id="27"
                  onclick="toggle(27);">
                <li class="context-line" id="context-27"><code>        status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="23" class="post-context"
                  id="post-27" onclick="toggle(27);">
                
                <li class="post-context-line"><code>        [status, header.merge(headers), body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;nulllogger.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="2"
                  class="pre-context" id="pre-28"
                  onclick="toggle(28);">
                
                <li class="pre-context-line"><code>  class NullLogger
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.logger&#x27;] = self
</code></li>
                
              </ol>
              

              <ol start="9" class="context" id="28"
                  onclick="toggle(28);">
                <li class="context-line" id="context-28"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="10" class="post-context"
                  id="post-28" onclick="toggle(28);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def info(progname = nil, &amp;block);  end
</code></li>
                
                <li class="post-context-line"><code>    def debug(progname = nil, &amp;block); end
</code></li>
                
                <li class="post-context-line"><code>    def warn(progname = nil, &amp;block);  end
</code></li>
                
                <li class="post-context-line"><code>    def error(progname = nil, &amp;block); end
</code></li>
                
                <li class="post-context-line"><code>    def fatal(progname = nil, &amp;block); end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;head.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="2"
                  class="pre-context" id="pre-29"
                  onclick="toggle(29);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>class Head
</code></li>
                
                <li class="pre-context-line"><code>  def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>    @app = app
</code></li>
                
                <li class="pre-context-line"><code>  end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>  def call(env)
</code></li>
                
              </ol>
              

              <ol start="9" class="context" id="29"
                  onclick="toggle(29);">
                <li class="context-line" id="context-29"><code>    status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="10" class="post-context"
                  id="post-29" onclick="toggle(29);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    if env[&quot;REQUEST_METHOD&quot;] == &quot;HEAD&quot;
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, []]
</code></li>
                
                <li class="post-context-line"><code>    else
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;showexceptions.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="14"
                  class="pre-context" id="pre-30"
                  onclick="toggle(30);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app      = app
</code></li>
                
                <li class="pre-context-line"><code>      @template = ERB.new(TEMPLATE)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="21" class="context" id="30"
                  onclick="toggle(30);">
                <li class="context-line" id="context-30"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="22" class="post-context"
                  id="post-30" onclick="toggle(30);">
                
                <li class="post-context-line"><code>    rescue Exception =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      errors, env[&quot;rack.errors&quot;] = env[&quot;rack.errors&quot;], @@eats_errors
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if respond_to?(:prefers_plain_text?) and prefers_plain_text?(env)
</code></li>
                
                <li class="post-context-line"><code>        content_type = &quot;text&#x2F;plain&quot;
</code></li>
                
                <li class="post-context-line"><code>        body = [dump_exception(e)]
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1327"
                  class="pre-context" id="pre-31"
                  onclick="toggle(31);">
                
                <li class="pre-context-line"><code>        setup_default_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        setup_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        builder.run new!(*args, &amp;bk)
</code></li>
                
                <li class="pre-context-line"><code>        builder
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="1334" class="context" id="31"
                  onclick="toggle(31);">
                <li class="context-line" id="context-31"><code>        synchronize { prototype.call(env) }</code></li>
              </ol>

              
              <ol start="1335" class="post-context"
                  id="post-31" onclick="toggle(31);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>      def setup_default_middleware(builder)
</code></li>
                
                <li class="post-context-line"><code>        builder.use ShowExceptions       if show_exceptions?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::MethodOverride if method_override?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::Head
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>synchronize</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1396"
                  class="pre-context" id="pre-32"
                  onclick="toggle(32);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @@mutex = Mutex.new
</code></li>
                
                <li class="pre-context-line"><code>      def synchronize(&amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        if lock?
</code></li>
                
                <li class="pre-context-line"><code>          @@mutex.synchronize(&amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        else
</code></li>
                
              </ol>
              

              <ol start="1403" class="context" id="32"
                  onclick="toggle(32);">
                <li class="context-line" id="context-32"><code>          yield</code></li>
              </ol>

              
              <ol start="1404" class="post-context"
                  id="post-32" onclick="toggle(32);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    public
</code></li>
                
                <li class="post-context-line"><code>      CALLERS_TO_IGNORE = [ # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>        &#x2F;\&#x2F;sinatra(\&#x2F;(base|main|showexceptions))?\.rb$&#x2F;, # all sinatra code
</code></li>
                
                <li class="post-context-line"><code>        &#x2F;lib\&#x2F;tilt.*\.rb$&#x2F;,                              # all tilt code
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1327"
                  class="pre-context" id="pre-33"
                  onclick="toggle(33);">
                
                <li class="pre-context-line"><code>        setup_default_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        setup_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        builder.run new!(*args, &amp;bk)
</code></li>
                
                <li class="pre-context-line"><code>        builder
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="1334" class="context" id="33"
                  onclick="toggle(33);">
                <li class="context-line" id="context-33"><code>        synchronize { prototype.call(env) }</code></li>
              </ol>

              
              <ol start="1335" class="post-context"
                  id="post-33" onclick="toggle(33);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>      def setup_default_middleware(builder)
</code></li>
                
                <li class="post-context-line"><code>        builder.use ShowExceptions       if show_exceptions?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::MethodOverride if method_override?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::Head
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;auth.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code app">
              
              <ol start="14"
                  class="pre-context" id="pre-34"
                  onclick="toggle(34);">
                
                <li class="pre-context-line"><code>        request.env[&#x27;smoke.request_token&#x27;] = String.random :length =&gt; 48
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :MissingSecurityHeader) unless request.has_auth?
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :NotSignedUp) unless request.has_user?
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :AccountProblem) unless request.env[&#x27;smoke.user&#x27;].is_active?
</code></li>
                
                <li class="pre-context-line"><code>        # pp request
</code></li>
                
                <li class="pre-context-line"><code>        if request.valid?
</code></li>
                
              </ol>
              

              <ol start="21" class="context" id="34"
                  onclick="toggle(34);">
                <li class="context-line" id="context-34"><code>          return @app.call(env)</code></li>
              </ol>

              
              <ol start="22" class="post-context"
                  id="post-34" onclick="toggle(34);">
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          return error(env, :SignatureDoesNotMatch)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      private 
</code></li>
                
                <li class="post-context-line"><code>      def error(env, error)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>_call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="41"
                  class="pre-context" id="pre-35"
                  onclick="toggle(35);">
                
                <li class="pre-context-line"><code>      assert(&quot;No env given&quot;) { env }
</code></li>
                
                <li class="pre-context-line"><code>      check_env env
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.input&#x27;] = InputWrapper.new(env[&#x27;rack.input&#x27;])
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.errors&#x27;] = ErrorWrapper.new(env[&#x27;rack.errors&#x27;])
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      ## and returns an Array of exactly three values:
</code></li>
                
              </ol>
              

              <ol start="48" class="context" id="35"
                  onclick="toggle(35);">
                <li class="context-line" id="context-35"><code>      status, headers, @body = @app.call(env)</code></li>
              </ol>

              
              <ol start="49" class="post-context"
                  id="post-35" onclick="toggle(35);">
                
                <li class="post-context-line"><code>      ## The *status*,
</code></li>
                
                <li class="post-context-line"><code>      check_status status
</code></li>
                
                <li class="post-context-line"><code>      ## the *headers*,
</code></li>
                
                <li class="post-context-line"><code>      check_headers headers
</code></li>
                
                <li class="post-context-line"><code>      ## and the *body*.
</code></li>
                
                <li class="post-context-line"><code>      check_content_type status, headers
</code></li>
                
                <li class="post-context-line"><code>      check_content_length status, headers
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="29"
                  class="pre-context" id="pre-36"
                  onclick="toggle(36);">
                
                <li class="pre-context-line"><code>    ## after to catch all mistakes.
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## = Rack applications
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## A Rack application is a Ruby object (not a class) that
</code></li>
                
                <li class="pre-context-line"><code>    ## responds to +call+.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env=nil)
</code></li>
                
              </ol>
              

              <ol start="36" class="context" id="36"
                  onclick="toggle(36);">
                <li class="context-line" id="context-36"><code>      dup._call(env)</code></li>
              </ol>

              
              <ol start="37" class="post-context"
                  id="post-36" onclick="toggle(36);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def _call(env)
</code></li>
                
                <li class="post-context-line"><code>      ## It takes exactly one argument, the *environment*
</code></li>
                
                <li class="post-context-line"><code>      assert(&quot;No env given&quot;) { env }
</code></li>
                
                <li class="post-context-line"><code>      check_env env
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>block in pre_process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="73"
                  class="pre-context" id="pre-37"
                  onclick="toggle(37);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
                <li class="pre-context-line"><code>      catch(:async) do
</code></li>
                
                <li class="pre-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
              </ol>
              

              <ol start="80" class="context" id="37"
                  onclick="toggle(37);">
                <li class="context-line" id="context-37"><code>        response = @app.call(@request.env)</code></li>
              </ol>

              
              <ol start="81" class="post-context"
                  id="post-37" onclick="toggle(37);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
                <li class="post-context-line"><code>      nil # Signal to post_process that the request could not be processed
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code system">
              
              <ol start="71"
                  class="pre-context" id="pre-38"
                  onclick="toggle(38);">
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="38"
                  onclick="toggle(38);">
                <li class="context-line" id="context-38"><code>      catch(:async) do</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-38" onclick="toggle(38);">
                
                <li class="post-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
                <li class="post-context-line"><code>        response = @app.call(@request.env)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>pre_process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="71"
                  class="pre-context" id="pre-39"
                  onclick="toggle(39);">
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="39"
                  onclick="toggle(39);">
                <li class="context-line" id="context-39"><code>      catch(:async) do</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-39" onclick="toggle(39);">
                
                <li class="post-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
                <li class="post-context-line"><code>        response = @app.call(@request.env)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-40"
                  onclick="toggle(40);">
                
                <li class="pre-context-line"><code>    # is ready to be processed.
</code></li>
                
                <li class="pre-context-line"><code>    def process
</code></li>
                
                <li class="pre-context-line"><code>      if threaded?
</code></li>
                
                <li class="pre-context-line"><code>        @request.threaded = true
</code></li>
                
                <li class="pre-context-line"><code>        EventMachine.defer(method(:pre_process), method(:post_process))
</code></li>
                
                <li class="pre-context-line"><code>      else
</code></li>
                
                <li class="pre-context-line"><code>        @request.threaded = false
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="40"
                  onclick="toggle(40);">
                <li class="context-line" id="context-40"><code>        post_process(pre_process)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-40" onclick="toggle(40);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def pre_process
</code></li>
                
                <li class="post-context-line"><code>      # Add client info to the request env
</code></li>
                
                <li class="post-context-line"><code>      @request.remote_address = remote_address
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>receive_data</strong></code>
            </li>

            <li class="code system">
              
              <ol start="31"
                  class="pre-context" id="pre-41"
                  onclick="toggle(41);">
                
                <li class="pre-context-line"><code>      @request  = Request.new
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Called when data is received from the client.
</code></li>
                
                <li class="pre-context-line"><code>    def receive_data(data)
</code></li>
                
                <li class="pre-context-line"><code>      trace { data }
</code></li>
                
              </ol>
              

              <ol start="38" class="context" id="41"
                  onclick="toggle(41);">
                <li class="context-line" id="context-41"><code>      process if @request.parse(data)</code></li>
              </ol>

              
              <ol start="39" class="post-context"
                  id="post-41" onclick="toggle(41);">
                
                <li class="post-context-line"><code>    rescue InvalidRequest =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      log &quot;!! Invalid request&quot;
</code></li>
                
                <li class="post-context-line"><code>      log_error e
</code></li>
                
                <li class="post-context-line"><code>      close_connection
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Called when all data was received and the request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;eventmachine-0.12.10&#x2F;lib&#x2F;eventmachine.rb</code> in
                <code><strong>run_machine</strong></code>
            </li>

            <li class="code system">
              
              <ol start="249"
                  class="pre-context" id="pre-42"
                  onclick="toggle(42);">
                
                <li class="pre-context-line"><code>        @reactor_running = true
</code></li>
                
                <li class="pre-context-line"><code>        initialize_event_machine
</code></li>
                
                <li class="pre-context-line"><code>        (b = blk || block) and add_timer(0, b)
</code></li>
                
                <li class="pre-context-line"><code>        if @next_tick_queue &amp;&amp; !@next_tick_queue.empty?
</code></li>
                
                <li class="pre-context-line"><code>          add_timer(0) { signal_loopbreak }
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        @reactor_thread = Thread.current
</code></li>
                
              </ol>
              

              <ol start="256" class="context" id="42"
                  onclick="toggle(42);">
                <li class="context-line" id="context-42"><code>        run_machine</code></li>
              </ol>

              
              <ol start="257" class="post-context"
                  id="post-42" onclick="toggle(42);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        until @tails.empty?
</code></li>
                
                <li class="post-context-line"><code>          @tails.pop.call
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        begin
</code></li>
                
                <li class="post-context-line"><code>          release_machine
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;eventmachine-0.12.10&#x2F;lib&#x2F;eventmachine.rb</code> in
                <code><strong>run</strong></code>
            </li>

            <li class="code system">
              
              <ol start="249"
                  class="pre-context" id="pre-43"
                  onclick="toggle(43);">
                
                <li class="pre-context-line"><code>        @reactor_running = true
</code></li>
                
                <li class="pre-context-line"><code>        initialize_event_machine
</code></li>
                
                <li class="pre-context-line"><code>        (b = blk || block) and add_timer(0, b)
</code></li>
                
                <li class="pre-context-line"><code>        if @next_tick_queue &amp;&amp; !@next_tick_queue.empty?
</code></li>
                
                <li class="pre-context-line"><code>          add_timer(0) { signal_loopbreak }
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        @reactor_thread = Thread.current
</code></li>
                
              </ol>
              

              <ol start="256" class="context" id="43"
                  onclick="toggle(43);">
                <li class="context-line" id="context-43"><code>        run_machine</code></li>
              </ol>

              
              <ol start="257" class="post-context"
                  id="post-43" onclick="toggle(43);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        until @tails.empty?
</code></li>
                
                <li class="post-context-line"><code>          @tails.pop.call
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        begin
</code></li>
                
                <li class="post-context-line"><code>          release_machine
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;backends&#x2F;base.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="54"
                  class="pre-context" id="pre-44"
                  onclick="toggle(44);">
                
                <li class="pre-context-line"><code>          @running = true
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>        # Allow for early run up of eventmachine.
</code></li>
                
                <li class="pre-context-line"><code>        if EventMachine.reactor_running?
</code></li>
                
                <li class="pre-context-line"><code>          starter.call
</code></li>
                
                <li class="pre-context-line"><code>        else
</code></li>
                
              </ol>
              

              <ol start="61" class="context" id="44"
                  onclick="toggle(44);">
                <li class="context-line" id="context-44"><code>          EventMachine.run(&amp;starter)</code></li>
              </ol>

              
              <ol start="62" class="post-context"
                  id="post-44" onclick="toggle(44);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      # Stop of the backend from accepting new connections.
</code></li>
                
                <li class="post-context-line"><code>      def stop
</code></li>
                
                <li class="post-context-line"><code>        @running  = false
</code></li>
                
                <li class="post-context-line"><code>        @stopping = true
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;server.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="152"
                  class="pre-context" id="pre-45"
                  onclick="toggle(45);">
                
                <li class="pre-context-line"><code>      log   &quot;&gt;&gt; Thin web server (v#{VERSION::STRING} codename #{VERSION::CODENAME})&quot;
</code></li>
                
                <li class="pre-context-line"><code>      debug &quot;&gt;&gt; Debugging ON&quot;
</code></li>
                
                <li class="pre-context-line"><code>      trace &quot;&gt;&gt; Tracing ON&quot;
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
                <li class="pre-context-line"><code>      log &quot;&gt;&gt; Maximum connections set to #{@backend.maximum_connections}&quot;
</code></li>
                
                <li class="pre-context-line"><code>      log &quot;&gt;&gt; Listening on #{@backend}, CTRL+C to stop&quot;
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
              </ol>
              

              <ol start="159" class="context" id="45"
                  onclick="toggle(45);">
                <li class="context-line" id="context-45"><code>      @backend.start</code></li>
              </ol>

              
              <ol start="160" class="post-context"
                  id="post-45" onclick="toggle(45);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>    alias :start! :start
</code></li>
                
                <li class="post-context-line"><code>    
</code></li>
                
                <li class="post-context-line"><code>    # == Gracefull shutdown
</code></li>
                
                <li class="post-context-line"><code>    # Stops the server after processing all current connections.
</code></li>
                
                <li class="post-context-line"><code>    # As soon as this method is called, the server stops accepting
</code></li>
                
                <li class="post-context-line"><code>    # new requests and wait for all current connections to finish.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;controllers&#x2F;controller.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="79"
                  class="pre-context" id="pre-46"
                  onclick="toggle(46);">
                
                <li class="pre-context-line"><code>        # If a stats URL is specified, wrap in Stats adapter
</code></li>
                
                <li class="pre-context-line"><code>        server.app = Stats::Adapter.new(server.app, @options[:stats]) if @options[:stats]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        # Register restart procedure which just start another process with same options,
</code></li>
                
                <li class="pre-context-line"><code>        # so that&#x27;s why this is done here.
</code></li>
                
                <li class="pre-context-line"><code>        server.on_restart { Command.run(:start, @options) }
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="86" class="context" id="46"
                  onclick="toggle(46);">
                <li class="context-line" id="context-46"><code>        server.start</code></li>
              </ol>

              
              <ol start="87" class="post-context"
                  id="post-46" onclick="toggle(46);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    
</code></li>
                
                <li class="post-context-line"><code>      def stop
</code></li>
                
                <li class="post-context-line"><code>        raise OptionRequired, :pid unless @options[:pid]
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>        tail_log(@options[:log]) do
</code></li>
                
                <li class="post-context-line"><code>          if Server.kill(@options[:pid], @options[:force] ? 0 : (@options[:timeout] || 60))
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;runner.rb</code> in
                <code><strong>run_command</strong></code>
            </li>

            <li class="code system">
              
              <ol start="178"
                  class="pre-context" id="pre-47"
                  onclick="toggle(47);">
                
                <li class="pre-context-line"><code>      when cluster? then Controllers::Cluster.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      when service? then Controllers::Service.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      else               Controllers::Controller.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
                <li class="pre-context-line"><code>      if controller.respond_to?(@command)
</code></li>
                
                <li class="pre-context-line"><code>        begin
</code></li>
                
              </ol>
              

              <ol start="185" class="context" id="47"
                  onclick="toggle(47);">
                <li class="context-line" id="context-47"><code>          controller.send(@command, *@arguments)</code></li>
              </ol>

              
              <ol start="186" class="post-context"
                  id="post-47" onclick="toggle(47);">
                
                <li class="post-context-line"><code>        rescue RunnerError =&gt; e
</code></li>
                
                <li class="post-context-line"><code>          abort e.message
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        abort &quot;Invalid options for command: #{@command}&quot;
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;runner.rb</code> in
                <code><strong>run!</strong></code>
            </li>

            <li class="code system">
              
              <ol start="144"
                  class="pre-context" id="pre-48"
                  onclick="toggle(48);">
                
                <li class="pre-context-line"><code>      @arguments = @argv
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>    # Parse the current shell arguments and run the command.
</code></li>
                
                <li class="pre-context-line"><code>    # Exits on error.
</code></li>
                
                <li class="pre-context-line"><code>    def run!
</code></li>
                
                <li class="pre-context-line"><code>      if self.class.commands.include?(@command)
</code></li>
                
              </ol>
              

              <ol start="151" class="context" id="48"
                  onclick="toggle(48);">
                <li class="context-line" id="context-48"><code>        run_command</code></li>
              </ol>

              
              <ol start="152" class="post-context"
                  id="post-48" onclick="toggle(48);">
                
                <li class="post-context-line"><code>      elsif @command.nil?
</code></li>
                
                <li class="post-context-line"><code>        puts &quot;Command required&quot;
</code></li>
                
                <li class="post-context-line"><code>        puts @parser
</code></li>
                
                <li class="post-context-line"><code>        exit 1  
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        abort &quot;Unknown command: #{@command}. Use one of #{self.class.commands.join(&#x27;, &#x27;)}&quot;
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;bin&#x2F;thin</code> in
                <code><strong>&lt;top (required)&gt;</strong></code>
            </li>

            <li class="code system">
              
              <ol start="1"
                  class="pre-context" id="pre-49"
                  onclick="toggle(49);">
                
                <li class="pre-context-line"><code>#!&#x2F;usr&#x2F;bin&#x2F;env ruby
</code></li>
                
                <li class="pre-context-line"><code># Thin command line interface script.
</code></li>
                
                <li class="pre-context-line"><code># Run &lt;tt&gt;thin -h&lt;&#x2F;tt&gt; to get more usage.
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>require &#x27;thin&#x27;
</code></li>
                
              </ol>
              

              <ol start="6" class="context" id="49"
                  onclick="toggle(49);">
                <li class="context-line" id="context-49"><code>Thin::Runner.new(ARGV).run!</code></li>
              </ol>

              
              <ol start="7" class="post-context"
                  id="post-49" onclick="toggle(49);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;bin&#x2F;thin</code> in
                <code><strong>load</strong></code>
            </li>

            <li class="code system">
              
              <ol start="12"
                  class="pre-context" id="pre-50"
                  onclick="toggle(50);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>if ARGV.first =~ &#x2F;^_(.*)_$&#x2F; and Gem::Version.correct? $1 then
</code></li>
                
                <li class="pre-context-line"><code>  version = $1
</code></li>
                
                <li class="pre-context-line"><code>  ARGV.shift
</code></li>
                
                <li class="pre-context-line"><code>end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>gem &#x27;thin&#x27;, version
</code></li>
                
              </ol>
              

              <ol start="19" class="context" id="50"
                  onclick="toggle(50);">
                <li class="context-line" id="context-50"><code>load Gem.bin_path(&#x27;thin&#x27;, &#x27;thin&#x27;, version)</code></li>
              </ol>

              
              <ol start="20" class="post-context"
                  id="post-50" onclick="toggle(50);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;bin&#x2F;thin</code> in
                <code><strong>&lt;main&gt;</strong></code>
            </li>

            <li class="code system">
              
              <ol start="12"
                  class="pre-context" id="pre-51"
                  onclick="toggle(51);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>if ARGV.first =~ &#x2F;^_(.*)_$&#x2F; and Gem::Version.correct? $1 then
</code></li>
                
                <li class="pre-context-line"><code>  version = $1
</code></li>
                
                <li class="pre-context-line"><code>  ARGV.shift
</code></li>
                
                <li class="pre-context-line"><code>end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>gem &#x27;thin&#x27;, version
</code></li>
                
              </ol>
              

              <ol start="19" class="context" id="51"
                  onclick="toggle(51);">
                <li class="context-line" id="context-51"><code>load Gem.bin_path(&#x27;thin&#x27;, &#x27;thin&#x27;, version)</code></li>
              </ol>

              
              <ol start="20" class="post-context"
                  id="post-51" onclick="toggle(51);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      

      </ul>
    </div> <!-- /BACKTRACE -->

    <div id="get">
      <h3 id="get-info">GET</h3>
      
        <table class="req">
          <tr>
            <th>Variable</th>
            <th>Value</th>
          </tr>
           
          <tr>
            <td>delimiter</td>
            <td class="code"><div>&quot;&#x2F;&quot;</div></td>
          </tr>
          
          <tr>
            <td>max-keys</td>
            <td class="code"><div>&quot;1000&quot;</div></td>
          </tr>
          
          <tr>
            <td>prefix</td>
            <td class="code"><div>nil</div></td>
          </tr>
          
        </table>
      
      <div class="clear"></div>
    </div> <!-- /GET -->

    <div id="post">
      <h3 id="post-info">POST</h3>
      
        <p class="no-data">No POST data.</p>
      
      <div class="clear"></div>
    </div> <!-- /POST -->

    <div id="cookies">
      <h3 id="cookie-info">COOKIES</h3>
      
        <p class="no-data">No cookie data.</p>
      
      <div class="clear"></div>
    </div> <!-- /COOKIES -->

    <div id="rack">
      <h3 id="env-info">Rack ENV</h3>
      <table class="req">
        <tr>
          <th>Variable</th>
          <th>Value</th>
        </tr>
         
         <tr>
           <td>CONTENT_TYPE</td>
           <td class="code"><div></div></td>
         </tr>
         
         <tr>
           <td>GATEWAY_INTERFACE</td>
           <td class="code"><div>CGI&#x2F;1.2</div></td>
         </tr>
         
         <tr>
           <td>HTTP_ACCEPT_ENCODING</td>
           <td class="code"><div>gzip,deflate</div></td>
         </tr>
         
         <tr>
           <td>HTTP_AUTHORIZATION</td>
           <td class="code"><div>AWS 0PN5J17HBGZHT7JJ3X82:dIZzkhNOFaed4yLgvqr&#x2F;kQtXeVA=</div></td>
         </tr>
         
         <tr>
           <td>HTTP_CONNECTION</td>
           <td class="code"><div>close</div></td>
         </tr>
         
         <tr>
           <td>HTTP_DATE</td>
           <td class="code"><div>Mon, 28 Nov 2011 00:33:34 GMT</div></td>
         </tr>
         
         <tr>
           <td>HTTP_HOST</td>
           <td class="code"><div>localhost</div></td>
         </tr>
         
         <tr>
           <td>HTTP_USER_AGENT</td>
           <td class="code"><div>Cyberduck&#x2F;4.1.2 (Mac OS X&#x2F;10.6.8) (i386)</div></td>
         </tr>
         
         <tr>
           <td>HTTP_VERSION</td>
           <td class="code"><div>HTTP&#x2F;1.0</div></td>
         </tr>
         
         <tr>
           <td>HTTP_X_FORWARDED_FOR</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>HTTP_X_REAL_IP</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>PATH_INFO</td>
           <td class="code"><div>&#x2F;mocky&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>QUERY_STRING</td>
           <td class="code"><div>delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>REMOTE_ADDR</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_METHOD</td>
           <td class="code"><div>GET</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_PATH</td>
           <td class="code"><div>&#x2F;mocky&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_URI</td>
           <td class="code"><div>&#x2F;mocky&#x2F;?delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>SCRIPT_NAME</td>
           <td class="code"><div></div></td>
         </tr>
         
         <tr>
           <td>SERVER_NAME</td>
           <td class="code"><div>localhost</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PORT</td>
           <td class="code"><div>80</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PROTOCOL</td>
           <td class="code"><div>HTTP&#x2F;1.1</div></td>
         </tr>
         
         <tr>
           <td>SERVER_SOFTWARE</td>
           <td class="code"><div>thin 1.3.1 codename Triple Espresso</div></td>
         </tr>
         
         <tr>
           <td>async.callback</td>
           <td class="code"><div>#&lt;Method: Thin::Connection#post_process&gt;</div></td>
         </tr>
         
         <tr>
           <td>async.close</td>
           <td class="code"><div>#&lt;EventMachine::DefaultDeferrable:0x00000103052810&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.errors</td>
           <td class="code"><div>#&lt;Object:0x000001011cb860&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.input</td>
           <td class="code"><div>#&lt;Rack::Lint::InputWrapper:0x00000103043a68 @input=#&lt;StringIO:0x00000103052f68&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.logger</td>
           <td class="code"><div>#&lt;Rack::NullLogger:0x000001030b3110 @app=#&lt;Rack::Protection::FrameOptions:0x000001030b31d8 @app=#&lt;Rack::Protection::IPSpoofing:0x000001030b3250 @app=#&lt;Rack::Protection::JsonCsrf:0x000001030b32c8 @app=#&lt;Rack::Protection::PathTraversal:0x000001030b3340 @app=#&lt;Rack::Protection::XSSHeader:0x000001030b33e0 @app=#&lt;Smoke::Server::App:0x00000100fae8e8 @default_layout=:layout, @app=nil, @template_cache=#&lt;Tilt::Cache:0x00000100fae8c0 @cache={}&gt;&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :xss_mode=&gt;:block, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :xss_mode=&gt;:block, :frame_options=&gt;:sameorigin, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.multiprocess</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.multithread</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.request.cookie_hash</td>
           <td class="code"><div>{}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_hash</td>
           <td class="code"><div>{&quot;delimiter&quot;=&gt;&quot;&#x2F;&quot;, &quot;max-keys&quot;=&gt;&quot;1000&quot;, &quot;prefix&quot;=&gt;nil}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_string</td>
           <td class="code"><div>delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>rack.run_once</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.url_scheme</td>
           <td class="code"><div>http</div></td>
         </tr>
         
         <tr>
           <td>rack.version</td>
           <td class="code"><div>[1, 0]</div></td>
         </tr>
         
         <tr>
           <td>sinatra.error</td>
           <td class="code"><div>#&lt;ArgumentError: comparison of Fixnum with String failed&gt;</div></td>
         </tr>
         
         <tr>
           <td>smoke.access_id</td>
           <td class="code"><div>0PN5J17HBGZHT7JJ3X82</div></td>
         </tr>
         
         <tr>
           <td>smoke.amz_headers</td>
           <td class="code"><div>{}</div></td>
         </tr>
         
         <tr>
           <td>smoke.bucket</td>
           <td class="code"><div>mocky</div></td>
         </tr>
         
         <tr>
           <td>smoke.path</td>
           <td class="code"><div>&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>smoke.request_id</td>
           <td class="code"><div>7C7349A5F5B9076FEF9F976D76EE13F4</div></td>
         </tr>
         
         <tr>
           <td>smoke.request_token</td>
           <td class="code"><div>KTPDG3DOPqmJjae0hw4jTZ06Io8HSw96OOi01reUKeCwCEAp</div></td>
         </tr>
         
         <tr>
           <td>smoke.resource_headers</td>
           <td class="code"><div>{&quot;version&quot;=&gt;&quot;HTTP&#x2F;1.0&quot;, &quot;x-real-ip&quot;=&gt;&quot;127.0.0.1&quot;, &quot;host&quot;=&gt;&quot;localhost&quot;, &quot;x-forwarded-for&quot;=&gt;&quot;127.0.0.1&quot;, &quot;connection&quot;=&gt;&quot;close&quot;, &quot;date&quot;=&gt;&quot;Mon, 28 Nov 2011 00:33:34 GMT&quot;, &quot;authorization&quot;=&gt;&quot;AWS 0PN5J17HBGZHT7JJ3X82:dIZzkhNOFaed4yLgvqr&#x2F;kQtXeVA=&quot;, &quot;user-agent&quot;=&gt;&quot;Cyberduck&#x2F;4.1.2 (Mac OS X&#x2F;10.6.8) (i386)&quot;, &quot;accept-encoding&quot;=&gt;&quot;gzip,deflate&quot;}</div></td>
         </tr>
         
         <tr>
           <td>smoke.user</td>
           <td class="code"><div>#&lt;Smoke::Server::User id: 1, username: &quot;mocky&quot;, access_id: &quot;0PN5J17HBGZHT7JJ3X82&quot;, secret_key: &quot;uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o&quot;, display_name: &quot;Mocky User&quot;, email: &quot;mocky@dev.null.com&quot;, max_buckets: 1, expires_at: 1324785151, is_active: true, role: &quot;admin&quot;, enc_password: nil, created_at: &quot;2011-11-26 19:52:31&quot;, updated_at: &quot;2011-11-26 19:52:31&quot;&gt;</div></td>
         </tr>
         
      </table>
      <div class="clear"></div>
    </div> <!-- /RACK ENV -->

    <p id="explanation">You're seeing this error because you have
enabled the <code>show_exceptions</code> setting.</p>
  </div> <!-- /WRAP -->
  </body>
</html>
GET /mocky/?delimiter=%2F&max-keys=1000&prefix HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:33:36 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:r9u8+PGRNTHJ4MPrSmkgMfswaQA=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100e8fe08
   @input=#<StringIO:0x00000100eb3dd0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100e8fd90
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"delimiter=%2F&max-keys=1000&prefix",
 "REQUEST_URI"=>"/mocky/?delimiter=%2F&max-keys=1000&prefix",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:33:36 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:r9u8+PGRNTHJ4MPrSmkgMfswaQA=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100eb3628>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:33:36 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:r9u8+PGRNTHJ4MPrSmkgMfswaQA=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"0877321C4BD486306C4B37FE66152C91",
 "smoke.request_token"=>"GObzcSqD7njGXjnvASnp6ZfyqcOYa8Mx8qW8F8wOhhFnh0co"}
StringToSign: GET


Mon, 28 Nov 2011 00:33:36 GMT
/mocky/
ArgumentError - comparison of Fixnum with String failed:
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/bucket.rb:127:in `>'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/bucket.rb:127:in `find_filtered_assets'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/app.rb:78:in `block in <class:App>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1211:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1211:in `block in compile!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `[]'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `block (3 levels) in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:788:in `route_eval'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:772:in `block (2 levels) in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:821:in `block in process_route'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:819:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:819:in `process_route'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:771:in `block in route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:770:in `each'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:770:in `route!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:886:in `dispatch!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:706:in `block in call!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `block in invoke'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:871:in `invoke'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:706:in `call!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:692:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/path_traversal.rb:16:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/json_csrf.rb:17:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/base.rb:47:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/nulllogger.rb:9:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/head.rb:9:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/showexceptions.rb:21:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `block in call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1403:in `synchronize'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `call'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:21:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'
HTTP/1.1 500 Internal Server Error
Content-Type: text/html
Content-Length: 145876
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>ArgumentError at &#x2F;mocky&#x2F;</title>

  <script type="text/javascript">
  //<!--
  function toggle(id) {
    var pre  = document.getElementById("pre-" + id);
    var post = document.getElementById("post-" + id);
    var context = document.getElementById("context-" + id);

    if (pre.style.display == 'block') {
      pre.style.display = 'none';
      post.style.display = 'none';
      context.style.background = "none";
    } else {
      pre.style.display = 'block';
      post.style.display = 'block';
      context.style.background = "#fffed9";
    }
  }

  function toggleBacktrace(){
    var bt = document.getElementById("backtrace");
    var toggler = document.getElementById("expando");

    if (bt.className == 'condensed') {
      bt.className = 'expanded';
      toggler.innerHTML = "(condense)";
    } else {
      bt.className = 'condensed';
      toggler.innerHTML = "(expand)";
    }
  }
  //-->
  </script>

<style type="text/css" media="screen">
  *                   {margin: 0; padding: 0; border: 0; outline: 0;}
  div.clear           {clear: both;}
  body                {background: #EEEEEE; margin: 0; padding: 0;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode',
                       'Garuda';}
  code                {font-family: 'Lucida Console', monospace;
                       font-size: 12px;}
  li                  {height: 18px;}
  ul                  {list-style: none; margin: 0; padding: 0;}
  ol:hover            {cursor: pointer;}
  ol li               {white-space: pre;}
  #explanation        {font-size: 12px; color: #666666;
                       margin: 20px 0 0 100px;}
/* WRAP */
  #wrap               {width: 1000px; background: #FFFFFF; margin: 0 auto;
                       padding: 30px 50px 20px 50px;
                       border-left: 1px solid #DDDDDD;
                       border-right: 1px solid #DDDDDD;}
/* HEADER */
  #header             {margin: 0 auto 25px auto;}
  #header img         {float: left;}
  #header #summary    {float: left; margin: 12px 0 0 20px; width:660px;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode';}
  h1                  {margin: 0; font-size: 36px; color: #981919;}
  h2                  {margin: 0; font-size: 22px; color: #333333;}
  #header ul          {margin: 0; font-size: 12px; color: #666666;}
  #header ul li strong{color: #444444;}
  #header ul li       {display: inline; padding: 0 10px;}
  #header ul li.first {padding-left: 0;}
  #header ul li.last  {border: 0; padding-right: 0;}
/* BODY */
  #backtrace,
  #get,
  #post,
  #cookies,
  #rack               {width: 980px; margin: 0 auto 10px auto;}
  p#nav               {float: right; font-size: 14px;}
/* BACKTRACE */
  a#expando           {float: left; padding-left: 5px; color: #666666;
                      font-size: 14px; text-decoration: none; cursor: pointer;}
  a#expando:hover     {text-decoration: underline;}
  h3                  {float: left; width: 100px; margin-bottom: 10px;
                       color: #981919; font-size: 14px; font-weight: bold;}
  #nav a              {color: #666666; text-decoration: none; padding: 0 5px;}
  #backtrace li.frame-info {background: #f7f7f7; padding-left: 10px;
                           font-size: 12px; color: #333333;}
  #backtrace ul       {list-style-position: outside; border: 1px solid #E9E9E9;
                       border-bottom: 0;}
  #backtrace ol       {width: 920px; margin-left: 50px;
                       font: 10px 'Lucida Console', monospace; color: #666666;}
  #backtrace ol li    {border: 0; border-left: 1px solid #E9E9E9;
                       padding: 2px 0;}
  #backtrace ol code  {font-size: 10px; color: #555555; padding-left: 5px;}
  #backtrace-ul li    {border-bottom: 1px solid #E9E9E9; height: auto;
                       padding: 3px 0;}
  #backtrace-ul .code {padding: 6px 0 4px 0;}
  #backtrace.condensed .system,
  #backtrace.condensed .framework {display:none;}
/* REQUEST DATA */
  p.no-data           {padding-top: 2px; font-size: 12px; color: #666666;}
  table.req           {width: 980px; text-align: left; font-size: 12px;
                       color: #666666; padding: 0; border-spacing: 0;
                       border: 1px solid #EEEEEE; border-bottom: 0;
                       border-left: 0;
                       clear:both}
  table.req tr th     {padding: 2px 10px; font-weight: bold;
                       background: #F7F7F7; border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
  table.req tr td     {padding: 2px 20px 2px 10px;
                       border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
/* HIDE PRE/POST CODE AT START */
  .pre-context,
  .post-context       {display: none;}

  table td.code       {width:750px}
  table td.code div   {width:750px;overflow:hidden}
</style>
</head>
<body>
  <div id="wrap">
    <div id="header">
      <img src="/__sinatra__/500.png" alt="application error" height="161" width="313" />
      <div id="summary">
        <h1><strong>ArgumentError</strong> at <strong>&#x2F;mocky&#x2F;
          </strong></h1>
        <h2>comparison of Fixnum with String failed</h2>
        <ul>
          <li class="first"><strong>file:</strong> <code>
            bucket.rb</code></li>
          <li><strong>location:</strong> <code>&gt;
            </code></li>
          <li class="last"><strong>line:
            </strong> 127</li>
        </ul>
      </div>
      <div class="clear"></div>
    </div>

    <div id="backtrace" class='condensed'>
      <h3>BACKTRACE</h3>
      <p><a href="#" id="expando"
            onclick="toggleBacktrace(); return false">(expand)</a></p>
      <p id="nav"><strong>JUMP TO:</strong>
         <a href="#get-info">GET</a>
         <a href="#post-info">POST</a>
         <a href="#cookie-info">COOKIES</a>
         <a href="#env-info">ENV</a>
      </p>
      <div class="clear"></div>

      <ul id="backtrace-ul">

      
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;bucket.rb</code> in
                <code><strong>&gt;</strong></code>
            </li>

            <li class="code app">
              
              <ol start="120"
                  class="pre-context" id="pre-1"
                  onclick="toggle(1);">
                
                <li class="pre-context-line"><code>          asset_list = asset_list.inject([]) do |arr,asset|
</code></li>
                
                <li class="pre-context-line"><code>            base = asset.basename(delimiter,prefix)
</code></li>
                
                <li class="pre-context-line"><code>            arr &lt;&lt; asset if !base.nil? &amp;&amp; base &gt; marker
</code></li>
                
                <li class="pre-context-line"><code>            arr
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
              </ol>
              

              <ol start="127" class="context" id="1"
                  onclick="toggle(1);">
                <li class="context-line" id="context-1"><code>        self.truncated = true if asset_list.length &gt; max_keys</code></li>
              </ol>

              
              <ol start="128" class="post-context"
                  id="post-1" onclick="toggle(1);">
                
                <li class="post-context-line"><code>        asset_list = asset_list[0..max_keys]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      class &lt;&lt; self
</code></li>
                
                <li class="post-context-line"><code>        def find_all_through_acl(user)
</code></li>
                
                <li class="post-context-line"><code>          acls = Acl.where(:user_id =&gt; user.id)
</code></li>
                
                <li class="post-context-line"><code>          acls.map { |acl| acl.bucket }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;bucket.rb</code> in
                <code><strong>find_filtered_assets</strong></code>
            </li>

            <li class="code app">
              
              <ol start="120"
                  class="pre-context" id="pre-2"
                  onclick="toggle(2);">
                
                <li class="pre-context-line"><code>          asset_list = asset_list.inject([]) do |arr,asset|
</code></li>
                
                <li class="pre-context-line"><code>            base = asset.basename(delimiter,prefix)
</code></li>
                
                <li class="pre-context-line"><code>            arr &lt;&lt; asset if !base.nil? &amp;&amp; base &gt; marker
</code></li>
                
                <li class="pre-context-line"><code>            arr
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
              </ol>
              

              <ol start="127" class="context" id="2"
                  onclick="toggle(2);">
                <li class="context-line" id="context-2"><code>        self.truncated = true if asset_list.length &gt; max_keys</code></li>
              </ol>

              
              <ol start="128" class="post-context"
                  id="post-2" onclick="toggle(2);">
                
                <li class="post-context-line"><code>        asset_list = asset_list[0..max_keys]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      class &lt;&lt; self
</code></li>
                
                <li class="post-context-line"><code>        def find_all_through_acl(user)
</code></li>
                
                <li class="post-context-line"><code>          acls = Acl.where(:user_id =&gt; user.id)
</code></li>
                
                <li class="post-context-line"><code>          acls.map { |acl| acl.bucket }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;app.rb</code> in
                <code><strong>block in &lt;class:App&gt;</strong></code>
            </li>

            <li class="code app">
              
              <ol start="71"
                  class="pre-context" id="pre-3"
                  onclick="toggle(3);">
                
                <li class="pre-context-line"><code>          @max_keys = params.has_key?(&#x27;max-keys&#x27;) ? params[&#x27;max-keys&#x27;] : SMOKE_CONFIG[&#x27;default_max_keys&#x27;]
</code></li>
                
                <li class="pre-context-line"><code>          @prefix = params.has_key?(&#x27;prefix&#x27;) ? params[&#x27;prefix&#x27;] : nil
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>          unless @delimited
</code></li>
                
                <li class="pre-context-line"><code>            @assets = @bucket.assets
</code></li>
                
                <li class="pre-context-line"><code>            @common_prefixes = []
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="3"
                  onclick="toggle(3);">
                <li class="context-line" id="context-3"><code>            @assets = @bucket.find_filtered_assets :prefix =&gt; @prefix, :max_keys =&gt; @max_keys</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-3" onclick="toggle(3);">
                
                <li class="post-context-line"><code>            @common_prefixes = @bucket.common_prefixes :prefix =&gt; @prefix, :delimiter =&gt; params[&#x27;delimiter&#x27;]
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>          
</code></li>
                
                <li class="post-context-line"><code>          erb :get_bucket
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1204"
                  class="pre-context" id="pre-4"
                  onclick="toggle(4);">
                
                <li class="pre-context-line"><code>        options.each_pair { |option, args| send(option, *args) }
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        pattern, keys           = compile path
</code></li>
                
                <li class="pre-context-line"><code>        conditions, @conditions = @conditions, []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        [ pattern, keys, conditions, block.arity != 0 ?
</code></li>
                
              </ol>
              

              <ol start="1211" class="context" id="4"
                  onclick="toggle(4);">
                <li class="context-line" id="context-4"><code>            proc { |a,p| unbound_method.bind(a).call(*p) } :</code></li>
              </ol>

              
              <ol start="1212" class="post-context"
                  id="post-4" onclick="toggle(4);">
                
                <li class="post-context-line"><code>            proc { |a,p| unbound_method.bind(a).call } ]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path)
</code></li>
                
                <li class="post-context-line"><code>        keys = []
</code></li>
                
                <li class="post-context-line"><code>        if path.respond_to? :to_str
</code></li>
                
                <li class="post-context-line"><code>          pattern = path.to_str.gsub(&#x2F;[^\?\%\\\&#x2F;\:\*\w]&#x2F;) { |c| encoded(c) }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in compile!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1204"
                  class="pre-context" id="pre-5"
                  onclick="toggle(5);">
                
                <li class="pre-context-line"><code>        options.each_pair { |option, args| send(option, *args) }
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        pattern, keys           = compile path
</code></li>
                
                <li class="pre-context-line"><code>        conditions, @conditions = @conditions, []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        [ pattern, keys, conditions, block.arity != 0 ?
</code></li>
                
              </ol>
              

              <ol start="1211" class="context" id="5"
                  onclick="toggle(5);">
                <li class="context-line" id="context-5"><code>            proc { |a,p| unbound_method.bind(a).call(*p) } :</code></li>
              </ol>

              
              <ol start="1212" class="post-context"
                  id="post-5" onclick="toggle(5);">
                
                <li class="post-context-line"><code>            proc { |a,p| unbound_method.bind(a).call } ]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path)
</code></li>
                
                <li class="post-context-line"><code>        keys = []
</code></li>
                
                <li class="post-context-line"><code>        if path.respond_to? :to_str
</code></li>
                
                <li class="post-context-line"><code>          pattern = path.to_str.gsub(&#x2F;[^\?\%\\\&#x2F;\:\*\w]&#x2F;) { |c| encoded(c) }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>[]</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-6"
                  onclick="toggle(6);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="6"
                  onclick="toggle(6);">
                <li class="context-line" id="context-6"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-6" onclick="toggle(6);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (3 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-7"
                  onclick="toggle(7);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="7"
                  onclick="toggle(7);">
                <li class="context-line" id="context-7"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-7" onclick="toggle(7);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route_eval</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="781"
                  class="pre-context" id="pre-8"
                  onclick="toggle(8);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      route_eval(&amp;pass_block) if pass_block
</code></li>
                
                <li class="pre-context-line"><code>      route_missing
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run a route block and throw :halt with the result.
</code></li>
                
                <li class="pre-context-line"><code>    def route_eval
</code></li>
                
              </ol>
              

              <ol start="788" class="context" id="8"
                  onclick="toggle(8);">
                <li class="context-line" id="context-8"><code>      throw :halt, yield</code></li>
              </ol>

              
              <ol start="789" class="post-context"
                  id="post-8" onclick="toggle(8);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # If the current request matches pattern and conditions, fill params
</code></li>
                
                <li class="post-context-line"><code>    # with keys and call the given block.
</code></li>
                
                <li class="post-context-line"><code>    # Revert params afterwards.
</code></li>
                
                <li class="post-context-line"><code>    #
</code></li>
                
                <li class="post-context-line"><code>    # Returns pass block.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (2 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="765"
                  class="pre-context" id="pre-9"
                  onclick="toggle(9);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
              </ol>
              

              <ol start="772" class="context" id="9"
                  onclick="toggle(9);">
                <li class="context-line" id="context-9"><code>            route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="773" class="post-context"
                  id="post-9" onclick="toggle(9);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
                <li class="post-context-line"><code>        return route!(base.superclass, pass_block)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="814"
                  class="pre-context" id="pre-10"
                  onclick="toggle(10);">
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
                <li class="pre-context-line"><code>        catch(:pass) do
</code></li>
                
                <li class="pre-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
              </ol>
              

              <ol start="821" class="context" id="10"
                  onclick="toggle(10);">
                <li class="context-line" id="context-10"><code>          block ? block[self, @block_params] : yield(self, @block_params)</code></li>
              </ol>

              
              <ol start="822" class="post-context"
                  id="post-10" onclick="toggle(10);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # No matching route was found or all routes passed. The default
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="812"
                  class="pre-context" id="pre-11"
                  onclick="toggle(11);">
                
                <li class="pre-context-line"><code>          elsif values.any?
</code></li>
                
                <li class="pre-context-line"><code>            {&#x27;captures&#x27; =&gt; values}
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
              </ol>
              

              <ol start="819" class="context" id="11"
                  onclick="toggle(11);">
                <li class="context-line" id="context-11"><code>        catch(:pass) do</code></li>
              </ol>

              
              <ol start="820" class="post-context"
                  id="post-11" onclick="toggle(11);">
                
                <li class="post-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>          block ? block[self, @block_params] : yield(self, @block_params)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="812"
                  class="pre-context" id="pre-12"
                  onclick="toggle(12);">
                
                <li class="pre-context-line"><code>          elsif values.any?
</code></li>
                
                <li class="pre-context-line"><code>            {&#x27;captures&#x27; =&gt; values}
</code></li>
                
                <li class="pre-context-line"><code>          else
</code></li>
                
                <li class="pre-context-line"><code>            {}
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>        @params = @original_params.merge(params)
</code></li>
                
                <li class="pre-context-line"><code>        @block_params = values
</code></li>
                
              </ol>
              

              <ol start="819" class="context" id="12"
                  onclick="toggle(12);">
                <li class="context-line" id="context-12"><code>        catch(:pass) do</code></li>
              </ol>

              
              <ol start="820" class="post-context"
                  id="post-12" onclick="toggle(12);">
                
                <li class="post-context-line"><code>          conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>          block ? block[self, @block_params] : yield(self, @block_params)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @params = @original_params
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="764"
                  class="pre-context" id="pre-13"
                  onclick="toggle(13);">
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>        routes.each do |pattern, keys, conditions, block|
</code></li>
                
              </ol>
              

              <ol start="771" class="context" id="13"
                  onclick="toggle(13);">
                <li class="context-line" id="context-13"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|</code></li>
              </ol>

              
              <ol start="772" class="post-context"
                  id="post-13" onclick="toggle(13);">
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
                <li class="post-context-line"><code>      if base.superclass.respond_to?(:routes)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>each</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="763"
                  class="pre-context" id="pre-14"
                  onclick="toggle(14);">
                
                <li class="pre-context-line"><code>      filter! type, base.superclass if base.superclass.respond_to?(:filters)
</code></li>
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
              </ol>
              

              <ol start="770" class="context" id="14"
                  onclick="toggle(14);">
                <li class="context-line" id="context-14"><code>        routes.each do |pattern, keys, conditions, block|</code></li>
              </ol>

              
              <ol start="771" class="post-context"
                  id="post-14" onclick="toggle(14);">
                
                <li class="post-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="763"
                  class="pre-context" id="pre-15"
                  onclick="toggle(15);">
                
                <li class="pre-context-line"><code>      filter! type, base.superclass if base.superclass.respond_to?(:filters)
</code></li>
                
                <li class="pre-context-line"><code>      base.filters[type].each { |args| process_route(*args) }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block=nil)
</code></li>
                
                <li class="pre-context-line"><code>      if routes = base.routes[@request.request_method]
</code></li>
                
              </ol>
              

              <ol start="770" class="context" id="15"
                  onclick="toggle(15);">
                <li class="context-line" id="context-15"><code>        routes.each do |pattern, keys, conditions, block|</code></li>
              </ol>

              
              <ol start="771" class="post-context"
                  id="post-15" onclick="toggle(15);">
                
                <li class="post-context-line"><code>          pass_block = process_route(pattern, keys, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>            route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>dispatch!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="879"
                  class="pre-context" id="pre-16"
                  onclick="toggle(16);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Dispatch a request with error handling.
</code></li>
                
                <li class="pre-context-line"><code>    def dispatch!
</code></li>
                
                <li class="pre-context-line"><code>      static! if settings.static? &amp;&amp; (request.get? || request.head?)
</code></li>
                
                <li class="pre-context-line"><code>      filter! :before
</code></li>
                
              </ol>
              

              <ol start="886" class="context" id="16"
                  onclick="toggle(16);">
                <li class="context-line" id="context-16"><code>      route!</code></li>
              </ol>

              
              <ol start="887" class="post-context"
                  id="post-16" onclick="toggle(16);">
                
                <li class="post-context-line"><code>    rescue ::Exception =&gt; boom
</code></li>
                
                <li class="post-context-line"><code>      handle_exception!(boom)
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      filter! :after unless env[&#x27;sinatra.static_file&#x27;]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Error handling during requests.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="699"
                  class="pre-context" id="pre-17"
                  onclick="toggle(17);">
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @params   = indifferent_params(@request.params)
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>      force_encoding(@params)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @response[&#x27;Content-Type&#x27;] = nil
</code></li>
                
              </ol>
              

              <ol start="706" class="context" id="17"
                  onclick="toggle(17);">
                <li class="context-line" id="context-17"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="707" class="post-context"
                  id="post-17" onclick="toggle(17);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) }
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body and body[0].respond_to? :content_type
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          content_type :html
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-18"
                  onclick="toggle(18);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="18"
                  onclick="toggle(18);">
                <li class="context-line" id="context-18"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-18" onclick="toggle(18);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-19"
                  onclick="toggle(19);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="19"
                  onclick="toggle(19);">
                <li class="context-line" id="context-19"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-19" onclick="toggle(19);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="864"
                  class="pre-context" id="pre-20"
                  onclick="toggle(20);">
                
                <li class="pre-context-line"><code>    # Creates a Hash with indifferent access.
</code></li>
                
                <li class="pre-context-line"><code>    def indifferent_hash
</code></li>
                
                <li class="pre-context-line"><code>      Hash.new {|hash,key| hash[key.to_s] if Symbol === key }
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke
</code></li>
                
              </ol>
              

              <ol start="871" class="context" id="20"
                  onclick="toggle(20);">
                <li class="context-line" id="context-20"><code>      res = catch(:halt) { yield }</code></li>
              </ol>

              
              <ol start="872" class="post-context"
                  id="post-20" onclick="toggle(20);">
                
                <li class="post-context-line"><code>      res = [res] if Fixnum === res or String === res
</code></li>
                
                <li class="post-context-line"><code>      if Array === res and Fixnum === res.first
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
                <li class="post-context-line"><code>      elsif res.respond_to? :each
</code></li>
                
                <li class="post-context-line"><code>        body res
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="699"
                  class="pre-context" id="pre-21"
                  onclick="toggle(21);">
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @params   = indifferent_params(@request.params)
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>      force_encoding(@params)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @response[&#x27;Content-Type&#x27;] = nil
</code></li>
                
              </ol>
              

              <ol start="706" class="context" id="21"
                  onclick="toggle(21);">
                <li class="context-line" id="context-21"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="707" class="post-context"
                  id="post-21" onclick="toggle(21);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) }
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body and body[0].respond_to? :content_type
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          content_type :html
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="685"
                  class="pre-context" id="pre-22"
                  onclick="toggle(22);">
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>      @template_cache = Tilt::Cache.new
</code></li>
                
                <li class="pre-context-line"><code>      yield self if block_given?
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Rack call interface.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="692" class="context" id="22"
                  onclick="toggle(22);">
                <li class="context-line" id="context-22"><code>      dup.call!(env)</code></li>
              </ol>

              
              <ol start="693" class="post-context"
                  id="post-22" onclick="toggle(22);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    attr_accessor :env, :request, :response, :params
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def call!(env) # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>      @env      = env
</code></li>
                
                <li class="post-context-line"><code>      @request  = Request.new(env)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;xss_header.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="15"
                  class="pre-context" id="pre-23"
                  onclick="toggle(23);">
                
                <li class="pre-context-line"><code>      default_options :xss_mode =&gt; :block
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def header
</code></li>
                
                <li class="pre-context-line"><code>        { &#x27;X-XSS-Protection&#x27; =&gt; &quot;1; mode=#{options[:xss_mode]}&quot; }
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="22" class="context" id="23"
                  onclick="toggle(23);">
                <li class="context-line" id="context-23"><code>        status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="23" class="post-context"
                  id="post-23" onclick="toggle(23);">
                
                <li class="post-context-line"><code>        [status, header.merge(headers), body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;path_traversal.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="9"
                  class="pre-context" id="pre-24"
                  onclick="toggle(24);">
                
                <li class="pre-context-line"><code>    #
</code></li>
                
                <li class="pre-context-line"><code>    # Unescapes &#x27;&#x2F;&#x27; and &#x27;.&#x27;, expands +path_info+.
</code></li>
                
                <li class="pre-context-line"><code>    # Thus &lt;tt&gt;GET &#x2F;foo&#x2F;%2e%2e%2fbar&lt;&#x2F;tt&gt; becomes &lt;tt&gt;GET &#x2F;bar&lt;&#x2F;tt&gt;.
</code></li>
                
                <li class="pre-context-line"><code>    class PathTraversal &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        path_was         = env[&quot;PATH_INFO&quot;]
</code></li>
                
                <li class="pre-context-line"><code>        env[&quot;PATH_INFO&quot;] = cleanup path_was if path_was
</code></li>
                
              </ol>
              

              <ol start="16" class="context" id="24"
                  onclick="toggle(24);">
                <li class="context-line" id="context-24"><code>        app.call env</code></li>
              </ol>

              
              <ol start="17" class="post-context"
                  id="post-24" onclick="toggle(24);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        env[&quot;PATH_INFO&quot;] = path_was
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def cleanup(path)
</code></li>
                
                <li class="post-context-line"><code>        parts     = []
</code></li>
                
                <li class="post-context-line"><code>        unescaped = path.gsub(&#x27;%2e&#x27;, &#x27;.&#x27;).gsub(&#x27;%2f&#x27;, &#x27;&#x2F;&#x27;)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;json_csrf.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="10"
                  class="pre-context" id="pre-25"
                  onclick="toggle(25);">
                
                <li class="pre-context-line"><code>    # JSON GET APIs are vulnerable to being embedded as JavaScript while the
</code></li>
                
                <li class="pre-context-line"><code>    # Array prototype has been patched to track data. Checks the referrer
</code></li>
                
                <li class="pre-context-line"><code>    # even on GET requests if the content type is JSON.
</code></li>
                
                <li class="pre-context-line"><code>    class JsonCsrf &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      default_reaction :deny
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="17" class="context" id="25"
                  onclick="toggle(25);">
                <li class="context-line" id="context-25"><code>        status, headers, body = app.call(env)</code></li>
              </ol>

              
              <ol start="18" class="post-context"
                  id="post-25" onclick="toggle(25);">
                
                <li class="post-context-line"><code>        if headers[&#x27;Content-Type&#x27;].to_s.split(&#x27;;&#x27;, 2).first =~ &#x2F;^\s*application\&#x2F;json\s*$&#x2F;
</code></li>
                
                <li class="post-context-line"><code>          result = react(env) if referrer(env) != Request.new(env).host
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>        result or [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="40"
                  class="pre-context" id="pre-26"
                  onclick="toggle(26);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          warn env, &quot;attack prevented by #{self.class}&quot;
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="47" class="context" id="26"
                  onclick="toggle(26);">
                <li class="context-line" id="context-26"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="48" class="post-context"
                  id="post-26" onclick="toggle(26);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if Array === result and result.size == 3
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-protection-1.1.4&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;xss_header.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="15"
                  class="pre-context" id="pre-27"
                  onclick="toggle(27);">
                
                <li class="pre-context-line"><code>      default_options :xss_mode =&gt; :block
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def header
</code></li>
                
                <li class="pre-context-line"><code>        { &#x27;X-XSS-Protection&#x27; =&gt; &quot;1; mode=#{options[:xss_mode]}&quot; }
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="22" class="context" id="27"
                  onclick="toggle(27);">
                <li class="context-line" id="context-27"><code>        status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="23" class="post-context"
                  id="post-27" onclick="toggle(27);">
                
                <li class="post-context-line"><code>        [status, header.merge(headers), body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;nulllogger.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="2"
                  class="pre-context" id="pre-28"
                  onclick="toggle(28);">
                
                <li class="pre-context-line"><code>  class NullLogger
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.logger&#x27;] = self
</code></li>
                
              </ol>
              

              <ol start="9" class="context" id="28"
                  onclick="toggle(28);">
                <li class="context-line" id="context-28"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="10" class="post-context"
                  id="post-28" onclick="toggle(28);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def info(progname = nil, &amp;block);  end
</code></li>
                
                <li class="post-context-line"><code>    def debug(progname = nil, &amp;block); end
</code></li>
                
                <li class="post-context-line"><code>    def warn(progname = nil, &amp;block);  end
</code></li>
                
                <li class="post-context-line"><code>    def error(progname = nil, &amp;block); end
</code></li>
                
                <li class="post-context-line"><code>    def fatal(progname = nil, &amp;block); end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;head.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="2"
                  class="pre-context" id="pre-29"
                  onclick="toggle(29);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>class Head
</code></li>
                
                <li class="pre-context-line"><code>  def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>    @app = app
</code></li>
                
                <li class="pre-context-line"><code>  end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>  def call(env)
</code></li>
                
              </ol>
              

              <ol start="9" class="context" id="29"
                  onclick="toggle(29);">
                <li class="context-line" id="context-29"><code>    status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="10" class="post-context"
                  id="post-29" onclick="toggle(29);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    if env[&quot;REQUEST_METHOD&quot;] == &quot;HEAD&quot;
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, []]
</code></li>
                
                <li class="post-context-line"><code>    else
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;showexceptions.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="14"
                  class="pre-context" id="pre-30"
                  onclick="toggle(30);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app      = app
</code></li>
                
                <li class="pre-context-line"><code>      @template = ERB.new(TEMPLATE)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="21" class="context" id="30"
                  onclick="toggle(30);">
                <li class="context-line" id="context-30"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="22" class="post-context"
                  id="post-30" onclick="toggle(30);">
                
                <li class="post-context-line"><code>    rescue Exception =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      errors, env[&quot;rack.errors&quot;] = env[&quot;rack.errors&quot;], @@eats_errors
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if respond_to?(:prefers_plain_text?) and prefers_plain_text?(env)
</code></li>
                
                <li class="post-context-line"><code>        content_type = &quot;text&#x2F;plain&quot;
</code></li>
                
                <li class="post-context-line"><code>        body = [dump_exception(e)]
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1327"
                  class="pre-context" id="pre-31"
                  onclick="toggle(31);">
                
                <li class="pre-context-line"><code>        setup_default_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        setup_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        builder.run new!(*args, &amp;bk)
</code></li>
                
                <li class="pre-context-line"><code>        builder
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="1334" class="context" id="31"
                  onclick="toggle(31);">
                <li class="context-line" id="context-31"><code>        synchronize { prototype.call(env) }</code></li>
              </ol>

              
              <ol start="1335" class="post-context"
                  id="post-31" onclick="toggle(31);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>      def setup_default_middleware(builder)
</code></li>
                
                <li class="post-context-line"><code>        builder.use ShowExceptions       if show_exceptions?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::MethodOverride if method_override?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::Head
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>synchronize</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1396"
                  class="pre-context" id="pre-32"
                  onclick="toggle(32);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @@mutex = Mutex.new
</code></li>
                
                <li class="pre-context-line"><code>      def synchronize(&amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        if lock?
</code></li>
                
                <li class="pre-context-line"><code>          @@mutex.synchronize(&amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        else
</code></li>
                
              </ol>
              

              <ol start="1403" class="context" id="32"
                  onclick="toggle(32);">
                <li class="context-line" id="context-32"><code>          yield</code></li>
              </ol>

              
              <ol start="1404" class="post-context"
                  id="post-32" onclick="toggle(32);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    public
</code></li>
                
                <li class="post-context-line"><code>      CALLERS_TO_IGNORE = [ # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>        &#x2F;\&#x2F;sinatra(\&#x2F;(base|main|showexceptions))?\.rb$&#x2F;, # all sinatra code
</code></li>
                
                <li class="post-context-line"><code>        &#x2F;lib\&#x2F;tilt.*\.rb$&#x2F;,                              # all tilt code
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;sinatra-1.3.1&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1327"
                  class="pre-context" id="pre-33"
                  onclick="toggle(33);">
                
                <li class="pre-context-line"><code>        setup_default_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        setup_middleware builder
</code></li>
                
                <li class="pre-context-line"><code>        builder.run new!(*args, &amp;bk)
</code></li>
                
                <li class="pre-context-line"><code>        builder
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="1334" class="context" id="33"
                  onclick="toggle(33);">
                <li class="context-line" id="context-33"><code>        synchronize { prototype.call(env) }</code></li>
              </ol>

              
              <ol start="1335" class="post-context"
                  id="post-33" onclick="toggle(33);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>      def setup_default_middleware(builder)
</code></li>
                
                <li class="post-context-line"><code>        builder.use ShowExceptions       if show_exceptions?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::MethodOverride if method_override?
</code></li>
                
                <li class="post-context-line"><code>        builder.use Rack::Head
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;src&#x2F;ruby&#x2F;sinatra&#x2F;smoke_server&#x2F;lib&#x2F;smoke&#x2F;server&#x2F;auth.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code app">
              
              <ol start="14"
                  class="pre-context" id="pre-34"
                  onclick="toggle(34);">
                
                <li class="pre-context-line"><code>        request.env[&#x27;smoke.request_token&#x27;] = String.random :length =&gt; 48
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :MissingSecurityHeader) unless request.has_auth?
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :NotSignedUp) unless request.has_user?
</code></li>
                
                <li class="pre-context-line"><code>        return error(env, :AccountProblem) unless request.env[&#x27;smoke.user&#x27;].is_active?
</code></li>
                
                <li class="pre-context-line"><code>        # pp request
</code></li>
                
                <li class="pre-context-line"><code>        if request.valid?
</code></li>
                
              </ol>
              

              <ol start="21" class="context" id="34"
                  onclick="toggle(34);">
                <li class="context-line" id="context-34"><code>          return @app.call(env)</code></li>
              </ol>

              
              <ol start="22" class="post-context"
                  id="post-34" onclick="toggle(34);">
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          return error(env, :SignatureDoesNotMatch)
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      private 
</code></li>
                
                <li class="post-context-line"><code>      def error(env, error)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>_call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="41"
                  class="pre-context" id="pre-35"
                  onclick="toggle(35);">
                
                <li class="pre-context-line"><code>      assert(&quot;No env given&quot;) { env }
</code></li>
                
                <li class="pre-context-line"><code>      check_env env
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.input&#x27;] = InputWrapper.new(env[&#x27;rack.input&#x27;])
</code></li>
                
                <li class="pre-context-line"><code>      env[&#x27;rack.errors&#x27;] = ErrorWrapper.new(env[&#x27;rack.errors&#x27;])
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      ## and returns an Array of exactly three values:
</code></li>
                
              </ol>
              

              <ol start="48" class="context" id="35"
                  onclick="toggle(35);">
                <li class="context-line" id="context-35"><code>      status, headers, @body = @app.call(env)</code></li>
              </ol>

              
              <ol start="49" class="post-context"
                  id="post-35" onclick="toggle(35);">
                
                <li class="post-context-line"><code>      ## The *status*,
</code></li>
                
                <li class="post-context-line"><code>      check_status status
</code></li>
                
                <li class="post-context-line"><code>      ## the *headers*,
</code></li>
                
                <li class="post-context-line"><code>      check_headers headers
</code></li>
                
                <li class="post-context-line"><code>      ## and the *body*.
</code></li>
                
                <li class="post-context-line"><code>      check_content_type status, headers
</code></li>
                
                <li class="post-context-line"><code>      check_content_length status, headers
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;rack-1.3.5&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="29"
                  class="pre-context" id="pre-36"
                  onclick="toggle(36);">
                
                <li class="pre-context-line"><code>    ## after to catch all mistakes.
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## = Rack applications
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## A Rack application is a Ruby object (not a class) that
</code></li>
                
                <li class="pre-context-line"><code>    ## responds to +call+.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env=nil)
</code></li>
                
              </ol>
              

              <ol start="36" class="context" id="36"
                  onclick="toggle(36);">
                <li class="context-line" id="context-36"><code>      dup._call(env)</code></li>
              </ol>

              
              <ol start="37" class="post-context"
                  id="post-36" onclick="toggle(36);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def _call(env)
</code></li>
                
                <li class="post-context-line"><code>      ## It takes exactly one argument, the *environment*
</code></li>
                
                <li class="post-context-line"><code>      assert(&quot;No env given&quot;) { env }
</code></li>
                
                <li class="post-context-line"><code>      check_env env
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>block in pre_process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="73"
                  class="pre-context" id="pre-37"
                  onclick="toggle(37);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
                <li class="pre-context-line"><code>      catch(:async) do
</code></li>
                
                <li class="pre-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
              </ol>
              

              <ol start="80" class="context" id="37"
                  onclick="toggle(37);">
                <li class="context-line" id="context-37"><code>        response = @app.call(@request.env)</code></li>
              </ol>

              
              <ol start="81" class="post-context"
                  id="post-37" onclick="toggle(37);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
                <li class="post-context-line"><code>      nil # Signal to post_process that the request could not be processed
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code system">
              
              <ol start="71"
                  class="pre-context" id="pre-38"
                  onclick="toggle(38);">
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="38"
                  onclick="toggle(38);">
                <li class="context-line" id="context-38"><code>      catch(:async) do</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-38" onclick="toggle(38);">
                
                <li class="post-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
                <li class="post-context-line"><code>        response = @app.call(@request.env)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>pre_process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="71"
                  class="pre-context" id="pre-39"
                  onclick="toggle(39);">
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # When we&#x27;re under a non-async framework like rails, we can still spawn
</code></li>
                
                <li class="pre-context-line"><code>      # off async responses using the callback info, so there&#x27;s little point
</code></li>
                
                <li class="pre-context-line"><code>      # in removing this.
</code></li>
                
                <li class="pre-context-line"><code>      response = AsyncResponse
</code></li>
                
              </ol>
              

              <ol start="78" class="context" id="39"
                  onclick="toggle(39);">
                <li class="context-line" id="context-39"><code>      catch(:async) do</code></li>
              </ol>

              
              <ol start="79" class="post-context"
                  id="post-39" onclick="toggle(39);">
                
                <li class="post-context-line"><code>        # Process the request calling the Rack adapter
</code></li>
                
                <li class="post-context-line"><code>        response = @app.call(@request.env)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      response
</code></li>
                
                <li class="post-context-line"><code>    rescue Exception
</code></li>
                
                <li class="post-context-line"><code>      handle_error
</code></li>
                
                <li class="post-context-line"><code>      terminate_request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>process</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-40"
                  onclick="toggle(40);">
                
                <li class="pre-context-line"><code>    # is ready to be processed.
</code></li>
                
                <li class="pre-context-line"><code>    def process
</code></li>
                
                <li class="pre-context-line"><code>      if threaded?
</code></li>
                
                <li class="pre-context-line"><code>        @request.threaded = true
</code></li>
                
                <li class="pre-context-line"><code>        EventMachine.defer(method(:pre_process), method(:post_process))
</code></li>
                
                <li class="pre-context-line"><code>      else
</code></li>
                
                <li class="pre-context-line"><code>        @request.threaded = false
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="40"
                  onclick="toggle(40);">
                <li class="context-line" id="context-40"><code>        post_process(pre_process)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-40" onclick="toggle(40);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def pre_process
</code></li>
                
                <li class="post-context-line"><code>      # Add client info to the request env
</code></li>
                
                <li class="post-context-line"><code>      @request.remote_address = remote_address
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;connection.rb</code> in
                <code><strong>receive_data</strong></code>
            </li>

            <li class="code system">
              
              <ol start="31"
                  class="pre-context" id="pre-41"
                  onclick="toggle(41);">
                
                <li class="pre-context-line"><code>      @request  = Request.new
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Called when data is received from the client.
</code></li>
                
                <li class="pre-context-line"><code>    def receive_data(data)
</code></li>
                
                <li class="pre-context-line"><code>      trace { data }
</code></li>
                
              </ol>
              

              <ol start="38" class="context" id="41"
                  onclick="toggle(41);">
                <li class="context-line" id="context-41"><code>      process if @request.parse(data)</code></li>
              </ol>

              
              <ol start="39" class="post-context"
                  id="post-41" onclick="toggle(41);">
                
                <li class="post-context-line"><code>    rescue InvalidRequest =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      log &quot;!! Invalid request&quot;
</code></li>
                
                <li class="post-context-line"><code>      log_error e
</code></li>
                
                <li class="post-context-line"><code>      close_connection
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Called when all data was received and the request
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;eventmachine-0.12.10&#x2F;lib&#x2F;eventmachine.rb</code> in
                <code><strong>run_machine</strong></code>
            </li>

            <li class="code system">
              
              <ol start="249"
                  class="pre-context" id="pre-42"
                  onclick="toggle(42);">
                
                <li class="pre-context-line"><code>        @reactor_running = true
</code></li>
                
                <li class="pre-context-line"><code>        initialize_event_machine
</code></li>
                
                <li class="pre-context-line"><code>        (b = blk || block) and add_timer(0, b)
</code></li>
                
                <li class="pre-context-line"><code>        if @next_tick_queue &amp;&amp; !@next_tick_queue.empty?
</code></li>
                
                <li class="pre-context-line"><code>          add_timer(0) { signal_loopbreak }
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        @reactor_thread = Thread.current
</code></li>
                
              </ol>
              

              <ol start="256" class="context" id="42"
                  onclick="toggle(42);">
                <li class="context-line" id="context-42"><code>        run_machine</code></li>
              </ol>

              
              <ol start="257" class="post-context"
                  id="post-42" onclick="toggle(42);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        until @tails.empty?
</code></li>
                
                <li class="post-context-line"><code>          @tails.pop.call
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        begin
</code></li>
                
                <li class="post-context-line"><code>          release_machine
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;eventmachine-0.12.10&#x2F;lib&#x2F;eventmachine.rb</code> in
                <code><strong>run</strong></code>
            </li>

            <li class="code system">
              
              <ol start="249"
                  class="pre-context" id="pre-43"
                  onclick="toggle(43);">
                
                <li class="pre-context-line"><code>        @reactor_running = true
</code></li>
                
                <li class="pre-context-line"><code>        initialize_event_machine
</code></li>
                
                <li class="pre-context-line"><code>        (b = blk || block) and add_timer(0, b)
</code></li>
                
                <li class="pre-context-line"><code>        if @next_tick_queue &amp;&amp; !@next_tick_queue.empty?
</code></li>
                
                <li class="pre-context-line"><code>          add_timer(0) { signal_loopbreak }
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        @reactor_thread = Thread.current
</code></li>
                
              </ol>
              

              <ol start="256" class="context" id="43"
                  onclick="toggle(43);">
                <li class="context-line" id="context-43"><code>        run_machine</code></li>
              </ol>

              
              <ol start="257" class="post-context"
                  id="post-43" onclick="toggle(43);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        until @tails.empty?
</code></li>
                
                <li class="post-context-line"><code>          @tails.pop.call
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        begin
</code></li>
                
                <li class="post-context-line"><code>          release_machine
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;backends&#x2F;base.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="54"
                  class="pre-context" id="pre-44"
                  onclick="toggle(44);">
                
                <li class="pre-context-line"><code>          @running = true
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>        # Allow for early run up of eventmachine.
</code></li>
                
                <li class="pre-context-line"><code>        if EventMachine.reactor_running?
</code></li>
                
                <li class="pre-context-line"><code>          starter.call
</code></li>
                
                <li class="pre-context-line"><code>        else
</code></li>
                
              </ol>
              

              <ol start="61" class="context" id="44"
                  onclick="toggle(44);">
                <li class="context-line" id="context-44"><code>          EventMachine.run(&amp;starter)</code></li>
              </ol>

              
              <ol start="62" class="post-context"
                  id="post-44" onclick="toggle(44);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>      # Stop of the backend from accepting new connections.
</code></li>
                
                <li class="post-context-line"><code>      def stop
</code></li>
                
                <li class="post-context-line"><code>        @running  = false
</code></li>
                
                <li class="post-context-line"><code>        @stopping = true
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;server.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="152"
                  class="pre-context" id="pre-45"
                  onclick="toggle(45);">
                
                <li class="pre-context-line"><code>      log   &quot;&gt;&gt; Thin web server (v#{VERSION::STRING} codename #{VERSION::CODENAME})&quot;
</code></li>
                
                <li class="pre-context-line"><code>      debug &quot;&gt;&gt; Debugging ON&quot;
</code></li>
                
                <li class="pre-context-line"><code>      trace &quot;&gt;&gt; Tracing ON&quot;
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
                <li class="pre-context-line"><code>      log &quot;&gt;&gt; Maximum connections set to #{@backend.maximum_connections}&quot;
</code></li>
                
                <li class="pre-context-line"><code>      log &quot;&gt;&gt; Listening on #{@backend}, CTRL+C to stop&quot;
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
              </ol>
              

              <ol start="159" class="context" id="45"
                  onclick="toggle(45);">
                <li class="context-line" id="context-45"><code>      @backend.start</code></li>
              </ol>

              
              <ol start="160" class="post-context"
                  id="post-45" onclick="toggle(45);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>    alias :start! :start
</code></li>
                
                <li class="post-context-line"><code>    
</code></li>
                
                <li class="post-context-line"><code>    # == Gracefull shutdown
</code></li>
                
                <li class="post-context-line"><code>    # Stops the server after processing all current connections.
</code></li>
                
                <li class="post-context-line"><code>    # As soon as this method is called, the server stops accepting
</code></li>
                
                <li class="post-context-line"><code>    # new requests and wait for all current connections to finish.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;controllers&#x2F;controller.rb</code> in
                <code><strong>start</strong></code>
            </li>

            <li class="code system">
              
              <ol start="79"
                  class="pre-context" id="pre-46"
                  onclick="toggle(46);">
                
                <li class="pre-context-line"><code>        # If a stats URL is specified, wrap in Stats adapter
</code></li>
                
                <li class="pre-context-line"><code>        server.app = Stats::Adapter.new(server.app, @options[:stats]) if @options[:stats]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        # Register restart procedure which just start another process with same options,
</code></li>
                
                <li class="pre-context-line"><code>        # so that&#x27;s why this is done here.
</code></li>
                
                <li class="pre-context-line"><code>        server.on_restart { Command.run(:start, @options) }
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="86" class="context" id="46"
                  onclick="toggle(46);">
                <li class="context-line" id="context-46"><code>        server.start</code></li>
              </ol>

              
              <ol start="87" class="post-context"
                  id="post-46" onclick="toggle(46);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    
</code></li>
                
                <li class="post-context-line"><code>      def stop
</code></li>
                
                <li class="post-context-line"><code>        raise OptionRequired, :pid unless @options[:pid]
</code></li>
                
                <li class="post-context-line"><code>      
</code></li>
                
                <li class="post-context-line"><code>        tail_log(@options[:log]) do
</code></li>
                
                <li class="post-context-line"><code>          if Server.kill(@options[:pid], @options[:force] ? 0 : (@options[:timeout] || 60))
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;runner.rb</code> in
                <code><strong>run_command</strong></code>
            </li>

            <li class="code system">
              
              <ol start="178"
                  class="pre-context" id="pre-47"
                  onclick="toggle(47);">
                
                <li class="pre-context-line"><code>      when cluster? then Controllers::Cluster.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      when service? then Controllers::Service.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      else               Controllers::Controller.new(@options)
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>      
</code></li>
                
                <li class="pre-context-line"><code>      if controller.respond_to?(@command)
</code></li>
                
                <li class="pre-context-line"><code>        begin
</code></li>
                
              </ol>
              

              <ol start="185" class="context" id="47"
                  onclick="toggle(47);">
                <li class="context-line" id="context-47"><code>          controller.send(@command, *@arguments)</code></li>
              </ol>

              
              <ol start="186" class="post-context"
                  id="post-47" onclick="toggle(47);">
                
                <li class="post-context-line"><code>        rescue RunnerError =&gt; e
</code></li>
                
                <li class="post-context-line"><code>          abort e.message
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        abort &quot;Invalid options for command: #{@command}&quot;
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;lib&#x2F;thin&#x2F;runner.rb</code> in
                <code><strong>run!</strong></code>
            </li>

            <li class="code system">
              
              <ol start="144"
                  class="pre-context" id="pre-48"
                  onclick="toggle(48);">
                
                <li class="pre-context-line"><code>      @arguments = @argv
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>        
</code></li>
                
                <li class="pre-context-line"><code>    # Parse the current shell arguments and run the command.
</code></li>
                
                <li class="pre-context-line"><code>    # Exits on error.
</code></li>
                
                <li class="pre-context-line"><code>    def run!
</code></li>
                
                <li class="pre-context-line"><code>      if self.class.commands.include?(@command)
</code></li>
                
              </ol>
              

              <ol start="151" class="context" id="48"
                  onclick="toggle(48);">
                <li class="context-line" id="context-48"><code>        run_command</code></li>
              </ol>

              
              <ol start="152" class="post-context"
                  id="post-48" onclick="toggle(48);">
                
                <li class="post-context-line"><code>      elsif @command.nil?
</code></li>
                
                <li class="post-context-line"><code>        puts &quot;Command required&quot;
</code></li>
                
                <li class="post-context-line"><code>        puts @parser
</code></li>
                
                <li class="post-context-line"><code>        exit 1  
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        abort &quot;Unknown command: #{@command}. Use one of #{self.class.commands.join(&#x27;, &#x27;)}&quot;
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;gems&#x2F;thin-1.3.1&#x2F;bin&#x2F;thin</code> in
                <code><strong>&lt;top (required)&gt;</strong></code>
            </li>

            <li class="code system">
              
              <ol start="1"
                  class="pre-context" id="pre-49"
                  onclick="toggle(49);">
                
                <li class="pre-context-line"><code>#!&#x2F;usr&#x2F;bin&#x2F;env ruby
</code></li>
                
                <li class="pre-context-line"><code># Thin command line interface script.
</code></li>
                
                <li class="pre-context-line"><code># Run &lt;tt&gt;thin -h&lt;&#x2F;tt&gt; to get more usage.
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>require &#x27;thin&#x27;
</code></li>
                
              </ol>
              

              <ol start="6" class="context" id="49"
                  onclick="toggle(49);">
                <li class="context-line" id="context-49"><code>Thin::Runner.new(ARGV).run!</code></li>
              </ol>

              
              <ol start="7" class="post-context"
                  id="post-49" onclick="toggle(49);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;bin&#x2F;thin</code> in
                <code><strong>load</strong></code>
            </li>

            <li class="code system">
              
              <ol start="12"
                  class="pre-context" id="pre-50"
                  onclick="toggle(50);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>if ARGV.first =~ &#x2F;^_(.*)_$&#x2F; and Gem::Version.correct? $1 then
</code></li>
                
                <li class="pre-context-line"><code>  version = $1
</code></li>
                
                <li class="pre-context-line"><code>  ARGV.shift
</code></li>
                
                <li class="pre-context-line"><code>end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>gem &#x27;thin&#x27;, version
</code></li>
                
              </ol>
              

              <ol start="19" class="context" id="50"
                  onclick="toggle(50);">
                <li class="context-line" id="context-50"><code>load Gem.bin_path(&#x27;thin&#x27;, &#x27;thin&#x27;, version)</code></li>
              </ol>

              
              <ol start="20" class="post-context"
                  id="post-50" onclick="toggle(50);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;Users&#x2F;rlyon&#x2F;.rvm&#x2F;gems&#x2F;ruby-1.9.2-p290@smoke_server&#x2F;bin&#x2F;thin</code> in
                <code><strong>&lt;main&gt;</strong></code>
            </li>

            <li class="code system">
              
              <ol start="12"
                  class="pre-context" id="pre-51"
                  onclick="toggle(51);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>if ARGV.first =~ &#x2F;^_(.*)_$&#x2F; and Gem::Version.correct? $1 then
</code></li>
                
                <li class="pre-context-line"><code>  version = $1
</code></li>
                
                <li class="pre-context-line"><code>  ARGV.shift
</code></li>
                
                <li class="pre-context-line"><code>end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>gem &#x27;thin&#x27;, version
</code></li>
                
              </ol>
              

              <ol start="19" class="context" id="51"
                  onclick="toggle(51);">
                <li class="context-line" id="context-51"><code>load Gem.bin_path(&#x27;thin&#x27;, &#x27;thin&#x27;, version)</code></li>
              </ol>

              
              <ol start="20" class="post-context"
                  id="post-51" onclick="toggle(51);">
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      

      </ul>
    </div> <!-- /BACKTRACE -->

    <div id="get">
      <h3 id="get-info">GET</h3>
      
        <table class="req">
          <tr>
            <th>Variable</th>
            <th>Value</th>
          </tr>
           
          <tr>
            <td>delimiter</td>
            <td class="code"><div>&quot;&#x2F;&quot;</div></td>
          </tr>
          
          <tr>
            <td>max-keys</td>
            <td class="code"><div>&quot;1000&quot;</div></td>
          </tr>
          
          <tr>
            <td>prefix</td>
            <td class="code"><div>nil</div></td>
          </tr>
          
        </table>
      
      <div class="clear"></div>
    </div> <!-- /GET -->

    <div id="post">
      <h3 id="post-info">POST</h3>
      
        <p class="no-data">No POST data.</p>
      
      <div class="clear"></div>
    </div> <!-- /POST -->

    <div id="cookies">
      <h3 id="cookie-info">COOKIES</h3>
      
        <p class="no-data">No cookie data.</p>
      
      <div class="clear"></div>
    </div> <!-- /COOKIES -->

    <div id="rack">
      <h3 id="env-info">Rack ENV</h3>
      <table class="req">
        <tr>
          <th>Variable</th>
          <th>Value</th>
        </tr>
         
         <tr>
           <td>CONTENT_TYPE</td>
           <td class="code"><div></div></td>
         </tr>
         
         <tr>
           <td>GATEWAY_INTERFACE</td>
           <td class="code"><div>CGI&#x2F;1.2</div></td>
         </tr>
         
         <tr>
           <td>HTTP_ACCEPT_ENCODING</td>
           <td class="code"><div>gzip,deflate</div></td>
         </tr>
         
         <tr>
           <td>HTTP_AUTHORIZATION</td>
           <td class="code"><div>AWS 0PN5J17HBGZHT7JJ3X82:r9u8+PGRNTHJ4MPrSmkgMfswaQA=</div></td>
         </tr>
         
         <tr>
           <td>HTTP_CONNECTION</td>
           <td class="code"><div>close</div></td>
         </tr>
         
         <tr>
           <td>HTTP_DATE</td>
           <td class="code"><div>Mon, 28 Nov 2011 00:33:36 GMT</div></td>
         </tr>
         
         <tr>
           <td>HTTP_HOST</td>
           <td class="code"><div>localhost</div></td>
         </tr>
         
         <tr>
           <td>HTTP_USER_AGENT</td>
           <td class="code"><div>Cyberduck&#x2F;4.1.2 (Mac OS X&#x2F;10.6.8) (i386)</div></td>
         </tr>
         
         <tr>
           <td>HTTP_VERSION</td>
           <td class="code"><div>HTTP&#x2F;1.0</div></td>
         </tr>
         
         <tr>
           <td>HTTP_X_FORWARDED_FOR</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>HTTP_X_REAL_IP</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>PATH_INFO</td>
           <td class="code"><div>&#x2F;mocky&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>QUERY_STRING</td>
           <td class="code"><div>delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>REMOTE_ADDR</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_METHOD</td>
           <td class="code"><div>GET</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_PATH</td>
           <td class="code"><div>&#x2F;mocky&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_URI</td>
           <td class="code"><div>&#x2F;mocky&#x2F;?delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>SCRIPT_NAME</td>
           <td class="code"><div></div></td>
         </tr>
         
         <tr>
           <td>SERVER_NAME</td>
           <td class="code"><div>localhost</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PORT</td>
           <td class="code"><div>80</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PROTOCOL</td>
           <td class="code"><div>HTTP&#x2F;1.1</div></td>
         </tr>
         
         <tr>
           <td>SERVER_SOFTWARE</td>
           <td class="code"><div>thin 1.3.1 codename Triple Espresso</div></td>
         </tr>
         
         <tr>
           <td>async.callback</td>
           <td class="code"><div>#&lt;Method: Thin::Connection#post_process&gt;</div></td>
         </tr>
         
         <tr>
           <td>async.close</td>
           <td class="code"><div>#&lt;EventMachine::DefaultDeferrable:0x00000100eb3628&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.errors</td>
           <td class="code"><div>#&lt;Object:0x000001011cb860&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.input</td>
           <td class="code"><div>#&lt;Rack::Lint::InputWrapper:0x00000100e8fe08 @input=#&lt;StringIO:0x00000100eb3dd0&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.logger</td>
           <td class="code"><div>#&lt;Rack::NullLogger:0x000001030b3110 @app=#&lt;Rack::Protection::FrameOptions:0x000001030b31d8 @app=#&lt;Rack::Protection::IPSpoofing:0x000001030b3250 @app=#&lt;Rack::Protection::JsonCsrf:0x000001030b32c8 @app=#&lt;Rack::Protection::PathTraversal:0x000001030b3340 @app=#&lt;Rack::Protection::XSSHeader:0x000001030b33e0 @app=#&lt;Smoke::Server::App:0x00000100fae8e8 @default_layout=:layout, @app=nil, @template_cache=#&lt;Tilt::Cache:0x00000100fae8c0 @cache={}&gt;&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :xss_mode=&gt;:block, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;, @options={:reaction=&gt;:default_reaction, :logging=&gt;true, :message=&gt;&quot;Forbidden&quot;, :encryptor=&gt;Digest::SHA1, :session_key=&gt;&quot;rack.session&quot;, :status=&gt;403, :allow_empty_referrer=&gt;true, :xss_mode=&gt;:block, :frame_options=&gt;:sameorigin, :except=&gt;[:escaped_params, :session_hijacking, :remote_token]}&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.multiprocess</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.multithread</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.request.cookie_hash</td>
           <td class="code"><div>{}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_hash</td>
           <td class="code"><div>{&quot;delimiter&quot;=&gt;&quot;&#x2F;&quot;, &quot;max-keys&quot;=&gt;&quot;1000&quot;, &quot;prefix&quot;=&gt;nil}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_string</td>
           <td class="code"><div>delimiter=%2F&amp;max-keys=1000&amp;prefix</div></td>
         </tr>
         
         <tr>
           <td>rack.run_once</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.url_scheme</td>
           <td class="code"><div>http</div></td>
         </tr>
         
         <tr>
           <td>rack.version</td>
           <td class="code"><div>[1, 0]</div></td>
         </tr>
         
         <tr>
           <td>sinatra.error</td>
           <td class="code"><div>#&lt;ArgumentError: comparison of Fixnum with String failed&gt;</div></td>
         </tr>
         
         <tr>
           <td>smoke.access_id</td>
           <td class="code"><div>0PN5J17HBGZHT7JJ3X82</div></td>
         </tr>
         
         <tr>
           <td>smoke.amz_headers</td>
           <td class="code"><div>{}</div></td>
         </tr>
         
         <tr>
           <td>smoke.bucket</td>
           <td class="code"><div>mocky</div></td>
         </tr>
         
         <tr>
           <td>smoke.path</td>
           <td class="code"><div>&#x2F;</div></td>
         </tr>
         
         <tr>
           <td>smoke.request_id</td>
           <td class="code"><div>0877321C4BD486306C4B37FE66152C91</div></td>
         </tr>
         
         <tr>
           <td>smoke.request_token</td>
           <td class="code"><div>GObzcSqD7njGXjnvASnp6ZfyqcOYa8Mx8qW8F8wOhhFnh0co</div></td>
         </tr>
         
         <tr>
           <td>smoke.resource_headers</td>
           <td class="code"><div>{&quot;version&quot;=&gt;&quot;HTTP&#x2F;1.0&quot;, &quot;x-real-ip&quot;=&gt;&quot;127.0.0.1&quot;, &quot;host&quot;=&gt;&quot;localhost&quot;, &quot;x-forwarded-for&quot;=&gt;&quot;127.0.0.1&quot;, &quot;connection&quot;=&gt;&quot;close&quot;, &quot;date&quot;=&gt;&quot;Mon, 28 Nov 2011 00:33:36 GMT&quot;, &quot;authorization&quot;=&gt;&quot;AWS 0PN5J17HBGZHT7JJ3X82:r9u8+PGRNTHJ4MPrSmkgMfswaQA=&quot;, &quot;user-agent&quot;=&gt;&quot;Cyberduck&#x2F;4.1.2 (Mac OS X&#x2F;10.6.8) (i386)&quot;, &quot;accept-encoding&quot;=&gt;&quot;gzip,deflate&quot;}</div></td>
         </tr>
         
         <tr>
           <td>smoke.user</td>
           <td class="code"><div>#&lt;Smoke::Server::User id: 1, username: &quot;mocky&quot;, access_id: &quot;0PN5J17HBGZHT7JJ3X82&quot;, secret_key: &quot;uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o&quot;, display_name: &quot;Mocky User&quot;, email: &quot;mocky@dev.null.com&quot;, max_buckets: 1, expires_at: 1324785151, is_active: true, role: &quot;admin&quot;, enc_password: nil, created_at: &quot;2011-11-26 19:52:31&quot;, updated_at: &quot;2011-11-26 19:52:31&quot;&gt;</div></td>
         </tr>
         
      </table>
      <div class="clear"></div>
    </div> <!-- /RACK ENV -->

    <p id="explanation">You're seeing this error because you have
enabled the <code>show_exceptions</code> setting.</p>
  </div> <!-- /WRAP -->
  </body>
</html>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET / HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:38:40 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:ApV2ZEgh4DYrWhXCzlfXaiQuvV8=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101291830
   @input=#<StringIO:0x00000101363560>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001012916c8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/",
 "PATH_INFO"=>"/",
 "REQUEST_URI"=>"/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:38:40 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:ApV2ZEgh4DYrWhXCzlfXaiQuvV8=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "QUERY_STRING"=>"",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001012a8850>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:38:40 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:ApV2ZEgh4DYrWhXCzlfXaiQuvV8=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"78D5E63B93B025656CA252AF39E4C3ED",
 "smoke.request_token"=>"rgzrpcqxzkjzY0bGpEjr4mpuqWgmOsiwR2V5aQNdKMwC0NkQ"}
StringToSign: GET


Mon, 28 Nov 2011 00:38:40 GMT
/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: application/xml
Content-Length: 491
Connection: close
Date: 2011-11-28T00:38:40.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 78D5E63B93B025656CA252AF39E4C3ED
x-amz-id-2: rgzrpcqxzkjzY0bGpEjr4mpuqWgmOsiwR2V5aQNdKMwC0NkQ

<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Owner>
    <ID>0PN5J17HBGZHT7JJ3X82</ID>
    <DisplayName>Mocky User</DisplayName>
  </Owner>
  <Buckets>
	
    <Bucket>
      <Name>mocky</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
    <Bucket>
      <Name>mocky-logs</Name>
      <CreationDate>2011-11-27T03:52:31.000Z</CreationDate>
    </Bucket>
	
  </Buckets>
</ListAllMyBucketResult>
GET /mocky/?delimiter=%2F&max-keys=1000&versions&prefix HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:38:41 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:gsJVpoRXfUmzJv8oyvmTw0TgAKI=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001012347c0
   @input=#<StringIO:0x00000101246628>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001012346d0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"delimiter=%2F&max-keys=1000&versions&prefix",
 "REQUEST_URI"=>"/mocky/?delimiter=%2F&max-keys=1000&versions&prefix",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:38:41 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:gsJVpoRXfUmzJv8oyvmTw0TgAKI=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001012453e0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:38:41 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:gsJVpoRXfUmzJv8oyvmTw0TgAKI=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"6ADF127C7B92A318E5E3EBFFAE769CDC",
 "smoke.request_token"=>"BeAysi5P00d859djKjtP7hYyRUw8ZCUzwWU6VchIxnBKQqJa"}
StringToSign: GET


Mon, 28 Nov 2011 00:38:41 GMT
/mocky/?versions
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 321
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
  <CommonPrefixes>
    <Prefix>path/</Prefix>
  </CommonPrefixes>
	
	
</ListBucketResult>
GET /mocky/?delimiter=%2F&max-keys=1000&prefix=path%2Fto%2F HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:38:46 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:IPS2gdkURIGE/64ZdLsrScuqHkc=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001031e86e8
   @input=#<StringIO:0x000001031ed990>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001031e8670
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"delimiter=%2F&max-keys=1000&prefix=path%2Fto%2F",
 "REQUEST_URI"=>"/mocky/?delimiter=%2F&max-keys=1000&prefix=path%2Fto%2F",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:38:46 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:IPS2gdkURIGE/64ZdLsrScuqHkc=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001031ed148>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:38:46 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:IPS2gdkURIGE/64ZdLsrScuqHkc=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"951ED5C686D7A25642427104EB05E630",
 "smoke.request_token"=>"LRB6zyz05J5ptQSj7IlRGMmhbTQAlO1Ub58rIkuGQvRBon4S"}
StringToSign: GET


Mon, 28 Nov 2011 00:38:46 GMT
/mocky/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 327
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
  <CommonPrefixes>
    <Prefix>path/to/my/</Prefix>
  </CommonPrefixes>
	
	
</ListBucketResult>
GET /mocky/?delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2F HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:38:48 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:TCDeWZ49Jr2FwDVU4mjWp+wKOGc=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101753698
   @input=#<StringIO:0x00000101758f80>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000101753620
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>
  "delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2F",
 "REQUEST_URI"=>
  "/mocky/?delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2F",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:38:48 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:TCDeWZ49Jr2FwDVU4mjWp+wKOGc=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000101758828>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:38:48 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:TCDeWZ49Jr2FwDVU4mjWp+wKOGc=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"EFC77A32CDFE4D1C5C300E32A2202309",
 "smoke.request_token"=>"ktS2qw8Py7xGrTPcjivZFg6j60wqJlQQpzlR69oihSNdcwv4"}
StringToSign: GET


Mon, 28 Nov 2011 00:38:48 GMT
/mocky/?versions
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 412
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
  <CommonPrefixes>
    <Prefix>path/to/my/S3/</Prefix>
  </CommonPrefixes>
	
  <CommonPrefixes>
    <Prefix>path/to/my/S3-copy/</Prefix>
  </CommonPrefixes>
	
	
</ListBucketResult>
GET /mocky/?delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2FS3%2F HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:38:50 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:19YhGw9pY5WdlGdqz6hVxyoXOi4=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001013f3958
   @input=#<StringIO:0x00000101416ae8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001013f38e0
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>
  "delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2FS3%2F",
 "REQUEST_URI"=>
  "/mocky/?delimiter=%2F&max-keys=1000&versions&prefix=path%2Fto%2Fmy%2FS3%2F",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:38:50 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:19YhGw9pY5WdlGdqz6hVxyoXOi4=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000101415ad0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:38:50 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:19YhGw9pY5WdlGdqz6hVxyoXOi4=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"6C246FA5B25D563E988BC701DAF8DEC7",
 "smoke.request_token"=>"mcGzh0jlZPPnPL0M7UFx91kGBZAwsbiG7GFqnBYOJ5QepU6z"}
StringToSign: GET


Mon, 28 Nov 2011 00:38:50 GMT
/mocky/?versions
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 9608
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
  <Contents>
    <Key>path/to/my/S3/ACL.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>577a2c29e4910b5be9d133592a50b85e</ETag>
    <Size>5989</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/ACL.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>181b5fac09b034b06e92badf8da00524</ETag>
    <Size>8406</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8eb7d0e65af11d814281c2752b37871b</ETag>
    <Size>2551</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/AccessLog.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>aa81939b1ce989e56383f841cbfa26ba</ETag>
    <Size>3705</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>0a3d6c68a87253d7829a6a84f4f6b713</ETag>
    <Size>890</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/BidirMap.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>fbb9d1c3e06198a40649ac6cb0756199</ETag>
    <Size>2038</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8ca4670a301344a5075ca0e3430bb1d7</ETag>
    <Size>19915</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/CloudFront.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>cf95acdffd54fd3949d8b2f3e4e7d0f3</ETag>
    <Size>20025</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6c103d7c5d2b16bf454852c2fbeb8707</ETag>
    <Size>6174</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Config.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f93c915747f27f2933a18bcc20d80624</ETag>
    <Size>7790</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>f863cdc2cb89f3fe8836c4b603889dfb</ETag>
    <Size>2251</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Exceptions.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9513f99a0b242973c795bb5811fcf25c</ETag>
    <Size>4104</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d3af86656acfd8147cb10b0dafc3d9dc</ETag>
    <Size>445</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/PkgInfo.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4eb412d003103ebc938ab27261c6cad1</ETag>
    <Size>639</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>9c38d2dfc83c701f8e3e62e771002278</ETag>
    <Size>5193</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Progress.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e9d7eb6d87e256e94de8c4e7d7c1a02a</ETag>
    <Size>5526</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>8f194a5efc6e5b5e77b936c1299839d6</ETag>
    <Size>27450</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>257619936bb45f137d7baa6c4537f50f</ETag>
    <Size>24851</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>7bfe82b2950b542ef985ee611fa2b310</ETag>
    <Size>5347</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/S3Uri.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>4693dba05bcc4e2da47fed4a10db8069</ETag>
    <Size>8954</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SimpleDB.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>e7a9a30012449beb3fa970b1d239a273</ETag>
    <Size>6017</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>05a6053b5f0cb40b09872572b238a50c</ETag>
    <Size>1640</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/SortedDict.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>b7de15f5827bbed529f5b1671c895cd3</ETag>
    <Size>2591</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>68fbe83ef100b95b2746a691f6c7885a</ETag>
    <Size>10994</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/Utils.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>c5d468a10b86b6de15cbd0ec76df1776</ETag>
    <Size>14047</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.py</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
    <Size>0</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
  <Contents>
    <Key>path/to/my/S3/__init__.pyc</Key>
    <LastModified>2011-11-27T20:37:21.000Z</LastModified>
    <ETag>6fd10432e9fee54c1311d7d9090af6ee</ETag>
    <Size>130</Size>
    <StorageClass>STANDARD</StorageClass>
    <Owner>
      <ID>0PN5J17HBGZHT7JJ3X82</ID>
      <DisplayName>Mocky User</DisplayName>
    </Owner>
  </Contents>
	
	
	
	
</ListBucketResult>
PUT /mocky/?versioning HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:40:06 GMT
Content-Type: text/plain
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:g5wc/jUZKbZ5H8ijDqQVT/l7NtM=
Content-Length: 210
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

<?xml version="1.0" encoding="UTF-8" standalone="no"?><VersioningConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/"><Status>Suspended</Status><MfaDelete>Disabled</MfaDelete></VersioningConfiguration>
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001009d1bc8
   @input=#<StringIO:0x000001009d6e48>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001009d1b00
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"versioning",
 "REQUEST_URI"=>"/mocky/?versioning",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:40:06 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:g5wc/jUZKbZ5H8ijDqQVT/l7NtM=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_LENGTH"=>"210",
 "CONTENT_TYPE"=>"text/plain",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001009d66a0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:40:06 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:g5wc/jUZKbZ5H8ijDqQVT/l7NtM=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"68712DC851D028684A3EE66B23932A61",
 "smoke.request_token"=>"DGQZcO6ZGyClUS5oA8FwMbczM6rzMjzdr5zskGT6P3eahqCx"}
StringToSign: PUT

text/plain
Mon, 28 Nov 2011 00:40:06 GMT
/mocky/?versioning
HTTP/1.1 501 Not Implemented
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 225
Connection: close
Date: 2011-11-28T00:40:06.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 68712DC851D028684A3EE66B23932A61
x-amz-id-2: DGQZcO6ZGyClUS5oA8FwMbczM6rzMjzdr5zskGT6P3eahqCx

<?xml version="1.0" encoding="UTF-8"?>
<Error>
	<Code>NotImplemented</Code>
	<Message>A header you provided implies a functionality that is not implemented.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
GET /mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:42:05 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Hq8m1bOZWypu3mqlF/QDV4QkCzQ=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x0000010309b060
   @input=#<StringIO:0x00000103110a90>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x0000010309afe8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "PATH_INFO"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "QUERY_STRING"=>"acl",
 "REQUEST_URI"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:42:05 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:Hq8m1bOZWypu3mqlF/QDV4QkCzQ=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000103110388>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:42:05 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:Hq8m1bOZWypu3mqlF/QDV4QkCzQ=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"B007CEDE8218BE2A46365119FCBBCC8C",
 "smoke.request_token"=>"VYyAnzsTl4ltVOwhR92DX7nw9uHmlU8Ks2UXSiODKd9PPQuQ"}
StringToSign: GET


Mon, 28 Nov 2011 00:42:05 GMT
/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl
HTTP/1.1 501 Not Implemented
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 258
Connection: close
Date: 2011-11-28T00:42:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: B007CEDE8218BE2A46365119FCBBCC8C
x-amz-id-2: VYyAnzsTl4ltVOwhR92DX7nw9uHmlU8Ks2UXSiODKd9PPQuQ

<?xml version="1.0" encoding="UTF-8"?>
<Error>
	<Code>NotImplemented</Code>
	<Message>A header you provided implies a functionality that is not implemented.</Message>
	<Resource>/path%2Fto%2Fmy%2FS3%2F__init__.py</Resource>
	<RequestId></RequestId>
</Error>
GET /mocky/path/to/my/S3/__init__.py HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

!! Unexpected error while processing request: undefined method `split' for nil:NilClass
undefined method `split' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:148:in `credentials'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:152:in `access_id'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:112:in `find_user'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:79:in `initialize'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `new'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527394&Signature=tDe%2F%2Bt3GnF7F7AUilYZ9LWXk1qA%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

!! Unexpected error while processing request: undefined method `split' for nil:NilClass
undefined method `split' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:148:in `credentials'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:152:in `access_id'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:112:in `find_user'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:79:in `initialize'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `new'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527394&Signature=tDe%2F%2Bt3GnF7F7AUilYZ9LWXk1qA%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

!! Unexpected error while processing request: undefined method `split' for nil:NilClass
undefined method `split' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:148:in `credentials'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:152:in `access_id'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:112:in `find_user'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:79:in `initialize'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `new'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'GET /mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:47:05 GMT
Content-Type: 
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:bGq0vZ+4Gu3Q51AVW1zWFeEaK/0=
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000103161990
   @input=#<StringIO:0x000001031219a8>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000103161918
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "PATH_INFO"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "QUERY_STRING"=>"acl",
 "REQUEST_URI"=>"/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:47:05 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:bGq0vZ+4Gu3Q51AVW1zWFeEaK/0=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_TYPE"=>"",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001031212a0>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:47:05 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:bGq0vZ+4Gu3Q51AVW1zWFeEaK/0=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/path%2Fto%2Fmy%2FS3%2F__init__.py",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"AC80BE1BBB28EDFF13CE0E401ABEB762",
 "smoke.request_token"=>"iUPj1ZNGvrbW10xTOCb642mil5WQCbvp2cZqIyuMzVuodzUq"}
StringToSign: GET


Mon, 28 Nov 2011 00:47:05 GMT
/mocky/path%2Fto%2Fmy%2FS3%2F__init__.py?acl
HTTP/1.1 501 Not Implemented
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 258
Connection: close
Date: 2011-11-28T00:47:05.000Z
Server: Smoke - Mary Jane
x-amz-request-id: AC80BE1BBB28EDFF13CE0E401ABEB762
x-amz-id-2: iUPj1ZNGvrbW10xTOCb642mil5WQCbvp2cZqIyuMzVuodzUq

<?xml version="1.0" encoding="UTF-8"?>
<Error>
	<Code>NotImplemented</Code>
	<Message>A header you provided implies a functionality that is not implemented.</Message>
	<Resource>/path%2Fto%2Fmy%2FS3%2F__init__.py</Resource>
	<RequestId></RequestId>
</Error>
PUT /mocky/?versioning HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Date: Mon, 28 Nov 2011 00:50:51 GMT
Content-Type: text/plain
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:fd4V8u+L5IbwvqQzfgtq8iE+i6c=
Content-Length: 210
User-Agent: Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)
Accept-Encoding: gzip,deflate

<?xml version="1.0" encoding="UTF-8" standalone="no"?><VersioningConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/"><Status>Suspended</Status><MfaDelete>Disabled</MfaDelete></VersioningConfiguration>
{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000103165f90
   @input=#<StringIO:0x00000100d54de0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000103165f18
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"PUT",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"versioning",
 "REQUEST_URI"=>"/mocky/?versioning",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_DATE"=>"Mon, 28 Nov 2011 00:50:51 GMT",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:fd4V8u+L5IbwvqQzfgtq8iE+i6c=",
 "HTTP_USER_AGENT"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
 "HTTP_ACCEPT_ENCODING"=>"gzip,deflate",
 "CONTENT_LENGTH"=>"210",
 "CONTENT_TYPE"=>"text/plain",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100d54638>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "date"=>"Mon, 28 Nov 2011 00:50:51 GMT",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:fd4V8u+L5IbwvqQzfgtq8iE+i6c=",
   "user-agent"=>"Cyberduck/4.1.2 (Mac OS X/10.6.8) (i386)",
   "accept-encoding"=>"gzip,deflate"},
 "smoke.amz_headers"=>{},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"BBCD52886084A1497F935D49E9A4EE86",
 "smoke.request_token"=>"9tbLbKUFRAOeT3WrzYFgLrkUuuqvMN3p3N6dNncmKbiRkFpf"}
StringToSign: PUT

text/plain
Mon, 28 Nov 2011 00:50:51 GMT
/mocky/?versioning
HTTP/1.1 501 Not Implemented
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: plain/text
Content-Length: 225
Connection: close
Date: 2011-11-28T00:50:51.000Z
Server: Smoke - Mary Jane
x-amz-request-id: BBCD52886084A1497F935D49E9A4EE86
x-amz-id-2: 9tbLbKUFRAOeT3WrzYFgLrkUuuqvMN3p3N6dNncmKbiRkFpf

<?xml version="1.0" encoding="UTF-8"?>
<Error>
	<Code>NotImplemented</Code>
	<Message>A header you provided implies a functionality that is not implemented.</Message>
	<Resource>/</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /?prefix=path/to/my/&delimiter=/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:jLL3fZDyakTIBqP9FgwjABjycw0=
x-amz-date: Mon, 28 Nov 2011 01:09:24 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x000001014676c8
   @input=#<StringIO:0x000001014ca8e0>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000101467650
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"prefix=path/to/my/&delimiter=/",
 "REQUEST_URI"=>"http://mocky.localhost/mocky/?prefix=path/to/my/&delimiter=/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:jLL3fZDyakTIBqP9FgwjABjycw0=",
 "HTTP_X_AMZ_DATE"=>"Mon, 28 Nov 2011 01:09:24 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x000001014a0860>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:jLL3fZDyakTIBqP9FgwjABjycw0="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Mon, 28 Nov 2011 01:09:24 +0000"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"363F5AF6416EB7CF21789CB868A4F0FF",
 "smoke.request_token"=>"OhfUa27b7rcjboxtKJgdCJKmaBqiyEr25f5awwL80SxlGZZz"}
!! Unexpected error while processing request: undefined method `+' for nil:NilClass
undefined method `+' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/signature.rb:21:in `sign'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:95:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'GET /?prefix=path/to/my/&delimiter=/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:Zc/HlOpgg8w0u7qm9X7fnZ8uCw8=
x-amz-date: Mon, 28 Nov 2011 01:09:29 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000100867f30
   @input=#<StringIO:0x00000100953d40>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x00000100867e18
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"prefix=path/to/my/&delimiter=/",
 "REQUEST_URI"=>"http://mocky.localhost/mocky/?prefix=path/to/my/&delimiter=/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:Zc/HlOpgg8w0u7qm9X7fnZ8uCw8=",
 "HTTP_X_AMZ_DATE"=>"Mon, 28 Nov 2011 01:09:29 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x00000100951400>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:Zc/HlOpgg8w0u7qm9X7fnZ8uCw8="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Mon, 28 Nov 2011 01:09:29 +0000"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"3E966A9193C34FD54F37A274626A47A9",
 "smoke.request_token"=>"YzGpcze7iyBiCLFJmnZI77i9MzzYZKJ3BEyHk0H51UHiSSju"}
!! Unexpected error while processing request: undefined method `+' for nil:NilClass
undefined method `+' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/signature.rb:21:in `sign'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:95:in `valid?'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:20:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /?prefix=path/to/my/&delimiter=/ HTTP/1.0
X-Real-IP: 127.0.0.1
Host: mocky.localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Accept-Encoding: identity
content-length: 0
Authorization: AWS 0PN5J17HBGZHT7JJ3X82:LxGc2PRkTMD2qtjmYRBmVrjJdN8=
x-amz-date: Mon, 28 Nov 2011 01:10:21 +0000

{"SERVER_SOFTWARE"=>"thin 1.3.1 codename Triple Espresso",
 "SERVER_NAME"=>"mocky.localhost",
 "rack.input"=>
  #<Rack::Lint::InputWrapper:0x00000101426a38
   @input=#<StringIO:0x000001014e9f10>>,
 "rack.version"=>[1, 0],
 "rack.errors"=>
  #<Rack::Lint::ErrorWrapper:0x000001014268a8
   @error=#<IO:/Users/rlyon/src/ruby/sinatra/smoke_server/logs/thin.4226.log>>,
 "rack.multithread"=>false,
 "rack.multiprocess"=>false,
 "rack.run_once"=>false,
 "REQUEST_METHOD"=>"GET",
 "REQUEST_PATH"=>"/mocky/",
 "PATH_INFO"=>"/mocky/",
 "QUERY_STRING"=>"prefix=path/to/my/&delimiter=/",
 "REQUEST_URI"=>"http://mocky.localhost/mocky/?prefix=path/to/my/&delimiter=/",
 "HTTP_VERSION"=>"HTTP/1.0",
 "HTTP_X_REAL_IP"=>"127.0.0.1",
 "HTTP_HOST"=>"mocky.localhost",
 "HTTP_X_FORWARDED_FOR"=>"127.0.0.1",
 "HTTP_CONNECTION"=>"close",
 "HTTP_ACCEPT_ENCODING"=>"identity",
 "HTTP_AUTHORIZATION"=>"AWS 0PN5J17HBGZHT7JJ3X82:LxGc2PRkTMD2qtjmYRBmVrjJdN8=",
 "HTTP_X_AMZ_DATE"=>"Mon, 28 Nov 2011 01:10:21 +0000",
 "CONTENT_LENGTH"=>"0",
 "GATEWAY_INTERFACE"=>"CGI/1.2",
 "SERVER_PORT"=>"80",
 "SERVER_PROTOCOL"=>"HTTP/1.1",
 "rack.url_scheme"=>"http",
 "SCRIPT_NAME"=>"",
 "REMOTE_ADDR"=>"127.0.0.1",
 "async.callback"=>#<Method: Thin::Connection#post_process>,
 "async.close"=>#<EventMachine::DefaultDeferrable:0x0000010145b328>,
 "smoke.resource_headers"=>
  {"version"=>"HTTP/1.0",
   "x-real-ip"=>"127.0.0.1",
   "host"=>"mocky.localhost",
   "x-forwarded-for"=>"127.0.0.1",
   "connection"=>"close",
   "accept-encoding"=>"identity",
   "authorization"=>"AWS 0PN5J17HBGZHT7JJ3X82:LxGc2PRkTMD2qtjmYRBmVrjJdN8="},
 "smoke.amz_headers"=>{"x-amz-date"=>["Mon, 28 Nov 2011 01:10:21 +0000"]},
 "smoke.bucket"=>"mocky",
 "smoke.path"=>"/",
 "smoke.user"=>
  #<Smoke::Server::User id: 1, username: "mocky", access_id: "0PN5J17HBGZHT7JJ3X82", secret_key: "uV3F3YluFJax1cknvbcGwgjvx4QpvB+leU8dUj2o", display_name: "Mocky User", email: "mocky@dev.null.com", max_buckets: 1, expires_at: 1324785151, is_active: true, role: "admin", enc_password: nil, created_at: "2011-11-26 19:52:31", updated_at: "2011-11-26 19:52:31">,
 "smoke.access_id"=>"0PN5J17HBGZHT7JJ3X82",
 "smoke.request_id"=>"E89082ABE69FEB03326884D0DE83A5BA",
 "smoke.request_token"=>"OeqI4HcravyXDFg9Pbw4c1Vf1vmrvFcZX2Y78xNnG8Bnh7Ug"}
StringToSign: GET



x-amz-date:Mon, 28 Nov 2011 01:10:21 +0000
/mocky/
HTTP/1.1 200 OK
X-Frame-Options: sameorigin
X-XSS-Protection: 1; mode=block
Content-Type: text/html;charset=utf-8
Content-Length: 412
Connection: close
Server: thin 1.3.1 codename Triple Espresso

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://doc.s3.amazonaws.com/2006-03-01">
  <Name>mocky</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>100</MaxKeys>
  <IsTruncated>false</IsTruncated>
	
	
	
  <CommonPrefixes>
    <Prefix>path/to/my/S3/</Prefix>
  </CommonPrefixes>
	
  <CommonPrefixes>
    <Prefix>path/to/my/S3-copy/</Prefix>
  </CommonPrefixes>
	
	
</ListBucketResult>
GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527853&Signature=2S5RHs36FCyKIcgG02FpfpDdR0E%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

!! Unexpected error while processing request: undefined method `split' for nil:NilClass
undefined method `split' for nil:NilClass
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:148:in `credentials'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:152:in `access_id'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:112:in `find_user'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:79:in `initialize'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `new'
	/Users/rlyon/src/ruby/sinatra/smoke_server/lib/smoke/server/auth.rb:11:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:48:in `_call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/rack-1.3.5/lib/rack/lint.rb:36:in `call'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:80:in `block in pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `catch'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:78:in `pre_process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:53:in `process'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/connection.rb:38:in `receive_data'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/backends/base.rb:61:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/server.rb:159:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/controllers/controller.rb:86:in `start'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:185:in `run_command'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/lib/thin/runner.rb:151:in `run!'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/gems/thin-1.3.1/bin/thin:6:in `<top (required)>'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `load'
	/Users/rlyon/.rvm/gems/ruby-1.9.2-p290@smoke_server/bin/thin:19:in `<main>'>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527853&Signature=2S5RHs36FCyKIcgG02FpfpDdR0E%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

HTTP/1.1 400 Bad Request
Content-Length: 191
Content-Type: plain/text
Connection: close
Date: 2011-11-28T01:19:22.000Z
Server: Smoke - Mary Jane
x-amz-request-id: CA519C9AA4F0BA27EA3AE0E681C4E66D
x-amz-id-2: ZOTHRrAVM5BAPdIdfN708kxwFNt3ANQde3VeMiNDV2XrQpcf

<Error>
	<Code>MissingSecurityHeader</Code>
	<Message>Your request was missing a required header.</Message>
	<Resource>/path/to/my/S3/__init__.py</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527853&Signature=2S5RHs36FCyKIcgG02FpfpDdR0E%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

HTTP/1.1 400 Bad Request
Content-Length: 191
Content-Type: plain/text
Connection: close
Date: 2011-11-28T01:23:07.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 67E952C82C5EC78A3FEB055983655CCA
x-amz-id-2: puAupfVRbcVGZ1fsThUJjabg4EtKMeEFmHZGH3Zl5wHcM587

<Error>
	<Code>MissingSecurityHeader</Code>
	<Message>Your request was missing a required header.</Message>
	<Resource>/path/to/my/S3/__init__.py</Resource>
	<RequestId></RequestId>
</Error>
GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527853&Signature=2S5RHs36FCyKIcgG02FpfpDdR0E%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

HTTP/1.1 400 Bad Request
Content-Length: 191
Content-Type: plain/text
Connection: close
Date: 2011-11-28T01:24:20.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 89EE818E648E1361C467E2C733CCA8A4
x-amz-id-2: j1Ri2GJf5viKAgIhadbeNIMFAfHOp2qitQAMqrl83VK4VQj8

<Error>
	<Code>MissingSecurityHeader</Code>
	<Message>Your request was missing a required header.</Message>
	<Resource>/path/to/my/S3/__init__.py</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
>> Writing PID to tmp/pids/thin.4226.pid
>> Thin web server (v1.3.1 codename Triple Espresso)
>> Debugging ON
>> Tracing ON
>> Maximum connections set to 1024
>> Listening on 127.0.0.1:4226, CTRL+C to stop
GET /mocky/path/to/my/S3/__init__.py?AWSAccessKeyId=0PN5J17HBGZHT7JJ3X82&Expires=1322527853&Signature=2S5RHs36FCyKIcgG02FpfpDdR0E%3D HTTP/1.0
X-Real-IP: 127.0.0.1
Host: localhost
X-Forwarded-For: 127.0.0.1
Connection: close
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: sinatra.session=BAh7CkkiD3Nlc3Npb25faWQGOgZFRiJFMDFkODRkYTMxMDBhY2IyNzA3Zjk5%0AYjcwZDg3YmYyNTZkZmFhM2U3MGI0ZDY4ZDdjMTU3ZWI3ZjYyMDYzNTk5NEki%0AFHNpbmF0cmEuc2Vzc2lvbgY7AEZUSSINdXNlcm5hbWUGOwBGSSIIcm9iBjsA%0AVEkiD2FjY2Vzc19rZXkGOwBGSSIJeHh4eAY7AEZJIg9zZWNyZXRfa2V5BjsA%0ARkkiCXh4eHgGOwBG%0A--73e40523ed73eb474bb7040894e0dd8e163ec6cf

HTTP/1.1 400 Bad Request
Content-Length: 191
Content-Type: plain/text
Connection: close
Date: 2011-11-28T01:25:48.000Z
Server: Smoke - Mary Jane
x-amz-request-id: 527FA430FDDBB361BB6917C16AC328F8
x-amz-id-2: U4VkNaBatyuhRtLisxo324cELMEELOuWQ7tXmNgHgjOAgdGs

<Error>
	<Code>MissingSecurityHeader</Code>
	<Message>Your request was missing a required header.</Message>
	<Resource>/path/to/my/S3/__init__.py</Resource>
	<RequestId></RequestId>
</Error>
>> Exiting!
